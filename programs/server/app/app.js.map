{"version":3,"sources":["meteor://ðŸ’»app/lib/1_collections/beta_users.js","meteor://ðŸ’»app/lib/1_collections/buzzy_log.js","meteor://ðŸ’»app/lib/1_collections/errors.js","meteor://ðŸ’»app/lib/1_collections/legacy_stubs.js","meteor://ðŸ’»app/lib/1_collections/user_tags_resource.js","meteor://ðŸ’»app/lib/1_global/1_config.js","meteor://ðŸ’»app/lib/1_global/2_globals.js","meteor://ðŸ’»app/lib/1_global/avatar.js","meteor://ðŸ’»app/lib/1_global/counter.js","meteor://ðŸ’»app/lib/1_global/push.js","meteor://ðŸ’»app/lib/1_global/saml2.js","meteor://ðŸ’»app/lib/3_methods/comments.js","meteor://ðŸ’»app/lib/3_methods/notifications.js","meteor://ðŸ’»app/lib/3_methods/resourceFollowers.js","meteor://ðŸ’»app/lib/3_methods/resources.js","meteor://ðŸ’»app/lib/3_methods/stripe.js","meteor://ðŸ’»app/lib/3_methods/userTags.js","meteor://ðŸ’»app/lib/router.js","meteor://ðŸ’»app/server/lib/ainjectinitial.js","meteor://ðŸ’»app/server/lib/server_routes.js","meteor://ðŸ’»app/server/lib/template-helpers.js","meteor://ðŸ’»app/server/lib/templates.js","meteor://ðŸ’»app/server/collections/registered_users.js","meteor://ðŸ’»app/server/collections/saml_providers.js","meteor://ðŸ’»app/server/methods/admin.js","meteor://ðŸ’»app/server/methods/comments.js","meteor://ðŸ’»app/server/methods/filepicker.js","meteor://ðŸ’»app/server/methods/froala.js","meteor://ðŸ’»app/server/methods/giphy.js","meteor://ðŸ’»app/server/methods/googledrive.js","meteor://ðŸ’»app/server/methods/inbound_email.js","meteor://ðŸ’»app/server/methods/micro_app_data.js","meteor://ðŸ’»app/server/methods/registered_users.js","meteor://ðŸ’»app/server/methods/resources.js","meteor://ðŸ’»app/server/methods/stripe.js","meteor://ðŸ’»app/server/methods/twitter.js","meteor://ðŸ’»app/server/methods/userContacts.js","meteor://ðŸ’»app/server/methods/video_upload.js","meteor://ðŸ’»app/server/methods/vimeo_server.js","meteor://ðŸ’»app/server/methods/watson.js","meteor://ðŸ’»app/server/a_server_routines.js","meteor://ðŸ’»app/server/config.js","meteor://ðŸ’»app/server/fixtures.js","meteor://ðŸ’»app/server/lookbackEmails.js","meteor://ðŸ’»app/server/phantomjs.js","meteor://ðŸ’»app/server/publications.js","meteor://ðŸ’»app/server/push.js","meteor://ðŸ’»app/server/updateComments.js"],"names":["BetaUsers","Meteor","Collection","deny","update","isClient","BuzzyLogData","Mongo","clearLog","resourceID","remove","Errors","clearErrors","seen","clearAllErrors","Images","Attachements","Avatars","UserTagsResources","allow","Resources","ownsDocument","insert","user","Accounts","oauth","registerService","CURRENCY_SYMBOL_MAP","require","startup","Avatar","setOptions","fallbackType","defaultType","defaultImageUrl","generateCSS","Counter","collection","get","name","doc","findOne","count","isServer","cursor","interval","_collectionName","prototype","_getCollectionName","_publishCursor","sub","self","added","handler","setInterval","changed","onStop","clearTimeout","Push","send","userId","notification","methods","addComment","commentAttributes","topLevelParentID","truncatedComment","truncatedText","optCommentExtraContent","optMeteorUserID","optCommentID","optUserToken","BuzzyGlobal","getCurrentUser","resource","resourceParentID","throwError","newCommentID","ObjectID","_str","Error","Users","isStarterTemplate","message","canView","_id","status","commentsApprovalRequired","gIsCommentModerator","toUsers","length","gCOMMENTSTATUS","WAITING_APPROVAL","LIVE","submittedDate","TimeSync","serverTime","Date","getTime","push","comment","_","extend","pick","userID","author","gGetUserNameByID","type","submitted","extraContent","sanitizeHtml","Comments","error","gRESOURCE_STATUS","PUBLISHED","call","sendCommentToAll","commentID","indexOf","$set","err","substring","gTRUNCATE_COMMENT_TEXT","updatedComment","createCustomNotification","action","recipients","emailRecipients","i","toUser","gGetUserforEmail","activity","gGetUserName","Notifications","forUserID","byUserID","target","commenterName","profile","read","console","log","from","actor","displayName","title","text","verb","badge","sound","query","createContactNotification","targetUserID","unfollowResourceByEmail","userEmail","follower","resourceIsFollowed","resourceFollower","ResourceFollowers","$and","reason","updateResourceFollowersCount","addFollower","followerID","removeFollower","toggleFollowResource","resourceQuery","resourceListType","searchQuery","searchUserExpression","RegExp","followResourceArray","find","map","followItem","searchQueryExpression","$or","path","editors","owners","readers","privacy","gPRIVACY","PUBLIC","UNLISTED","$in","resourceAndChildrenQuery","ARCHIVED","DELETED","searchExpression","uniqueUsers","gUniqueUsers","canEdit","userSearchExpression","resourcesCursor","templateQuery","searchString","STRIPE_TOKEN_URI","STRIPE_AUTHORIZE_URI","updateTags","tags","newUserTagsResource","existingUserTagResource","updatedUserTagResource","newUserTagResource","subs","SubsManager","ResourceCommentsController","RouteController","template","increment","gCOMMENT_LIMIT","layoutTemplate","commentLimit","parseInt","params","waitOn","Session","set","hash","limitObj","limit","commentUpLimit","commentDownLimit","data","TemplateListController","gDEFAULT_LIMIT","resourcesLimit","findOptions","sort","gGetSortFilter","chosenSortFilter","resourcesSub","subscribe","resources","pairs","hasMore","nextPath","route","ready","MyTemplateListController","Router","configure","loadingTemplate","redirect","controller","where","req","request","res","response","utm_source","writeHead","utm_campaign","utm_content","end","post","body","email","put","code","clientID","settings","stripe","debug","testClientID","liveClientID","error_description","go","userid","resource_id","comment_id","imgHex","imgBinary","Buffer","app_id","field_id","field_val","useremail","onBeforeAction","getName","result","next","except","configureBodyParsers","Iron","bodyParser","urlencoded","extended","Inject","rawHead","saml2js","bodyparser","connectCookies","saml2","Fiber","cookieParser","getSPOptions","sp_options","entity_id","absoluteUrl","private_key","Assets","getText","certificate","assert_endpoint","org","WebApp","connectHandlers","use","method","run","sp","ServiceProvider","create_metadata","idp_options","SamlProviders","idp","IdentityProvider","create_login_request_url","login_url","request_id","options","request_body","post_assert","saml_response","extra","name_id","session_index","users","toLowerCase","userData","split","channels","channel","gNOTIFICATION_CHANNEL","EMAIL","address","enabled","stampedLoginToken","_generateStampedLoginToken","_insertLoginToken","cookies","token","httpOnly","TemplateHelpers","isImageMime","mimetype","isArray","obj","Array","showUserProfileImage","fromUserID","profileImage","url","getPromoInviteExistingUser","randomNum","gRandomNumForLimit","getPromoInviteNewUser","getPromoCommentExistingUser","getPromoCommentNewUser","getCtaInviteExistingUser","content","bg","border","getCtaInviteNewUser","getCtaTopTitleInvite","getCtaTopTitleUpdate","getRandomNumber50Percent","getRandomNumber33Percent","getRandomNumber25Percent","mainLink","userName","getFirstMobile","commentURL","viewCommentURL","toUserID","viewCommentURLResource","viewURLResource","files","images","embeddedBuzzResources","authors","singleResource","resourceIDs","sortedChildren","leftSortedTree","nodes","childSearchExpression","node","directChildren","DRAFT","rank","union","displayComments","showComments","gCOMMENTSHOW","NONE","hasComments","numberOfComments","getRecentComments","latestComments","reverse","getAppData","sortOrder","currLimit","gMICROAPPDATA_LIMIT","numberOfItems","sortField","whoCanView","gMICROAPP_PERMISSION_WHOCANVIEW","OWNER_AUTHOR_CREATOR","MicroAppData","parentResourceID","sortVal","getAppDataRow","rowID","getAppFieldsNotCollapsed","MicroAppFields","collapseBreakPoint","$ne","gAPPFIELD_COLLAPSE","COLLAPSE","getAppFieldsCollapsed","getAppFieldData","appDataID","fieldID","microField","showFieldVoteOptions","fieldData","option","values","commentReplyAddress","topResourceID","currentResourceID","currentUserID","replyEmailAddress","MAIL_INCOMING_DOMAIN","locationSearch","coords","encodeURI","lat","lng","voteLink","appID","fieldVal","encodeURIComponent","replace","escape","commentLink","completedSetup","context","commentLinkEmbedded","buzzLink","notTopResource","mainBuzzLink","randomOpt","activateLink","createTemplateID","invitingResourceID","getFirstImageinGalleryURL","galleryID","pathRegex","image","gBASICTYPES","FILEPICKER","filePicker","getFileURL","fileID","generatedToken","getURL","fileURL","truncateURL","gMAX_LINK_DISPLAY_LENGTH","unfollowURL","toUserEmail","formatBytes","bytes","k","sizes","Math","floor","pow","toPrecision","$eq","a","b","$gt","dateDiffDays","start","moment","diff","formatDateTime","inputDate","format","formatDate","timezone","gFormatDate","microAppChildren","MicroAppChild","parentAppItemID","parentAppFieldID","Templates","commentNotification","css","helpers","capitalizedName","charAt","toUpperCase","slice","resourceNotification","microAppNotification","inviteEmail","activationEmail","iCalEmail","RegisteredUsers","BuzzyGlobalAdmin","isBuzzyAdmin","BUZZY_ADMIN_IDS","adminRefreshAllMicroAppSortFields","APPLICATION","cleanUpPushTokens","appCollection","buzzOwnerAuthors","pipeline","$match","$project","updated","authorOwners","$setUnion","$size","$sort","results","aggregate","authorOwnersEmails","gGetUserEmails","updatedDate","uniqueUsersCommentsViews","$gte","$lte","$group","CommentsViewed","gGetUserEmail","removeUserFromAllBuzzes","check","String","userRegex","$pull","multi","markCommentDeleted","moderator","markCommentFlagged","FLAGGED","flaggedBy","id","markCommentApproved","updateResourceCommentCount","crypto","Npm","filepickerSignUrl","blob","handle","expiry","gFILEPICKER_EXPIRY","calls","policy","JSON","stringify","toString","signature","createHmac","filepicker","secret","digest","HTTP","key","EXIF","exif","filepickerSignUrlMethod","filepickerSignUrlListMethod","blobsArray","createFilepickerCollage","handleArray","signHandle","expiryMain","signedHandles","gMAX_COLLAGE","listOfSignedHandles","join","collageURL","collageHandle","collagePolicy","collageSignature","signedURL","additionalImageCount","getFroalaKey","process","env","FROALAKEY","giphy","apiKey","https","searchGIPHY","search","imageURLs","item","original","AWS","config","accessKeyId","secretAccessKey","warn","s3","S3","parseEmail","emailContent","sender","toName","recipient","nameArray","senderUserID","resourceToCommentOn","commentExtraContent","gCOMMENTTYPE","URL_LIST","isExternal","linkToURL","openInNewWindow","caption","urlList","truncate","gCOMMENT_TRUNCATE","attachments","EJSON","parse","MAILGUN_KEY","sortedMicroAppData","$limit","registerUser","emailAddress","referringURL","fromURL","RelatedBuzz","Future","Stripe","StripeKey","testSecretKey","liveSecretKey","payment","optReceiptEmail","optMicroAppDataField","recipientID","stripeInfo","stripe_user_id","totalAmount","receiptEmail","applicationFee","ceil","toFixed","roundedAmount","charges","create","amount","currency","source","stripeToken","receipt_email","description","application_fee","statement_descriptor","metadata","user_name","buzzy_user_id","stripe_account","chargeResult","statusCode","currentResource","createAnonymousPaymentNotification","accounts","managed","country","account","clientSecret","grant_type","client_id","client_secret","accessToken","access_token","subscription","subscriber","customers","plan","customer","createAndsubscribeResult","stripeCustomerInfo","teamID","Teams","isAdmin","subscriptions","list","currentSubscriptions","retrieve","subscriptionID","oldSubscriberPlan","TeamMembers","gIsSubScriptionMatch","quantity","newSubs","tempSubscription","ReactiveMethod","invalidateCall","changedMember","userToUpdate","userToUpdateOldSubscription","toPlan","gPLAN_TYPE","BASIC","teamInfo","role","gMEMBER_TYPE","MEMBER","subscriberPlan","gFindSubscription","newQuantity","newSubscription","fromPlan","promoCode","coupon","currentSubscription","userIDs","team","retrieveCustomer","customerID","forceRefresh","temp","retrieveSubscriptions","retrieveSingleSubscription","listPlans","plans","listInvoices","invoices","listUpcomingInvoices","subsID","retrieveUpcoming","retrieveCharge","chargeID","searchContactsTeam","searchText","filter","excludeContacts","member","userContactsIDs","UserContacts","contactID","$nin","contact","participantsWithNames","currentUsersArray","RetryHandler","maxInterval","retry","fn","setTimeout","nextInterval_","reset","getRandomInt_","min","max","random","MediaUploader","noop","file","contentType","upgrade_to_1080","onComplete","onProgress","onError","offset","chunkSize","retryHandler","buildUrl_","fileId","baseUrl","httpMethod","upload","xhr","XMLHttpRequest","open","setRequestHeader","onload","e","responseText","upload_link_secure","ticket_id","complete_url","complete_uri","sendFile_","onUploadError_","bind","onerror","size","addEventListener","onContentUploadSuccess_","onContentUploadError_","resume_","extractRange_","range","getResponseHeader","match","pop","complete_","location","video_id","onCompleteError_","buildQuery_","Object","keys","ConversationV1","MAX_TWEETS","setPersonalityInsights","microAppField","PersonalityInsightsV3","microAppResource","watsonCreds","personalityInsightsCreds","creds","watsonType","gWATSON_SERVICE_TYPES","PERSONALITY_INSIGHTS","personality_insights","username","watsonUserID","password","watsonPassword","version_date","microAppDataItem","collectedText","currentField","isWatsonPersonality","currFieldItem","currentDataItemField","value","fieldType","gAPPFIELDTYPE","TWITTER_FEED","cachedData","getPersonalityInsights","wrapAsync","personalityProfile","compact","consumption_preferences","sendCommentToWatson","sendToWatson","conversation","VERSION_DATE_2017_02_03","input","workspace_id","watsonWorkspaceID","responseComment","watsonContext","output","flattenedText","firstBotUser","$exists","isBot","j","insertExternalData","ExternalData","gGetTweets","Twit","TwitMaker","consumer_key","consumer_secret","access_token_secret","q","statuses","newExternalData","twitter_id","str_id","created_at","TWITTER","getUserTweetsAsText","twitterHandle","getTweets","tweets","screen_name","exclude_replies","trim_user","twitterText","forEach","tweet","in_reply_to_status_id","gGetURLMetaData","tempID","embedType","EMBEDDED_LINK","http","imageIURL","$","cheerio","load","canonicalLink","attr","oembedURL","style","originalLink","audio","site_name","video","tDescription","tTitle","eq","imageURL","gGetURLMetaData2","future","wait","markResourceAndChildrenDeleted","BUZZ","$regex","updateResourceAndChildren","fieldName","newValue","removeResourceAndChildren","MAIL_URL","BrowserPolicy","allowOriginForAll","allowConnectOrigin","allowEval","framing","allowAll","forbidClientAccountCreation","sendVerificationEmail","ServiceConfiguration","configurations","service","clientId","loginStyle","consumerKey","appId","settings_file","BUZZY_SETTINGS_FILE","microsoft","display","scope","onCreateUser","createdAt","services","existingUser","emails","verified","inArrayPosition","emailArray","positionEmail","found","resume","loginTokens","urls","enrollAccount","resetPassword","emailTemplates","siteName","subject","senderName","html","emailHTML","now","tempResourceID","tempResourceID2","tempUserID","reusable","META_FIELD","isBasic","CSSclass","special","avatar","TABLE","EMBED_BUZZ","CONTENT_LAYOUT_ROW","tempResourceIDChild1","CONTENT_LAYOUT_COLUMN","whoCanAdd","gAPPFIELD_INTERACT","OWNERS_AND_AUTHORS","whoCanDelete","RESTCALL","FILEPICKER_GALLERY","tempResourceIDChild2","tempResourceIDChild3","TEXT","IMAGE","VIDEO","BUTTON","PAYMENT","SLIDESHOW","GALLERY","TAG_QUERY","GIPHY","GOOGLE_MAP","GOOGLE_DRIVE","EXTERNAL_SERVICE","Mailer","replyTo","testEmail","logger","addRoutes","init","templates","layout","getContactID","gUSERSTATUS","PENDING","getUserContacts","BUZZY_DEBUG","perfStartTime","contactList","without","concat","perfEndTime","publish","unblock","MicroAppVotes","MicroAppActionRules","microAppDataFieldObj","voteFieldID","fields","publishComposite","children","userContacts","gUSER_CONTACTS_LIMIT","userCursor","userContactsCursor","listIDs","participants","$all","favoriteBuzz","gMAX_HISTORY","recentBuzz","sortOptions","showTemplates","optMicroAppFilter","userSearchCommentsExpression","resourcesList","commentCursor","coreQuery","isAuthorOwner","INLINE","MODAL","ExternalRestData","currSortOrder","queryObj","projection","OWNER_AUTHOR_CREATORS_VIEWERS","viewers","indexOfFilter","findIndex","field","order","sortVal2","sortVal3","searchRegEx","searchField","gSORT_ORDER","ASCENDING","microAppItem","FILE_ATTACHMENTS","buzzID","searchTerm","notificationLimit","notifcation","membership","counterName","pollingInterval","Configure","apn","certData","keyData","passphrase","production","gcm"],"mappings":"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","file":"/app.js","sourcesContent":["/**\n * Created by adamginsburg on 18/07/2014.\n */\nBetaUsers = new Meteor.Collection('betaUsers');\nBetaUsers.deny({update: function () { return false; }});","/**\n * Created by adamginsburg on 22/02/2016.\n */\nif (Meteor.isClient){\n    BuzzyLogData = new Mongo.Collection(null);\n\n\n    BuzzyLogData.clearLog = function(resourceID) {\n        BuzzyLogData.remove({resourceID:resourceID});\n    };\n\n\n\n}","/**\n * Created by adamginsburg on 12/05/2014.\n */\n\nif (Meteor.isClient){\n    Errors = new Mongo.Collection(null);\n\n\n    Errors.clearErrors = function() {\n        Errors.remove({seen: true});\n    };\n    Errors.clearAllErrors = function() {\n        Errors.remove({});\n    };\n\n\n}\n\n","/**\n * Created by adamginsburg on 8/10/2016.\n */\nImages = new Meteor.Collection(null);\nAttachements = new Meteor.Collection(null);\nAvatars = new Meteor.Collection(null);\n","/**\n * Created by adamginsburg on 7/07/2014.\n */\nUserTagsResources = new Meteor.Collection('userTagsResources');\n\n\nUserTagsResources.allow({\n    update: Resources.ownsDocument,\n    remove: Resources.ownsDocument,\n    insert: Meteor.user\n});\n\n","/**\n * Created by adamginsburg on 20/11/2014.\n */\n//FS.debug = true;\nAccounts.oauth.registerService('microsoft');\n\n","/**\n * Created by adamginsburg on 13/06/2014.\n */\n// The application\n\nCURRENCY_SYMBOL_MAP = require('currency-symbol-map');\n\n\n\n\n\n\n\n\n","/**\n * Created by adamginsburg on 5/12/2014.\n */\n\nMeteor.startup(function () {\n    if (Meteor.isClient){\n        Avatar.setOptions({\n            //emailHashProperty: 'email_hash',\n            fallbackType: \"default image\",\n            defaultType: \"intials\",\n            defaultImageUrl: 'https://buzzy.buzz/assets/img/avatar.png',\n            //gravatarDefault: 'identicon'\n            //serverBaseUrl: 'http://example.com'\n            generateCSS: false\n        })\n    }\n\n\n\n\n});\n","/**\n * Created by adamginsburg on 18/02/2016.\n */\nif (Meteor.isClient){\n    Counter = {};\n    Counter.collection = new Meteor.Collection('counters-collection');\n\n    Counter.get = function(name) {\n        var doc = Counter.collection.findOne(name);\n        if(doc) {\n            return doc.count;\n        } else {\n            return 0;\n        }\n    };\n}\n\nif (Meteor.isServer){\n\n    Counter = function (name, cursor, interval) {\n        this.name = name;\n        this.cursor = cursor;\n        this.interval = interval || 1000 * 10;\n        this._collectionName = 'counters-collection';\n    }\n\n// every cursor must provide a collection name via this method\n    Counter.prototype._getCollectionName = function() {\n        return \"counter-\" + this._collectionName;\n    };\n\n// the api to publish\n    Counter.prototype._publishCursor = function (sub) {\n\n        var self = this;\n\n        var count = self.cursor.count();\n        sub.added(self._collectionName, self.name, {count: count});\n\n        var handler = Meteor.setInterval(function () {\n            var count = self.cursor.count();\n            sub.changed(self._collectionName, self.name, {count: count});\n        }, self.interval);\n\n        sub.onStop(function () {\n            Meteor.clearTimeout(handler);\n        });\n    };\n}","/**\n * Created by adamginsburg on 28/12/2014.\n */\nPush.allow({\n    send: function(userId, notification) {\n        // Allow all users to send to everybody - For test only!\n        return true;\n    }\n});\n","/**\n * Created by adamginsburg on 26/05/2016.\n */\n\n\n\n","/**\n * Created by adamginsburg on 15/07/15.\n */\n\nMeteor.methods({\n    // LOOK AT ADDING OPTIONAL USER ID PARAM FOR SERVER SIDE ROUTE - could check for a token or something\n\n    addComment: function (commentAttributes, topLevelParentID, truncatedComment, truncatedText, optCommentExtraContent,optMeteorUserID,optCommentID,optUserToken) {\n\n        var user = BuzzyGlobal.getCurrentUser(optUserToken);\n\n\n        var resource = Resources.findOne(commentAttributes.resourceParentID);\n        if (!resource){\n            BuzzyGlobal.throwError(\"Invalid Resource ID\");\n            return;\n        }\n        var newCommentID = (typeof optCommentID !== \"undefined\" && optCommentID !== null)?optCommentID:new Meteor.Collection.ObjectID()._str;\n        if (!newCommentID){\n            BuzzyGlobal.throwError(\"Invalid Comment ID\");\n        }\n        // ensure the user is logged in\n        if (!user) {\n            if (typeof optMeteorUserID === \"undefined\"){\n                throw new Meteor.Error(411, \"You need to login to make comments\");\n            } else {\n                user = Users.findOne(optMeteorUserID);\n                if (!user) {\n                    throw new Meteor.Error(411, \"Error getting user information\");\n                }\n            }\n\n        };\n\n        if (resource.isStarterTemplate){\n            BuzzyGlobal.throwError(\"Sorry, you can't comment on a template. Please create a new buzz using the template and invite someone and comment from there.\");\n            return;\n        }\n\n\n        if (!commentAttributes.message && (typeof optCommentExtraContent === \"undefined\")) {\n            throw new Meteor.Error(411, 'Please write some content');\n        };\n        if (!resource) {\n            throw new Meteor.Error(411, 'You must comment on something');\n        };\n        if (!Resources.canView(user._id, resource)){\n            BuzzyGlobal.throwError(\"Sorry you cannot comment in this buzz.\")\n        }\n        var status = \"\";\n        if (resource.commentsApprovalRequired && !BuzzyGlobal.gIsCommentModerator(user._id, topLevelParentID) && (typeof commentAttributes.toUsers === \"undefined\" || commentAttributes.toUsers === null || (commentAttributes.toUsers && commentAttributes.toUsers.length === 0))) {\n            status = BuzzyGlobal.gCOMMENTSTATUS.WAITING_APPROVAL;\n        } else {\n            status = BuzzyGlobal.gCOMMENTSTATUS.LIVE\n        }\n\n        var submittedDate;\n        if (Meteor.isClient){\n            submittedDate = TimeSync.serverTime();\n        } else {\n            submittedDate = new Date().getTime();\n        }\n        if (typeof commentAttributes.toUsers !== \"undefined\" && commentAttributes.toUsers){\n            commentAttributes.toUsers.push(user._id);\n        }\n        var comment = _.extend(_.pick(commentAttributes, 'resourceParentID', 'message', 'topLevelParentID', 'toUsers','watsonContext'), {\n            userID: user._id,\n            author: BuzzyGlobal.gGetUserNameByID(user._id),\n            type: 'comment',\n            submitted: submittedDate,\n            status: status,\n            _id: newCommentID\n        });\n        if (typeof optCommentExtraContent != \"undefined\") {\n            comment.extraContent = optCommentExtraContent;\n        }\n\n        if (Meteor.isServer){\n            comment.message = sanitizeHtml(comment.message);\n        }\n        comment._id = Comments.insert(comment, function(error){\n            if (!error){\n\n                if (Meteor.isServer){\n                    if (comment.status === BuzzyGlobal.gCOMMENTSTATUS.LIVE){\n                        if (resource.status === BuzzyGlobal.gRESOURCE_STATUS.PUBLISHED){\n                            Meteor.call(\"createCommentNotification\", comment, topLevelParentID, comment.resourceParentID, truncatedText);\n                            Meteor.call('sendCommentToWatson', comment);\n                        } else {\n                            Meteor.call(\"createCommentNotificationAuthorsAndOwners\", comment, topLevelParentID, comment.resourceParentID, truncatedText)\n                        }\n\n                    } else   if (comment.status === BuzzyGlobal.gCOMMENTSTATUS.WAITING_APPROVAL){\n                        Meteor.call(\"createCommentNotificationAuthorsAndOwners\", comment, topLevelParentID, comment.resourceParentID, truncatedText);\n                    }\n\n\n                    Meteor.call(\"updateUpdatedDate\", topLevelParentID);\n                }\n\n\n            }\n        });\n        // now create a notification, informing the user that there's been a comment\n\n        return comment._id;\n\n    },\n    sendCommentToAll: function(commentID){\n        if (commentID){\n            var comment = Comments.findOne({_id:commentID});\n            if (!comment){\n                BuzzyGlobal.throwError(\"Can't find comment!\");\n            }\n            var resource = Resources.findOne({_id:comment.topLevelParentID})\n            var toUsers = null;\n            if (resource.commentsApprovalRequired && !BuzzyGlobal.gIsCommentModerator(Meteor.userId(), comment.topLevelParentID) ) {\n                comment.status = BuzzyGlobal.gCOMMENTSTATUS.WAITING_APPROVAL;\n                toUsers = comment.toUsers;\n            }\n            if (comment.toUsers.indexOf(Meteor.userId()) !== -1){\n                Comments.update(\n                    {_id:commentID},\n                    {$set:{toUsers:toUsers, status:comment.status}},\n                    function(err){\n                        if (err){\n                            BuzzyGlobal.throwError(err);\n                        } else {\n                            var truncatedText = comment.message.substring(0, BuzzyGlobal.gTRUNCATE_COMMENT_TEXT);\n                            var updatedComment = Comments.findOne({_id:commentID});\n                            Meteor.call(\"createCommentNotification\", updatedComment, updatedComment.topLevelParentID, updatedComment.resourceParentID, truncatedText, comment.toUsers);\n                        }\n                    }\n                )\n            }\n        }\n\n    }\n});\n","/**\n * Created by adamginsburg on 15/07/15.\n */\ncreateCustomNotification = function(resource, action, message, recipients) {\n\n    //var resource = Resources.findOne(comment.resourceParentID);\n    //var resource = Resources.findOne(parentResourceID);// come back to look at children notifications later, for now do for parent\n    var emailRecipients = [];\n    var user = Meteor.user();\n\n    for(i in recipients){\n        var toUser = BuzzyGlobal.gGetUserforEmail(recipients[i]);\n\n\n        var activity = {\n            \"actor\": {\n                \"objectType\": \"person\",\n                \"displayName\": BuzzyGlobal.gGetUserName(user)\n            },\n            \"verb\": action.type,\n            \"object\": {\n                \"objectType\": \"note\",\n                \"content\": message\n            },\n            \"target\": {\n                \"objectType\": \"person\",\n                \"displayName\": BuzzyGlobal.gGetUserName(toUser)\n            }\n        };\n\n        if (toUser && typeof toUser._id !== \"undefined\"){\n            Notifications.insert({\n                forUserID: toUser._id,\n                byUserID: user._id,\n                activity:activity,\n                target:resource._id,\n                //resourceID: resource._id,\n                resourceID: resource._id, // insert for parent not actual resource ID, may need to come back to this\n                commentID: null,\n                commenterName: user.profile.name,\n                read: false,\n                submitted:new Date().getTime()\n            });\n\n            console.log({\n                from: activity.actor.displayName,\n                title: \"Some title\",\n                text: activity.verb  + activity.target.displayName,\n                badge: Meteor.call(\"gNotificationsUnreadForUserID\",toUser._id), // get notifications count for user\n                sound: 'yes',\n                query: {\n                    userId: toUser._id\n                }});\n\n            Push.send({\n                from: activity.actor.displayName,\n                title: \"Some title\",\n                text: activity.verb  + activity.target.displayName,\n                badge: Meteor.call(\"gNotificationsUnreadForUserID\",toUser._id), // get notifications count for user\n                sound: 'yes',\n                query: {\n                    userId: toUser._id\n                }\n\n            });\n\n        } else {\n            if ( typeof toUser._id !== \"undefined\"){\n                emailRecipients.push(recipients[i]);\n            }\n\n\n        }\n        /*  if (emailRecipients) {\n         //console.log(\"about to call sendEmailNotifications:\" + emailRecipients + \" url: \" + Meteor.absoluteUrl());\n         Meteor.call('sendExternalEmailNotifications', emailRecipients, message, resource._id, function (error, id) {\n         if (error) {\n         // display the error to the user\n         BuzzyGlobal.throwError(error.reason);\n         }\n         });\n\n         }*/\n        return;\n\n\n    }\n\n\n\n};\n\ncreateContactNotification = function(targetUserID) {\n\n    //var resource = Resources.findOne(comment.resourceParentID);\n    //var resource = Resources.findOne(parentResourceID);// come back to look at children notifications later, for now do for parent\n    var emailRecipients = [];\n    var user = Meteor.user();\n    if (!user) {\n        BuzzyGlobal.throwError(\"No user found\");\n    }\n\n\n    var activity = {\n        \"actor\": {\n            \"objectType\": \"person\",\n            \"displayName\": BuzzyGlobal.gGetUserName(user)\n        },\n        \"verb\": \"request-contact\",\n        \"object\": {\n            \"objectType\": \"person\",\n            \"displayName\": BuzzyGlobal.gGetUserNameByID(targetUserID),\n            \"objectUserID\": targetUserID\n        }\n    };\n\n\n\n\n    if (targetUserID) {\n        Notifications.insert({\n            forUserID: targetUserID,\n            byUserID: user._id,\n            activity: activity,\n            target: null,\n            //resourceID: resource._id,\n            resourceID: null, // insert for parent not actual resource ID, may need to come back to this\n            commentID: null,\n            commenterName: user.profile.name,\n            read: false,\n            submitted: new Date().getTime()\n        });\n\n        Notifications.insert({\n            forUserID: user._id,\n            byUserID: user._id,\n            activity: activity,\n            target: null,\n            //resourceID: resource._id,\n            resourceID: null, // insert for parent not actual resource ID, may need to come back to this\n            commentID: null,\n            commenterName: user.profile.name,\n            read: true,\n            submitted: new Date().getTime()\n        });\n\n    }\n\n\n\n    return;\n\n\n\n};","/**\n * Created by adamginsburg on 15/07/15.\n */\nMeteor.methods({\n    unfollowResourceByEmail: function(userEmail, resourceID) {\n        // need to add some token as well.\n        if (userEmail && resourceID){\n            var follower = BuzzyGlobal.gGetUserforEmail(userEmail);\n            if (typeof  follower !== \"undefined\"){\n                if (Resources.resourceIsFollowed (follower._id,resourceID)){\n                    console.log(\"removing follower:resource \" + follower._id + \":\" + resourceID);\n                    var resourceFollower = ResourceFollowers.remove({$and:[{resourceID:resourceID},{userID:follower._id}]}, function(error){\n                        if (error){\n                            throw new Meteor.Error(422, error.reason);\n                        } else {\n                            ResourceFollowers.updateResourceFollowersCount(resourceID);\n                        }\n                    });\n\n                }\n            } else {\n                BuzzyGlobal.throwError(\"invalid user\")\n            }\n\n        } else {\n            BuzzyGlobal.throwError(\"invalid params\")\n        }\n\n\n    },\n    addFollower: function(resourceID,followerID) {\n        var user = Meteor.user();\n        // ensure the user is logged in\n        if (!user)\n            BuzzyGlobal.throwError(\"You need to login to follow\");\n        if (!resourceID)\n            BuzzyGlobal.throwError(\"Invalid Resource ID\");\n\n        var resource = Resources.findOne({_id:resourceID});\n\n        if (resource && !Resources.resourceIsFollowed (followerID,resourceID) && Resources.canView(user._id, resource)){\n\n\n            var resourceFollower =  {\n                userID: followerID,\n                resourceID: resourceID,\n                submitted: new Date().getTime()\n            };\n\n            var resourceFollower = ResourceFollowers.insert(resourceFollower, function(error){\n                if (error){\n                    BuzzyGlobal.throwError(error.reason)\n                } else {\n                    ResourceFollowers.updateResourceFollowersCount(resourceID);\n                }\n            });\n\n\n        }\n\n\n        return true;\n    },\n    removeFollower: function(resourceID,followerID) {\n        var user = Meteor.user();\n        // ensure the user is logged in\n\n        if (!user)\n            throw new Meteor.Error(401, \"You need to login to follow\");\n\n        if (Resources.resourceIsFollowed (followerID,resourceID)){\n            var resourceFollower = ResourceFollowers.remove({$and:[{resourceID:resourceID},{userID:followerID}]}, function(error){\n                console.log(\"removeFollower:\", error);\n                if (error){\n                    throw new Meteor.Error(422, error.reason);\n                } else {\n                    ResourceFollowers.updateResourceFollowersCount(resourceID);\n                }\n            });\n\n        }\n        return true;\n    },\n\n    toggleFollowResource: function(resourceID) {\n        var user = Meteor.user();\n        // ensure the user is logged in\n        if (!user)\n            throw new Meteor.Error(401, \"You need to login to follow\");\n\n        if (!Resources.resourceIsFollowed (user._id,resourceID)){\n            var resourceFollower =  {\n                userID: user._id,\n                resourceID: resourceID,\n                submitted: new Date().getTime()\n            };\n\n            var resourceFollower = ResourceFollowers.insert(resourceFollower, function(error){\n                if (error){\n                    throw new Meteor.Error(422, error.reason);\n                } else {\n                    ResourceFollowers.updateResourceFollowersCount(resourceID);\n                }\n            });\n\n\n\n        }\n        else {\n            ResourceFollowers.remove({$and:[{resourceID:resourceID},{userID:user._id}]});\n            ResourceFollowers.updateResourceFollowersCount(resourceID, function(error){\n                if (error){\n                    throw new Meteor.Error(422, error.reason);\n                } else {\n                    ResourceFollowers.updateResourceFollowersCount(resourceID);\n                }\n            });\n        }\n\n        return true;\n    }\n\n});","/**\n * Created by adamginsburg on 15/07/15.\n */\nresourceQuery = function(userID, resourceListType, searchQuery) {\n    var searchUserExpression = new RegExp(userID);\n    var followResourceArray = ResourceFollowers.find({userID:userID}).map(function(followItem){\n        return followItem.resourceID;\n    })\n    if  (typeof searchQuery != \"undefined\" && searchQuery) {\n\n        var searchQueryExpression = new RegExp(searchQuery, \"i\");\n        return  {$or:[\n            {$and:[\n                {title:searchQueryExpression},\n                {path:null},\n                {type:\"buzz\"},\n                {isStarterTemplate:false},\n                {$or:[\n                    {editors:searchUserExpression},\n                    {owners:searchUserExpression}\n                ]},\n                {$or:[{status:'draft'},{status:'published'}]},\n\n            ]},\n            {$and:[\n                {title:searchQueryExpression},\n                {path:null},\n                {type:\"buzz\"},\n                {isStarterTemplate:false},\n                {readers:searchUserExpression},\n                {status:'published'}\n            ]},\n            {$and:[\n                {title:searchQueryExpression},\n                {path:null},\n                {type:\"buzz\"},\n                {$or:[{privacy:BuzzyGlobal.gPRIVACY.PUBLIC},{privacy:BuzzyGlobal.gPRIVACY.UNLISTED}]},\n                {isStarterTemplate:false},\n                {status:'published'},\n                {_id:{$in:followResourceArray}}\n            ]}\n        ]};\n    } else {\n\n        return  {$or:[\n            {$and:[\n                {path:null},\n                {type:\"buzz\"},\n                {isStarterTemplate:false},\n                {$or:[\n                    {editors:searchUserExpression},\n                    {owners:searchUserExpression}\n                ]},\n                {$or:[{status:'draft'},{status:'published'}]},\n\n            ]},\n            {$and:[\n                {path:null},\n                {type:\"buzz\"},\n                {isStarterTemplate:false},\n                {readers:searchUserExpression},\n                {status:'published'}\n            ]},\n            {$and:[\n                {path:null},\n                {type:\"buzz\"},\n                {isStarterTemplate:false},\n                {status:'published'},\n                {$or:[{privacy:BuzzyGlobal.gPRIVACY.PUBLIC},{privacy:BuzzyGlobal.gPRIVACY.UNLISTED}]},\n                {_id:{$in:followResourceArray}}\n            ]}\n        ]};\n\n    }\n\n\n\n}\n\nresourceAndChildrenQuery = function(resourceID){\n    self = this;\n    var userID = Meteor.userId;\n\n    var resource = Resources.findOne({_id:resourceID});\n    //var resource = Resources.findOne({_id:resourceID});\n    if (!resource) {\n        console.log(\"error 1\")\n        //throw new Meteor.Error(\"no-resource 1\",\"Can't find resource\");\n        return null;\n\n    }\n\n    if (resource.status === BuzzyGlobal.gRESOURCE_STATUS.ARCHIVED || resource.status === BuzzyGlobal.gRESOURCE_STATUS.DELETED){\n        console.log(\"error 2\")\n        //throw new Meteor.Error(\"no-resource 2\",\"Can't find resource\");\n\n        return null;\n\n    }\n\n    var searchExpression = new RegExp(\"^,\"+ resourceID +\",\");\n\n\n    if (resource.privacy === BuzzyGlobal.gPRIVACY.PUBLIC || resource.privacy === BuzzyGlobal.gPRIVACY.UNLISTED){\n        var uniqueUsers = BuzzyGlobal.gUniqueUsers(resource);\n        if (Resources.canEdit(userID,resource)){\n            return [\n\n                Resources.find(\n                    {$and:[\n                        {$or:[\n                            {status:'published'},\n                            {status:'draft'}\n                        ]},\n                        {$or:[\n                            {_id:resourceID},\n                            {path:searchExpression}\n                        ]}\n\n                    ]}\n                ),\n            ]\n\n\n        } else {\n            return [\n\n                Resources.find(\n                    {$and:[\n                        {status:'published'},\n                        {$or:[\n                            {_id:resourceID},\n                            {path:searchExpression}\n                        ]}\n\n                    ]}\n                ),\n            ]\n\n\n        }\n\n    } else {\n        if (userID){\n            console.log(\"HERE 1\")\n            var userSearchExpression = new RegExp(userID);\n            var resourcesCursor = Resources.find(\n                {$and:[\n                    {$or:[\n                        {_id:resourceID},\n                        {path:searchExpression}\n                    ]},\n                    {$or:[{userID: userID},\n                        {readers:userSearchExpression},\n                        {editors:userSearchExpression},\n                        {owners:userSearchExpression},\n                    ]},\n                    {$or:[{status:'draft'},{status:'published'}]},\n\n                ]}\n            );\n            console.log(\"HERE 2\", resourcesCursor);\n            return resourcesCursor;\n\n\n        } else {\n            throw new Meteor.Error(\"no-resource 3\",\"Can't find resource\");\n\n            return null;\n\n        }\n\n    }\n}\n\ntemplateQuery = function(userID, resourceListType, searchString) {\n    var searchExpression = new RegExp(userID);\n    console.log(\"templateQuery searchExpression:\" + searchExpression);\n    switch (resourceListType){\n\n        case 'my':\n            console.log(\"my\");\n            if (searchString){\n                var searchQueryExpression = new RegExp(searchString, \"i\");\n                return {$and:[\n                    {path:null},\n                    {type:\"buzz\"},\n                    {isStarterTemplate:true},\n                    {$or:[{status:'draft'},{status:'published'},{status:'unlisted'}]},\n                    {$or:[\n                        {userID: userID},\n                        {editors:searchExpression},\n                        {readers:searchExpression},\n                        {owners:searchExpression}\n                    ]},\n                    {title:searchQueryExpression}\n                ]};\n\n\n            } else {\n\n                return {$and:[\n                    {path:null},\n                    {type:\"buzz\"},\n                    {isStarterTemplate:true},\n                    {$or:[{status:'draft'},{status:'published'},{status:'unlisted'}]},\n                    {$or:[\n                        {userID: userID},\n                        {editors:searchExpression},\n                        {readers:searchExpression},\n                        {owners:searchExpression}\n                    ]},\n                ]};\n\n            }\n\n\n            break;\n\n\n        default:\n\n            console.log(\"all\")\n            if (searchString){\n                var searchQueryExpression = new RegExp(searchString, \"i\");\n                return  {$or:[\n                    {$and:[\n                        {path:null},\n                        {type:\"buzz\"},\n                        {isStarterTemplate:true},\n                        {$or:[\n                            {userID: userID},\n                            {editors:searchExpression},\n                            {readers:searchExpression},\n                            {owners:searchExpression}\n                        ]},\n                        {status:\"published\"},\n                        {privacy:\"private\"},\n                        {title:searchQueryExpression}\n                    ]},\n                    {$and:[\n                        {path:null},\n                        {type:\"buzz\"},\n                        {isStarterTemplate:true},\n\n                        {status:\"published\"},\n                        {privacy:\"public\"},\n                        {title:searchQueryExpression}\n                    ]}\n                ]};\n\n            } else {\n                return  {$or:[\n                    {$and:[\n                        {path:null},\n                        {type:\"buzz\"},\n                        {isStarterTemplate:true},\n                        {$or:[\n                            {userID: userID},\n                            {editors:searchExpression},\n                            {readers:searchExpression},\n                            {owners:searchExpression}\n                        ]},\n                        {status:\"published\"},\n                        {privacy:\"private\"}\n                    ]},\n                    {$and:[\n                        {path:null},\n                        {type:\"buzz\"},\n                        {isStarterTemplate:true},\n\n                        {status:\"published\"},\n                        {privacy:\"public\"}\n                    ]}\n                ]};\n            }\n\n            break;\n\n    }\n};\n","/**\n * Created by adamginsburg on 21/03/2016.\n */\nSTRIPE_TOKEN_URI = 'https://connect.stripe.com/oauth/token';\nSTRIPE_AUTHORIZE_URI = 'https://connect.stripe.com/oauth/authorize';\n","/**\n * Created by adamginsburg on 15/07/15.\n */\nMeteor.methods({\n\n    updateTags: function(resourceID,tags) {\n        //var user = Meteor.user();\n        // ensure the user is logged in\n        console.log(\"Add Tag resID:\" + resourceID);\n        if (!Meteor.userId())\n            throw new Meteor.Error(401, \"You need to login to tag\");\n\n\n        var newUserTagsResource = {\n            resourceID: resourceID,\n            userID:Meteor.userId(),\n            tags: tags\n        };\n\n        existingUserTagResource = UserTagsResources.findOne(\n            {$and:[{resourceID:resourceID},{userID:Meteor.userId()}]});\n\n        if (existingUserTagResource) {\n            var updatedUserTagResource = UserTagsResources.update(existingUserTagResource._id,newUserTagsResource);\n            console.log(\"1 Add Tag resID:\" + resourceID);\n\n        } else {\n            var newUserTagResource = UserTagsResources.insert(newUserTagsResource);\n            console.log(\" 2 Add Tag resID:\" + resourceID);\n        }\n\n\n        return true;\n    },\n\n\n\n});","/**\n * Created by adamginsburg on 15/09/2014.\n */\nvar subs = new SubsManager();\n\n\nResourceCommentsController = RouteController.extend({\n    template: 'resourcePage',\n    increment: BuzzyGlobal.gCOMMENT_LIMIT,\n    layoutTemplate: function() {\n        return Meteor.userId() ? 'layoutApp' : 'layoutPublicResource'\n    },\n    commentLimit: function(){\n        return parseInt(this.params.commentLimit) || this.increment;\n    },\n\n\n    waitOn: function() {\n\n        Session.set('currentResourceID',this.params._id);\n        Session.set('topLevelParentID',this.params._id);\n        Session.set('currentHash', this.params.hash);\n        Session.set('query',this.params.query);\n        Session.set(\"resourceChangeList\",[]);\n\n\n        var limitObj = {};\n        if (this.params.resourceID){\n            //limitObj =  {resourceID: this.params.resourceID, limit: this.commentLimit()};\n            limitObj =  {\n                resourceID: this.params.resourceID,\n                limit: this.commentLimit(),\n                commentUpLimit:BuzzyGlobal.gCOMMENT_LIMIT,\n                commentDownLimit:BuzzyGlobal.gCOMMENT_LIMIT\n            };\n            Session.set(\"currentCommentLimit\", limitObj);\n\n        } else {\n            limitObj =  {\n                resourceID: null,\n                limit: this.commentLimit(),\n                commentUpLimit:BuzzyGlobal.gCOMMENT_LIMIT,\n                commentDownLimit:BuzzyGlobal.gCOMMENT_LIMIT\n            };\n            Session.set(\"currentCommentLimit\", limitObj);\n\n        };\n\n\n\n\n    },\n    data: function() {\n        return  Resources.findOne(this.params._id);\n    },\n\n});\n\n\nTemplateListController = RouteController.extend({\n    template: 'wizChooseTemplate',\n    increment: BuzzyGlobal.gDEFAULT_LIMIT,\n\n    resourcesLimit: function() {\n        console.log(\"this.params.resourcesLimit:\" + this.params.resourcesLimit )\n        return parseInt(this.params.resourcesLimit) || this.increment;\n    },\n    findOptions: function() {\n        //console.log(\"sort params:\" + Session.get('resourceSort') + \" sort filer:\" + _.pairs(BuzzyGlobal.gGetSortFilter(Session.get('resourceSort'))));\n        return {sort:BuzzyGlobal.gGetSortFilter(Session.get('resourceSort')),limit:this.resourcesLimit()};\n    },\n    waitOn: function() {\n        //this.resourcesSub = Meteor.subscribe('resources', this.findOptions());\n        //Session.set('resourceListType','all');\n\n\n        var chosenSortFilter = Session.get('resourceSort')\n\n\n        if (chosenSortFilter === \"undefined\" || (!chosenSortFilter)){\n            chosenSortFilter = 'recently-updated'\n\n        }\n        this.resourcesSub = subs.subscribe('resourcesAndImages', this.findOptions(),\"\", Session.get('resourceListType'), true);\n        // TEMP NEED TO CHANGE TO DIFF PUB subs.subscribe('images');\n        subs.subscribe('resourceFollowersByUser',Meteor.userId());\n    },\n    resources: function() {\n        console.log(\"choose template in resources function:\" + _.pairs(this.findOptions()))\n        return Resources.find(templateQuery(Meteor.userId(), Session.get('resourceListType')), this.findOptions());\n    },\n    data: function() {\n        var hasMore = this.resources().count() === this.resourcesLimit();\n        var nextPath = this.route.path({resourcesLimit: this.resourcesLimit() + this.increment});\n\n        return {\n            resources: this.resources(),\n            ready: this.resourcesSub.ready,\n            nextPath: hasMore ? nextPath : null\n        };\n    },\n\n});\n\nMyTemplateListController = RouteController.extend({\n    template: 'resourceMyTemplateList',\n    increment: BuzzyGlobal.gDEFAULT_LIMIT,\n\n    resourcesLimit: function() {\n        console.log(\"this.params.resourcesLimit:\" + this.params.resourcesLimit )\n        return parseInt(this.params.resourcesLimit) || this.increment;\n    },\n    findOptions: function() {\n        //console.log(\"sort params:\" + Session.get('resourceSort') + \" sort filer:\" + _.pairs(BuzzyGlobal.gGetSortFilter(Session.get('resourceSort'))));\n        return {sort:BuzzyGlobal.gGetSortFilter(Session.get('resourceSort')),limit:this.resourcesLimit()};\n    },\n    waitOn: function() {\n        //this.resourcesSub = Meteor.subscribe('resources', this.findOptions());\n        //Session.set('resourceListType','all');\n\n\n        var chosenSortFilter = Session.get('resourceSort')\n\n\n        if (chosenSortFilter === \"undefined\" || (!chosenSortFilter)){\n            chosenSortFilter = 'recently-updated'\n\n        }\n        this.resourcesSub = subs.subscribe('resourcesAndImages', this.findOptions(),\"\", \"my\",true);\n        // TEMP NEED TO CHANGE TO DIFF PUB subs.subscribe('images');\n        subs.subscribe('resourceFollowersByUser',Meteor.userId());\n    },\n    resources: function() {\n        console.log(\"choose template in resources function:\" + _.pairs(this.findOptions()))\n        return Resources.find(templateQuery(Meteor.userId(),\"my\"), this.findOptions());\n    },\n    data: function() {\n        var hasMore = this.resources().count() === this.resourcesLimit();\n        var nextPath = this.route.path({resourcesLimit: this.resourcesLimit() + this.increment});\n\n        return {\n            resources: this.resources(),\n            ready: this.resourcesSub.ready,\n            nextPath: hasMore ? nextPath : null\n        };\n    },\n\n});\n\n\nRouter.configure({\n    layoutTemplate: 'layoutApp',\n    loadingTemplate: 'loading',\n    waitOn: function() {\n        //console.log(\"Waiting for initial subs for userid:\" + Meteor.userId());\n        //Session.set('resourcePageLimit',BuzzyGlobal.gDEFAULT_LIMIT);\n        //console.log(\"WaitOn resourcePageLImit\", Session.get('resourcePageLimit'));\n        if (Meteor.userId()){\n            return [\n\n                subs.subscribe('notifications', Session.get('activitySearch'),Session.get('activityLimit')),\n                //subs.subscribe('users'),\n\n                subs.subscribe('resourcesForAddition'),\n\n\n\n                //subs.subscribe('singleUser'),\n                subs.subscribe('resourceFollowersByUser', Meteor.userId()),\n                subs.subscribe(\"myUser\")\n\n            ];\n        } else {\n            return [\n\n                subs.subscribe('resourcesForAddition'),\n\n            ];\n        }\n\n\n\n    }\n});\n\nRouter.route('/', function () {\n    this.redirect('/l');\n});\n\n\n\n\nRouter.route('/l/', {\n\n    name: 'resourceList'\n});\n\nRouter.route('/unfollowed', {\n\n    name: 'regoLandingUnsubscribe',\n    layoutTemplate: 'layoutPublic'\n});\nRouter.route('/voted', {\n\n    name: 'appVoted',\n    layoutTemplate: 'layoutPublic'\n});\n\nRouter.route('/my-templates/:resourcesLimit?', {\n\n    name: 'resourceMyTemplateList',\n    controller: 'MyTemplateListController'\n});\n\n\nRouter.route('/wizard', {\n    name: 'wizardLanding',\n    waitOn: function() {\n        subs.subscribe('templateResources')\n    }\n\n\n});\n\n\n\nRouter.route('/go/:_id?/:resourceID?/:commentLimit?', {\n    name: 'resourcePage',\n    controller: 'ResourceCommentsController'\n});\n\nRouter.route('/profile/:_id', {\n    name: 'userProfile'\n});\n\nRouter.route('/team/:_id', {\n    name: 'team'\n});\n\nRouter.route('/account/', {\n    name: 'userAccount'\n    \n});\n\nRouter.route('/admin/', {\n    name: 'admin'\n\n});\n\nRouter.route('/my-contacts/', {\n    name: 'userMyContacts',\n//        onBeforeAction: filters.authenticate,\n\n    waitOn: function() {\n\n\n\n    },\n    data: function() {\n\n        return Users.findOne(Meteor.userId);\n    },\n\n});\n\nRouter.route('/licensepage/', {\n    name: 'licensePage',\n});\n\n\n\nRouter.route('/start', {\n    name: 'start',\n    layoutTemplate: 'layoutPublic'\n\n});\nRouter.route('/sign-in', {\n    name: 'signIn',\n    layoutTemplate: 'layoutPublic'\n\n});\nRouter.route('/forgot-pass', {\n    name: 'forgotPass',\n    layoutTemplate: 'layoutPublic'\n\n});\n\nRouter.route('/createpassword/:_id', {\n    name: 'appCreatePassword',\n    layoutTemplate: 'layoutPublic'\n\n});\nRouter.route('/regopassword/:_id', {\n    name: 'appRegisterPassword',\n    layoutTemplate: 'layoutPublic'\n\n});\n\nRouter.route('/rego', {\n    name: 'rego',\n    layoutTemplate: 'layoutPublic'\n\n});\n\nRouter.route('/license', {\n    name: 'license',\n    layoutTemplate: 'layoutAppBlankHeader'\n\n});\n\nRouter.route('/initialsetup', {\n    name: 'appInitialSetup',\n    layoutTemplate: 'layoutAppBlankHeader',\n    data: function() {\n        return Meteor.user();\n\n    },\n\n});\n\nRouter.route('/licenseviewonly', {\n    name: 'licenseViewOnly',\n    layoutTemplate: 'layoutPublic'\n\n});\n\n\nRouter.route('/noaccess', {\n    name: 'noAccess',\n    layoutTemplate: 'layoutApp'\n\n\n});\n\nRouter.route('/rego-thanks', {\n    name: 'regoThanksStatic',\n    layoutTemplate: 'layoutAppBlankHeader'\n\n\n});\n\n\n\nRouter.route('/hero', { where: 'server' })\n    .get(function () {\n        var req = this.request;\n        var res = this.response;\n        var query = req.query;\n        if (query && typeof query.utm_source !== \"undefined\"){\n            this.response.writeHead(301, {'Location': '/s/hero.html?utm_source=' + query.utm_source + \"&utm_campaign=\" + query.utm_campaign + \"&utm_content=\" + query.utm_content });\n        } else {\n            this.response.writeHead(301, {'Location': '/s/hero.html?utm_source=direct&utm_campaign=hero&utm_content=hero1' });\n\n        }\n        this.response.end();\n    });\nRouter.route('/register', { where: 'server' })\n    .get(function () {\n        var req = this.request;\n        var res = this.response;\n\n        res.end('hello from the server\\n')\n        // GET /webhooks/stripe\n    })\n    .post(function () {\n\n        var req = this.request;\n        var res = this.response;\n        var post = req.body;\n\n\n        Meteor.call(\"postRegisterEmail\",post.email, post.template);\n\n        this.response.writeHead(301, {'Location': '/rego-thanks?email=' + post.email});\n        this.response.end();\n        /*res.writeHead(200, {'Content-Type': 'text/plain'})\n        res.end('hi from the server\\n')\n*/\n\n\n    })\n    .put(function () {\n        console.log(\"IN PUT\")\n\n        // PUT /webhooks/stripe\n    });\nRouter.route('/stripeauthorize', { where: 'server' })\n    .get(function () {\n        var req = this.request;\n        var res = this.response;\n        var query = req.query;\n        if (query && typeof query.code !== \"undefined\"){\n            var clientID = Meteor.settings.public.stripe.debug?Meteor.settings.public.stripe.testClientID:Meteor.settings.public.stripe.liveClientID;\n            console.log(\"query.code:\" + query.code);\n            this.response.writeHead(301, {'Location': STRIPE_AUTHORIZE_URI + \"?response_type=code&scope=read_write&client_id=\"+ clientID});\n        } else if (query && typeof query.error !== \"undefined\") {\n            res.writeHead(200, {'Content-Type': 'text/plain'})\n            console.log(\"query.error:\", query.error, query.error_description );\n            res.end(\"query.error:\" + query.error + query.error_description);\n        }\n        this.response.end();\n    });\n\n/*Router.route('/stripecallback', { where: 'server' })\n    .get(function () {\n        var self = this;\n        var req = this.request;\n        var res = this.response;\n        var query = req.query;\n        if (query && typeof query.code !== \"undefined\"){\n            var clientID = Meteor.settings.public.stripe.debug?Meteor.settings.public.stripe.testClientID:Meteor.settings.public.stripe.liveClientID;\n\n            HTTP.call(\"POST\", STRIPE_TOKEN_URI, {\n                    data: {\n                        //loginToken: \"A2VWvjjJ2PM-aNZvP3fng8OmDr6_o2aNFvosMMX7yV7\",\n                        grant_type: 'authorization_code',\n                        client_id: clientID,\n                        code: query.code ,\n                        client_secret: 'sk_test_K1uIbqws6DAfYZsnYEWR9EB6'\n                    }\n                },\n                function (err, result) {\n                    console.log(\"POST RESULT userID:\", self.userId, result, \" ERR:\", err)\n                    if (err) {\n                        console.log({message: 'Test failed error.'});\n                    } else {\n                        var accessToken =result.data.access_token;\n\n                        // Do something with your accessToken\n\n                        // For demo's sake, output in response:\n                        res.end({ 'Your Token': accessToken });\n\n                    }\n\n\n                })\n\n        } else if (query && typeof query.error !== \"undefined\") {\n            res.writeHead(200, {'Content-Type': 'text/plain'})\n            console.log(\"query.error:\", query.error, query.error_description );\n            res.end(\"query.error:\" + query.error + query.error_description);\n        }\n        this.response.end();\n    });*/\nRouter.route('/stripecallback2', {\n    name: 'stripeCallback2',\n    layoutTemplate: 'layoutPublic',\n    waitOn: function() {\n        var self = this;\n        var query = self.params.query;\n        if (Meteor.userId() && query && typeof query.code !== \"undefined\"){\n\n            Meteor.call(\"updateStripeInfo\", query.code, function(err){\n                if (err){\n                    BuzzyGlobal.throwError(err);\n                } else {\n                    Router.go('userProfile',{_id:Meteor.userId()});\n                }\n            })\n\n        } else if (query && typeof query.error !== \"undefined\") {\n            console.log(\"query.error:\", query.error, query.error_description );\n        }\n    }\n},{ where: 'server' });\n\nRouter.route('/pixel/:userid/:resource_id/:comment_id',function(){\n\n\n    Meteor.call(\"viewedComment\",this.params.userid, this.params.resource_id,this.params.comment_id);\n\n    var req = this.request;\n    var res = this.response;\n\n\n    var imgHex = '47494638396101000100800000dbdfef00000021f90401000000002c00000000010001000002024401003b';\n    var imgBinary = new Buffer(imgHex, 'hex');\n    res.writeHead(200, {'Content-Type': 'image/gif' });\n    res.end(imgBinary, 'binary');\n},\n{\n    where: 'server',\n    name: 'viewComment'\n});\nRouter.route('/pixelr/:userid/:resource_id',function(){\n\n        Meteor.call(\"resourceTrackUserView\",this.params.userid, this.params.resource_id);\n    /*\n    if (typeof this.params.userid !== \"undefined\" && this.params.userid && typeof this.params.resource_id !== \"undefined\" && this.params.resource_id){\n        Meteor.call(\"resourceTrackUserView\",this.params.userid, this.params.resource_id);\n    }*/\n\n    var req = this.request;\n    var res = this.response;\n\n\n    var imgHex = '47494638396101000100800000dbdfef00000021f90401000000002c00000000010001000002024401003b';\n    var imgBinary = new Buffer(imgHex, 'hex');\n    res.writeHead(200, {'Content-Type': 'image/gif' });\n    res.end(imgBinary, 'binary');\n},\n{\n    where: 'server',\n    name: 'viewResourcePixel'\n});\n\nRouter.route('/vote/:userid/:resource_id/:app_id/:field_id/:field_val',function(){\n\n    console.log(\"here 1\",this.params.userid, this.params.resource_id,this.params.app_id, this.params.field_id, this.params.field_val);\n    Meteor.call(\"microAppVoteUser\",this.params.userid, this.params.resource_id,this.params.app_id, this.params.field_id, this.params.field_val);\n    var req = this.request;\n    var res = this.response;\n\n    this.response.writeHead(301, {'Location': '/voted'});\n    this.response.end();\n},\n{\n    where: 'server',\n    name: 'vote'\n});\n\nRouter.route('/unfollow/:useremail/:resource_id', function(){\n\n        console.log(\"here 2\")\n        Meteor.call(\"unfollowResourceByEmail\",this.params.useremail, this.params.resource_id);\n\n        this.response.writeHead(301, {'Location': '/unfollowed'});\n        this.response.end();\n        //Router.go('regoLandingUnsubscribe');\n\n    },\n    {\n        where: 'server',\n        name: 'unfollow'\n    });\n\n\n\n// Landing - not sure of context here, think Adam uses this\nRouter.route('/landing/:template', {\n    name: 'landing',\n    layoutTemplate: 'layoutPublic',\n    waitOn: function() {\n        Session.set('currentTemplate', this.params.template)\n    }\n});\n\n\n// Dave scratchpad - signed in app template\nRouter.route('/scratchpad/:template', {\n    name: 'scratchpad',\n    layoutTemplate: 'layout_dave_app',\n    waitOn: function() {\n        Session.set('currentTemplate', this.params.template)\n    }\n});\n\n// Dave scratchpad - signed in app, but no nav - use for modals where we can't do anything else until we make a decision eg terms accept\nRouter.route('/scratchpadblank/:template', {\n    name: 'scratchpadblank',\n    layoutTemplate: 'layout_dave_blank',\n    waitOn: function() {\n        Session.set('currentTemplate', this.params.template)\n    }\n});\n\n// Dave scratchpad - public landing/nav template\nRouter.route('/scratchpadpublic/:template', {\n    name: 'scratchpadpublic',\n    layoutTemplate: 'layout_dave_public',\n    waitOn: function() {\n        Session.set('currentTemplate', this.params.template)\n    }\n});\n\n// Dave scratchpad - one-off pages not using scratchpad layout\nRouter.route('/dave/landing', {\n    name: 'layout_dave_sample_landing',\n    layoutTemplate: 'layout_dave_sample_landing',\n});\nRouter.route('/dave/campaign', {\n    name: 'layout_dave_sample_landing_campaign',\n    layoutTemplate: 'layout_dave_sample_landing_campaign',\n});\nRouter.route('/dave/modal', {\n    name: 'layout_dave_sample_modal',\n    layoutTemplate: 'layout_dave_sample_modal',\n});\n\n/*var requireLogin = function() {\n    if (! Meteor.user()) {\n        if (Meteor.loggingIn())\n            this.render(this.loadingTemplate);\n        else\n            this.render('accessDenied');\n\n        /!*pause();*!/\n\n    } else {\n        this.next();\n    }\n}\n\nvar IR_BeforeHooks = {\n    isLoggedIn: function() {\n        var self = this;\n        if (!Meteor.userId()) {\n            console.log(\"user not logged in - routing to start\");\n            //this.render('start');\n            Router.go('start');\n\n\n        } else {\n\n            this.next();\n            //return pause()\n        }\n    },\n    hasAcceptedLicense: function() {\n        var self = this;\n        if (Meteor.userId()) {\n\n            //check is accepted  license, if not then logout otherwise take to home page\n            Meteor.call(\"userHasAcceptedLicense\",function(err, result){\n                if (!err){\n                    if (!result){\n                        self.render(this.loadingTemplate);\n\n                        Router.go('license');\n                        //self.render('license');\n                    }\n                }\n\n            });\n            self.next();\n\n\n            /!*this.render('resourceList');*!/\n        } /!*else {\n         this.next()\n         }*!/\n    },\n    hasCompletedSetup: function() {\n        var self = this;\n        if (Meteor.userId()) {\n           /!* //check is accepted  license, if not then logout otherwise take to home page\n            Meteor.call(\"userHasCompletedInitialSetup\",function(err, result){\n                if (!err){\n                    if (!result){\n                        self.render(this.loadingTemplate);\n\n                        //Router.go('appInitialSetup');\n                        self.render('appInitialSetup');\n                    }\n                }\n\n            });*!/\n\n            if (typeof(Meteor.user().completedSetup) === \"undefined\" || !Meteor.user().completedSetup){\n                self.render(this.loadingTemplate);\n\n                Router.go('appInitialSetup');\n                //self.render('appInitialSetup');\n\n            }\n            self.next();\n\n\n            /!*this.render('resourceList');*!/\n        } /!*else {\n         this.next()\n         }*!/\n    },\n\n\n}*/\n\n/*var IR_AfterHooks = {\n    isLoggedIn: ,\n\n\n}*/\n\n\nRouter.onBeforeAction(function() {\n    var self = this;\n    if (!Meteor.userId()) {\n        //need to check if public\n        if (self.route.getName() === \"resourcePage\") {\n            Meteor.call('isPublicOrUnlistedResource',self.params._id , function(err,result){\n                if (err){\n                    BuzzyGlobal.throwError(err);\n                } else if (result){\n                    Router.go('resourcePage',{_id:self.params._id})\n                } else {\n                    Session.set(\"regoTop\", self.params._id);\n                    Router.go('signIn');\n                };\n\n            });\n            self.next();\n\n        } else {\n                Router.go('start');\n        }\n\n    } else {\n\n        this.next();\n        //return pause()\n    }\n\n\n    },\n    {except: ['start','signIn','appCreatePassword','appRegisterPassword','landing', 'rego','register','hero', 'forgotPass', 'licenseViewOnly','incoming','preview','unfollow','viewComment','viewResourcePixel','noAccess','regoLandingUnsubscribe','vote','appVoted','stripecallback','stripecallback2','stripeauthorize']});\n\nRouter.onBeforeAction('loading');\n\n/*\nRouter.onBeforeAction( function() {\n    var self = this;\n    if (Meteor.userId()) {\n\n        //check is accepted  license, if not then logout otherwise take to home page\n        Meteor.call(\"userHasAcceptedLicense\",function(err, result){\n            if (!err){\n                if (!result){\n                    self.render(this.loadingTemplate);\n\n                    Router.go('license');\n                } else {\n                    self.render(this.loadingTemplate);\n                    self.next();\n                }\n            }\n\n        });\n\n\n\n\n    }\n},\n    {except: ['start','rego','signIn','appCreatePassword','landing','license', 'forgotPass', 'licenseViewOnly','incoming','preview','unfollow','noAccess']});\n\n*/\n\n/*\nRouter.onBeforeAction(function() {\n        var self = this;\n        if (Meteor.userId()) {\n            /!* //check is accepted  license, if not then logout otherwise take to home page\n             Meteor.call(\"userHasCompletedInitialSetup\",function(err, result){\n             if (!err){\n             if (!result){\n             self.render(this.loadingTemplate);\n\n             //Router.go('appInitialSetup');\n             self.render('appInitialSetup');\n             }\n             }\n\n             });*!/\n\n            if (typeof(Meteor.user().completedSetup) === \"undefined\" || !Meteor.user().completedSetup){\n                self.render(this.loadingTemplate);\n\n                Router.go('appInitialSetup');\n                //self.render('appInitialSetup');\n\n            }\n            self.next();\n\n\n            /!*this.render('resourceList');*!/\n        } /!*else {\n         this.next()\n         }*!/\n    },\n    {except: ['start','rego','signIn','appCreatePassword','landing','license', 'forgotPass', 'licenseViewOnly','incoming','preview','unfollow','noAccess']});\n*/\n\n\nRouter.onBeforeAction(function () {\n        Errors.clearAllErrors();\n        this.next();\n    },\n    {except: ['incoming','unfollow','viewComment','viewResourcePixel','noAccess','regoLandingUnsubscribe','register','hero','vote','appVoted','stripecallback','stripecallback2','stripeauthorize']});\n\nRouter.configureBodyParsers = function() {\n    Router.onBeforeAction(Iron.Router.bodyParser.urlencoded({\n        extended: true,\n        limit: '200mb'\n    }), {where: 'server'});\n};\n\n/*Router.onAfterAction(function() {\n        var self = this;\n        if (Meteor.userId()){\n            Router.go('resourceList');\n        }\n\n    },\n    {only: ['rego','start','signIn','license', 'forgotPass']});*/\n\n\n\n/*Router.onAfterAction(function () {\n        var self = this;\n        // always start by resetting scroll to top of the page\n        $(window).scrollTop(0);\n        // if there is a hash in the URL, handle it\n        if (this.params.hash && (this.params.hash.length > 1)) {\n            // now this is important : Deps.afterFlush ensures that iron-router rendering\n            // process has finished inserting the current route template into DOM so we\n            // can manipulate it via jQuery, if you skip this part the HTML element you\n            // want to scroll to might not yet be present in the DOM (this is probably\n            // why your code fails in the first place)\n            Tracker.afterFlush(function () {\n\n                if (typeof $(\"#\" + self.params.hash).offset() != \"undefined\") {\n\n                    var scrollTop = $(\"#\" + self.params.hash).offset().top;\n\n                    $(\"html,body\").animate({\n                        scrollTop: scrollTop\n                    });\n\n                }\n\n            });\n        }\n    },\n    {except: ['incoming','unfollow','noAccess']});*/\n\n","/**\n * Created by adamginsburg on 1/10/15.\n */\nInject.rawHead('my-meta',\n    '<meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">');","/**\n * Created by adamginsburg on 26/05/2016.\n */\n\nimport  saml2js from 'saml2-js';\nimport bodyparser from 'body-parser';\nimport connectCookies from 'connect-cookies';\n\nconst saml2 = require('saml2-js');\nconst Fiber = require('fibers');\nconst bodyParser = require('body-parser');\nconst cookieParser = require('connect-cookies');\n\n\n\nvar getSPOptions = function(query){\n    var sp_options = {\n        entity_id: Meteor.absoluteUrl(\"metadata.xml\"),\n        private_key:  Assets.getText('saml/sp.key'),\n        certificate: Assets.getText('saml/sp.crt'),\n        assert_endpoint: Meteor.absoluteUrl(\"assert?org=\"  + query.org)\n    }\n    return sp_options;\n}\n\n\n\n\nWebApp.connectHandlers\n    .use(bodyParser.urlencoded({ extended: false }))\n    .use(cookieParser())\n    .use('/incoming', function (req, res, next) {\n        Fiber(function() {\n            console.log(\"incoming 1\", req.method);\n\n\n            if (req.method === \"POST\"){\n                console.log(\"incoming 1.2\");\n                var post = req.body;\n                console.log(\"incoming 2\", post)\n                Meteor.call(\"parseEmail\",post);\n\n                console.log(\"incoming 3\")\n\n            }\n\n            res.writeHead(200, {'Content-Type': 'text/plain'})\n            res.end('hi from the server\\n');\n        }).run();;\n\n\n    })\n    .use('/metadata.xml', function (req, res, next) {\n        var sp_options = getSPOptions(req.query);\n\n// Call service provider constructor with options\n        var sp = new saml2.ServiceProvider(sp_options);\n\n\n        res.writeHead(200, { 'Content-Type': 'application/xml'});\n        res.end(sp.create_metadata());\n\n\n    })\n    .use('/loginsaml', function (req, res, next) {\n        if (req.query && req.query.org){\n            // Initialize options object\n            var sp_options = getSPOptions(req.query);\n\n// Call service provider constructor with options\n            var sp = new saml2.ServiceProvider(sp_options);\n            var idp_options = SamlProviders.findOne({org:req.query.org});\n            console.log(\"IDP_OPTIONS:\", idp_options)\n\n// Call identity provider constructor with options\n\n\n            if (idp_options){\n                var idp = new saml2.IdentityProvider(idp_options);\n            }\n            if (idp_options && typeof idp !== \"undefined\"){\n                sp.create_login_request_url(idp, {}, function(err, login_url, request_id) {\n                    if (err != null){\n                        return res.send(500);\n                    }\n\n                    res.writeHead(301, {'Location': login_url});\n                    res.end();\n                });\n\n            } else {\n                return res.end(\"Ooops Assert Login!\");\n            }\n        } else {\n            return res.end(\"Ooops Invalid Params!\");\n        }\n\n\n    })\n    .use('/assert',  function (req, res, next) {\n\n        Fiber(function() {\n            var sp_options = getSPOptions(req.query);\n            // Call service provider constructor with options\n            var sp = new saml2.ServiceProvider(sp_options);\n\n            var options = {request_body: req.body};\n\n            if (req.query && req.query.org){\n                // Initialize options object\n                var idp_options = SamlProviders.findOne({org:req.query.org});\n                console.log(\"IDP_OPTIONS:\", idp_options)\n\n\n// Call identity provider constructor with options\n\n\n                if (idp_options){\n                    var idp = new saml2.IdentityProvider(idp_options);\n                }\n            } else {\n                BuzzyGlobal.throwError(\"Invalid Params!\")\n            }\n\n\n            if (typeof idp !== \"undefined\"){\n                sp.post_assert(idp, options, function(err, saml_response) {\n                    if (err != null){\n                        if (typeof err.extra !== \"undefined\") {\n                            console.log(\"Assert Error 1:\", err.extra.status);\n                            BuzzyGlobal.throwError(\"Invalid Params!\")\n                        }\n                        return res.end(\"Ooops Assert issue!\");\n                    }\n\n                    var name_id = saml_response.user.name_id;\n                    var session_index = saml_response.user.session_index;\n                    console.log(\"SAML user:\",saml_response.user);\n\n                    Fiber(function() {\n                        var user =  Accounts.users.findOne({email:saml_response.user.name_id.toLowerCase()});\n                        var userID;\n                        if(!user) {\n                            var userData = {\n                                _id: new Meteor.Collection.ObjectID()._str,\n                                email: saml_response.user.name_id.toLowerCase(),\n                                profile : {}\n                            };\n                            userData.profile.name =  userData.email.split(\"@\")[0];\n                            userData.profile.channels = [{channel: BuzzyGlobal.gNOTIFICATION_CHANNEL.EMAIL, address:userData.email, enabled: true}]\n                            userID = userData._id;\n                            Accounts.users.insert(userData);\n                        } else {\n                            userID = user._id;\n                        }\n                        var stampedLoginToken = Accounts._generateStampedLoginToken();\n                        Accounts._insertLoginToken(userID, stampedLoginToken);\n                        res.cookies.set('token', stampedLoginToken.token, { httpOnly: false });\n                        res.writeHead(301, {'Location': Meteor.absoluteUrl('sign-in')});\n                        res.end();\n\n                    }).run();\n\n\n                });\n\n            } else {\n                return res.end(\"Ooops Assert issue 2!\");\n            }\n\n\n\n\n        }).run();\n\n\n    });","TemplateHelpers = {\n\n    isImageMime: function(mimetype){\n        if (mimetype && mimetype.indexOf(\"image\") === -1) {\n            return false;\n        } else {\n            return true;\n        }\n    },\n    isArray: function(obj){\n        return Array.isArray(obj);\n    },\n    showUserProfileImage: function(fromUserID){\n        var user = Users.findOne({_id:fromUserID});\n        if (user && user.profile && typeof user.profile.profileImage !== \"undefined\") {\n            return user.profile.profileImage.url;\n        } else {\n            return \"https://buzzy.buzz/assets/email/avatar-default.jpg\";\n        }\n    },\n\n    getPromoInviteExistingUser: function(){\n        var randomNum = BuzzyGlobal.gRandomNumForLimit(4);\n        return Assets.getText('emails/email-notification/emailpromos/promo_invite_existing_random' + randomNum + '.html');\n    },\n    getPromoInviteNewUser: function(){\n        var randomNum = BuzzyGlobal.gRandomNumForLimit(4);\n        return Assets.getText('emails/email-notification/emailpromos/promo_invite_new_random' + randomNum + '.html');\n    },\n    getPromoCommentExistingUser: function(){\n        var randomNum = BuzzyGlobal.gRandomNumForLimit(4);\n        return Assets.getText('emails/email-notification/emailpromos/promo_comment_existing_random' + randomNum + '.html');\n    },\n    getPromoCommentNewUser: function(){\n        var randomNum = BuzzyGlobal.gRandomNumForLimit(4);\n        return Assets.getText('emails/email-notification/emailpromos/promo_comment_new_random' + randomNum + '.html');\n    },\n    getCtaInviteExistingUser: function(){\n        var options = [\n            {content:\"cta-invite-existing-red-clicktoviewonbuzzy\",bg:\"#d9534f\",border:\"#d43f3a\", message:\"Click to view on Buzzy\"}\n        ]\n        return options[BuzzyGlobal.gRandomNumForLimit(options.length) - 1];\n    },\n\tgetCtaInviteNewUser: function(){\n        var options = [\n            {content:\"cta-invite-new-red-followthisbuzz\",bg:\"#d9534f\",border:\"#d43f3a\", message:\"Follow this Buzz\"}\n        ]\n        return options[BuzzyGlobal.gRandomNumForLimit(options.length) - 1];\n    },\n    getCtaTopTitleInvite: function(){\n        var options = [\n            {content:\"cta-top-title-invite\",bg:\"#d9534f\",border:\"#d43f3a\", message:\"Accept the invitation\"}\n        ]\n        return options[BuzzyGlobal.gRandomNumForLimit(options.length) - 1];\n    },\n    getCtaTopTitleUpdate: function(){\n        var options = [\n            {content:\"cta-top-title-update\",bg:\"#d9534f\",border:\"#d43f3a\", message:\"View it on Buzzy\"}\n        ]\n        return options[BuzzyGlobal.gRandomNumForLimit(options.length) - 1];\n    },\n\n    getRandomNumber50Percent: function(){\n        return BuzzyGlobal.gRandomNumForLimit(2);\n    },\n    getRandomNumber33Percent: function(){\n        return BuzzyGlobal.gRandomNumForLimit(3);\n    },\n    getRandomNumber25Percent: function(){\n        return BuzzyGlobal.gRandomNumForLimit(4);\n    },\n    \n    mainLink: function(){\n        return {content:\"main-link\"};\n    },\n    userName: function(){\n        return BuzzyGlobal.gGetUserName(Meteor.user())\n    },\n    getFirstMobile: function(userID){\n        console.log(\"getFirstMobile:\", userID)\n        return BuzzyGlobal.getFirstMobile(userID)\n    },\n    commentURL: function () {\n        return Meteor.absoluteUrl(\"go/\" + this.comment.topLevelParentID + \"#\" + this.comment._id);\n    },\n    viewCommentURL: function () {\n        return Meteor.absoluteUrl(\"pixel/\" + this.toUserID + \"/\" + this.comment.topLevelParentID + \"/\" + this.comment._id);\n    },\n    viewCommentURLResource: function (userID) {\n        return Meteor.absoluteUrl(\"pixel/\" + userID + \"/\" + this.topLevelParentID + \"/\" + this._id);\n    },\n    viewURLResource: function (resourceID, userID) {\n        return Meteor.absoluteUrl(\"pixelr/\" + userID + \"/\"  + resourceID);\n    },\n    files: function (commentID) {\n        //console.log(\"FILES:\", commentID, Attachments.find({commentID:commentID,published:true}).count())\n        //console.log(\"FILES2:\", commentID, Attachments.find({commentID:commentID}).count())\n        //return Attachments.find({commentID:commentID,published:true})\n        if (commentID){\n            console.log(\"here 1\")\n            //return Attachments.find({commentID: commentID})\n        } else {\n            console.log(\"here 2\")\n            return null;\n        }\n\n    },\n    images: function (commentID) {\n        if (commentID){\n            //return Images.find({commentID:commentID,published:true})\n            console.log(\"here 3\")\n            //return Images.find({commentID: commentID})\n\n        } else {\n            console.log(\"here 4\")\n            return null;\n\n        }\n\n\n    },\n\n    embeddedBuzzResources: function(resourceID, userID){\n        var searchExpression = new RegExp(\"^,\"+ resourceID +\",\");\n        var userSearchExpression = new RegExp(userID);\n\n\n\n\n        return  Resources.find(\n            {$and:[\n                {$or:[\n                    {_id:resourceID},\n                    {path:searchExpression}\n                ]},\n                {$or:[\n                    {readers:userSearchExpression},\n                    {authors:userSearchExpression},\n                    {owners:userSearchExpression}\n                ]},\n\n                {status:'published'}\n\n            ]}\n\n        );\n    },\n    singleResource: function(resourceID){\n        return Resources.findOne(resourceID);\n    },\n    resources: function (resourceIDs, toUserID) {\n        var searchUserExpression = new RegExp(toUserID);\n        if (resourceIDs){\n            var sortedChildren = [];\n            var leftSortedTree = function(nodes){\n                var childSearchExpression = function(node){\n                    return new RegExp(\",\"+ node +\",$\");\n                }\n\n                for (var i = 0; i < nodes.length; i++){\n                    var directChildren = Resources.find(\n                        {$or:[\n                            {$and: [\n                                {path:childSearchExpression(nodes[i])},\n                                {status:BuzzyGlobal.gRESOURCE_STATUS.PUBLISHED}]},\n                            {$and: [\n                                {$or:[\n                                    {editors:searchUserExpression},\n                                    {owners:searchUserExpression}\n                                ]},\n                                {path:childSearchExpression(nodes[i])},\n                                {status:BuzzyGlobal.gRESOURCE_STATUS.DRAFT}]},\n\n                        ]},\n                        {sort:{path:1,rank:1}})\n                        .map(function(resource){\n                            return resource._id;\n                        });\n                    console.log(\"i:\",i,nodes[i]);\n                    if (directChildren.length > 0 ){\n\n                        _.union(sortedChildren.push(nodes[i]),leftSortedTree(directChildren));\n                    } else {\n                        sortedChildren.push(nodes[i]);\n                    }\n\n                }\n\n            }\n            leftSortedTree(resourceIDs);\n            return sortedChildren;\n\n\n        } else {\n            return null;\n        }\n\n    },\n\n    displayComments: function (showComments) {\n        if (showComments === BuzzyGlobal.gCOMMENTSHOW.NONE){\n            return false;\n        } else {\n            return true;\n        }\n        //return Images.find({commentID:commentID,published:true})\n\n    },\n    hasComments: function (resourceID) {\n        if (resourceID){\n            return Comments.find({resourceParentID: resourceID,  status: BuzzyGlobal.gCOMMENTSTATUS.LIVE}).count() > 0;\n        } else {\n            return false;\n        }\n        //return Images.find({commentID:commentID,published:true})\n\n    },\n    numberOfComments: function (resourceID) {\n        if (resourceID){\n            return Comments.find({resourceParentID: resourceID,  status: BuzzyGlobal.gCOMMENTSTATUS.LIVE}).count();\n        } else {\n            return null;\n        }\n        //return Images.find({commentID:commentID,published:true})\n\n    },\n    getRecentComments: function (resourceID, toUserID) {\n        if (resourceID){\n            var userSearchExpression = new RegExp(toUserID);\n            var latestComments=  Comments.find(\n                {$and:[\n                    {$or: [\n\n                        {\n                            $and: [{resourceParentID: resourceID},{toUsers: null}]\n                        },\n                        {\n                            $and: [{resourceParentID: resourceID},{toUsers: userSearchExpression}]\n                        }\n                    ]},\n                    {status: BuzzyGlobal.gCOMMENTSTATUS.LIVE}]}, //may have to change to show all and then deleted, flagged etc\n                { sort: { submitted : -1 },limit: 3 }).map(function(comment){\n                    return comment;\n                });\n            return latestComments.reverse();\n        } else {\n            return null;\n        }\n\n\n    },\n    getAppData: function (resourceID, userID) {\n        console.log(\"getAppData:\",userID)\n        if (resourceID){\n            var resource = Resources.findOne(resourceID);\n            var sortOrder = 1;\n            \n            var currLimit = BuzzyGlobal.gMICROAPPDATA_LIMIT;\n            if (typeof resource.content.numberOfItems != \"undefined\" && resource.content.numberOfItems > 0){\n                currLimit = resource.content.numberOfItems;\n            }\n            \n            if (resource && typeof resource.content.sortField !== \"undefined\"){\n                if (typeof resource.content.sortOrder !== \"undefined\" && resource.content.sortOrder === \"asc\"){\n                    sortOrder = 1;\n                } else {\n                    sortOrder = -1;\n                }\n                if (resource.content.whoCanView === BuzzyGlobal.gMICROAPP_PERMISSION_WHOCANVIEW.OWNER_AUTHOR_CREATOR){\n                    if (Resources.canEdit(userID, resource)){\n                        return MicroAppData.find({parentResourceID:  resource._id},{sort:{sortVal:sortOrder},limit:currLimit});\n                    } else {\n                        return MicroAppData.find({parentResourceID:  resource._id, userID:userID},{sort:{sortVal:sortOrder},limit:currLimit});\n                    }\n\n                } else {\n                    return MicroAppData.find({parentResourceID:  resource._id},{sort:{sortVal:sortOrder},limit:currLimit});\n                }\n\n\n            } else {\n                if (resource.content.whoCanView === BuzzyGlobal.gMICROAPP_PERMISSION_WHOCANVIEW.OWNER_AUTHOR_CREATOR){\n                    if (Resources.canEdit(userID, resource)){\n                        return MicroAppData.find({parentResourceID:  resource._id},{sort:{submitted:-1},limit:currLimit});\n                    } else {\n                        return MicroAppData.find({parentResourceID:  resource._id, userID:userID},{sort:{submitted:-1},limit:currLimit});\n                    }\n\n                } else {\n                    return MicroAppData.find({parentResourceID:  resource._id},{sort:{submitted:-1},limit:currLimit});\n                }\n\n            }\n\n\n\n\n        } else {\n            return null;\n        }\n\n\n    },\n    getAppDataRow: function (resourceID, userID, rowID) {\n        console.log(\"getAppData:\",userID)\n        if (resourceID){\n            var resource = Resources.findOne(resourceID);\n            var sortOrder = 1;\n\n            if (resource.content.whoCanView === BuzzyGlobal.gMICROAPP_PERMISSION_WHOCANVIEW.OWNER_AUTHOR_CREATOR){\n                console.log(\"getAppData:1 \",rowID)\n                if (Resources.canEdit(userID, resource)){\n                    console.log(\"getAppData:2 \",rowID)\n                    return MicroAppData.findOne({_id:rowID});\n                } else {\n                    console.log(\"getAppData:3 \",rowID)\n                    return MicroAppData.findOne({_id:rowID, userID:userID});\n                }\n\n            } else {\n                console.log(\"getAppData:4 \",rowID)\n                return MicroAppData.findOne({_id:rowID});\n            }\n\n        } else {\n            console.log(\"getAppData:5 \",rowID)\n            return null;\n        }\n\n\n    },\n    getAppFieldsNotCollapsed: function (resourceID) {\n        if (resourceID){\n            return MicroAppFields.find({parentResourceID:resourceID,collapseBreakPoint:{$ne:BuzzyGlobal.gAPPFIELD_COLLAPSE.COLLAPSE}},{sort:{rank:1}});\n        } else {\n            return null;\n        }\n\n\n    },\n    getAppFieldsCollapsed: function (resourceID) {\n        if (resourceID){\n            return MicroAppFields.find({parentResourceID:resourceID,collapseBreakPoint:BuzzyGlobal.gAPPFIELD_COLLAPSE.COLLAPSE},{sort:{rank:1}});\n        } else {\n            return null;\n        }\n    },\n    getAppFieldData:  function(appDataID, fieldID) {\n        //return MicroAppData.findOne({parentResourceID:this.parentResourceID,\"content._id\":this._id});\n        var microField = MicroAppData.findOne({_id: appDataID});\n        if (microField) {\n            for (i in microField.content) {\n                if (microField.content[i]._id === fieldID) {\n                    microField.content[i].appDataID = appDataID;\n                    return microField.content[i];\n                }\n            }\n        }\n\n    },\n\n    showFieldVoteOptions: function (fieldID) {\n        if (fieldID){\n            var fieldData = MicroAppFields.findOne({_id:fieldID});\n            if (fieldData && fieldData.option && fieldData.option.values){\n                return fieldData.option.values\n            } else {\n                return\n            }\n             ;\n        } else {\n            return null;\n        }\n\n\n    },\n    commentReplyAddress: function(topResourceID, currentResourceID, currentUserID){\n        var replyEmailAddress = topResourceID  + \".\" + currentResourceID + \".\" + currentUserID + \"@\" + Meteor.settings.MAIL_INCOMING_DOMAIN;\n\n        return  replyEmailAddress;\n\n    },\n    locationSearch: function(coords){\n        if (coords){\n            return encodeURI(\"https://maps.google.com/?q=\" + coords.lat + \",\" + coords.lng);\n        } else {\n            return encodeURI(\"https://maps.google.com/\");\n        }\n\n\n    },\n    voteLink: function( toUserID, currentResourceID, appID, fieldID, fieldVal){\n\n        console.log(\"Vote LInk: \", Meteor.absoluteUrl(\"vote/\" + toUserID + \"/\" + currentResourceID + \"/\" + appID + \"/\" + fieldID + \"/\" + encodeURIComponent(fieldVal).replace(/[!'()*]/g, escape) ))\n\n        return  Meteor.absoluteUrl(\"vote/\" +  toUserID + \"/\" + currentResourceID + \"/\" + appID + \"/\" + fieldID + \"/\" + encodeURIComponent(fieldVal).replace(/[!'()*]/g, escape) );\n\n    },\n    commentLink: function(topResourceID, currentResourceID,completedSetup, context){\n        if (completedSetup){\n            return  Meteor.absoluteUrl(\"go/\" + topResourceID + \"#\" + currentResourceID);\n        } else {\n            return  Meteor.absoluteUrl('regopassword/1/?token=' + context.token + \"&top=\" + topResourceID + \"&sub=\" + currentResourceID + \"&user=\" + context.toUserID);\n        }\n    },\n    commentLinkEmbedded: function(topResourceID, currentResourceID, completedSetup, token, toUserID){\n        if (completedSetup){\n            return  Meteor.absoluteUrl(\"go/\" + topResourceID + \"#\" + currentResourceID);\n        } else {\n            return  Meteor.absoluteUrl('regopassword/1/?token=' + token + \"&top=\" + topResourceID + \"&sub=\" + currentResourceID + \"&user=\" + toUserID);\n        }\n    },\n    buzzLink: function(resourceID){\n        return  Meteor.absoluteUrl(\"go/\" + resourceID);\n\n\n    },\n    notTopResource: function(topResourceID, resourceID){\n        return  topResourceID !== resourceID;\n\n    },\n    mainBuzzLink: function(context, resourceID, randomOpt){\n        if (context.completedSetup){\n\n            return  Meteor.absoluteUrl(\"go/\" + resourceID + \"/?utm_source=buzzyinvite&utm_campaign=buzzyemail&utm_content=\" + randomOpt.content);\n        } else {\n            return  Meteor.absoluteUrl('regopassword/1/?token=' + context.token + \"&top=\" + resourceID + \"&user=\" + context.toUserID + \"&utm_source=buzzyinvite&utm_campaign=buzzyemail&utm_content=\" + randomOpt.content);\n        }\n\n\n    },\n    activateLink: function(){\n        if (typeof this.createTemplateID !== \"undefined\" && this.createTemplateID) {\n            return Meteor.absoluteUrl('createpassword/1/?token=' + this.token + \"&template=\" + this.createTemplateID);\n        } else if (typeof this.invitingResourceID !== \"undefined\" && this.invitingResourceID) {\n            return Meteor.absoluteUrl('createpassword/1/?token=' + this.token + \"&top=\" + this.invitingResourceID);\n        } else {\n            return  Meteor.absoluteUrl('createpassword/1/?token=' + this.token);\n        }\n\n    },\n\n    getFirstImageinGalleryURL: function (galleryID) {\n        var pathRegex = new RegExp(galleryID);\n        var image = Resources.findOne({path:pathRegex, type:BuzzyGlobal.gBASICTYPES.FILEPICKER});\n        if (image){\n            return image.content.filePicker.url;\n        }\n\n        //return Meteor.absoluteUrl();\n    },\n    getFileURL: function (fileID, generatedToken) {\n        console.log(\"GET FILE URL:\", fileID);\n       /* var attachment = Attachments.findOne(fileID);\n        if (attachment){\n            return Meteor.absoluteUrl() + attachment.url({auth:generatedToken, download:true}).substring(1);\n        }*/\n\n        //return Meteor.absoluteUrl();\n    },\n    getURL: function () {\n        var fileURL = this.url();\n        console.log(\"fileURL\", fileURL);\n        if (fileURL){\n            return Meteor.absoluteUrl() + this.url().substring(1);\n        } else {\n            return Meteor.absoluteUrl();\n        }\n\n    },\n    truncateURL: function (url) {\n\n        if (url){\n            return url.substring(0,BuzzyGlobal.gMAX_LINK_DISPLAY_LENGTH) + \"...\";\n        }\n\n    },\n    unfollowURL: function (resourceID) {\n\n        return Meteor.absoluteUrl() + \"unfollow/\" + this.toUserEmail + \"/\" + resourceID;\n    },\n    formatBytes: function (bytes) {\n\n        if (bytes == 0) return '0 Byte';\n        var k = 1000;\n        var sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];\n        var i = Math.floor(Math.log(bytes) / Math.log(k));\n        return (bytes / Math.pow(k, i)).toPrecision(3) + ' ' + sizes[i];\n\n    },\n    $eq: function (a, b) {\n        return a === b;\n    },\n    $gt: function (a, b) {\n        return a > b;\n    },\n    dateDiffDays: function (start, end) {\n        if (start && end) {\n            return moment(end).diff(moment(start), \"days\");\n        } else {\n            return \"\";\n        }\n\n    },\n\n    formatDateTime: function(inputDate){\n        return moment(inputDate).format('DD MMM YYYY (h:mm a)');\n    },\n    formatDate: function(inputDate, options, timezone){\n        return BuzzyGlobal.gFormatDate(inputDate, options, timezone)\n    },\n    microAppChildren: function(userID, resourceID, appID, fieldID) {\n        console.log(\"microAppchildren:\", userID, resourceID, appID, fieldID)\n        if (userID && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (Resources.canView(userID, resource)) {\n                return MicroAppChild.find({parentAppItemID: appID, parentAppFieldID: fieldID});\n            }\n\n        }\n    }\n\n\n\n\n\n};\n","Templates = {};\n\nTemplates.commentNotification = {\n  path: 'emails/email-notification/comment.html',    // Relative to the 'private' dir.\n  css: 'emails/email-notification/style.css',      \t // Mail specific CSS.\n\n  helpers: {\n    capitalizedName: function() {\n      return this.name.charAt(0).toUpperCase() + this.name.slice(1);\n    }\n  }\n};\nTemplates.resourceNotification = {\n  path: 'emails/email-notification/resource.html',    // Relative to the 'private' dir.\n  css: 'emails/email-notification/style.css',       // Mail specific CSS.\n\n  helpers: {\n    capitalizedName: function() {\n      return this.name.charAt(0).toUpperCase() + this.name.slice(1);\n    }\n  }\n};\nTemplates.microAppNotification = {\n  path: 'emails/email-notification/microapp.html',    // Relative to the 'private' dir.\n  css: 'emails/email-notification/style.css',       // Mail specific CSS.\n\n  helpers: {\n    capitalizedName: function() {\n      return this.name.charAt(0).toUpperCase() + this.name.slice(1);\n    }\n  }\n};\nTemplates.inviteEmail = {\n  path: 'emails/email-notification/invite.html',      // Relative to the 'private' dir.\n  css: 'emails/email-notification/style.css',       // Mail specific CSS.\n\n  helpers: {\n    capitalizedName: function() {\n      return this.name.charAt(0).toUpperCase() + this.name.slice(1);\n    }\n  }\n};\nTemplates.activationEmail = {\n  path: 'emails/email-notification/activate.html',    // Relative to the 'private' dir.\n  css: 'emails/email-notification/style.css',       // Mail specific CSS.\n\n  helpers: {\n    capitalizedName: function() {\n      return this.name.charAt(0).toUpperCase() + this.name.slice(1);\n    }\n  }\n};\n\nTemplates.iCalEmail = {\n  path: 'emails/email-notification/ical.html',    // Relative to the 'private' dir.\n  css: 'emails/email-notification/style.css',       // Mail specific CSS.\n\n  helpers: {\n    capitalizedName: function() {\n      return this.name.charAt(0).toUpperCase() + this.name.slice(1);\n    }\n  }\n};\n","/**\n * Created by adamginsburg on 18/02/2015.\n */\nRegisteredUsers = new Meteor.Collection('registeredUsers');","/**\n * Created by adamginsburg on 9/09/2016.\n */\nSamlProviders = new Meteor.Collection('samlProviders');","/**\n * Created by adamginsburg on 21/07/2016.\n */\n\nBuzzyGlobalAdmin = new function(){\n    this.isBuzzyAdmin = function(){\n        return Meteor.userId() && Meteor.settings.BUZZY_ADMIN_IDS.indexOf(Meteor.userId()) !== -1;\n    };\n}\n\nMeteor.methods({\n    adminRefreshAllMicroAppSortFields: function () {\n        if (Meteor.userId() &&  BuzzyGlobalAdmin.isBuzzyAdmin()){\n\n            var resources = Resources.find({type:BuzzyGlobal.gBASICTYPES.APPLICATION}).map(function(resource){\n                if (resource && resource.content && resource.content.sortField){\n                    Meteor.call(\"updateAllFieldsMicroAppDataSortVal\", resource._id,resource.content.sortField,\"1\");\n                }\n            });\n\n\n        } else {\n            console.log(\"ERROR Trying to adminRefreshAllMicroAppSortFields with userID\" ,Meteor.userId());\n            BuzzyGlobal.throwError(\"Ooops! You are not allowed to do this!\");\n\n        }\n    },\n\n    cleanUpPushTokens: function(userID){\n        if (userID && Meteor.userId() &&  BuzzyGlobalAdmin.isBuzzyAdmin()){\n\n            //PushTokens.remove({userId:userID})\n            if (userID){\n                return Push.appCollection.remove({userId:userID});\n            }\n\n\n        } else {\n            console.log(\"ERROR Trying to cleanUpPushTokens with userID\" ,Meteor.userId());\n            BuzzyGlobal.throwError(\"Ooops! You are not allowed to do this!\");\n\n        }\n\n    },\n    buzzOwnerAuthors: function(){\n        if ( !BuzzyGlobalAdmin.isBuzzyAdmin()){\n            BuzzyGlobal.throwError(\"Sorry, you are not allowed to do that!!!\")\n            return;\n        }\n        var query = resourceQuery(Meteor.userId(), \"all\",\"\");\n        var pipeline = [\n            { $match:{path:null, status:{$ne:BuzzyGlobal.gRESOURCE_STATUS.DELETED}}},\n            { $project: { title:1, updated:1, type:1, status:1, readers:1, editors: 1, owners: 1,  authorOwners: { $setUnion: [ \"$editors\",\"$owners\" ] }, _id: 1 } },\n            { $match:{ authorOwners: { $size: 2 } }},\n            { $sort: { updated : -1 } }\n            //{$group: {_id: null, resTime: {$sum: \"$resTime\"}}}\n        ];\n        var results = Resources.aggregate(pipeline);\n\n       if (results){\n           for (i in results){\n               results[i].authorOwnersEmails = BuzzyGlobal.gGetUserEmails(results[i].authorOwners );\n               results[i].updatedDate = BuzzyGlobal.gFormatDate(results[i].updated);\n           }\n       }\n\n        return results;\n\n\n    },\n    uniqueUsersCommentsViews: function(start, end){\n        if ( !BuzzyGlobalAdmin.isBuzzyAdmin()){\n            BuzzyGlobal.throwError(\"Sorry, you are not allowed to do that!!!\")\n            return;\n        }\n\n\n\n\n        var pipeline = [\n            {\n                $match:\n                    {$and:[\n                        {submitted: {$gte: start}},\n                        {submitted: {$lte: end}}\n                    ]},\n            },\n            {\n                $group: { _id: '$userID'  }\n            }\n        ];\n        var results = CommentsViewed.aggregate(pipeline);\n        if (results){\n            for (i in results){\n                user = Users.findOne({_id:results[i]._id})\n                results[i].name = BuzzyGlobal.gGetUserName(user);\n                results[i].email = BuzzyGlobal.gGetUserEmail(user);\n            }\n        }\n\n        return results;\n\n\n    },\n\n    removeUserFromAllBuzzes: function(userID){\n        check(userID,String);\n        if ( !BuzzyGlobalAdmin.isBuzzyAdmin()){\n            BuzzyGlobal.throwError(\"Sorry, you are not allowed to do that!!!\")\n            return;\n        }\n\n        var userRegex = new RegExp(userID);\n        Resources.find({$or:[\n            {owners:userRegex},\n            {editors:userRegex},\n            {readers:userRegex}\n            ]})\n        .map(function(resource){\n            console.log(\"removing user:\" + userID + \" from \" + resource._id);\n            Resources.update(\n                {_id:resource._id},\n                { $pull: {owners: userID,editors: userID,readers: userID} },\n                { multi: true }\n\n            )\n        })\n\n\n\n    },\n\n\n\n})"," /**\n * Created by adamginsburg on 21/02/2015.\n */\nMeteor.methods({\n\n    markCommentDeleted: function (commentID, resourceID){\n\n        var user = Meteor.user();\n        if (!user)\n            throw new Meteor.Error(401, \"You need to login to delete resources\");\n        var comment = Comments.findOne({_id:commentID});\n        if (!comment)\n            throw new Meteor.Error(401, \"Error locating comment\");\n\n        console.log('is moderator:' + BuzzyGlobal.gIsCommentModerator(user._id, resourceID));\n\n        if ((comment.userID === user._id)|| (BuzzyGlobal.gIsCommentModerator(user._id, resourceID))){\n            Comments.update({_id:commentID},{$set: {status:BuzzyGlobal.gCOMMENTSTATUS.DELETED,moderator:user._id}}, function(error){\n                if (error) {\n                    // display the error to the user - Need to come back to fix 422 (not sure what # it should be???) as the error number\n                    throw new Meteor.Error(422, error.reason);\n                } else {\n                    console.log(\"Deleted comment\");\n                }\n            });\n\n        } else {\n            throw new Meteor.Error(401, \"Only owner or moderator can delete comment\");\n        }\n\n\n\n\n        return;\n\n\n    },\n    markCommentFlagged: function (commentID){\n\n        var user = Meteor.user();\n        if (!user)\n            throw new Meteor.Error(401, \"You need to login to report resources\");\n        var comment = Comments.findOne({_id:commentID});\n        if (!comment)\n            throw new Meteor.Error(401, \"Error locating comment\");\n\n\n\n        Comments.update({_id:commentID},{$set: {status:BuzzyGlobal.gCOMMENTSTATUS.FLAGGED,flaggedBy:user.id}}, function(error){\n            if (error) {\n                // display the error to the user - Need to come back to fix 422 (not sure what # it should be???) as the error number\n                throw new Meteor.Error(422, error.reason);\n            } else {\n                console.log(\"Flagged comment\");\n            }\n        });\n\n        return;\n\n\n    },\n    markCommentApproved: function (commentID){\n\n        var user = Meteor.user();\n        if (!user)\n            throw new Meteor.Error(401, \"You need to login to approve\");\n        var comment = Comments.findOne({_id:commentID});\n        if (!comment || !commentID)\n            throw new Meteor.Error(401, \"Error locating comment\");\n\n        if (BuzzyGlobal.gIsCommentModerator(Meteor.userId(),comment.topLevelParentID)){\n            Comments.update({_id:commentID},{$set: {toUsers:null,status:BuzzyGlobal.gCOMMENTSTATUS.LIVE,moderator:user._id}}, function(error){\n                if (error) {\n                    // display the error to the user - Need to come back to fix 422 (not sure what # it should be???) as the error number\n                    throw new Meteor.Error(422, error.reason);\n                } else {\n                    var truncatedText = comment.message.substring(0, BuzzyGlobal.gTRUNCATE_COMMENT_TEXT);\n                    Meteor.call(\"createCommentNotification\", comment, comment.topLevelParentID, comment.resourceParentID, truncatedText);\n                }\n            });\n        }\n\n        return;\n\n\n    },\n\n    updateResourceCommentCount: function(resourceID){\n\n       /* var newCommentCount = {\n            commentCount: Comments.find({resourceParentID:resourceID}).count()\n        };\n        Resources.update({_id:resourceID},  {$set:newCommentCount}, function(error) {\n            if (error) {\n                throw new Meteor.Error(422, error.reason);\n            } else {\n\n                return;\n                //Router.go('resourceList');\n            }\n        });*/\n    }\n\n})","/**\n * Created by adamginsburg on 11/11/2015.\n */\nvar crypto = Npm.require('crypto');\n\nvar filepickerSignUrl = function(blob) {\n\n    var handle = blob.url.slice(\"https://www.filepicker.io/api/file/\".length);\n\n    var expiry = Math.floor(new Date().getTime() / 1000 + BuzzyGlobal.gFILEPICKER_EXPIRY);\n    var calls = [\"read\",\"convert\",\"pick\", \"stat\", \"exif\"];\n    var policy = new Buffer(JSON.stringify({\n        call:calls,\n        handle: handle,\n        expiry: expiry\n    })).toString('base64');\n\n    var signature = crypto\n        .createHmac('sha256', Meteor.settings.filepicker.secret)\n        .update(policy)\n        .digest('hex');\n\n    if (blob.mimetype.indexOf(\"image\") === -1 ){\n        if (blob.url.indexOf(\"?\") === -1){\n            blob.url = blob.url  + \"?signature=\" + signature + \"&policy=\" + policy;\n            blob.signature =  signature;\n            blob.policy = policy;\n            return  blob;\n        } else {\n            blob.url = blob.url  + \"&signature=\" + signature + \"&policy=\" + policy;\n            blob.signature =  signature;\n            blob.policy = policy;\n            return  blob;\n        }\n\n    } else {\n        var result = HTTP.call(\"GET\", \"https://www.filepicker.io/api/file/\" + handle + \"/metadata?exif=true\" +  \"&signature=\" + signature + \"&policy=\" + policy);\n        if (blob.url.indexOf(\"?\") === -1){\n\n            blob.url =  \"https://process.filepicker.io/\" + Meteor.settings.public.filepicker.key + \"/security=\" + \"signature:\" + signature + \",policy:\" + policy + \"/rotate=deg:exif/\" + blob.url  + \"?signature=\" + signature + \"&policy=\" + policy;\n            blob.signature =  signature;\n            blob.policy = policy;\n            blob.EXIF = result.data?result.data.exif:null;\n            return blob;\n\n        } else {\n            blob.url = \"https://process.filepicker.io/\" + Meteor.settings.public.filepicker.key + \"/security=\" + \"signature:\" + signature + \",policy:\" + policy + \"/rotate=deg:exif/\" + blob.url +  \"&signature=\" + signature + \"&policy=\" + policy;\n            blob.signature =  signature;\n            blob.policy = policy;\n            blob.EXIF = result.data?result.data.exif:null;\n            return blob;\n\n        }\n\n\n    }\n\n\n};\n\nMeteor.methods({\n\n    filepickerSignUrlMethod: function(blob){\n\n        if (Meteor.userId()){\n            return filepickerSignUrl(blob)\n        } else {\n            BuzzyGlobal.throwError(\"Not allowed\")\n        }\n\n    },\n    filepickerSignUrlListMethod: function(blobsArray){\n\n        if (Meteor.userId()){\n            for (i in blobsArray){\n                blobsArray[i] = filepickerSignUrl(blobsArray[i])\n\n            }\n            return blobsArray;\n        } else {\n            BuzzyGlobal.throwError(\"Not allowed\")\n        }\n\n    },\n\n    createFilepickerCollage: function( handleArray){\n\n        var signHandle = function(handle){\n            var expiryMain = Math.floor(new Date().getTime() /1000 + BuzzyGlobal.gFILEPICKER_EXPIRY);\n            var calls = [\"read\",\"convert\",\"store\",\"write\",\"writeUrl\"];\n            var policy = new Buffer(JSON.stringify({\n                call:calls,\n                handle: handle,\n                expiry: expiryMain\n            })).toString('base64');\n\n            var signature = crypto\n                .createHmac('sha256', Meteor.settings.filepicker.secret)\n                .update(policy)\n                .digest('hex');\n            return   handle + \"?rotate=exif:false&signature=\" + signature + \"&policy=\" + policy;\n\n\n        };\n        if ( handleArray && handleArray.length > 1){\n\n            var expiry = Math.floor(new Date().getTime() / 1000 + BuzzyGlobal.gFILEPICKER_EXPIRY);\n            var calls = [\"read\",\"convert\",\"store\",\"write\",\"writeUrl\"];\n            var policy = new Buffer(JSON.stringify({\n                call:calls,\n                handle: handleArray[0],\n                expiry: expiry\n            })).toString('base64');\n\n            var signature = crypto\n                .createHmac('sha256', Meteor.settings.filepicker.secret)\n                .update(policy)\n                .digest('hex');\n\n\n\n\n            var signedHandles = [];\n            //start at second handle\n            for (i = 1; i < handleArray.length && i < BuzzyGlobal.gMAX_COLLAGE;i++){\n                signedHandles.push(signHandle(handleArray[i]));\n            }\n            var listOfSignedHandles = signedHandles.join(\",\");\n            var collageURL = \"https://process.filestackapi.com/\" + Meteor.settings.public.filepicker.key +  \"/security=signature:\" + signature + \",policy:\" + policy + \"/collage=files:[\" + listOfSignedHandles +  \"],w:1200,h:800,c:white,autorotate:true/\" + handleArray[0] + \"?signature=\" + signature + \"&policy=\" + policy;\n\n            var result = HTTP.call(\"POST\", collageURL);\n            if (result){\n                var collageHandle =   result.data.url.slice(\"https://cdn.filestackcontent.com/\".length);\n                var collagePolicy = new Buffer(JSON.stringify({\n                    call:[\"read\",\"convert\"],\n                    handle:collageHandle,\n                    expiry: expiry\n                })).toString('base64');\n\n                var collageSignature = crypto\n                    .createHmac('sha256', Meteor.settings.filepicker.secret)\n                    .update(collagePolicy)\n                    .digest('hex');\n            }\n            return {\n                signedURL: result.data.url +\"?signature=\" + collageSignature + \"&policy=\" + collagePolicy,\n                policy:collagePolicy,\n                signature: collageSignature,\n                additionalImageCount: (handleArray.length < BuzzyGlobal.gMAX_COLLAGE)?0:handleArray.length - BuzzyGlobal.gMAX_COLLAGE\n            } ;\n\n\n        }\n    }\n});\n","/**\n * Created by adamginsburg on 3/02/2015.\n */\nMeteor.methods({\n    getFroalaKey: function(){\n\n        var key = process.env.FROALAKEY;\n        if (typeof(key) !== 'undefined') {\n            // FOO environment variables exists\n            console.log(\"FROALA KEY server:\",key)\n            return key;\n        } else {\n            return \"XC1D2H-9oafB5A-16jzF-10==\"\n        }\n\n    }\n})","/**\n * Created by adamginsburg on 21/12/2016.\n */\ngiphy = require( 'giphy-api' )( { apiKey:'3oEjHUKDRyl8u0TW8w', https:true} );\n\n\nMeteor.methods({\n    searchGIPHY: async function (searchString) {\n\n        var result = await giphy.search( searchString);\n        var imageURLs = result.data.map(function(item){\n            return item.images.original.url\n        })\n        return imageURLs;\n\n\n    }\n})","/**\n * Created by adamginsburg on 4/07/15.\n */\n/*\nGoogleApi.get('/drive/v2/files', {}, function(result){\n    console.log(result);\n});*/\n","/**\n * Created by adamginsburg on 16/05/15.\n */\n\nMeteor.startup(function () {\n    //fs = Npm.require('fs');\n    //https = Npm.require('https');\n    if (Meteor.settings.AWS){\n        AWS.config.update({accessKeyId: Meteor.settings.AWS.accessKeyId, secretAccessKey: Meteor.settings.AWS.secretAccessKey});\n    } else {\n        console.warn(\"Warning. AWS Settings missing\");\n    }\n    s3 = new AWS.S3();\n\n\n});\n\nMeteor.methods({\n    parseEmail:  function(emailContent){\n\n\n        // need to sadd code to look through to, cc, bcc list to add them as \"reader\" if they are not in the list already.\n        // Ie if someone new got cc'd\n        try {\n            if (emailContent.sender && emailContent.sender !== \"undefined\"){\n                var user =  BuzzyGlobal.gGetUserforEmail(emailContent.sender)\n                if (user && user !== \"undefined\"){\n\n                    var toName = emailContent.recipient.split(\"@\")[0];\n\n                    var nameArray = toName.split(\".\");\n\n                    if (nameArray.length === 3){\n\n                        var topLevelParentID = nameArray[0];\n                        var resourceParentID = nameArray[1];\n                        var senderUserID = nameArray[2];\n                        var userID = user._id; // sender's buzzy ID\n\n                        var resourceToCommentOn = Resources.findOne(resourceParentID);\n                        if (!resourceToCommentOn){\n                            throw new Meteor.Error(422, \"Can't find reosource to comment on\");\n                        }\n                        if (!userID){\n                            throw new Meteor.Error(422, \"Invalid User ID\");\n                        }\n                        var user = Users.findOne(userID);\n\n                        if (!user){\n                            throw new Meteor.Error(422, \"User not found!!!\");\n                        }\n\n                        if (!Resources.canView(userID,resourceToCommentOn)){\n                            throw new Meteor.Error(422, \"Can't comment on reosource.\");\n                        }\n\n\n                        var comment = {\n                            //message: emailContent[\"stripped-text\"],\n                            message: emailContent[\"stripped-html\"],\n                            resourceParentID: resourceParentID,\n                            topLevelParentID: topLevelParentID,\n                            toUsers: [senderUserID, user._id]\n                        };\n\n\n\n                        var commentExtraContent = {\n                            type: BuzzyGlobal.gCOMMENTTYPE.URL_LIST,\n\n                            //files: Session.get(\"insertedFiles\"),\n                            isExternal: false,\n                            linkToURL: null,\n                            openInNewWindow:false,\n                            caption:\"\",\n                            urlList: []\n                        };\n\n\n\n                        var truncatedComment = truncate(comment.message, BuzzyGlobal.gCOMMENT_TRUNCATE);\n\n                        var truncatedText = (emailContent[\"stripped-text\"])?emailContent[\"stripped-text\"].substring(0, BuzzyGlobal.gTRUNCATE_COMMENT_TEXT):\"\";;\n                        var newCommentID = new Meteor.Collection.ObjectID()._str;\n                        try {\n                            if (typeof emailContent[\"attachments\"] !== \"undefined\" && emailContent[\"attachments\"].length > 0){\n                                var attachments = EJSON.parse(emailContent[\"attachments\"]);\n                                console.log(\"ATTACHMENTS:\", attachments, \" LENGTH:\", attachments.length);\n                                if (attachments.length > 0){\n                                    for (i = 0; i < attachments.length; i++) {\n\n                                        attachments[i].url = attachments[i].url.replace(\"api.mailgun.net\", \"api:\" + Meteor.settings.MAILGUN_KEY + \"@api.mailgun.net\");\n                                        /*var paramsA =\n                                        {\n                                            auth:{\n                                                user:'api',\n                                                pass:Meteor.settings.MAILGUN_KEY\n                                            },\n                                            encoding: null\n                                        }\n                                        var resultA = request(attachments[i].url, paramsA, function(error, response,body){\n                                            if (!error && response.statusCode == 200) {\n                                                console.log(body) // Show the HTML for the Google homepage.\n                                                var randomFileName = Random.id();\n                                                var params = {Bucket: 'buzzy-tempemail', Key: randomFileName, Body:response, CacheControl: 5184000 };\n                                                if (200 == response.statusCode) {\n                                                    s3.upload(params, function (err, data) {  //2 months\n                                                        console.log(err,data);\n                                                    });\n                                                }\n                                            }\n                                        });*/\n                                        /*if (resultA.response){\n                                            var randomFileName = Random.id();\n                                            //var file = fs.createWriteStream(randomFileName);\n                                            var fileBuf = new Buffer(resultA.response.body,'binary').toString('base64')\n                                            console.log(\"Random file:\",randomFileName, resultA.response.headers[\"content-type\"]);\n\n                                            var params = {Bucket: 'buzzy-tempemail', Key: randomFileName, Body:fileBuf ,ContentType:resultA.response.headers[\"content-type\"] };\n\n                                            var getParams = {Bucket: 'buzzy-tempemail', Key: randomFileName};\n                                            var url = s3.getSignedUrl('getObject', getParams);\n                                            s3.upload(params, function(err, data) {\n                                                if (err) {\n                                                    console.log(\"Error uploading data: \", err);\n                                                } else {\n                                                    console.log(\"Successfully uploaded data to myBucket/myKey\");\n                                                }\n                                            });\n                                        }*/\n\n                                       /*HTTP.get(attachments[i].url ,\n                                            {\n                                                auth:'api:'+ Meteor.settings.MAILGUN_KEY\n                                            },\n                                            function (error,result) {\n\n                                                console.log(\"RESULT\",result);\n                                                if (error){\n                                                    BuzzyGlobal.throwError(error)\n                                                } else {\n                                                    if (result.content){\n                                                        var randomFileName = Random.id();\n                                                        //var file = fs.createWriteStream(randomFileName);\n                                                        var fileBuf = new Buffer(result.content,'binary').toString('base64')\n                                                        console.log(\"Random file:\",randomFileName, result.headers[\"content-type\"]);\n\n                                                        var params = {Bucket: 'buzzy-tempemail', Key: randomFileName, Body:fileBuf ,ContentType:result.headers[\"content-type\"] };\n\n                                                        var getParams = {Bucket: 'buzzy-tempemail', Key: randomFileName};\n                                                        var url = s3.getSignedUrl('getObject', getParams);\n                                                        s3.upload(params, function(err, data) {\n                                                            if (err) {\n                                                                console.log(\"Error uploading data: \", err);\n                                                            } else {\n                                                                console.log(\"Successfully uploaded data to myBucket/myKey\");\n                                                            }\n                                                        });\n                                                    }\n                                                }\n\n                                        });*/\n\n\n                                    }\n                                    commentExtraContent.urlList = attachments;\n                                }\n\n\n                                Meteor.call(\"addComment\",comment, nameArray[0], truncatedComment, truncatedText, commentExtraContent, userID,newCommentID, function(err){\n                                    if (err){\n                                        BuzzyGlobal.throwError(err);\n                                    }\n\n                                });\n\n                            } else {\n                                Meteor.call(\"addComment\",comment, nameArray[0], truncatedComment, truncatedText, null, userID,newCommentID, function(err){\n                                    if (err){\n                                        BuzzyGlobal.throwError(err);\n                                    }\n\n                                });\n                            }\n\n                        } catch (err){\n                            BuzzyGlobal.throwError(err)\n                        }\n\n\n\n\n                    }\n\n                }\n            } else {\n                //shoudl we create a new user and invite them to buzzy?\n                console.log(\"INVALID SENDER\", emailContent);\n            }\n        } catch(err){\n            BuzzyGlobal.throwError(err)\n        }\n\n\n    }\n\n})\n","/**\n * Created by adamginsburg on 21/12/2015.\n */\nMeteor.methods({\n    sortedMicroAppData: function(resourceID){\n        var pipeline = [\n            { $match:{parentResourceID:  resourceID}},\n            { $project: { author:1, content:1, parentResourceID:1, submitted:1, userID:1, _id: 1 } },\n            { $sort: { submitted : -1 } },\n            { $limit: 10 }\n            //{$group: {_id: null, resTime: {$sum: \"$resTime\"}}}\n        ];\n        var results = MicroAppData.aggregate(pipeline);\n\n        return results;\n    }\n});","/**\n * Created by adamginsburg on 18/02/2015.\n */\nMeteor.methods({\n    registerUser: function (emailAddress, referringURL) {\n        RegisteredUsers.insert({\n            email: emailAddress,\n            fromURL: referringURL,\n            submitted: new Date().getTime()\n        });\n    }\n});","/**\n * Created by adamginsburg on 24/11/2014.\n */\nRelatedBuzz = new Mongo.Collection(\"RelatedBuzz\");\n\n","/**\n * Created by adamginsburg on 21/03/2016.\n */\n\nvar Future = require('fibers/future');\nvar Fiber = require('fibers');\nStripe = {};\nMeteor.startup(function(){\n    var StripeKey  = Meteor.settings.stripe.testSecretKey;\n    if (!Meteor.settings.public.stripe.debug) {\n        StripeKey = Meteor.settings.stripe.liveSecretKey;\n    }\n    Stripe = require('stripe')(StripeKey);\n\n})\n\n\n\n/*\n\nfunction chargeCard(payment, optReceiptEmail){\n    var future = new Future();\n    console.log(\"chargeCard payment:\", payment)\n\n    //should possibly get resourceID instead... then use that to derive the recipientID - seems safer. That said, everything is tracked via Stripe, so should be traceable.\n\n    var recipient = Users.findOne({_id: payment.recipientID});\n\n\n\n    if (payment && recipient && typeof recipient.stripeInfo !== \"undefined\" && typeof recipient.stripeInfo.stripe_user_id !== \"undefined\" && payment.totalAmount > 0) {\n\n        var receiptEmail = Meteor.user()? BuzzyGlobal.gGetUserEmail(Meteor.user()):optReceiptEmail;\n        var applicationFee = Math.ceil(payment.totalAmount * Meteor.settings.stripe.applicationFee).toFixed(0);\n        var roundedAmount = payment.totalAmount.toFixed(0);\n        Stripe.charges.create(\n            {\n                amount: roundedAmount,\n                currency: payment.currency,\n                source: payment.stripeToken,\n                receipt_email: receiptEmail,\n                description: payment.description,\n                application_fee: applicationFee,\n                statement_descriptor: payment.description,\n                metadata:{\n                    receipt_email:receiptEmail,\n                    user_name: Meteor.user()?BuzzyGlobal.gGetUserName(Meteor.user()):\"Anonymous\",\n                    buzzy_user_id: Meteor.userId()?Meteor.userId():\"Anonymous\"\n                }\n\n            },\n            {stripe_account: recipient.stripeInfo.stripe_user_id},\n\n            function (err, charge) {\n                if (err) {\n                    console.log(\"Stripe.charges.create Err:\", err);\n                    future.return(err);\n                } else {\n                    console.log(\"charge:\",charge, \" by:\", Meteor.userId());\n                    future.return(charge);\n                }\n            });\n    } else {\n        BuzzyGlobal.throwError(\"error making payment\")\n    }\n\n    return future.wait();\n}\n\n*/\n\n\nif (Meteor.isServer){\n\n\n    Meteor.methods({\n        'chargeCard2': async function (payment, resourceID, optReceiptEmail, optMicroAppDataField) {\n\n            var recipient = Users.findOne({_id: payment.recipientID});\n\n\n\n            if (payment && recipient && typeof recipient.stripeInfo !== \"undefined\" && typeof recipient.stripeInfo.stripe_user_id !== \"undefined\" && payment.totalAmount > 0) {\n\n                var receiptEmail = Meteor.user()? BuzzyGlobal.gGetUserEmail(Meteor.user()):optReceiptEmail;\n                var applicationFee = Math.ceil(payment.totalAmount * Meteor.settings.stripe.applicationFee).toFixed(0);\n                var roundedAmount = payment.totalAmount.toFixed(0);\n                const chargeResult = await Stripe.charges.create(\n                    {\n                        amount: roundedAmount,\n                        currency: payment.currency,\n                        source: payment.stripeToken,\n                        receipt_email: receiptEmail,\n                        description: payment.description,\n                        application_fee: applicationFee,\n                        statement_descriptor: payment.description,\n                        metadata:{\n                            receipt_email:receiptEmail,\n                            user_name: Meteor.user()?BuzzyGlobal.gGetUserName(Meteor.user()):\"Anonymous\",\n                            buzzy_user_id: Meteor.userId()?Meteor.userId():\"Anonymous\"\n                        }\n\n                    },\n                    {stripe_account: recipient.stripeInfo.stripe_user_id});\n                if (!chargeResult.statusCode || chargeResult.statusCode === 200) {\n                    var currentResource = null;\n                    if (resourceID){\n                        currentResource = Resources.findOne({_id: resourceID});\n                    }\n                    if (Meteor.userId()) {\n\n                        var activity = {\n                            \"actor\": {\n                                \"objectType\": \"person\",\n                                \"displayName\": BuzzyGlobal.gGetUserName(Meteor.user())\n                            },\n                            \"verb\": \"transfer\",\n                            \"object\": {\n                                \"objectType\": \"payment\",\n                                \"amount\": chargeResult.amount,\n                                \"currency\": chargeResult.currency,\n                                \"charge_id\": chargeResult.id,\n                                \"resource_button_id\": currentResource?currentResource._id:null,\n                                \"microAppField\": optMicroAppDataField?optMicroAppDataField:null\n                            },\n                            \"target\": {\n                                \"objectType\": \"person\",\n                                \"displayName\": BuzzyGlobal.gGetUserNameByID(payment.recipientID)\n                            }\n                        };\n                        //Meteor.call(\"createSingleUserResourceNotification\", payment.recipientID, currentResource._id, \"transfer\", activity);\n                    } else {\n\n                        var activity = {\n                            \"actor\": {\n                                \"objectType\": \"person\",\n                                \"displayName\":optReceiptEmail\n                            },\n                            \"verb\": \"transfer\",\n                            \"object\": {\n                                \"objectType\": \"payment\",\n                                \"amount\": chargeResult.amount,\n                                \"currency\": chargeResult.currency,\n                                \"charge_id\": chargeResult.id,\n                                \"resource_button_id\": currentResource._id\n                            },\n                            \"target\": {\n                                \"objectType\": \"person\",\n                                \"displayName\": BuzzyGlobal.gGetUserNameByID(payment.recipientID)\n                            }\n                        };\n                        Notifications.createAnonymousPaymentNotification(payment.recipientID, currentResource._id, \"transfer\", activity);\n                    }\n                }\n                console.log(\"chargeResult:\",chargeResult);\n                return  chargeResult;// insert into your own db\n            } else {\n                BuzzyGlobal.throwError(\"error making payment\")\n            }\n\n\n        },\n\n\n        'createStripeAccount': function() {\n\n            var user = Meteor.user();\n            if (user){\n                var email = BuzzyGlobal.gGetUserEmail(user);\n                if (email){\n                    Stripe.accounts.create({\n                        managed: false,\n                        country: 'AU',\n                        email: email\n                    }, function(err, account) {\n                        if (err){\n                            console.log(\"Stripe.accounts.create err:\", err);\n                            BuzzyGlobal.throwError(err)\n                        } else {\n                            Users.update({_id:user._id},{$set:{stripe:account}});\n                        }\n\n                    });\n                }\n\n            } else {\n                BuzzyGlobal.throwError(\"Invalid User:\" + user._id)\n            }\n\n        },\n        'updateStripeInfo': function(code) {\n            var clientID = Meteor.settings.public.stripe.debug?Meteor.settings.public.stripe.testClientID:Meteor.settings.public.stripe.liveClientID;\n            var clientSecret = Meteor.settings.public.stripe.debug?Meteor.settings.stripe.testSecretKey:Meteor.settings.stripe.liveSecretKey;\n            HTTP.call(\"POST\", STRIPE_TOKEN_URI, {\n                    data: {\n                        //loginToken: \"A2VWvjjJ2PM-aNZvP3fng8OmDr6_o2aNFvosMMX7yV7\",\n                        grant_type: 'authorization_code',\n                        client_id: clientID,\n                        code: code,\n                        client_secret: clientSecret\n                    }\n                },\n                function (err, result) {\n                    console.log(\"POST RESULT userID:\", Meteor.userId(), result, \" ERR:\", err)\n                    if (err) {\n                        console.log({message: 'Test failed error.'});\n                        BuzzyGlobal.throwError(err);\n                    } else {\n                        var accessToken = result.data.access_token;\n\n                        Users.update({_id:Meteor.userId()},{$set:{stripeInfo:result.data}})\n\n                    }\n\n\n                })\n        },\n        'subscribeUserToPlan': async function (subscription, token) {\n\n\n\n            if (subscription && typeof subscription.userID !== \"undefined\" &&  subscription.userID) {\n\n                var subscriber = Users.findOne({_id:subscription.userID});\n\n\n                var receiptEmail = BuzzyGlobal.gGetUserEmail(subscriber);\n\n                const createAndsubscribeResult = await Stripe.customers.create({\n                    source: token, // obtained with Stripe.js\n                    plan: subscription.plan,\n                    email: receiptEmail\n                }, function(err, customer) {\n                    // asynchronously called\n                    console.log(\"Stripe.customers.create:\", err, customer);\n\n                });\n                if (createAndsubscribeResult && typeof createAndsubscribeResult.id !== \"undefined\"){\n                    Users.update({_id:subscriber._id},{$set:{stripeCustomerInfo:createAndsubscribeResult}}, function(err){\n                        console.log(err);\n                    })\n                }\n\n                return  createAndsubscribeResult;// insert into your own db\n            } else {\n                BuzzyGlobal.throwError(\"error making payment\")\n            }\n\n\n        },\n        'removeMemberSubscription': async function (teamID, userID) {\n            //check if this team is owner of this members subscription\n            if (teamID && userID && Teams.isAdmin(Meteor.userId(),teamID)) {\n                var subscriber = Teams.findOne({_id: teamID});\n\n                if (subscriber && typeof subscriber.stripeCustomerInfo !== \"undefined\") {\n\n                    const currentSubscriptions = await Stripe.subscriptions.list(\n                        {customer: subscriber.stripeCustomerInfo.id},\n                        function (err, subscriptions) {\n                            // asynchronously called\n                        });\n\n\n                    if (!currentSubscriptions){\n                        BuzzyGlobal.throwError(\"Sorry!!!, can't find subscriptions!\");\n                        return;\n                    }\n\n                    var user = Users.findOne({_id:userID});\n                    if (!user){\n                        BuzzyGlobal.throwError(\"Error - Cannot find user!!!\");\n                        return;\n                    }\n\n                    var oldSubscriberPlan = await Stripe.subscriptions.retrieve(user.subscriptionID);\n\n                    TeamMembers.remove({teamID: teamID, userID:userID},  function(error) {\n\n                        if (error) {\n                            // display the error to the user - Need to come back to fix 422 (not sure what # it should be???) as the error number\n                            BuzzyGlobal.throwError(error.reason);\n                        }\n                    });\n\n                    if ( BuzzyGlobal.gIsSubScriptionMatch(currentSubscriptions, user.subscriptionID)){\n\n                        if (oldSubscriberPlan && oldSubscriberPlan.quantity > 0){\n                            const tempSubscription  = await Stripe.subscriptions.update(\n                                oldSubscriberPlan.id,\n                                {\n                                    quantity: oldSubscriberPlan.quantity - 1\n                                },\n                                function(err, newSubs) {\n\n\n                                }\n                            );\n                            Users.update({_id:userID},{$set:{subscriptionID:null}});\n                            ReactiveMethod.invalidateCall(\"retrieveCustomer\",subscriber.stripeCustomerInfo.id, new Date())\n                        }\n\n                    }\n\n\n\n                } else {\n                    BuzzyGlobal.throwError(\"Sorry!!!, You can't do that.\");\n                    return;\n                }\n\n\n            }\n        },\n        'updateSingleSubscription': async function (changedMember, country) {\n\n            if (changedMember){\n                if (! Teams.isAdmin(Meteor.userId(),changedMember.teamID)){\n                    BuzzyGlobal.throwError(\"Oops!!! You're not allowd to do that!\");\n                    return;\n                }\n                //addUserToPlan(changedMember.teamID, changedMember.toPlan,changedMember.fromPlan, changedMember.userID, changedMember.source);\n                var subscriber = Teams.findOne({_id:changedMember.teamID});\n                var userToUpdate = Users.findOne({_id:changedMember.userID});\n                if (!userToUpdate){\n                    BuzzyGlobal.throwError(\"Error cannot find user!\");\n                    return;\n                }\n                var userToUpdateOldSubscription;\n                if (typeof  userToUpdate.subscriptionID !== \"undefined\" &&  userToUpdate.subscriptionID){\n                    userToUpdateOldSubscription = await Stripe.subscriptions.retrieve(userToUpdate.subscriptionID);\n                }\n\n                if (subscriber && typeof subscriber.stripeCustomerInfo !== \"undefined\"){\n\n\n                    const currentSubscriptions = await Stripe.subscriptions.list(\n                        { customer: subscriber.stripeCustomerInfo.id },\n                        function(err, subscriptions) {\n                            // asynchronously called\n                            console.log(err,subscriptions);\n                        });\n\n                    if (currentSubscriptions && changedMember.toPlan === BuzzyGlobal.gPLAN_TYPE.BASIC){\n\n                        if (userToUpdateOldSubscription && userToUpdateOldSubscription.quantity > 0){\n                            const tempSubscription  = await Stripe.subscriptions.update(\n                                userToUpdateOldSubscription.id,\n                                {\n                                    quantity: userToUpdateOldSubscription.quantity - 1\n                                },\n                                function(err, newSubs) {\n                                    console.log(err,newSubs);\n\n\n                                }\n                            );\n                        } else if (userToUpdateOldSubscription  && userToUpdateOldSubscription.quantity > 0){\n                            const tempSubscription  = await Stripe.subscriptions.update(\n                                userToUpdateOldSubscription.id,\n                                {\n                                    quantity: userToUpdateOldSubscription.quantity - 1\n                                },\n                                function(err, newSubs) {\n                                    console.log(err,newSubs);\n\n\n                                }\n                            );\n                        }\n                        var teamInfo = {\n                            teamID: changedMember.teamID,\n                            userID: changedMember.userID,\n                            plan: changedMember.toPlan,\n                            role: BuzzyGlobal.gMEMBER_TYPE.MEMBER // will have to work out if users is already admin\n                        }\n                        Meteor.call(\"addTeamMember\", teamInfo, function(err,results){\n                            if (!err){\n                                Users.update({_id:changedMember.userID},{$set:{subscriptionID:null}});\n                            }\n                        });\n                        return;\n\n                    }\n\n\n\n\n                    var subscriberPlan;\n                    if (currentSubscriptions){\n                        subscriberPlan = BuzzyGlobal.gFindSubscription(currentSubscriptions, changedMember.toPlan)\n                    }\n\n                    if (subscriberPlan){\n\n                        var newQuantity = subscriberPlan.quantity + 1;\n                        const newSubscription  = await Stripe.subscriptions.update(\n                            subscriberPlan.id,\n                            {\n                                quantity: newQuantity\n                            },\n                            function(err, newSubs) {\n                                console.log(err,newSubs)\n\n                            }\n                        );\n                        if (newSubscription && changedMember.userID) {\n\n                            if (changedMember.fromPlan !== BuzzyGlobal.gPLAN_TYPE.BASIC){\n\n                                if (userToUpdateOldSubscription && userToUpdateOldSubscription.quantity > 0){\n\n                                    const tempSubscription  = await Stripe.subscriptions.update(\n                                        userToUpdateOldSubscription.id,\n                                        {\n                                            quantity: userToUpdateOldSubscription.quantity - 1\n                                        },\n                                        function(err, newSubs) {\n\n                                            console.log(err,newSubs);\n\n\n                                        }\n                                    );\n                                }\n\n                            }\n                            var teamInfo = {\n                                teamID: changedMember.teamID,\n                                userID: changedMember.userID,\n                                plan: changedMember.toPlan,\n                                role: BuzzyGlobal.gMEMBER_TYPE.MEMBER // will have to work out if users is already admin\n                            }\n                            Meteor.call(\"addTeamMember\", teamInfo, function(err,results){\n                                if (!err){\n                                    Users.update({_id:changedMember.userID},{$set:{subscriptionID:newSubscription.id}});\n                                }\n                            });\n                            ReactiveMethod.invalidateCall(\"retrieveCustomer\",subscriberPlan.id, new Date());\n                        }\n\n\n                    } else {\n                        var createAndsubscribeResult;\n                        if (changedMember.promoCode){\n                            createAndsubscribeResult = await Stripe.subscriptions.create({\n                                // SHOUDL THIS HAVE SOURCE - WAS LEFT OUT , WHY NOT??? source: changedMember.source, if so, will need  metadata:{country:country} too\n                                customer: subscriber.stripeCustomerInfo.id,\n                                plan: changedMember.toPlan,\n                                quantity: 1,\n                                coupon: changedMember.promoCode\n                            }, function(err, customer) {\n                                // asynchronously called\n                                console.log(\"Stripe.customers.create:\", err, customer);\n\n                            });\n                        } else {\n                            createAndsubscribeResult = await Stripe.subscriptions.create({\n                                // SHOUDL THIS HAVE SOURCE - WAS LEFT OUT , WHY NOT??? source: changedMember.source, if so, will need  metadata:{country:country} too\n                                customer: subscriber.stripeCustomerInfo.id,\n                                plan: changedMember.toPlan,\n                                quantity: 1\n                            }, function(err, customer) {\n                                // asynchronously called\n                                console.log(\"Stripe.customers.create:\", err, customer);\n\n                            });\n                        }\n\n                        if (createAndsubscribeResult && typeof createAndsubscribeResult.id !== \"undefined\"){\n\n                            if (changedMember.fromPlan !== BuzzyGlobal.gPLAN_TYPE.BASIC){\n\n                                if (userToUpdateOldSubscription && userToUpdateOldSubscription.quantity > 0){\n\n                                    const tempSubscription  = await Stripe.subscriptions.update(\n                                        userToUpdateOldSubscription.id,\n                                        {\n                                            quantity: userToUpdateOldSubscription.quantity - 1\n                                        },\n                                        function(err, newSubs) {\n                                            console.log(err, newSubs)\n\n                                        }\n                                    );\n                                }\n\n                            }\n\n                            var teamInfo = {\n                                teamID: changedMember.teamID,\n                                userID: changedMember.userID,\n                                plan: changedMember.toPlan,\n                                role: BuzzyGlobal.gMEMBER_TYPE.MEMBER\n                            }\n                            Meteor.call(\"addTeamMember\", teamInfo, function(err){\n                                if (!err){\n                                    Users.update({_id:changedMember.userID},{$set:{subscriptionID:createAndsubscribeResult.id}});\n                                }\n                            });\n\n                        }\n                        ReactiveMethod.invalidateCall(\"retrieveCustomer\",createAndsubscribeResult.id, new Date())\n                        return  createAndsubscribeResult;// insert into your own db\n\n\n                    }\n\n\n                } else {\n                    var createAndsubscribeResult;\n                    if (changedMember.promoCode){\n                        createAndsubscribeResult = await Stripe.customers.create({\n                            source: changedMember.source, // obtained with Stripe.js\n                            plan: changedMember.toPlan,\n                            quantity: 1,\n                            metadata:{country:country},\n                            coupon: changedMember.promoCode\n                        }, function(err, customer) {\n                            // asynchronously called\n                            console.log(\"Stripe.customers.create:\", err, customer);\n\n                        });\n\n                    } else {\n                        createAndsubscribeResult = await Stripe.customers.create({\n                            source: changedMember.source, // obtained with Stripe.js\n                            plan: changedMember.toPlan,\n                            quantity: 1,\n                            metadata:{country:country}\n                        }, function(err, customer) {\n                            // asynchronously called\n                            console.log(\"Stripe.customers.create:\", err, customer);\n\n                        });\n\n                    }\n\n                    if (createAndsubscribeResult && typeof createAndsubscribeResult.id !== \"undefined\"){\n\n                        Teams.update({_id:subscriber._id},{$set:{stripeCustomerInfo:createAndsubscribeResult}}, function(err){\n                            console.log(err);\n                        });\n                        var currentSubscription = BuzzyGlobal.gFindSubscription(createAndsubscribeResult.subscriptions, changedMember.toPlan)\n                        if (changedMember.fromPlan !== BuzzyGlobal.gPLAN_TYPE.BASIC){\n\n                            if (userToUpdateOldSubscription && userToUpdateOldSubscription.quantity > 0){\n                                const tempSubscription  = await Stripe.subscriptions.update(\n                                    userToUpdateOldSubscription.id,\n                                    {\n                                        quantity: userToUpdateOldSubscription.quantity - 1\n                                    },\n                                    function(err, newSubs) {\n                                        console.log(err,newSubs);\n\n\n                                    }\n                                );\n                            }\n\n                        }\n\n                        var teamInfo = {\n                            teamID: changedMember.teamID,\n                            userID: changedMember.userID,\n                            plan: changedMember.toPlan,\n                            role: BuzzyGlobal.gMEMBER_TYPE.MEMBER\n                        }\n                        Meteor.call(\"addTeamMember\", teamInfo, function(err){\n                            if (!err){\n                                Users.update({_id:changedMember.userID},{$set:{subscriptionID:currentSubscription.id}});\n                            }\n                        });\n\n                    }\n\n                    ReactiveMethod.invalidateCall(\"retrieveCustomer\",createAndsubscribeResult.id, new Date())\n                    return  createAndsubscribeResult;// insert into your own db\n                }\n            }\n        },\n        'subscribeTeamToPlan': async function (subscription, token, country) {\n\n\n            if (subscription && typeof subscription.teamID !== \"undefined\" &&  subscription.teamID) {\n                if (! Teams.isAdmin(Meteor.userId(),subscription.teamID)){\n                    BuzzyGlobal.throwError(\"Oops!!! You're not allowd to do that!\");\n                    return;\n                }\n                var subscriber = Teams.findOne({_id:subscription.teamID});\n\n                if (subscriber && typeof subscriber.stripeCustomerInfo !== \"undefined\"){\n\n\n                    const currentSubscriptions = await Stripe.subscriptions.list(\n                        { customer: subscriber.stripeCustomerInfo.id },\n                        function(err, subscriptions) {\n                            // asynchronously called\n                        });\n                    var subscriberPlan;\n                    if (currentSubscriptions){\n                        subscriberPlan = BuzzyGlobal.gFindSubscription(currentSubscriptions, subscription.plan)\n                    }\n                    console.log(\"subscriberPlan\",subscriberPlan)\n                    if (subscriberPlan){\n                        var newQuantity = subscriberPlan.quantity + subscription.userIDs.length;\n                        const newSubscription  = await Stripe.subscriptions.update(\n                            subscriberPlan.id,\n                            {\n                                quantity: newQuantity\n                            },\n                            function(err, newSubs) {\n\n\n                            }\n                        );\n                        if (newSubscription && subscription.userIDs) {\n                            for (i in subscription.userIDs) {\n                                var teamInfo = {\n                                    teamID: subscription.teamID,\n                                    userID: subscription.userIDs[i],\n                                    plan: subscription.plan,\n                                    role: BuzzyGlobal.gMEMBER_TYPE.MEMBER\n                                }\n                                Meteor.call(\"addTeamMember\", teamInfo, function(err){\n                                    if (!err){\n                                        Users.update({_id:subscription.userIDs[i]},{$set:{subscriptionID:newSubscription.id}});\n                                    }\n                                });\n                            }\n                        }\n\n                    } else {\n                        var createAndsubscribeResult;\n                        if (subscription.promoCode){\n                            createAndsubscribeResult = await Stripe.subscriptions.create({\n                                customer: subscriber.stripeCustomerInfo.id,\n                                plan: subscription.plan,\n                                quantity: subscription.userIDs.length,\n                                coupon: subscription.promoCode,\n                                metadata: {country:country}\n                            }, function(err, customer) {\n                                // asynchronously called\n                                console.log(\"Stripe.customers.create:\", err, customer);\n                                if (customer){\n                                    createAndsubscribeResult = customer;\n                                }\n\n                            });\n                        } else {\n                            createAndsubscribeResult = await Stripe.subscriptions.create({\n                                customer: subscriber.stripeCustomerInfo.id,\n                                plan: subscription.plan,\n                                quantity: subscription.userIDs.length,\n                                metadata: {country:country}\n                            }, function(err, customer) {\n                                // asynchronously called\n                                console.log(\"Stripe.customers.create:\", err, customer);\n                                if (customer){\n                                    createAndsubscribeResult = customer;\n                                }\n\n                            });\n                        }\n\n                        if (createAndsubscribeResult && typeof createAndsubscribeResult.id !== \"undefined\"){\n\n                            if (subscription.userIDs) {\n                                for (i in subscription.userIDs) {\n                                    var teamInfo = {\n                                        teamID: subscription.teamID,\n                                        userID: subscription.userIDs[i],\n                                        plan: subscription.plan,\n                                        role: BuzzyGlobal.gMEMBER_TYPE.MEMBER\n                                    }\n                                    Meteor.call(\"addTeamMember\", teamInfo, function(err){\n                                        if (!err){\n                                            Users.update({_id:subscription.userIDs[i]},{$set:{subscriptionID:createAndsubscribeResult.id}});\n                                        }\n                                    });\n\n                                }\n                            }\n\n                        }\n\n\n\n\n                        ReactiveMethod.invalidateCall(\"retrieveCustomer\",createAndsubscribeResult.id, new Date())\n                        return  createAndsubscribeResult;// insert into your own db\n                    }\n\n\n                } else {\n\n                    var createAndsubscribeResult;\n                    if (subscription.promoCode){\n                        createAndsubscribeResult = await Stripe.customers.create({\n                            source: token, // obtained with Stripe.js\n                            plan: subscription.plan,\n                            quantity: subscription.userIDs.length,\n                            coupon: subscription.promoCode,\n                            metadata: {country:country}\n                        }, function(err, customer) {\n                            // asynchronously called\n                            console.log(\"Stripe.customers.create:\", err, customer);\n\n                        });\n                    } else {\n                        createAndsubscribeResult = await Stripe.customers.create({\n                            source: token, // obtained with Stripe.js\n                            plan: subscription.plan,\n                            quantity: subscription.userIDs.length,\n                            metadata: {country:country}\n                        }, function(err, customer) {\n                            // asynchronously called\n                            createAndsubscribeResult\n                            console.log(\"Stripe.customers.create:\", err, customer);\n\n                        });\n                    }\n\n                    if (createAndsubscribeResult && typeof createAndsubscribeResult.id !== \"undefined\"){\n                        Teams.update({_id:subscriber._id},{$set:{stripeCustomerInfo:createAndsubscribeResult}}, function(err){\n                            console.log(err);\n                        });\n                        var currentSubscription = BuzzyGlobal.gFindSubscription(createAndsubscribeResult.subscriptions, subscription.plan)\n                        if (subscription.userIDs) {\n                            for (i in subscription.userIDs) {\n                                var teamInfo = {\n                                    teamID: subscription.teamID,\n                                    userID: subscription.userIDs[i],\n                                    plan: subscription.plan,\n                                    role: BuzzyGlobal.gMEMBER_TYPE.MEMBER\n                                }\n                                Meteor.call(\"addTeamMember\", teamInfo, function(err){\n                                    if (!err){\n                                        Users.update({_id:subscription.userIDs[i]},{$set:{subscriptionID:currentSubscription.id}});\n                                    }\n                                });\n                            }\n                        }\n                    }\n\n                    if ( createAndsubscribeResult) {\n                        ReactiveMethod.invalidateCall(\"retrieveCustomer\",createAndsubscribeResult.id, new Date())\n                    }\n\n                    return  createAndsubscribeResult;// insert into your own db\n                }\n\n            } else {\n                BuzzyGlobal.throwError(\"error making payment\")\n            }\n\n\n        },\n        'updateCustomerDefaultSource': async function (teamID, token, promoCode, country) {\n\n            if (! Teams.isAdmin(Meteor.userId(),teamID)){\n                BuzzyGlobal.throwError(\"Oops!!! You're not allowd to do that!\");\n                return;\n            }\n\n            var result;\n            if (teamID && token){\n                var team = Teams.findOne({_id:teamID});\n\n                if (team && typeof team.stripeCustomerInfo !== \"undefined\") {\n\n                    if (promoCode && typeof promoCode !== \"undefined\"){\n                        result = await Stripe.customers.update(\n                            team.stripeCustomerInfo.id,\n                            {\n\n                                coupon: promoCode,\n                                source: token,\n                                metadata:{country:country}\n                            }\n                        );\n\n                    } else {\n                        result = await Stripe.customers.update(\n                            team.stripeCustomerInfo.id,\n                            {\n\n                                source: token,\n                                metadata:{country:country}\n                            }\n                        );\n\n                    }\n\n\n\n                    return result\n                } else {\n                    return;\n                }\n            }\n        },\n        retrieveCustomer: async function(customerID, forceRefresh){\n            var temp = forceRefresh;\n            var result;\n            if (customerID){\n                result = await Stripe.customers.retrieve(\n                    customerID\n                );\n                return result\n            }\n\n        },\n        retrieveSubscriptions: async function(customerID){\n\n            var result;\n            if (customerID){\n                result = await Stripe.subscriptions.list(\n                    {customer:customerID}\n                );\n                return result\n            }\n\n        },\n        retrieveSingleSubscription: async function(subscriptionID){\n\n            var result;\n            if (subscriptionID){\n                result = await Stripe.subscriptions.retrieve(subscriptionID);\n                return result\n            }\n\n        },\n        listPlans: async function(){\n\n            var result;\n            result = await Stripe.plans.list();\n            return result\n\n        },\n        listInvoices: async function(teamID, limit){\n\n            if (! Teams.isAdmin(Meteor.userId(),teamID)){\n                BuzzyGlobal.throwError(\"Oops!!! You're not allowd to do that!\");\n                return;\n            }\n\n            var result;\n            if (teamID){\n                var team = Teams.findOne({_id:teamID});\n\n                if (team && typeof team.stripeCustomerInfo !== \"undefined\") {\n\n                    result = await Stripe.invoices.list(\n                        {\n                            customer: team.stripeCustomerInfo.id,\n                            limit: limit\n                        }\n                    );\n\n                    return result\n                } else {\n                    return;\n                }\n            }\n\n        },\n        listUpcomingInvoices: async function(teamID, subsID){\n            if (! Teams.isAdmin(Meteor.userId(),teamID)){\n                BuzzyGlobal.throwError(\"Oops!!! You're not allowd to do that!\");\n                return;\n            }\n            var result;\n            if (teamID){\n                var team = Teams.findOne({_id:teamID});\n\n                if (team && typeof team.stripeCustomerInfo !== \"undefined\") {\n\n                    result = await Stripe.invoices.retrieveUpcoming(team.stripeCustomerInfo.id,{\n\n                        subscription: subsID\n\n\n                    });\n                    console.log(\"UPCOMING:\", result);\n                    return result\n                } else {\n                    return;\n                }\n            }\n\n        },\n        retrieveCharge: async function(chargeID, forceRefresh){\n            var temp = forceRefresh;\n            var result;\n            if (chargeID){\n                result = await Stripe.charges.retrieve(\n                    chargeID\n                );\n                return result\n            }\n\n        },\n\n    });\n\n}\n","/**\n * Created by adamginsburg on 23/02/2017.\n */\n","/**\n * Created by adamginsburg on 26/02/2015.\n */\nif (Meteor.isServer){\n    Meteor.methods({\n        searchContactsTeam: function(searchText, teamID) {\n\n            var filter = new RegExp(searchText, 'i');\n\n\n            var excludeContacts = TeamMembers.find({teamID: teamID}).map(function (member) {\n                return member.userID;\n\n            });\n            var userContactsIDs = UserContacts.find(\n                {$and:[\n                    {userID: Meteor.userId()},\n                    {$or:[{name:filter},{email:filter}]},\n                    {contactID:{$nin:excludeContacts}}\n                ]},\n                {sort: {name: 1}, limit: 20})\n                .map(function (contact) {\n                    return contact.contactID;\n                });\n\n            var participantsWithNames = [];\n            var currentUsersArray = Users.find({_id: {$in: userContactsIDs}}).map(function (user) {\n                return {_id: user._id, name: BuzzyGlobal.gGetUserName(user), email:BuzzyGlobal.gGetUserEmail(user)}\n            });\n\n            return currentUsersArray;\n\n        }\n\n\n\n\n\n    })\n\n}\n","/**\n * Created by adamginsburg on 2/05/15.\n */\n\n/**\n * Helper for implementing retries with backoff. Initial retry\n * delay is 1 second, increasing by 2x (+jitter) for subsequent retries\n *\n * @constructor\n */\nvar RetryHandler = function() {\n    this.interval = 1000; // Start at one second\n    this.maxInterval = 60 * 1000; // Don't wait longer than a minute\n};\n\n/**\n * Invoke the function after waiting\n *\n * @param {function} fn Function to invoke\n */\nRetryHandler.prototype.retry = function(fn) {\n    setTimeout(fn, this.interval);\n    this.interval = this.nextInterval_();\n};\n\n/**\n * Reset the counter (e.g. after successful request.)\n */\nRetryHandler.prototype.reset = function() {\n    this.interval = 1000;\n};\n\n/**\n * Calculate the next wait time.\n * @return {number} Next wait interval, in milliseconds\n *\n * @private\n */\nRetryHandler.prototype.nextInterval_ = function() {\n    var interval = this.interval * 2 + this.getRandomInt_(0, 1000);\n    return Math.min(interval, this.maxInterval);\n};\n\n/**\n * Get a random int in the range of min to max. Used to add jitter to wait times.\n *\n * @param {number} min Lower bounds\n * @param {number} max Upper bounds\n * @private\n */\nRetryHandler.prototype.getRandomInt_ = function(min, max) {\n    return Math.floor(Math.random() * (max - min + 1) + min);\n};\n\n\n/**\n * Helper class for resumable uploads using XHR/CORS. Can upload any Blob-like item, whether\n * files or in-memory constructs.\n *\n * @example\n * var content = new Blob([\"Hello world\"], {\"type\": \"text/plain\"});\n * var uploader = new MediaUploader({\n *   file: content,\n *   token: accessToken,\n *   onComplete: function(data) { ... }\n *   onError: function(data) { ... }\n * });\n * uploader.upload();\n *\n * @constructor\n * @param {object} options Hash of options\n * @param {string} options.token Access token\n * @param {blob} options.file Blob-like item to upload\n * @param {string} [options.fileId] ID of file if replacing\n * @param {object} [options.params] Additional query parameters\n * @param {string} [options.contentType] Content-type, if overriding the type of the blob.\n * @param {object} [options.metadata] File metadata\n * @param {function} [options.onComplete] Callback for when upload is complete\n * @param {function} [options.onProgress] Callback for status for the in-progress upload\n * @param {function} [options.onError] Callback if upload fails\n */\nvar MediaUploader = function(options) {\n    var noop = function() {};\n    this.file = options.file;\n    this.contentType = options.contentType || this.file.type || 'application/octet-stream';\n    this.metadata = options.metadata || {\n            'title': this.file.name,\n            'mimeType': this.contentType\n        };\n    this.token = options.token;\n    this.upgrade_to_1080 = options.upgrade_to_1080;\n    this.onComplete = options.onComplete || noop;\n    this.onProgress = options.onProgress || noop;\n    this.onError = options.onError || noop;\n    this.offset = options.offset || 0;\n    this.chunkSize = options.chunkSize || 0;\n    this.retryHandler = new RetryHandler();\n\n    this.url = options.url;\n\n    if (!this.url) {\n        var params = options.params || {};\n        // params.uploadType = 'resumable';\n        this.url = this.buildUrl_(options.fileId, params, options.baseUrl);\n    }\n\n    this.httpMethod = options.fileId ? 'PUT' : 'POST';\n};\n\n/**\n * Initiate the upload (Get vimeo ticket number and upload url)\n */\nMediaUploader.prototype.upload = function() {\n    var self = this;\n    var xhr = new XMLHttpRequest();\n    var upgrade_to_1080 = (this.upgrade_to_1080 == 'yes') ? true : false;\n\n    xhr.open(this.httpMethod, this.url, true);\n    xhr.setRequestHeader('Authorization', 'Bearer ' + this.token);\n    xhr.setRequestHeader('Content-Type', 'application/json');\n\n    xhr.onload = function(e) {\n        // get vimeo upload  url, user (for available quote), ticket id and complete url\n        if (e.target.status < 400) {\n            var response = JSON.parse(e.target.responseText);\n            this.url = response.upload_link_secure;\n            this.user = response.user;\n            this.ticket_id = response.ticket_id;\n            this.complete_url = \"https://api.vimeo.com\"+response.complete_uri;\n            this.sendFile_();\n        } else {\n            this.onUploadError_(e);\n        }\n    }.bind(this);\n\n    xhr.onerror = this.onUploadError_.bind(this);\n    xhr.send(JSON.stringify({\n        type:'streaming',\n        upgrade_to_1080: upgrade_to_1080\n    }));\n\n};\n\n/**\n * Send the actual file content.\n *\n * @private\n */\nMediaUploader.prototype.sendFile_ = function() {\n    var content = this.file;\n    var end = this.file.size;\n\n    if (this.offset || this.chunkSize) {\n        // Only bother to slice the file if we're either resuming or uploading in chunks\n        if (this.chunkSize) {\n            end = Math.min(this.offset + this.chunkSize, this.file.size);\n        }\n        content = content.slice(this.offset, end);\n    }\n\n    var xhr = new XMLHttpRequest();\n    xhr.open('PUT', this.url, true);\n    xhr.setRequestHeader('Content-Type', this.contentType);\n    // xhr.setRequestHeader('Content-Length', this.file.size);\n    xhr.setRequestHeader('Content-Range', \"bytes \" + this.offset + \"-\" + (end - 1) + \"/\" + this.file.size);\n\n    if (xhr.upload) {\n        xhr.upload.addEventListener('progress', this.onProgress);\n    }\n    xhr.onload = this.onContentUploadSuccess_.bind(this);\n    xhr.onerror = this.onContentUploadError_.bind(this);\n    xhr.send(content);\n};\n\n/**\n * Query for the state of the file for resumption.\n *\n * @private\n */\nMediaUploader.prototype.resume_ = function() {\n    var xhr = new XMLHttpRequest();\n    xhr.open('PUT', this.url, true);\n    xhr.setRequestHeader('Content-Range', \"bytes */\" + this.file.size);\n    xhr.setRequestHeader('X-Upload-Content-Type', this.file.type);\n    if (xhr.upload) {\n        xhr.upload.addEventListener('progress', this.onProgress);\n    }\n    xhr.onload = this.onContentUploadSuccess_.bind(this);\n    xhr.onerror = this.onContentUploadError_.bind(this);\n    xhr.send();\n};\n\n/**\n * Extract the last saved range if available in the request.\n *\n * @param {XMLHttpRequest} xhr Request object\n */\nMediaUploader.prototype.extractRange_ = function(xhr) {\n    var range = xhr.getResponseHeader('Range');\n    if (range) {\n        this.offset = parseInt(range.match(/\\d+/g).pop(), 10) + 1;\n    }\n};\n\n/**\n * The final step is to call vimeo.videos.upload.complete to queue up\n * the video for transcoding.\n *\n * If successful call 'onComplete'\n *\n * @private\n */\nMediaUploader.prototype.complete_ = function() {\n\n    var xhr = new XMLHttpRequest();\n    xhr.open('DELETE', this.complete_url, true);\n    xhr.setRequestHeader('Authorization', 'Bearer ' + this.token);\n\n    xhr.onload = function(e) {\n\n        // Get the video location (videoId)\n        if (e.target.status < 400) {\n\n            var location = e.target.getResponseHeader('Location');\n\n            // Example of location: ' /videos/115365719', extract the video id only\n            var video_id = location.split('/').pop();\n\n            this.onComplete(video_id);\n\n        } else {\n            this.onCompleteError_(e);\n        }\n    }.bind(this);\n\n    xhr.onerror = this.onCompleteError_.bind(this);\n    xhr.send();\n};\n\n/**\n * Handle successful responses for uploads. Depending on the context,\n * may continue with uploading the next chunk of the file or, if complete,\n * invokes vimeo complete service.\n *\n * @private\n * @param {object} e XHR event\n */\nMediaUploader.prototype.onContentUploadSuccess_ = function(e) {\n\n    if (e.target.status == 200 || e.target.status == 201) {\n\n        this.complete_();\n\n    } else if (e.target.status == 308) {\n        this.extractRange_(e.target);\n        this.retryHandler.reset();\n        this.sendFile_();\n    }\n\n};\n\n/**\n * Handles errors for uploads. Either retries or aborts depending\n * on the error.\n *\n * @private\n * @param {object} e XHR event\n */\nMediaUploader.prototype.onContentUploadError_ = function(e) {\n    if (e.target.status && e.target.status < 500) {\n        this.onError(e.target.response);\n    } else {\n        this.retryHandler.retry(this.resume_.bind(this));\n    }\n};\n\n/**\n * Handles errors for the complete request.\n *\n * @private\n * @param {object} e XHR event\n */\nMediaUploader.prototype.onCompleteError_ = function(e) {\n    this.onError(e.target.response); // TODO - Retries for initial upload\n};\n\n/**\n * Handles errors for the initial request.\n *\n * @private\n * @param {object} e XHR event\n */\nMediaUploader.prototype.onUploadError_ = function(e) {\n    this.onError(e.target.response); // TODO - Retries for initial upload\n};\n\n/**\n * Construct a query string from a hash/object\n *\n * @private\n * @param {object} [params] Key/value pairs for query string\n * @return {string} query string\n */\nMediaUploader.prototype.buildQuery_ = function(params) {\n    params = params || {};\n    return Object.keys(params).map(function(key) {\n        return encodeURIComponent(key) + '=' + encodeURIComponent(params[key]);\n    }).join('&');\n};\n\n/**\n * Build the drive upload URL\n *\n * @private\n * @param {string} [id] File ID if replacing\n * @param {object} [params] Query parameters\n * @return {string} URL\n */\nMediaUploader.prototype.buildUrl_ = function(id, params, baseUrl) {\n    var url = baseUrl || 'https://api.vimeo.com/me/videos';\n    if (id) {\n        url += id;\n    }\n    var query = this.buildQuery_(params);\n    if (query) {\n        url += '?' + query;\n    }\n    return url;\n};","/**\n * Created by adamginsburg on 8/01/2015.\n */\n//var Vimeo = Meteor.require('vimeo-api');\n/*var Vimeo = Meteor.npmRequire('vimeo-api').Vimeo;\n\nMeteor.methods({\n    uploadVimeo: function(){\n        var lib = new Vimeo(\"ff4a731a3c8fb25c0bc8850dc16465f3574752c8\", \"38dd1e054f60db676a05058cc7340363f2efb955\", \"e7202be2d68871133e9cff8ad89a72df\");\n\n\n        var scopes = [\"public\",\"private\",\"purchased\",\"create\",\"edit\",\"delete\",\"interact\",\"upload\"];\n        var state = Random.id();\n        var redirect_uri = \"http://localhost:3000/_oauth/vimeo\"\n        var url = lib.buildAuthorizationEndpoint(redirect_uri, scopes, state);\n        console.log(\"vimeo url\",url);\n\n        lib.request(\"/me\",\n            function (err, response)\n            {\n                console.log(\"/me\",err); console.log(\"/me\",response);\n            });\n\n    }\n});\n\nMeteor.startup(function(){\n    Meteor.call(\"uploadVimeo\");\n})*/\n\n/*var state = Random.id();\nvar redirect_uri = \"http://localhost:3000/_oauth/vimeo\"\nvar url = lib.buildAuthorizationEndpoint(redirect_uri, scopes, state);\nconsole.log(\"vimeo url\",url);*/\n\n\n/*HTTP.call(\"GET\", \"https://api.vimeo.com/me\",\n    {headers:{Authorization : \"bearer \"+ vimeoAccessToken}},\n\n    function (error, result) {\n        if (!error) {\n            console.log(result);\n        } else {\n            console.log(\"error:\" , error)\n        }\n    });\n\nHTTP.call(\"POST\", \"https://api.vimeo.com/me/videos\",\n    {headers:{Authorization : \"bearer \"+ vimeoAccessToken}},\n\n    function (error, result) {\n        if (!error) {\n            console.log(\"result.uri:\", result.content.uri);\n        } else {\n            console.log(\"error:\" , error)\n        }\n    });*/\n\n/*lib.streamingUpload('/Users/adamginsburg/Movies/Copter.m4v',  function (error, body, status_code, headers) {\n    if (error) {\n        console.log(\"streamingUploadError:\", error);\n\n\n        throw new Meteor.Error(\"Vimeo Upload Error\", error);\n    } else {\n        console.log(body)\n        console.log(status_code)\n\n        lib.request(headers.location, function (error, body, status_code, headers) {\n            console.log(body);\n        });\n    }\n\n\n});*/\n\n\n/*\n HTTP.call(\"POST\", url,\n\n function (error, result) {\n if (!error) {\n console.log(result);\n } else {\n console.log(error)\n }\n });\n *//*\n\nHTTP.call(\"POST\", url,\n    {header:{Authorization : \"Authorization: bearer \"+ vimeoAccessToken}},\n\n    function (error, result) {\n        if (!error) {\n            console.log(result);\n        } else {\n            console.log(error)\n        }\n    });\n\nconsole.log( \"ABOUT TO CALL /me 1 *************************\");\n\n*\n });*//*\n*//*lib.request(*//**//*options*//**//*{\n // This is the path for the videos contained within the staff picks channels\n path : '/channels/staffpicks/videos',\n // This adds the parameters to request page two, and 10 items per page\n query : {\n page : 2,\n per_page : 10\n },\n headers: {Authorization : \"Basic ZmY0YTczMWEzYzhmYjI1YzBiYzg4NTBkYzE2NDY1ZjM1NzQ3NTJjODozOGRkMWUwNTRmNjBkYjY3NmEwNTA1OGNjNzM0MDM2M2YyZWZiOTU1\"}\n }, *//**//*callback*//**//*function (error, body, status_code, headers) {\n if (error) {\n console.log('error');\n console.log(error);\n } else {\n console.log('body');\n console.log(body);\n }\n\n console.log('status code');\n console.log(status_code);\n console.log('headers');\n console.log(headers);\n });*/\n","/**\n * Created by adamginsburg on 18/02/2017.\n */\nconst Fiber = require('fibers');\nvar ConversationV1 = require('watson-developer-cloud/conversation/v1');\n\n\nconst MAX_TWEETS = 200;\n\nMeteor.methods({\n    setPersonalityInsights:  function(microAppField, topResourceID, appID,fieldID){\n        var PersonalityInsightsV3 = require('watson-developer-cloud/personality-insights/v3');\n\n      \n\n        var microAppResource = Resources.findOne({_id:microAppField.parentResourceID});\n        if (microAppResource && Resources.canEdit(Meteor.userId(),microAppResource) && microAppResource.watsonCreds){\n\n            var personalityInsightsCreds  = _.find(microAppResource.watsonCreds,function (creds) {\n                return  creds.watsonType === BuzzyGlobal.gWATSON_SERVICE_TYPES.PERSONALITY_INSIGHTS;\n            });\n            if (personalityInsightsCreds){\n                var personality_insights = new PersonalityInsightsV3({\n                    username: personalityInsightsCreds.watsonUserID,\n                    password:  personalityInsightsCreds.watsonPassword,\n                    version_date: '2016-10-19'\n                });\n\n                var microAppDataItem = MicroAppData.findOne({_id: appID});\n\n\n\n                var collectedText = MicroAppFields.find({parentResourceID:microAppDataItem.parentResourceID}).map(function(currentField){\n\n                    if (currentField.option && currentField.option.isWatsonPersonality){\n                        var currFieldItem =  MicroAppData.currentDataItemField(microAppDataItem,currentField._id);\n                        if (currFieldItem && currFieldItem.value){\n                            switch (currentField.fieldType){\n                                case BuzzyGlobal.gAPPFIELDTYPE.TWITTER_FEED:\n                                    return currFieldItem.value.cachedData;\n                                default:\n                                    return currFieldItem.value;\n                            }\n\n                        }\n\n                    }\n                });\n\n                const getPersonalityInsights = Meteor.wrapAsync(personality_insights.profile, personality_insights);\n\n                try {\n                    var personalityProfile = getPersonalityInsights( {text: _.compact(collectedText), consumption_preferences: true});\n                    //console.log(JSON.stringify(personalityProfile, null, 2));\n                    Meteor.call(\"updateMicroAppData\",microAppField.parentResourceID,\n                        topResourceID,appID,fieldID,\n                        {\n\n                            personalityProfile:personalityProfile\n                        });\n                    //return personalityProfile;\n\n                } catch (error) {\n                    throw new Meteor.Error(error.name, error.message);\n                }\n\n            }\n\n\n\n\n        } else {\n            BuzzyGlobal.throwError(\"Sorry, you don't have permission to do that.\");\n        }\n\n\n\n\n\n    },\n    sendCommentToWatson: function (comment) {\n        check(comment,Object);\n        var sendToWatson = function (message, creds, senderUserID, context) {\n            try {\n                var conversation = new ConversationV1({\n                    \"username\": creds.watsonUserID,\n                    \"password\": creds.watsonPassword,\n                    version_date: ConversationV1.VERSION_DATE_2017_02_03\n                });\n            }  catch (err) {\n                console.log(\"Issue creating Watson conversation \" + err)\n                Meteor.setTimeout(function(){\n                    BuzzyGlobal.throwError(\"Issue sending Watson message \" + err)\n                },0)\n\n            }\n            if (conversation) {\n                try {\n                    conversation.message({\n                        input: {text: message},\n                        context: context,\n                        workspace_id: creds.watsonWorkspaceID\n                    }, function (err, response) {\n                        if (err) {\n                            console.error(err);\n                        } else {\n                            console.log(JSON.stringify(response, null, 2));\n                            var responseComment = {\n\n                                resourceParentID: comment.resourceParentID,\n                                topLevelParentID: comment.topLevelParentID,\n                                toUsers: comment.toUsers,\n                                watsonContext: (typeof response.context === \"undefined\")?null:response.context\n                            };\n\n                            if (response.output.text) {\n                                var flattenedText = response.output.text.toString();\n                                if (flattenedText){\n                                    responseComment.message =  flattenedText;\n\n\n                                    var truncatedText = flattenedText.substring(0, BuzzyGlobal.gTRUNCATE_COMMENT_TEXT); //assume not HTML for now\n                                    var optCommentExtraContent, optMeteorUserID, optCommentID;\n                                    Fiber(function () {\n                                        try {\n                                            Meteor.call(\"addComment\", responseComment, responseComment.topLevelParentID, truncatedText, truncatedText, optCommentExtraContent,senderUserID,optCommentID); // this needs to change to use a token , not userID\n                                        }  catch (err) {\n                                            console.log(\"Issue posting Watson comment \" + err)\n                                            BuzzyGlobal.throwError(\"Issue sending Watson message \" + err)\n\n                                        }\n\n                                    }).run();\n                                } else {\n                                    Fiber(function () {\n                                        try {\n                                            responseComment.message = \"Ugh... sorry I can't answer that. Can you please rephrase the question\";\n                                            Meteor.call(\"addComment\", responseComment, responseComment.topLevelParentID, \"Ugh, sorry I can't answer that.\", \"Ugh, sorry I can't answer that.\", optCommentExtraContent, senderUserID, optCommentID);\n                                        } catch (err) {\n                                            console.log(\"Issue posting Watson comment \" + err)\n                                            Meteor.setTimeout(function(){\n                                                BuzzyGlobal.throwError(\"Issue sending Watson message \" + err)\n                                            },0)\n\n                                        }\n                                    }).run();\n                                }\n\n                            };\n\n\n\n                        }\n                    })\n\n                } catch (err) {\n                    console.log(\"Issue sending Watson message \" + err)\n                    BuzzyGlobal.throwError(\"Issue sending Watson message \" + err)\n\n                }\n\n            }\n        }\n\n        console.log(\"SEND TO WATSON\", comment);\n        if (  comment.toUsers && comment.toUsers !== null && comment.toUsers.length > 0) {\n            console.log(\"WATSON COMMENT\", comment);\n            var firstBotUser = Users.findOne( {$and:[\n                {_id: {$in: comment.toUsers}},\n                { watsonCreds: { $exists: true } }\n            ]});\n            if (Users.isBot(firstBotUser) && comment.userID !== firstBotUser._id){\n\n                for (j in firstBotUser.watsonCreds){\n                    sendToWatson(comment.message, firstBotUser.watsonCreds[j],firstBotUser._id, comment.watsonContext); // need to add context for watson message\n                }\n            }\n\n        }\n    }\n})\n;\n","/**\n * Created by adamginsburg on 5/06/2014.\n */\n\n//var cheerio = Npm.require('cheerio');\ntruncate = require('html-truncate');\nFuture = require('fibers/future');\nconst MAX_TWEETS = 200;\n\n\n// /truncate = Meteor.npmRequire('html-truncate');\n\n\n\nvar insertExternalData = function (data) {\n    ExternalData.insert(data, function (error) {\n        console.log(\"inserting ExternalData\");\n\n        if (error) {\n            // display the error to the user - Need to come back to fix 422 (not sure what # it should be???) as the error number\n            throw new Meteor.Error(422, error.reason);\n        } else {\n\n            return true;\n\n        }\n    });\n}\n\n\n\nMeteor.methods({\n\n\n\n\n    gGetTweets: function(searchQuery){\n        var Fiber = Npm.require('fibers');\n\n\n\n        Twit = new TwitMaker({\n            consumer_key:         'JQzLHQ0hneUJ7bHeSC2hnmYZF'\n            , consumer_secret:      'JKSlAKxZTx1z33Xau8b6ACEUU1UwX7dIIajxrzXLPSkPRVs7f8'\n            , access_token:         '2473311780-yENrSpDLbtYud7jTWJqsai1bOu5AjEtW0A0kuf2'\n            , access_token_secret:  'K1hCkgOatvFXiN8j5KpejJxwLOQyfQkF3I1s7HbCBZwCy'\n        });\n\n        var userID = Meteor.userId();\n\n        Twit.get('search/tweets', { q:searchQuery, count: 5 }, function(err, data, response) {\n            console.log(\"err:\" + err);\n            console.log(_.pairs(data.statuses));\n\n            Fiber(function() {\n                for (i in data.statuses ){\n                    console.log(\"i:\" + i + \" status:\" + data.statuses[i].metadata + \" user:\" + data.statuses[i].user);\n                    newExternalData = {\n                        _id:  new Meteor.Collection.ObjectID()._str,\n                        userID: userID,\n                        content: {\n                            text:data.statuses[i].text,\n                            twitter_id: data.statuses[i].str_id,\n                            user: data.statuses[i].user,\n                            created_at: data.statuses[i].created_at,\n\n                        },\n                        type: BuzzyGlobal.gBASICTYPES.TWITTER,\n\n                        submitted: new Date().getTime(),\n                        updated: new Date().getTime(),\n                    };\n\n\n                    ExternalData.insert(newExternalData);\n\n\n\n                }\n            }).run();\n        })\n\n\n    },\n    getUserTweetsAsText:  function(twitterHandle){\n        var Twit = new TwitMaker({\n            consumer_key:         'JQzLHQ0hneUJ7bHeSC2hnmYZF'\n            , consumer_secret:      'JKSlAKxZTx1z33Xau8b6ACEUU1UwX7dIIajxrzXLPSkPRVs7f8'\n            , access_token:         '2473311780-yENrSpDLbtYud7jTWJqsai1bOu5AjEtW0A0kuf2'\n            , access_token_secret:  'K1hCkgOatvFXiN8j5KpejJxwLOQyfQkF3I1s7HbCBZwCy'\n        });\n\n        const getTweets = Meteor.wrapAsync(Twit.get, Twit);\n\n        try {\n            var tweets = getTweets('statuses/user_timeline', { screen_name:twitterHandle, count: MAX_TWEETS,  exclude_replies: true, trim_user: true });\n            var twitterText = '';\n            tweets.forEach(function(tweet){\n                if (!tweet.in_reply_to_status_id){\n                    twitterText = twitterText +  tweet.text + '. ';\n                }\n\n            });\n            return twitterText;\n        } catch (error) {\n            throw new Meteor.Error(error.name, error.message);\n        }\n\n\n\n    },\n    gGetURLMetaData: function(tempID, url) {\n         console.log(\"url:\" + url);\n\n\n        if (url && (typeof url !== \"undefined\") && url.indexOf(\"facebook.com\") >= 0){\n            newExternalData = {\n                _id: tempID,\n                userID: Meteor.userId(),\n                content: {\n\n                    embedType: 'facebook',\n                    url: url\n                },\n                submitted: new Date().getTime(),\n                updated: new Date().getTime(),\n                type: BuzzyGlobal.gBASICTYPES.EMBEDDED_LINK,\n            };\n            insertExternalData(newExternalData);\n        } else {\n            Meteor.http.get(url,\n\n                function (error, result) {\n\n                    var title = \"Enter title\";\n                    var description = \"Enter description\";\n                    var imageIURL = \"\";\n\n                    if (!error) {\n                        console.log(\"statusCode:\" + result.statusCode);\n                        //console.log(\" URL results: \" + _.pairs(result));\n                        //console.log(\"content: \" + result.content);\n                        //console.log(\"data: \" + result.data);\n                        //console.log(_.pairs(result));\n                        var $;\n                        if (result.content){\n\n                            $ = cheerio.load(result.content);\n                        } else if (result.data) {\n\n                            $ = cheerio.load(result.data);\n                        } else {\n\n                            throw new Meteor.Error(422, \"Can't find OG data\");\n                        }\n\n                        var canonicalLink =  $('link[rel=\"canonical\"]').attr(\"href\");\n                        console.log(\"canonical: \" + canonicalLink);\n\n                        if ((canonicalLink && (canonicalLink === url)) || (!canonicalLink) || (canonicalLink.indexOf(\"http://\") === -1 && canonicalLink.indexOf(\"https://\") === -1 )){\n                            var newExternalData = {};\n\n                            var oembedURL = $('link[type=\"application/json+oembed\"]').attr('href');\n                            if (oembedURL) {\n\n                                Meteor.http.get(oembedURL,\n                                    function (error, result) {\n                                        if (!error) {\n                                            //console.log(\"oembed data: \" + _.pairs(result.data));\n                                            //console.log(\"oembed content: \" + content.data);\n                                            newExternalData = {\n                                                _id: tempID,\n                                                userID: Meteor.userId(),\n                                                content: {\n                                                    embedType: 'oembed',\n                                                    data: result.data,\n                                                    style:'resourceExternal1',\n                                                    originalLink: url\n                                                },\n\n                                                submitted: new Date().getTime(),\n                                                updated: new Date().getTime(),\n                                                type: BuzzyGlobal.gBASICTYPES.EMBEDDED_LINK,\n\n                                            };\n                                            insertExternalData(newExternalData);\n                                        }\n\n                                    }\n                                );\n\n                            } else if ($('meta[property=\"og:url\"]').attr('content')) {\n\n                                newExternalData = {\n                                    _id: tempID,\n                                    userID: Meteor.userId(),\n                                    content: {\n\n                                        embedType: 'og',\n                                        url: $('meta[property=\"og:url\"]').attr('content'),\n                                        title: $('meta[property=\"og:title\"]').attr('content'),\n                                        type: $('meta[property=\"og:type\"]').attr('content'),\n                                        description: $('meta[property=\"og:description\"]').attr('content'),\n                                        image: $('meta[property=\"og:image\"]').attr('content'),\n                                        audio: $('meta[property=\"og:audio\"]').attr('content'),\n                                        site_name: $('meta[property=\"og:site_name\"]').attr('content'),\n                                        video: $('meta[property=\"og:video\"]').attr('content'),\n                                        style:'resourceExternal1',\n                                        originalLink: url\n                                    },\n                                    submitted: new Date().getTime(),\n                                    updated: new Date().getTime(),\n                                    type: BuzzyGlobal.gBASICTYPES.EMBEDDED_LINK,\n                                };\n                                insertExternalData(newExternalData);\n\n                            } else {\n                                console.log(\"here 3\");\n\n                                console.log($('meta[name=\"description\"]').attr('content'))\n\n                                var tDescription = $('meta[name=\"description\"]').attr('content');\n\n                                var tTitle = $('meta[name=\"title\"]').attr('content');\n                                if (tDescription){\n                                    description = tDescription;\n\n                                }\n                                if (tTitle){\n                                    title = tTitle;\n\n                                } else {\n                                    if ($('title').text()){\n                                        title = $('title').text();\n                                    }\n                                }\n\n                                if ($('body').find('img').eq(0).attr('src')){\n                                    imageURL = $('body').find('img').eq(0).attr('src');\n                                }\n                                newExternalData = {\n                                    _id: tempID,\n                                    userID: Meteor.userId(),\n                                    content: {\n\n                                        embedType: 'basic',\n                                        url: url,\n                                        title: title,\n                                        description: description,\n                                        image : imageURL,\n                                        originalLink: url\n\n                                    },\n                                    submitted: new Date().getTime(),\n                                    updated: new Date().getTime(),\n                                    type: BuzzyGlobal.gBASICTYPES.EMBEDDED_LINK,\n                                };\n                                insertExternalData(newExternalData);\n\n                            }\n\n                        } else {\n                            Meteor.call('gGetURLMetaData',tempID, canonicalLink ); // should put a counter here so no infinite loops\n\n                        }\n\n\n\n\n\n                    } else {\n                        throw new Meteor.Error(500, \"Embed call Call failed:\" + error);\n                    }\n                });\n        }\n\n\n     },\n\n    gGetURLMetaData2: function(url) {\n\n        var future = new Future();\n\n        if (url && (typeof url !== \"undefined\") && url.indexOf(\"facebook.com\") >= 0){\n            newExternalData = {\n                content: {\n\n                    embedType: 'facebook',\n                    url: url\n                },\n                type: BuzzyGlobal.gBASICTYPES.EMBEDDED_LINK,\n            };\n            future.return(newExternalData);\n        } else {\n            Meteor.http.get(url,\n\n                function (error, result) {\n\n                    var title = \"Enter title\";\n                    var description = \"Enter description\";\n                    var imageIURL = \"\";\n\n                    if (!error) {\n                        var $;\n                        if (result.content){\n\n                            $ = cheerio.load(result.content);\n                        } else if (result.data) {\n\n                            $ = cheerio.load(result.data);\n                        } else {\n\n                            throw new Meteor.Error(422, \"Can't find OG data\");\n                        }\n\n                        var canonicalLink =  $('link[rel=\"canonical\"]').attr(\"href\");\n                        if ((canonicalLink && (canonicalLink === url)) || (!canonicalLink) || (canonicalLink.indexOf(\"http://\") === -1 && canonicalLink.indexOf(\"https://\") === -1 )){\n                            var newExternalData = {};\n\n                            var oembedURL = $('link[type=\"application/json+oembed\"]').attr('href');\n                            if (oembedURL) {\n\n                                Meteor.http.get(oembedURL,\n                                    function (error, result) {\n                                        if (!error) {\n                                            //console.log(\"oembed data: \" + _.pairs(result.data));\n                                            //console.log(\"oembed content: \" + content.data);\n                                            newExternalData = {\n                                                content: {\n                                                    embedType: 'oembed',\n                                                    data: result.data,\n                                                    style:'resourceExternal1',\n                                                    originalLink: url\n                                                },\n                                                type: BuzzyGlobal.gBASICTYPES.EMBEDDED_LINK,\n\n                                            };\n                                            future.return(newExternalData);\n                                        }\n\n                                    }\n                                );\n\n                            } else if ($('meta[property=\"og:url\"]').attr('content')) {\n\n                                newExternalData = {\n                                    content: {\n\n                                        embedType: 'og',\n                                        url: $('meta[property=\"og:url\"]').attr('content'),\n                                        title: $('meta[property=\"og:title\"]').attr('content'),\n                                        type: $('meta[property=\"og:type\"]').attr('content'),\n                                        description: $('meta[property=\"og:description\"]').attr('content'),\n                                        image: $('meta[property=\"og:image\"]').attr('content'),\n                                        audio: $('meta[property=\"og:audio\"]').attr('content'),\n                                        site_name: $('meta[property=\"og:site_name\"]').attr('content'),\n                                        video: $('meta[property=\"og:video\"]').attr('content'),\n                                        style:'resourceExternal1',\n                                        originalLink: url\n                                    },\n                                    type: BuzzyGlobal.gBASICTYPES.EMBEDDED_LINK,\n                                };\n                                future.return(newExternalData);\n\n                            } else {\n\n                                var tDescription = $('meta[name=\"description\"]').attr('content');\n\n                                var tTitle = $('meta[name=\"title\"]').attr('content');\n                                if (tDescription){\n                                    description = tDescription;\n\n                                }\n                                if (tTitle){\n                                    title = tTitle;\n\n                                } else {\n                                    if ($('title').text()){\n                                        title = $('title').text();\n                                    }\n                                }\n\n                                if ($('body').find('img').eq(0).attr('src')){\n                                    imageURL = $('body').find('img').eq(0).attr('src');\n                                }\n                                newExternalData = {\n                                    content: {\n\n                                        embedType: 'basic',\n                                        url: url,\n                                        title: title,\n                                        description: description,\n                                        image : imageURL,\n                                        originalLink: url\n\n                                    },\n                                    type: BuzzyGlobal.gBASICTYPES.EMBEDDED_LINK,\n                                };\n                                future.return(newExternalData);\n\n                            }\n\n                        } else {\n                            Meteor.call('gGetURLMetaData',tempID, canonicalLink ); // should put a counter here so no infinite loops\n                        }\n\n                    } else {\n                        throw BuzzyGlobal.throwError(error);\n                        future.return(error);\n                    }\n                });\n        }\n        return future.wait();\n\n\n    },\n\n    markResourceAndChildrenDeleted: function (currentResourceID){\n\n        var user = Meteor.user();\n        if (!user)\n            throw new Meteor.Error(401, \"You need to login to delete resources\");\n        var searchExpression = new RegExp(',' + currentResourceID +',') ;\n        console.log(\"about to remove children:\" + searchExpression);\n        //Resources.remove({path:{$regex: searchExpression}});\n\n        if (!currentResourceID){\n            throw new Meteor.Error(401, \"Invalid Resource ID\");\n        }\n\n        var resource = Resources.findOne({_id:currentResourceID});\n\n        if (resource.type === BuzzyGlobal.gBASICTYPES.BUZZ && !Resources.ownsDocument(user._id, resource)){\n            BuzzyGlobal.throwError(\"Only owner can delete a buzz\")\n        }\n\n        if (resource.type !== BuzzyGlobal.gBASICTYPES.BUZZ && !Resources.canEdit(user._id, resource)){\n            BuzzyGlobal.throwError(\"Insuffienct Rights to Delete content\")\n        }\n\n\n\n\n        Resources.update({path:{$regex: searchExpression}},{$set: {status:'deleted'}},{ multi: true }, function(error){\n            if (error) {\n                // display the error to the user - Need to come back to fix 422 (not sure what # it should be???) as the error number\n                throw new Meteor.Error(422, error.reason);\n            } else {\n                console.log(\"Deleted child resources\");\n            }\n        });\n        Resources.update({_id:currentResourceID},{$set: {status:'deleted'}}, function(error){\n            if (error) {\n                // display the error to the user - Need to come back to fix 422 (not sure what # it should be???) as the error number\n                throw new Meteor.Error(422, error.reason);\n            } else {\n                console.log(\"Deleted resource:\" + currentResourceID);\n            }\n        });\n        return;\n\n\n    },\n\n\n    updateResourceAndChildren: function (resourceID, fieldName, newValue){\n\n        var user = Meteor.user();\n        if (!user){\n            throw new Meteor.Error(401, \"You need to login to delete resources\");\n        }\n\n\n        var obj = {};\n        obj[fieldName] = newValue;\n        obj['updated'] =  new Date().getTime();\n\n        var searchExpression = new RegExp(',' + resourceID +',') ;\n        console.log(\"about to update children:\" + searchExpression);\n        //Resources.remove({path:{$regex: searchExpression}});\n\n        //should probably add some code later to check that user has right permissions to delete (ie isOwner)\n        var resource = Resources.findOne({_id:resourceID});\n\n        if (resource && Resources.canEdit(user._id, resource)){\n            Resources.update(\n                {$and:[\n\n                    {$or:[\n                        {status:'published'},\n                        {status:'draft'}\n                    ]},\n                    {$or:[\n                        {_id:resourceID},\n                        {path:{$regex: searchExpression}}\n                    ]}\n                ]},\n                {$set:obj},\n                { multi: true },\n                function(error){\n                    if (error) {\n                        // display the error to the user - Need to come back to fix 422 (not sure what # it should be???) as the error number\n                        throw new Meteor.Error(422, error.reason);\n                    } else {\n                        console.log(\"Updated child resources\");\n                    }\n                });\n\n        } else {\n            BuzzyGlobal.throwError(\"Sorry, you are not allowed to that!\")\n        }\n\n\n\n\n    },\n    removeResourceAndChildren: function (currentResourceID){\n\n        var user = Meteor.user();\n        if (!user)\n            throw new Meteor.Error(401, \"You need to login to remove resources\");\n        var searchExpression = new RegExp(',' + currentResourceID +',$') ;\n        console.log(\"about to remove children:\" + searchExpression);\n        //Resources.remove({path:{$regex: searchExpression}});\n\n        var resource = Resources.findOne({_id:resourceID});\n\n        if (resource && Resources.canEdit(user._id, resource)){\n            Resources.remove({path:{$regex: searchExpression}}, function(error){\n                if (error) {\n                    // display the error to the user - Need to come back to fix 422 (not sure what # it should be???) as the error number\n                    throw new Meteor.Error(422, error.reason);\n                } else {\n                    console.log(\"Deleted child resources\");\n                }\n            });\n            console.log(\"about to remove resource:\" + currentResourceID);\n            //Resources.remove(currentResourceID);\n            Resources.remove(currentResourceID, function(error){\n                if (error) {\n                    // display the error to the user - Need to come back to fix 422 (not sure what # it should be???) as the error number\n                    throw new Meteor.Error(422, error.reason);\n                } else {\n                    console.log(\"Deleted resource:\" + currentResourceID);\n                }\n            });\n            return true;\n        } else {\n            BuzzyGlobal.throwError(\"Sorry, you are not allowed to that!\")\n        }\n\n\n\n\n    },\n\n\n/*  getIFramlely  getIFramlely: function () {\n        this.unblock();\n        return Meteor.http.get(\"GET\", \"http://search.twitter.com/search.json?q=perkytweets\");\n\n        Meteor.http.get(\"http://iframe.ly/api/iframely?url=http%3A%2F%2F8tracks.com%2Ffloresea%2Fwhen-darkness-comes&api_key=5b1136e1a563f47835eb6a\",\n\n            function (error, result) {\n                if (!error) {\n                    console.log(\"iframely called: \" + result.data.html);\n                    return  result.data.html;\n                } else {\n                    throw new Meteor.Error(500, \"iFramely Call failed:\" + error);\n                }\n            }\n        );\n    }*/\n\n\n});\n\n\n\nMeteor.startup(function () {\n    //process.env.MAIL_URL = 'smtp://postmaster@mg.buzzy.buzz:1lui1xunks31@smtp.mailgun.org:465';\n    process.env.MAIL_URL = 'smtp://adamgins:yHsCzjbQezmH6QzH4hD@smtp.sendgrid.net:587';\n\n\n\n});","\nMeteor.startup(function(){\n\n    BrowserPolicy.content.allowOriginForAll(\"*\");\n    BrowserPolicy.content.allowConnectOrigin(\"*\");\n    BrowserPolicy.content.allowConnectOrigin(\"ws://localhost:*\");\n    BrowserPolicy.content.allowConnectOrigin(\"wss://*.buzzy.buzz:*\");\n    BrowserPolicy.content.allowOriginForAll('fonts.gstatic.com');\n    BrowserPolicy.content.allowOriginForAll('*.googleapis.com');\n    BrowserPolicy.content.allowOriginForAll('*.facebook.com');\n    BrowserPolicy.content.allowOriginForAll('staticxx.facebook.com');\n    BrowserPolicy.content.allowOriginForAll('*.facebook.net');\n    BrowserPolicy.content.allowOriginForAll('maps.gstatic.com');\n    BrowserPolicy.content.allowOriginForAll('maps.google.com');\n    BrowserPolicy.content.allowOriginForAll('*.google.com');\n    BrowserPolicy.content.allowOriginForAll('*.kadira.io');\n    BrowserPolicy.content.allowOriginForAll('*.officeapps.live.com');\n    BrowserPolicy.content.allowOriginForAll('*.giphy.com');\n    BrowserPolicy.content.allowOriginForAll('*.filepicker.io');\n    BrowserPolicy.content.allowOriginForAll('*.filestack.com');\n    BrowserPolicy.content.allowOriginForAll('*.filestackcontent.com');\n    BrowserPolicy.content.allowOriginForAll('*.mailgun.org');\n    BrowserPolicy.content.allowOriginForAll('*.mailgun.net');\n    BrowserPolicy.content.allowEval(\"*.facebook.net\");\n    BrowserPolicy.content.allowEval(\"*.facebook.com\");\n    BrowserPolicy.content.allowEval(\"*.googleapis.com\");\n    BrowserPolicy.content.allowOriginForAll(\"http://meteor.local\");\n    BrowserPolicy.content.allowOriginForAll(\"cdn.mxpnl.com\");\n    BrowserPolicy.content.allowOriginForAll(\"*.demandbase.com\");\n    BrowserPolicy.content.allowOriginForAll(\"*.addthis.com\");\n    BrowserPolicy.content.allowOriginForAll(\"*.sharethis.com\");\n    BrowserPolicy.content.allowOriginForAll(\"*.zimmer.com\");\n    BrowserPolicy.framing.allowAll();\n\n\n\n})\n\n\n\n\nAccounts.config({\n\n    forbidClientAccountCreation: true,\n    sendVerificationEmail: true\n\n});\n\n\ntry {\n    ServiceConfiguration.configurations.remove({\n        service: \"google\"\n    });\n\n\n    ServiceConfiguration.configurations.insert({\n        service: \"google\",\n        clientId: \"419835751806-tk9ok18vu868vclrighlt8i5b79ulcrc.apps.googleusercontent.com\",\n        secret: \"zt8-nZGIr-6wwtEDuEouH3Gi\",\n        /* clientId: \"1090788978289-1ta1l80bu20vimn1ss7d2c68ckg059ab@developer.gserviceaccount.com\",\n         secret: \"tistRNI721VDmL671ohz-uaL\",*/\n        loginStyle: \"redirect\"\n\n    });\n\n}catch (err) {\n    console.log(\"ERROR with settings file\", err.message);\n    throw _.extend(new Error(\"Failed to setup Service Configuration \" + err.message),\n        {response: err.response});\n}\n\ntry {\n    ServiceConfiguration.configurations.remove({\n        service: \"twitter\"\n    });\n\n\n    ServiceConfiguration.configurations.insert({\n        service: \"twitter\",\n        consumerKey: \"JQzLHQ0hneUJ7bHeSC2hnmYZF\",\n        secret: \"JKSlAKxZTx1z33Xau8b6ACEUU1UwX7dIIajxrzXLPSkPRVs7f8\"\n\n\n    });\n\n}catch (err) {\n    console.log(\"ERROR with settings file\", err.message);\n    throw _.extend(new Error(\"Failed to setup Service Configuration \" + err.message),\n        {response: err.response});\n}\n\n\n\ntry {\n    ServiceConfiguration.configurations.remove({\n        service: \"facebook\"\n    });\n\n    ServiceConfiguration.configurations.insert({\n        service: \"facebook\",\n        appId: \"312825212218682\",\n        secret: \"f44373229ac118535a75f5815f984729\",\n\n    });\n\n}catch (err) {\n    console.log(\"ERROR with settings file\", err.message);\n    throw _.extend(new Error(\"Failed to setup Service Configuration \" + err.message),\n        {response: err.response});\n}\n\n\n\n\n\ntry {\n    var settings_file = EJSON.parse(Assets.getText('settings/' + Meteor.settings.BUZZY_SETTINGS_FILE +  '_settings.json'));\n\n    ServiceConfiguration.configurations.remove({\n        service: \"microsoft\"\n    });\n\n    ServiceConfiguration.configurations.insert({\n        service: \"microsoft\",\n\n        clientId: settings_file.microsoft.clientId,\n        secret: settings_file.microsoft.secret,\n        display: \"popup\",\n        scope:\"wl.signin wl.basic wl.emails\"\n\n    });\n\n}catch (err) {\n    console.log(\"ERROR with settings file\", err.message);\n    throw _.extend(new Error(\"Failed to setup Service Configuration \" + err.message),\n        {response: err.response});\n}\n\n\n\n/*Accounts.validateNewUser(function (user) {\n    //currently only checks google users\n    //return true; // temp while one plane\n\n\n    var email = gGetUserEmail(user);\n\n\n\n    var betaUserFoundCount = BetaUsers.find({email:email}).count();\n    if (betaUserFoundCount > 0){\n        return true\n\n    } else {\n        throw new Meteor.Error(422, \"Sorry \" + email + \" is not in our beta program. Please request access below\");\n        return false;\n    }\n\n});*/\n\nAccounts.onCreateUser(function(options, user) {\n    user.createdAt = new Date().getTime();\n    user.completedSetup = false;\n\n\n\n\n    if (user.services) {\n\n        var service = _.keys(user.services)[0];\n        var email = user.services[service].email;\n\n\n        if (service == 'facebook') {\n            if (!user.profile){\n                user.profile = {};\n\n            }\n            if (!user.profile.name){\n                user.profile.name = user.services[service].name;\n\n            }\n        }\n        if (service == 'google') {\n            if (!user.profile){\n                user.profile = {};\n\n            }\n\n            if (!user.profile.name){\n                user.profile.name = user.services[service].name;\n\n            }\n\n        }\n        if (service == 'microsoft') {\n            if (!user.profile){\n                user.profile = {};\n\n            }\n\n            if (!user.profile.name){\n                user.profile.name = user.services[service].name;\n\n            }\n\n        }\n\n        if (service == 'password') {\n            if (!user.profile){\n                user.profile = {};\n\n            }\n\n            if (!user.profile.name && email){\n                user.profile.name = email.split(\"@\")[0];\n\n            }\n\n        }\n\n        if (!email){\n            console.log(\"ON CREATE USER 3.1\",user );\n            return user;\n\n        }\n\n        // see if any existing user has this email address, otherwise create new\n        //var existingUser = Meteor.users.findOne({'emails.address': email});\n        var existingUser = BuzzyGlobal.gGetUserforEmail(email);\n\n\n\n\n        if (!existingUser){\n            user.email = email;\n            user.emails = [{address:email, verified: true}];\n            user.profile.channels = [{channel: BuzzyGlobal.gNOTIFICATION_CHANNEL.EMAIL, address:email, enabled: true}];\n            /*if (BuzzyLogging){\n                BuzzyLogging.call(\"track\", {\n                    action:\"createUser\",\n                    \"userID\": user._id?user._id:null,\n                    \"dateCreated\": new Date().getTime(),\n                    \"source\": \"registered\"\n                }, Meteor.settings.BUZZY_LOGGING_TOKEN);\n            }*/\n            return user;\n        }\n\n        if (!existingUser.profile){\n            existingUser.profile = user.profile;\n\n        }\n\n        if (existingUser.emails){\n\n            var inArrayPosition = function(emailArray){\n                for (i in emailArray){\n                    if (emailArray[i].address === email){\n                        return i;\n                    }\n                }\n                return -1;\n            }\n            var positionEmail = inArrayPosition(existingUser.emails);\n            if ( positionEmail == -1){\n\n                existingUser.emails.push({address:email, verified: true});\n\n            } else {\n                existingUser.emails[positionEmail].verified = true;\n            }\n        }\n\n        if (existingUser.profile.channels){\n\n            var found = false;\n            for (i in existingUser.profile.channels){\n                if (existingUser.profile.channels[i].channel === BuzzyGlobal.gNOTIFICATION_CHANNEL.EMAIL && existingUser.profile.channels[i].address === email){\n                    existingUser.profile.channels[i].enabled = true\n                    found = true;\n                }\n            }\n            if ( !found){\n\n                existingUser.profile.channels.push({channel: BuzzyGlobal.gNOTIFICATION_CHANNEL.EMAIL, address:email, enabled: true});\n\n            }\n        }\n\n        //Use $Pull to remove items from the array\n\n\n            // precaution, these will exist from accounts-password if used\n        if (!existingUser.services){\n            existingUser.services = { resume: { loginTokens: [] }};\n        }\n\n        if (!existingUser.services.resume){\n            existingUser.services.resume = { loginTokens: [] };\n\n        }\n\n\n        // copy accross new service info\n        existingUser.services[service] = user.services[service];\n        if (typeof user.services.resume!= \"undefined\")\n\n        {\n            existingUser.services.resume.loginTokens.push(\n                user.services.resume.loginTokens[0]\n            );\n        }\n\n\n        // even worse hackery\n        Meteor.users.remove({_id: existingUser._id}); // remove existing record\n        return existingUser;                          // record is re-inserted\n    }\n});\n\nAccounts.urls.enrollAccount = function (token) {\n    //return Meteor.absoluteUrl('enroll/' + token);\n    return Meteor.absoluteUrl('createpassword/1/?token=' + token);\n};\n\nAccounts.urls.resetPassword = function (token) {\n    return Meteor.absoluteUrl('createpassword/1/?token=' + token);\n};\n\n\nAccounts.emailTemplates.siteName = \"Buzzy\";\nAccounts.emailTemplates.from = \"Buzzy Buzz <info@buzzy.buzz>\";\n\nAccounts.emailTemplates.enrollAccount.subject = function (user) {\n    var senderName = BuzzyGlobal.gGetUserNameByID(Meteor.userId());\n    if (senderName && senderName.toLowerCase() !== \"unknown\"){\n        return senderName + \" invited you to Buzzy Buzz \";\n    } else {\n        return \"[Buzzy] Please activate your account\";\n    }\n\n};\nAccounts.emailTemplates.enrollAccount.text = function (user, url) {\n    //var buzzyLink = \"Buzzy Buzz\".link(\"http://my.buzzy.buzz\");\n    var senderName = BuzzyGlobal.gGetUserNameByID(Meteor.userId());\n    if (senderName.toLowerCase() === \"unknown\"){\n        return  senderName + \" Welcome to Buzzy. To activate your own Buzzy account, follow the link below and choose a new password:\\n\"\n            + url + \"\\n\\n\"\n            + \" OR if this email address is associated with either Google or Facebook, simply go to https://buzzy.buzz and select the â€˜Sign in with Googleâ€™ or â€˜Sign in with Facebookâ€™ button.\\n\"\n            + \"Thanks,\\n\"\n            + \"The team at Buzzy\"\n\n    } else {\n        return  senderName + \" has shared something and is inviting you to try out Buzzy. To activate your own Buzzy account and view \" + senderName + \"â€™s Buzz, follow the link below and choose a new password:\\n\"\n            + \" To activate your account, with a user name (your email address) and password simply click the link below:\\n\\n\"\n            + url + \"\\n\\n\"\n            + \" OR if this email address is associated with either Google or Facebook, simply go to https://buzzy.buzz and select the â€˜Sign in with Googleâ€™ or â€˜Sign in with Facebookâ€™ button.\\n\"\n            + \"Thanks,\\n\"\n            + \"The team at Buzzy\"\n    }\n\n};\n\nAccounts.emailTemplates.enrollAccount.html = function (user, url) {\n\n    var senderName = BuzzyGlobal.gGetUserNameByID(Meteor.userId());\n    if (senderName.toLowerCase() === \"unknown\"){\n        var emailHTML = Assets.getText('emails/rego-email-activate.htm');\n        emailHTML = emailHTML.replace(/BUZZY_ACTIVATE_LINK/g,url);\n\n        return emailHTML;\n    } else {\n        var emailHTML = Assets.getText('emails/rego-email-invite.htm');\n        emailHTML = emailHTML.replace(/BUZZY_ACTIVATE_LINK/g,url);\n        emailHTML = emailHTML.replace(/BUZZY_USERNAME/g,senderName);\n\n        return emailHTML;\n    }\n\n};\n\n\n\n","//This could be client side - so different for each user.\n// Will eventually have to get your instragram pics\n\n\n\nif (Resources.find().count() === 0) {\n\n   /* Accounts.createUser({email: 'adam_ginsburg@yahoo.com', password : 'gkU2eJzEi9DBgk'});\n    Accounts.createUser({email: 'dave@smallsilences.com', password : 'cKVX9sB2ARtiVX'});\n    */\n\n    var now = new Date().getTime();\n    var tempResourceID, tempResourceID2;\n\n    var tempUserID =  Meteor.users.insert({\n        profile: {\n            name: 'BuzzyAdmin',\n            email: 'buzzyadmin@buzzy.buzz'\n        }\n    });\n    console.log(\"tUI:\" + tempUserID);\n    user = Meteor.users.findOne(tempUserID);\n    console.log(\"user._id:\" + user._id);\n\n\n    tempResourceID = Resources.insert({\n        title: 'Meta Field' ,\n        userID: user._id,\n        author: user.profile.name,\n        path:null,\n        reusable:'free',\n        privacy:\"draft\",\n        status:'published',\n        type: BuzzyGlobal.gBASICTYPES.META_FIELD,\n        isBasic:true,\n        isStarterTemplate:true,\n        CSSclass: '',\n        submitted: now ,\n        special:true,\n        avatar: '<i class=\\\"fa fa-fw fa-asterisk\\\"><\\/i>'\n    });\n\n    tempResourceID = Resources.insert({\n        title: 'Table' ,\n        userID: user._id,\n        author: user.profile.name,\n        path:null,\n        reusable:'free',\n        privacy:\"public\",\n        status:'published',\n        type: BuzzyGlobal.gBASICTYPES.TABLE,\n        isBasic:true,\n        special:true,\n        isStarterTemplate:true,\n        CSSclass: '',\n        submitted: now ,\n        avatar: '<i class=\\\"fa fa-fw fa-table\\\"><\\/i>',\n        content: '<table><tbody><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr></tbody></table>'\n    });\n\n    tempResourceID = Resources.insert({\n        title: 'Embeded Buzz' ,\n        userID: user._id,\n        author: user.profile.name,\n        path:null,\n        reusable:'free',\n        privacy:\"public\",\n        status:'published',\n        type: BuzzyGlobal.gBASICTYPES.EMBED_BUZZ,\n        isBasic:true,\n        isStarterTemplate:true,\n        CSSclass: '',\n        submitted: now ,\n        special:true,\n        avatar: '<i class=\\\"fa fa-fw fa-magic\\\"><\\/i>'\n    });\n\n    tempResourceID = Resources.insert({\n        title: '1 Column (12)' ,\n        userID: user._id,\n        author: user.profile.name,\n        path:null,\n        reusable:'free',\n        privacy:\"public\",\n        status:'published',\n        type: BuzzyGlobal.gBASICTYPES.CONTENT_LAYOUT_ROW,\n        isBasic:false,\n        special:true,\n        isStarterTemplate:true,\n        CSSclass: 'row',\n        submitted: now ,\n        avatar: '\\t\\x3Cdiv class=\\\"layout-schematic\\\"\\x3E\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\x3Cdiv class=\\\"row\\\"\\x3E\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\x3Cdiv class=\\\"col-xs-12\\\"\\x3E\\x3Cdiv class=\\\"layout-schematic-module\\\"\\x3E\\x3C\\x2Fdiv\\x3E\\x3C\\x2Fdiv\\x3E\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\n\\t\\t\\t\\t\\t\\t\\t\\t\\x3C\\x2Fdiv\\x3E'\n    });\n\n    var tempResourceIDChild1 = Resources.insert({\n        title: 'Placeholder md-12' ,\n        userID: user._id,\n        author: user.profile.name,\n        path: \",\" + tempResourceID + \",\",\n        reusable:'free',\n        privacy:\"public\",\n        status:'published',\n        special:true,\n        type: BuzzyGlobal.gBASICTYPES.CONTENT_LAYOUT_COLUMN,\n        isBasic:false,\n        isStarterTemplate:false,\n        CSSclass: 'col-md-12',\n        submitted: now,\n        avatar: '\\t\\x3Cdiv class=\\\"layout-schematic\\\"\\x3E\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\x3Cdiv class=\\\"row\\\"\\x3E\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\x3Cdiv class=\\\"col-xs-12\\\"\\x3E\\x3Cdiv class=\\\"layout-schematic-module\\\"\\x3E\\x3C\\x2Fdiv\\x3E\\x3C\\x2Fdiv\\x3E\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\n\\t\\t\\t\\t\\t\\t\\t\\t\\x3C\\x2Fdiv\\x3E'\n    });\n\n    tempResourceID = Resources.insert({\n        title: 'Application' ,\n        userID: user._id,\n        author: user.profile.name,\n        path:null,\n        reusable:'free',\n        privacy:\"public\",\n        status:'published',\n        isStarterTemplate:true,\n        special:true,\n        isBasic:true,\n        type: BuzzyGlobal.gBASICTYPES.APPLICATION,\n        content:{\n            whoCanAdd:BuzzyGlobal.gAPPFIELD_INTERACT.OWNERS_AND_AUTHORS,\n            whoCanDelete:BuzzyGlobal.gAPPFIELD_INTERACT.OWNERS_AND_AUTHORS,\n\n        },\n        CSSclass: 'row',\n        submitted: now ,\n        avatar: '<i class=\\\"fa fa-fw fa-asterisk\\\"><\\/i>'\n    });\n\n    tempResourceID = Resources.insert({\n        title: 'Rest Call' ,\n        userID: user._id,\n        author: user.profile.name,\n        path:null,\n        reusable:'free',\n        privacy:\"public\",\n        status:'published',\n        isStarterTemplate:true,\n        special:true,\n        isBasic:true,\n        type: BuzzyGlobal.gBASICTYPES.RESTCALL,\n        content:{url:null},\n        CSSclass: 'row',\n        submitted: now ,\n        avatar: '<i class=\\\"fa fa-fw fa-rss-square\\\"><\\/i>'\n    });\n\n    tempResourceID = Resources.insert({\n        title: 'Filepicker Gallery' ,\n        userID: user._id,\n        author: user.profile.name,\n        path:null,\n        reusable:'free',\n        privacy:\"public\",\n        status:'published',\n        isStarterTemplate:true,\n        special:true,\n        isBasic:true,\n        type: BuzzyGlobal.gBASICTYPES.FILEPICKER_GALLERY,\n        CSSclass: 'row',\n        submitted: now ,\n        avatar: '<i class=\\\"fa fa-fw fa-picture-o\\\"><\\/i>'\n    });\n\n    tempResourceID = Resources.insert({\n        title: 'Filepicker File' ,\n        userID: user._id,\n        author: user.profile.name,\n        path:null,\n        reusable:'free',\n        privacy:\"public\",\n        status:'published',\n        isStarterTemplate:true,\n        special:true,\n        isBasic:true,\n        type: BuzzyGlobal.gBASICTYPES.FILEPICKER,\n        CSSclass: 'row',\n        submitted: now ,\n        avatar: '<i class=\\\"fa fa-fw fa-paperclip\\\"><\\/i>'\n    });\n\n    tempResourceID = Resources.insert({\n        title: '2 Column (8 + 4)' ,\n        userID: user._id,\n        author: user.profile.name,\n        path:null,\n        reusable:'free',\n        privacy:\"public\",\n        status:'published',\n        isStarterTemplate:true,\n        special:true,\n        isBasic:true,\n        type: BuzzyGlobal.gBASICTYPES.CONTENT_LAYOUT_ROW,\n        CSSclass: 'row',\n        submitted: now ,\n        avatar: '\\x3Cdiv class=\\\"layout-schematic\\\"\\x3E\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\x3Cdiv class=\\\"row\\\"\\x3E\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\x3Cdiv class=\\\"col-xs-8\\\"\\x3E\\x3Cdiv class=\\\"layout-schematic-module\\\"\\x3E\\x3C\\x2Fdiv\\x3E\\x3C\\x2Fdiv\\x3E\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\x3Cdiv class=\\\"col-xs-4\\\"\\x3E\\x3Cdiv class=\\\"layout-schematic-module\\\"\\x3E\\x3C\\x2Fdiv\\x3E\\x3C\\x2Fdiv\\x3E\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\x3C\\x2Fdiv\\x3E\\n\\t\\t\\t\\t\\t\\t\\t\\t\\x3C\\x2Fdiv\\x3E'\n    });\n\n    var tempResourceIDChild2  = Resources.insert({\n        title: 'Placeholder md-8' ,\n        userID: user._id,\n        author: user.profile.name,\n        path: \",\" + tempResourceID + \",\",\n        reusable:'free',\n        privacy:\"public\",\n        status:'published',\n        type: BuzzyGlobal.gBASICTYPES.CONTENT_LAYOUT_COLUMN,\n        isBasic:true,\n        special:true,\n        isStarterTemplate:false,\n        CSSclass: 'col-sm-8',\n        rank: 1,\n        submitted: now,\n        avatar: '<table class=\\\"layoutAvatar\\\">\\r\\n    <tr>\\r\\n        <td><div><\\/div><\\/td>\\r\\n    <\\/tr>\\r\\n<\\/table>'\n    });\n\n    var tempResourceIDChild1 = Resources.insert({\n        title: 'Placeholder md-4' ,\n        userID: user._id,\n        author: user.profile.name,\n        path: \",\" + tempResourceID + \",\",\n        reusable:'free',\n        special:true,\n        privacy:\"public\",\n        status:'published',\n        type: BuzzyGlobal.gBASICTYPES.CONTENT_LAYOUT_COLUMN,\n        isBasic:true,\n        isStarterTemplate:false,\n        CSSclass: 'col-sm-4',\n        rank: 2,\n        submitted: now,\n        avatar: '<table class=\\\"layoutAvatar\\\">\\r\\n    <tr>\\r\\n        <td><div><\\/div><\\/td>\\r\\n    <\\/tr>\\r\\n<\\/table>'\n    });\n\n\n    tempResourceID = Resources.insert({\n        title: '2 Column (4 + 8)' ,\n        userID: user._id,\n        author: user.profile.name,\n        path:null,\n        reusable:'free',\n        privacy:\"public\",\n        status:'published',\n        isStarterTemplate:true,\n        special:true,\n        isBasic:true,\n        type: BuzzyGlobal.gBASICTYPES.CONTENT_LAYOUT_ROW,\n        CSSclass: 'row',\n        submitted: now ,\n        avatar: '\\x3Cdiv class=\\\"layout-schematic\\\"\\x3E\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\x3Cdiv class=\\\"row\\\"\\x3E\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\x3Cdiv class=\\\"col-xs-4\\\"\\x3E\\x3Cdiv class=\\\"layout-schematic-module\\\"\\x3E\\x3C\\x2Fdiv\\x3E\\x3C\\x2Fdiv\\x3E\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\x3Cdiv class=\\\"col-xs-8\\\"\\x3E\\x3Cdiv class=\\\"layout-schematic-module\\\"\\x3E\\x3C\\x2Fdiv\\x3E\\x3C\\x2Fdiv\\x3E\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\x3C\\x2Fdiv\\x3E\\n\\t\\t\\t\\t\\t\\t\\t\\t\\x3C\\x2Fdiv\\x3E'\n    });\n\n    var tempResourceIDChild1 = Resources.insert({\n        title: 'Placeholder md-4' ,\n        userID: user._id,\n        author: user.profile.name,\n        path: \",\" + tempResourceID + \",\",\n        reusable:'free',\n        privacy:\"public\",\n        status:'published',\n        type: BuzzyGlobal.gBASICTYPES.CONTENT_LAYOUT_COLUMN,\n        isBasic:true,\n        isStarterTemplate:false,\n        special:true,\n        CSSclass: 'col-sm-4',\n        rank: 1,\n        submitted: now,\n        avatar: '<table class=\\\"layoutAvatar\\\">\\r\\n    <tr>\\r\\n        <td><div><\\/div><\\/td>\\r\\n    <\\/tr>\\r\\n<\\/table>'\n    });\n    var tempResourceIDChild2  = Resources.insert({\n        title: 'Placeholder md-8' ,\n        userID: user._id,\n        author: user.profile.name,\n        path: \",\" + tempResourceID + \",\",\n        reusable:'free',\n        special:true,\n        privacy:\"public\",\n        status:'published',\n        type: BuzzyGlobal.gBASICTYPES.CONTENT_LAYOUT_COLUMN,\n        isBasic:true,\n        isStarterTemplate:false,\n        CSSclass: 'col-sm-8',\n        rank: 2,\n        submitted: now,\n        avatar: '<table class=\\\"layoutAvatar\\\">\\r\\n    <tr>\\r\\n        <td><div><\\/div><\\/td>\\r\\n    <\\/tr>\\r\\n<\\/table>'\n    });\n\n    tempResourceID = Resources.insert({\n        title: '3 Column (4 + 4 + 4)' ,\n        userID: user._id,\n        author: user.profile.name,\n        path:null,\n        reusable:'free',\n        special:true,\n        privacy:\"public\",\n        status:'published',\n        isBasic:true,\n        isStarterTemplate:true,\n        type: BuzzyGlobal.gBASICTYPES.CONTENT_LAYOUT_ROW,\n        CSSclass: 'row',\n        rank: 1,\n        submitted: now,\n        avatar: '\\x3Cdiv class=\\\"layout-schematic\\\"\\x3E\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\x3Cdiv class=\\\"row\\\"\\x3E\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\x3Cdiv class=\\\"col-xs-4\\\"\\x3E\\x3Cdiv class=\\\"layout-schematic-module\\\"\\x3E\\x3C\\x2Fdiv\\x3E\\x3C\\x2Fdiv\\x3E\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\x3Cdiv class=\\\"col-xs-4\\\"\\x3E\\x3Cdiv class=\\\"layout-schematic-module\\\"\\x3E\\x3C\\x2Fdiv\\x3E\\x3C\\x2Fdiv\\x3E\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\x3Cdiv class=\\\"col-xs-4\\\"\\x3E\\x3Cdiv class=\\\"layout-schematic-module\\\"\\x3E\\x3C\\x2Fdiv\\x3E\\x3C\\x2Fdiv\\x3E\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\x3C\\x2Fdiv\\x3E\\n\\t\\t\\t\\t\\t\\t\\t\\t\\x3C\\x2Fdiv\\x3E'\n    });\n\n    var tempResourceIDChild1 = Resources.insert({\n        title: 'Placeholder md-4' ,\n        userID: user._id,\n        author: user.profile.name,\n        path: \",\" + tempResourceID + \",\",\n        reusable:'free',\n        special:true,\n        privacy:\"public\",\n        status:'published',\n        type: BuzzyGlobal.gBASICTYPES.CONTENT_LAYOUT_COLUMN,\n        isBasic:true,\n        isStarterTemplate:false,\n        CSSclass: 'col-sm-4',\n        rank: 1,\n        submitted: now,\n        avatar: '<table class=\\\"layoutAvatar\\\">\\r\\n    <tr>\\r\\n        <td><div><\\/div><\\/td>\\r\\n    <\\/tr>\\r\\n<\\/table>'\n    });\n    var tempResourceIDChild2  = Resources.insert({\n        title: 'Placeholder md-4' ,\n        userID: user._id,\n        author: user.profile.name,\n        path: \",\" + tempResourceID + \",\",\n        reusable:'free',\n        special:true,\n        privacy:\"public\",\n        status:'published',\n        type: BuzzyGlobal.gBASICTYPES.CONTENT_LAYOUT_COLUMN,\n        isBasic:true,\n        isStarterTemplate:false,\n        CSSclass: 'col-sm-4',\n        rank: 2,\n        submitted: now,\n        avatar: '<table class=\\\"layoutAvatar\\\">\\r\\n    <tr>\\r\\n        <td><div><\\/div><\\/td>\\r\\n    <\\/tr>\\r\\n<\\/table>'\n    });\n    var tempResourceIDChild3  = Resources.insert({\n        title: 'Placeholder md-4' ,\n        userID: user._id,\n        author: user.profile.name,\n        path: \",\" + tempResourceID + \",\",\n        reusable:'free',\n        special:true,\n        privacy:\"public\",\n        status:'published',\n        type: BuzzyGlobal.gBASICTYPES.CONTENT_LAYOUT_COLUMN,\n        isBasic:true,\n        isStarterTemplate:false,\n        CSSclass: 'col-sm-4 droppable-layout',\n        rank: 3,\n        submitted: now,\n        avatar: '<table class=\\\"layoutAvatar\\\">\\r\\n    <tr>\\r\\n        <td><div><\\/div><\\/td>\\r\\n    <\\/tr>\\r\\n<\\/table>'\n    });\n    tempResourceID = Resources.insert({\n        title: '2 Column (6 + 6)' ,\n        userID: user._id,\n        author: user.profile.name,\n        path:null,\n        reusable:'free',\n        special:true,\n        privacy:\"public\",\n        status:'published',\n        isBasic:true,\n        isStarterTemplate:true,\n        type: BuzzyGlobal.gBASICTYPES.CONTENT_LAYOUT_ROW,\n        CSSclass: 'row',\n        submitted: now,\n        avatar: '\\x3Cdiv class=\\\"layout-schematic\\\"\\x3E\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\x3Cdiv class=\\\"row\\\"\\x3E\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\x3Cdiv class=\\\"col-xs-6\\\"\\x3E\\x3Cdiv class=\\\"layout-schematic-module\\\"\\x3E\\x3C\\x2Fdiv\\x3E\\x3C\\x2Fdiv\\x3E\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\x3Cdiv class=\\\"col-xs-6\\\"\\x3E\\x3Cdiv class=\\\"layout-schematic-module\\\"\\x3E\\x3C\\x2Fdiv\\x3E\\x3C\\x2Fdiv\\x3E\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\x3C\\x2Fdiv\\x3E\\n\\t\\t\\t\\t\\t\\t\\t\\t\\x3C\\x2Fdiv\\x3E'\n    });\n\n    var tempResourceIDChild1 = Resources.insert({\n        title: 'Placeholder md-6' ,\n        userID: user._id,\n        author: user.profile.name,\n        path: \",\" + tempResourceID + \",\",\n        reusable:'free',\n        special:true,\n        privacy:\"public\",\n        status:'published',\n        type: BuzzyGlobal.gBASICTYPES.CONTENT_LAYOUT_COLUMN,\n        isBasic:true,\n        isStarterTemplate:false,\n        CSSclass: 'col-sm-6',\n        rank: 1,\n        submitted: now,\n        avatar: '<table class=\\\"layoutAvatar\\\">\\r\\n    <tr>\\r\\n        <td><div><\\/div><\\/td>\\r\\n    <\\/tr>\\r\\n<\\/table>'\n    });\n    var tempResourceIDChild2  = Resources.insert({\n        title: 'Placeholder md-6' ,\n        userID: user._id,\n        author: user.profile.name,\n        path: \",\" + tempResourceID + \",\",\n        reusable:'free',\n        special:true,\n        privacy:\"public\",\n        status:'published',\n        type: BuzzyGlobal.gBASICTYPES.CONTENT_LAYOUT_COLUMN,\n        isBasic:true,\n        isStarterTemplate:false,\n        CSSclass: 'col-sm-6',\n        rank: 2,\n        submitted: now,\n        avatar: '<table class=\\\"layoutAvatar\\\">\\r\\n    <tr>\\r\\n        <td><div><\\/div><\\/td>\\r\\n    <\\/tr>\\r\\n<\\/table>'\n    });\n\n    tempResourceID = Resources.insert({\n        title: 'text',\n        userID: user._id,\n        author: user.profile.name,\n        path:null,\n        reusable:'free',\n        special:true,\n        privacy:\"public\",\n        status:'published',\n        isBasic:true,\n        isStarterTemplate:true,\n        type: BuzzyGlobal.gBASICTYPES.TEXT,\n         message: '', content:null,\n        \n        \n        submitted: now ,\n        CSSclass: '',\n        avatar:'<i class=\\\"fa fa-fw fa-align-left\\\"><\\/i>'\n    });\n\n\n\n    tempResourceID = Resources.insert({\n        title: 'Blank Buzz',\n        userID: user._id,\n        author: user.profile.name,\n        path:null,\n        reusable:'free',\n        special:true,\n        privacy:\"public\",\n        status:'published',\n        type: BuzzyGlobal.gBASICTYPES.BUZZ,\n        isBasic:false,\n        privacy:\"public\",\n        isStarterTemplate:true,\n         message: '', content:null,\n        submitted: now ,\n        CSSclass: '',\n        avatar:'<span style=\\\"font-size: 3.2em;\\\" class=\\\"fa fa-header\\\"><\\/span>'\n    });\n\n\n\n\n\n    tempResourceID2 = Resources.insert({\n        title: 'Conversation Buzz (aka SMS)',\n        userID: user._id,\n        author: user.profile.name,\n        path:null,\n        reusable:'free',\n        special:true,\n        privacy:\"public\",\n        status:'published',\n        type: BuzzyGlobal.gBASICTYPES.BUZZ,\n        isBasic:false,\n        privacy:\"public\",\n        isStarterTemplate:true,\n        message: '',\n        content:null,\n        submitted: now ,\n        CSSclass: '',\n        avatar:'<span style=\\\"font-size: 3.2em;\\\" class=\\\"fa fa-header\\\"><\\/span>',\n        showComments: 'along-side'\n    });\n\n\n   /* tempResourceID = Resources.insert({\n        title: 'Discussion',\n        userID: user._id,\n        author: user.profile.name,\n        path:\",\" + tempResourceID2 + \",\",\n        reusable:'free',\n        special:true,\n        privacy:\"public\",\n        status:'published',\n        showComments: 'along-side',\n        isStarterTemplate:true,\n        isBasic:true,\n        type: BuzzyGlobal.gBASICTYPES.COMMENTS,\n        message: '', content:null,\n        submitted: now ,\n        CSSclass: '',\n        avatar:'<i class=\\\"fa fa-comments\\\"><\\/i>',\n        rank: 1\n    });*/\n\n    tempResourceID = Resources.insert({\n        title: 'Image',\n        userID: user._id,\n        author: user.profile.name,\n        path:null,\n        reusable:'free',\n        special:true,\n        privacy:\"public\",\n        status:'published',\n        isBasic:true,\n        isStarterTemplate:true,\n        type: BuzzyGlobal.gBASICTYPES.IMAGE,\n         message: '', content:null,\n        submitted: now ,\n        CSSclass: '',\n        avatar:'<i class=\\\"fa fa-picture-o\\\"></i>'\n    });\n    tempResourceID = Resources.insert({\n        title: 'Video',\n        userID: user._id,\n        author: user.profile.name,\n        path:null,\n        privacy:\"public\",\n        reusable:'free',\n        special:true,\n        status:'published',\n        isBasic:true,\n        isStarterTemplate:true,\n        type: BuzzyGlobal.gBASICTYPES.VIDEO,\n         message: '', content:null,\n        submitted: now ,\n        CSSclass: '',\n        avatar:'<i class=\\\"fa fa-film\\\"><\\/i>'\n    });\n\n    tempResourceID = Resources.insert({\n        title: 'Embedded Link',\n        userID: user._id,\n        author: user.profile.name,\n        path:null,\n        reusable:'free',\n        special:true,\n        privacy:\"public\",\n        status:'published',\n        isBasic:true,\n        isStarterTemplate:true,\n        type: BuzzyGlobal.gBASICTYPES.EMBEDDED_LINK,\n        message: 'enter URL',\n        submitted: now ,\n        CSSclass: '',\n        avatar:'<i class=\\\"fa fa-usd\\\"><\\/i>'\n    });\n\n    \n\n    tempResourceID = Resources.insert({\n        title: 'Clickable Button',\n        userID: user._id,\n        author: user.profile.name,\n        path:null,\n        reusable:'free',\n        special:true,\n        privacy:\"public\",\n        status:'published',\n        isBasic:true,\n        isStarterTemplate:true,\n        type: BuzzyGlobal.gBASICTYPES.BUTTON,\n        message: 'enter URL',\n        submitted: now ,\n        CSSclass: '',\n        avatar:'<i class=\\\"fa fa-hand-pointer-o\\\"><\\/i>'\n    });\n    tempResourceID = Resources.insert({\n        title: 'Payment Button',\n        userID: user._id,\n        author: user.profile.name,\n        path:null,\n        reusable:'free',\n        special:true,\n        privacy:\"public\",\n        status:'published',\n        isBasic:true,\n        isStarterTemplate:true,\n        type: BuzzyGlobal.gBASICTYPES.PAYMENT,\n        message: 'enter URL',\n        submitted: now ,\n        CSSclass: '',\n        avatar:'<i class=\\\"fa fa-usd\\\"><\\/i>'\n    });\n\n    tempResourceID = Resources.insert({\n        title: 'Slide Show',\n        userID: user._id,\n        author: user.profile.name,\n        path:null,\n        reusable:'free',\n        special:true,\n        privacy:\"public\",\n        status:'draft',\n        isStarterTemplate:true,\n        isBasic:true,\n        type: BuzzyGlobal.gBASICTYPES.SLIDESHOW,\n        message: 'enter URL',\n        submitted: now ,\n        CSSclass: '',\n        avatar:'<i class=\\\"fa fa-file-image-o\\\"><\\/i>'\n    });\n     tempResourceID = Resources.insert({\n            title: 'Gallery',\n            userID: user._id,\n            author: user.profile.name,\n            path:null,\n            reusable:'free',\n            special:true,\n            privacy:\"public\",\n            status:'draft',\n            isStarterTemplate:true,\n            isBasic:true,\n            type: BuzzyGlobal.gBASICTYPES.GALLERY,\n            message: 'enter URL',\n            submitted: now ,\n            CSSclass: '',\n            avatar:'<i class=\\\"fa fa-th\\\"><\\/i>'\n        });\n\n    tempResourceID = Resources.insert({\n        title: 'Menu List',\n        userID: user._id,\n        author: user.profile.name,\n        path:null,\n        reusable:'free',\n        special:true,\n        privacy:\"public\",\n        status:'draft',\n        isStarterTemplate:true,\n        isBasic:true,\n        type: BuzzyGlobal.gBASICTYPES.TAG_QUERY,\n        message: 'enter URL',\n        submitted: now ,\n        CSSclass: '',\n        avatar:'<i class=\\\"fa fa-list\\\"><\\/i>'\n    });\n\n    tempResourceID = Resources.insert({\n        title: 'Twitter',\n        userID: user._id,\n        author: user.profile.name,\n        path:null,\n        reusable:'free',\n        special:true,\n        privacy:\"public\",\n        status:'published',\n        isBasic:true,\n        isStarterTemplate:true,\n        type: BuzzyGlobal.gBASICTYPES.TWITTER,\n        message: '', content:null,\n        submitted: now ,\n        CSSclass: '',\n        avatar:'<i class=\\\"fa fa-twitter\\\"></i>'\n    });\n\n    tempResourceID = Resources.insert({\n        title: 'GIPHY',\n        userID: user._id,\n        author: user.profile.name,\n        path:null,\n        reusable:'free',\n        special:true,\n        privacy:\"public\",\n        status:'published',\n        isBasic:true,\n        isStarterTemplate:true,\n        type: BuzzyGlobal.gBASICTYPES.GIPHY,\n        message: '', content:null,\n        submitted: now ,\n        CSSclass: '',\n        avatar:'<i class=\\\"fa fa-file-image-o\\\"></i>'\n    });\n\n    tempResourceID = Resources.insert({\n        title: 'Google Map',\n        userID: user._id,\n        author: user.profile.name,\n        path:null,\n        reusable:'free',\n        special:true,\n        privacy:\"public\",\n        status:'published',\n        isBasic:true,\n        isStarterTemplate:true,\n        type: BuzzyGlobal.gBASICTYPES.GOOGLE_MAP,\n        message: '', content:null,\n        submitted: now ,\n        CSSclass: '',\n        avatar:'<i class=\\\"fa fa-map-marker\\\"></i>'\n    });\n\n    tempResourceID = Resources.insert({\n        title: 'Google Drive',\n        userID: user._id,\n        author: user.profile.name,\n        path:null,\n        reusable:'free',\n        special:true,\n        privacy:\"public\",\n        status:'published',\n        isBasic:true,\n        isStarterTemplate:true,\n        type: BuzzyGlobal.gBASICTYPES.GOOGLE_DRIVE,\n        message: '', content:null,\n        submitted: now ,\n        CSSclass: '',\n        avatar:'<i class=\\\"fa fa-google\\\"></i>'\n    });\n\n    tempResourceID = Resources.insert({\n        title: 'Web Content',\n        userID: user._id,\n        author: user.profile.name,\n        path:null,\n        reusable:'free',\n        special:true,\n        privacy:\"public\",\n        status:'published',\n        isBasic:true,\n        isStarterTemplate:true,\n        type: BuzzyGlobal.gBASICTYPES.EXTERNAL_SERVICE,\n        message: '', content:null,\n        submitted: now ,\n        CSSclass: '',\n        avatar:'<i class=\\\"fa fa-globe\\\"></i>'\n    });\n\n\n\n    /*\n        Resources.insert({\n            title: 'Some item A' ,\n            userID: user._id,\n            author: user.profile.name,\n            path: \",\" + tempResourceID   + \",\" + tempResourceIDChild1 + \",\",\n            reusable:'free',\n            type: 'message',\n            CSSclass: '',\n            submitted: now - i * 3600 * 1000,\n            avatar: ''\n        });\n\n        Resources.insert({\n            title: 'Some item B' ,\n            userID: user._id,\n            author: user.profile.name,\n            path: \",\" + tempResourceID  + \",\" + tempResourceIDChild1 + \",\",\n            reusable:'free',\n            type: 'message',\n            CSSclass: '',\n            submitted: now - i * 3600 * 1000,\n            avatar: ''\n        });\n\n        var tempInsertID = Resources.insert({\n            _id: new Meteor.Collection.ObjectID()._str,\n            title: 'Some item C' ,\n            userID: user._id,\n            author: user.profile.name,\n            path: \",\" + tempResourceID  + \",\" + tempResourceIDChild1 + \",\",\n            reusable:'free',\n            type: 'message',\n            CSSclass: '',\n            submitted: now - i * 3600 * 1000,\n            avatar: ''\n        });\n        console.log(\"tempInsertID:\" +tempInsertID);\n    */\n    /*\n    tempResourceID = ContentLayouts.insert({\n        title: '2 Column' ,\n        userID: user._id,\n        author: user.profile.name,\n        type: 'contentlayout',\n        contentLayoutHTML: 'col-sm-6',\n        submitted: now - i * 3600 * 1000,\n        avatar:'<table class=\\\"layoutAvatar\\\">\\r\\n    <tr>\\r\\n        <td><div><\\/div><\\/td>\\r\\n       <td><div><\\/div><\\/td>\\r\\n    <\\/tr>\\r\\n<\\/table>'\n\n    });\n    tempResourceID = ContentLayouts.insert({\n        title: '3 Column' ,\n        userID: user._id,\n        author: user.profile.name,\n        type: 'contentlayout',\n        contentLayoutHTML: 'col-sm-4',\n        submitted: now - i * 3600 * 1000,\n        avatar: '<table class=\\\"layoutAvatar\\\">\\r\\n    <tr>\\r\\n        <td><div><\\/div><\\/td>\\r\\n        <td><div><\\/div><\\/td>\\r\\n        <td><div><\\/div><\\/td>\\r\\n    <\\/tr>\\r\\n<\\/table>\\r\\n    <\\/tr>\\r\\n    <\\/table>'\n    });\n    tempResourceID = ContentLayouts.insert({\n        title: '4 Column' ,\n        userID: user._id,\n        author: user.profile.name,\n        type: 'contentlayout',\n        contentLayoutHTML: 'col-sm-3',\n        submitted: now - i * 3600 * 1000,\n        avatar: '<table class=\\\"layoutAvatar\\\">\\r\\n    <tr>\\r\\n        <td><div><\\/div><\\/td>\\r\\n        <td><div><\\/div><\\/td>\\r\\n        <td><div><\\/div><\\/td>\\r\\n        <td><div><\\/div><\\/td>\\r\\n    <\\/tr>\\r\\n<\\/table>'\n    });\n    */\n\n\n/*\n    // connect the twitter api\n    console.log(\"about to creat new twit\");\n    var twit = new TwitMaker({\n        consumer_key: 'bIzTRcmTZjoCslPLlBWdx4mGR',\n        consumer_secret: 'GvHWwvZGUW6nxHxPb5Bwohefaw0EgwZ5Hy3eLVE904edkzO4hR',\n        access_token: '8525862-N1wT6QO3pPtBpMPdKjcm06adNKnp14nvtCo2LMUM2M',\n        access_token_secret: '2PyZdmO2AktnJ3yO3KETrA3F4BQMFa1xVk5hthtkVsmry'\n    });\n\n\n\n\n    twit.get('search/tweets', { q: 'cnn', lang:'en', count: 10 }, function(err, data, response) {\n        console.log(data.statuses[0]);\n\n        //var stuff = JSON.parse(data);\n        var Fiber = Npm.require('fibers');\n\n        console.log(\"for 0 ------------------------------\");\n        var i = 0;\n        console.log(\"text:\" + data.statuses[i].text);\n        console.log(\"user:\" + data.statuses[i].user.name);\n        console.log(\"created:\" + data.statuses[i].created_at);\n        //console.log(\"url:\" + data.statuses[i].url);\n\n\n        Fiber(function() {\n\n            console.log(\"in fiber:\" + data.statuses[0].text);\n            for (i in data.statuses){\n                var insertedTweet = TweetCache.insert({\n                    text: data.statuses[i].text,\n                    user: data.statuses[i].user.name,\n                    created: data.statuses[i].created_at\n                });\n                console.log(\"insertedTweet:\" + insertedTweet);\n\n            }\n\n\n        }).run();\n\n\n\n    });\n\n    //CacheIGForSearchTerm(\"surfing\");\n\n    /*ig.user('adam_ginsburg', function(err, result, limit) {\n     console.log(\"err:\" + err);\n     console.log(\"result:\" + result);\n\n     });*/\n\n\n\n\n\n\n}","/**\n * Created by adamginsburg on 25/05/15.\n */\n\n\n\nMailer.config({\n    from: 'Buzzy Buzz <info@buzzy.buzz>',\n    replyTo: 'Buzzy Buzz <info@buzzy.buzz>',\n    testEmail:'adam.ginsburg@gmail.com',\n    logger: console,\n    addRoutes:false\n\n});\n\nMeteor.startup(function() {\n\n    Mailer.init({\n        templates: Templates,     // Global Templates namespace, see lib/templates.js.\n        helpers: TemplateHelpers, // Global template helper namespace.\n        layout: {\n            name: 'emailLayout',\n            path: 'emails/email-notification/layout.html',   // Relative to 'private' dir.\n            css: 'emails/email-notification/style.css'\n        }\n    });\n\n});\n\n\n\n","/**\n * Created by adamginsburg on 25/11/2014.\n */\n/*Meteor.startup(function (){\n    var phantomExec, result, titleTest;\n\n    phantomExec = phantomLaunch();\n\n    titleTest = function(url, callback) {\n        var page, webpage;\n        webpage = require('webpage');\n        page = webpage.create();\n        return page.open(url, function(status) {\n\n            var title;\n            if (status === 'fail') {\n                return callback('load-failure');\n            } else {\n                title = page.evaluate(function() {\n                    return document.title;\n                });\n                return callback(void 0, title);\n            }\n        });\n    };\n    screenShot = function(url, callback) {\n        var page = require('webpage').create();\n        page.open(url, function() {\n            page.render('phantom.png');\n            setTimeout(function() {\n                phantom.exit();\n                return callback(void 0, \"done\");\n            }, 5000);\n            //phantom.exit();\n\n        });\n    };\n\n    screenShot2 = function(url, callback) {\n        var page = require(\"webpage\").create();\n        var homePage = url;\n        page.settings.javascriptEnabled = true;\n        page.settings.loadImages = true;\n        page.open(homePage);\n        page.onLoadFinished = function(status) {\n            var url = page.url;\n            console.log(\"Status:  \" + status);\n            console.log(\"Loaded:  \" + url);\n            page.render(\"google.png\");\n            phantom.exit();\n        };\n    };\n\n\n\n    //result = phantomExec(screenShot2, 'http://google.com/');\n\n    console.log(\"Phantom test:\" + result);\n\n});*/\n\n","var getContactID = function(contact){\n    if (contact.status === BuzzyGlobal.gUSERSTATUS.PENDING && contact.userID === this.userId){\n        return contact.userID;\n    } else {\n        return contact.contactID;\n    }\n\n}\n\nvar getUserContacts = function(resource, self){\n    if (Meteor.settings.BUZZY_DEBUG){\n        var perfStartTime = new Date().getTime();\n        console.log(\"PERF usersForResource contactList START\", perfStartTime);\n    }\n    var contactList =  _.without(resource.readers.concat( resource.editors, resource.owners),self.userId);\n    if (Meteor.settings.BUZZY_DEBUG){\n        var perfEndTime = new Date().getTime();\n        console.log(\"PERF usersForResource contactList DUR\", perfEndTime - perfStartTime);\n    }\n    return contactList;\n}\n\nMeteor.publish(\"microAppVotesAllForApp\", function(parentResourceID) {\n    this.unblock();\n    if (this.userId && parentResourceID) {\n        var resource = Resources.findOne({_id:parentResourceID});\n        if (Resources.canView(this.userId,resource)){ //need to change this to check fieldLevel\n            return MicroAppVotes.find({parentResourceID: parentResourceID});\n        }\n\n    }\n});\n\nMeteor.publish(\"microAppActionRule\", function(parentResourceID) {\n    this.unblock();\n    if (this.userId && parentResourceID) {\n        var resource = Resources.findOne({_id:parentResourceID});\n        if (Resources.canEdit(this.userId,resource)){ //need to change this to check fieldLevel\n            return MicroAppActionRules.find({parentResourceID: parentResourceID});\n        }\n\n    }\n});\n\nMeteor.publish(\"microAppVotes\", function(microAppDataFieldObj) {\n    this.unblock();\n    if (this.userId && microAppDataFieldObj) {\n        var resource = Resources.findOne({_id:microAppDataFieldObj.parentResourceID});\n        if (Resources.canView(this.userId,resource)){ //need to change this to check fieldLevel\n            console.log(\"FieldID:\", microAppDataFieldObj.voteFieldID);\n            return MicroAppVotes.find({voteFieldID: microAppDataFieldObj.voteFieldID});\n        }\n\n    }\n});\n\nMeteor.publish(\"microAppFieldsX\", function(resourceID) {\n    this.unblock();\n    if (this.userId && resourceID) {\n        var resource = Resources.findOne({_id:resourceID});\n        if (Resources.canView(this.userId,resource)){\n            return MicroAppFields.find({parentResourceID: resourceID});\n        }\n\n    }});\nMeteor.publish(\"microAppDataSingle\", function(resourceID, appID) {\n    this.unblock();\n    if (this.userId && resourceID) {\n        var resource = Resources.findOne({_id:resourceID});\n        if (Resources.canView(this.userId,resource)){\n            return MicroAppData.find({_id: appID});\n        }\n\n    }\n});\nMeteor.publish(\"microAppChildren\", function(resourceID, appID, fieldID) {\n    this.unblock();\n    if (this.userId && resourceID) {\n        var resource = Resources.findOne({_id:resourceID});\n        if (Resources.canView(this.userId,resource)){\n            return MicroAppChild.find({parentAppItemID:appID,parentAppFieldID:fieldID});\n        }\n\n    }\n});\n\n/*Meteor.publish(\"microAppDataX\", function(resourceID, optMicroAppFilter) {\n    this.unblock();\n    if (this.userId && resourceID) {\n        var resource = Resources.findOne({_id:resourceID});\n        if (Resources.canView(this.userId,resource)){\n            var currLimit = BuzzyGlobal.gMICROAPPDATA_LIMIT;\n            if (typeof optMicroAppFilter != \"undefined\"){\n                currLimit = optMicroAppFilter;\n            }\n            if (resource.type === BuzzyGlobal.gBASICTYPES.APPLICATION){\n\n                var queryObj = {\n                    query: {parentResourceID: resource._id},\n                    projection: {sort: {sortVal: -1}, limit: currLimit}\n                };\n\n                if (resource.content.whoCanView === BuzzyGlobal.gMICROAPP_PERMISSION_WHOCANVIEW.OWNER_AUTHOR_CREATOR){\n                    queryObj.query = {parentResourceID:  resource._id, userID:userID};\n                }\n\n                if (typeof optMicroAppFilter !== \"undefined\"  && optMicroAppFilter ) {\n                    if (typeof optMicroAppFilter.field !== \"undefined\" && optMicroAppFilter.field ){\n                        switch( optMicroAppFilter.field){\n                            case \"1\":\n                                queryObj.projection = {sort: {sortVal: optMicroAppFilter.order}, limit: currLimit};\n                                break;\n                            case \"2\":\n                                queryObj.projection = {sort: {sortVal2: optMicroAppFilter.order}, limit: currLimit};\n                                break;\n                            case \"3\":\n                                queryObj.projection = {sort: {sortVal3: optMicroAppFilter.order}, limit: currLimit};\n                                break;\n\n                        }\n                    }\n\n\n\n\n                } else {\n                    if (typeof resource.content.sortOrder !== \"undefined\") {\n                        var sortOrder = resource.content.sortOrder === BuzzyGlobal.gSORT_ORDER.ASCENDING ? 1 : -1;\n                        queryObj.projection.sort.sortVal = resource.content.sortOrder === BuzzyGlobal.gSORT_ORDER.ASCENDING ? 1 : -1;\n                    }\n                }\n\n\n\n\n                return MicroAppData.find(queryObj.query,queryObj.projection);\n\n\n            } else {\n                return;\n            }\n        }\n\n    }\n});*/\nMeteor.publish(\"myUser\", function() {\n    this.unblock();\n    if (this.userId){\n        return  Users.find(\n            {_id:this.userId},\n            {\n                fields:\n                {\n                    '_id': 1,\n                    'subscriptionID': 1,\n                    'profile': 1,\n                    'username': 1,\n                    'emails':1,\n                    'email':1,\n                    //'services':1\n\n                    'services.google.picture':1,\n                    'services.google.email':1,\n                    'services.google.name':1,\n                    'services.facebook.email':1,\n                    'services.facebook.id':1,\n                    'services.facebook.link':1,\n                    'services.facebook.name':1,\n                    'services.google.verified_email':1,\n                    'services.password.verified_email':1,\n                    'completedSetup':1,\n                    'invitingResourceID':1,\n                    'services.google.accessToken': 1,\n                    'services.google.expiresAt': 1\n                },\n                sort:{\"profile.name\":1},\n                limit:1\n            }\n        );\n    } else {\n        return null;\n    }\n\n});\n\nMeteor.publishComposite('viewedComments', function(commentID){\n    this.unblock();\n    var comment = Comments.findOne({_id:commentID});\n    var resource = Resources.findOne({_id:comment.topLevelParentID});\n    if (Resources.canEdit(this.userId,resource) || (this.userId === comment.userID)){\n        return {\n            find: function(){\n                return CommentsViewed.find({commentID:commentID})\n            },\n            children:[\n                {find: function(comment){\n                    return Users.find({_id: comment.userID});\n                }}\n            ]\n        }\n    } else {\n        return {};\n    }\n\n\n});\n\nMeteor.publishComposite('singleUserContact', function(userID){\n    this.unblock();\n\n    return {\n        find: function(){\n            return UserContacts.find({$or:[\n                {$and:[ {userID:this.userId}, {contactID:userID}]},\n                {$and:[{contactID:this.userId},{status:BuzzyGlobal.gUSERSTATUS.PENDING}]}\n            ]},{limit:1})\n        },\n        children:[\n            {find: function(contact){\n\n                return Users.find(\n                    {_id: contact.contactID},\n                    {\n                        fields:\n                        {\n                            '_id': 1,\n                            'profile': 1,\n                            'username': 1,\n                            'emails':1,\n                            'email':1,\n                            'stripeInfo.stripe_user_id':1,\n                            'stripeInfo.stripe_publishable_key':1,\n                            'stripeInfo.hasFeeBuffer':1,\n                            'stripeInfo.applyFeeFixed':1,\n                            'stripeInfo.applyFeeVariable':1,\n                            'stripeInfo.feeFixed':1,\n                            'stripeInfo.feePercent':1,\n                            'stripeInfo.currency':1,\n                            'services.google.picture':1,\n                            'services.google.email':1,\n                            'services.google.name':1,\n                            'services.facebook.email':1,\n                            'services.facebook.id':1,\n                            'services.facebook.link':1,\n                            'services.facebook.name':1,\n                            'services.google.verified_email':1,\n                            'services.password.verified_email':1\n\n                        },\n                        sort:{\"profile.name\":1},\n                        limit:1\n                    }\n\n                );\n            }}\n        ]\n    }\n\n});\n\nMeteor.publish('users', function(){\n    this.unblock();\n    var self = this;\n    var userContacts = UserContacts\n        .find({$or:[\n            //{userID:self.userId},\n            {$and:[{contactID:this.userId},{status:BuzzyGlobal.gUSERSTATUS.PENDING}]}\n        ]})\n        .map(function(item){\n            if (item.userID === self.userId){\n                return item.contactID\n            } else {\n                return item.userID\n            }\n\n        });\n\n\n    //console.log(\"publish users:\",userContacts , self.userId);\n\n    if (userContacts.length > 0 ){\n\n        return Users.find(\n            {$or:[\n                //{_id:self.userId},\n                {_id:{$in:userContacts}}\n\n            ]},\n            {\n                fields:\n                {\n                    '_id': 1,\n                    'profile': 1,\n                    'subscriptionID': 1,\n                    'username': 1,\n                    'emails':1,\n                    'email':1,\n                    //'services':1\n                    'services.google.picture':1,\n                    'services.google.email':1,\n                    'services.google.name':1,\n                    'services.facebook.email':1,\n                    'stripeCustomerInfo':1,\n                    'stripeInfo.stripe_user_id':1,\n                    'stripeInfo.hasFeeBuffer':1,\n                    'stripeInfo.applyFeeFixed':1,\n                    'stripeInfo.applyFeeVariable':1,\n                    'stripeInfo.feeFixed':1,\n                    'stripeInfo.feePercent':1,\n                    'stripeInfo.currency':1,\n                    'services.facebook.id':1,\n                    'services.facebook.link':1,\n                    'services.facebook.name':1,\n                    'services.google.verified_email':1,\n                    'services.password.verified_email':1,\n\n\n                },\n                sort:{\"profile.name\":1},\n                limit:BuzzyGlobal.gUSER_CONTACTS_LIMIT\n\n\n            });\n    } else {\n        return;\n    }\n\n\n});\n\n\nMeteor.publishComposite('usersForResource', function(resourceID) {\n    this.unblock();\n    if (Meteor.settings.BUZZY_DEBUG){\n        var perfStartTime = new Date().getTime();\n        console.log(\"PERF usersForResource Resources.find START\", perfStartTime);\n    }\n\n    var self = this;\n\n\n    return {\n        find: function () {\n\n            return Resources.find({_id: resourceID}, {limit: 1});\n        },\n        children: [\n            {\n                find: function (resource) {\n                    var userContacts = getUserContacts(resource,self);\n\n\n\n                    if (userContacts.length > 0){\n                        if (Meteor.settings.BUZZY_DEBUG){\n                            var perfStartTime = new Date().getTime();\n                            console.log(\"PERF usersForResource Users.find START\", perfStartTime);\n                        }\n                        var userCursor =  Users.find(\n                            {_id: {$in: userContacts}},\n                            {\n                                fields: {\n                                    '_id': 1,\n                                    'profile': 1,\n                                    'subscriptionID': 1,\n                                    'username': 1,\n                                    'emails': 1,\n                                    'email': 1,\n                                    //'services':1\n                                    'services.google.picture': 1,\n                                    'services.google.email': 1,\n                                    'services.google.name': 1,\n                                    'services.facebook.email': 1,\n                                    'stripeCustomerInfo':1,\n                                    'stripeInfo.stripe_user_id':1,\n                                    'stripeInfo.hasFeeBuffer':1,\n                                    'stripeInfo.applyFeeFixed':1,\n                                    'stripeInfo.applyFeeVariable':1,\n                                    'stripeInfo.feeFixed':1,\n                                    'stripeInfo.feePercent':1,\n                                    'stripeInfo.currency':1,\n                                    'services.facebook.id': 1,\n                                    'services.facebook.link': 1,\n                                    'services.facebook.name': 1,\n                                    'services.google.verified_email': 1,\n                                    'services.password.verified_email': 1,\n\n\n                                }\n                            });\n                        if (Meteor.settings.BUZZY_DEBUG){\n                            var perfEndTime = new Date().getTime();\n                            console.log(\"PERF usersForResource Users.find DUR\", perfEndTime - perfStartTime);\n                        }\n                        return userCursor;\n                    } else {\n                        return null;\n                    }\n\n\n\n                }\n\n            },\n            {\n                find: function (resource) {\n\n                    var userContacts = getUserContacts(resource,self);\n                    if (userContacts.length > 0){\n                        if (Meteor.settings.BUZZY_DEBUG){\n                            var perfStartTime = new Date().getTime();\n                            console.log(\"PERF usersForResource UserContacts.find START\", perfStartTime);\n                        }\n                        var userContactsCursor = UserContacts.find( {contactID: {$in: userContacts}});\n                        if (Meteor.settings.BUZZY_DEBUG){\n                            var perfEndTime = new Date().getTime();\n                            console.log(\"PERF usersForResource UserContacts.find  DUR\", perfEndTime - perfStartTime);\n                        }\n                        return userContactsCursor;\n                    } else {\n                        return null;\n                    }\n\n                }\n\n            }\n        ]\n\n\n    }\n});\n\n\nMeteor.publishComposite('searchContacts', function(searchText,excludeContacts) {\n    this.unblock();\n    var self = this;\n    var filter = new RegExp(searchText, 'i');\n\n    if (typeof excludeContacts !== \"undefined\"){\n        return {\n            find:function(){\n                return UserContacts.find(\n                    {$and:[\n                        {userID: this.userId},\n                        {$or:[{name:filter},{email:filter}]},\n                        {contactID:{$nin:excludeContacts}}\n                    ]},\n                    {sort: {name: 1}, limit:20});\n            },\n            children:[\n                {\n                    find: function(contact){\n\n                        return Users.find(\n                            {_id:contact.contactID},\n                            {\n                                fields: {\n                                    '_id': 1,\n                                    'profile': 1,\n                                    'subscriptionID': 1,\n                                    'username': 1,\n                                    'emails': 1,\n                                    'email': 1,\n                                    //'services':1\n                                    'services.google.picture': 1,\n                                    'services.google.email': 1,\n                                    'services.google.name': 1,\n                                    'services.facebook.email': 1,\n                                    'services.facebook.id': 1,\n                                    'services.facebook.link': 1,\n                                    'services.facebook.name': 1,\n                                    'services.google.verified_email': 1,\n                                    'services.password.verified_email': 1,\n\n                                },\n                                limit:1\n                            }\n                        );\n                    }\n                }\n            ]\n        }\n\n\n\n\n    } else {\n        return {\n            find:function(){\n                return UserContacts.find(\n                    {$and:[\n                        {userID: this.userId},\n                        {$or:[{name:filter},{email:filter}]}\n                    ]},\n                    {sort: {name: 1}, limit:20});\n            },\n            children:[\n                {\n                    find: function(contact){\n\n                        return Users.find(\n                            {_id:contact.contactID},\n                            {\n                                fields: {\n                                    '_id': 1,\n                                    'profile': 1,\n                                    'subscriptionID': 1,\n                                    'username': 1,\n                                    'emails': 1,\n                                    'email': 1,\n                                    //'services':1\n                                    'services.google.picture': 1,\n                                    'services.google.email': 1,\n                                    'services.google.name': 1,\n                                    'services.facebook.email': 1,\n                                    'services.facebook.id': 1,\n                                    'services.facebook.link': 1,\n                                    'services.facebook.name': 1,\n                                    'services.google.verified_email': 1,\n                                    'services.password.verified_email': 1,\n\n\n                                },\n                                limit:1\n                            });\n                    }\n                }\n            ]\n        }\n    }\n\n\n\n\n});\n\nMeteor.publish('usersList', function(listIDs) {\n    this.unblock();\n    var self = this;\n    if (self.userId){\n        return Users.find(\n            {_id:{$in:listIDs}},\n            {\n                fields: {\n                    '_id': 1,\n                    'profile': 1,\n                    'subscriptionID': 1,\n                    'username': 1,\n                    'emails': 1,\n                    'email': 1,\n                    //'services':1\n                    'services.google.picture': 1,\n                    'services.google.email': 1,\n                    'services.google.name': 1,\n                    'services.facebook.email': 1,\n                    'services.facebook.id': 1,\n                    'services.facebook.link': 1,\n                    'services.facebook.name': 1,\n                    'services.google.verified_email': 1,\n                    'services.password.verified_email': 1,\n\n\n                }\n            });\n    }\n\n\n});\n\n\nMeteor.publish('searchBuzzWithParticipants', function(participants, currentResourceID) {\n    this.unblock();\n\n    return Resources.find(\n        {$and:[\n            {_id: {$ne:currentResourceID}},\n            {type:BuzzyGlobal.gBASICTYPES.BUZZ},\n            {$or:[{status:BuzzyGlobal.gRESOURCE_STATUS.DRAFT},{status:BuzzyGlobal.gRESOURCE_STATUS.PUBLISHED}]},\n            {$or:[{readers:{$all:participants}},{editors:{$all:participants}},{owners:{$all:participants}}]}\n        ]},\n        {sort: {name: 1}, limit:20});\n});\n\nMeteor.publishComposite('myUserContacts', function(query) {\n    this.unblock();\n\n    var self = this;\n    var searchQuery = {};\n    if (query){\n        var searchExpression = new RegExp(query,\"i\");\n        return {\n            find:function(){\n                return  UserContacts\n                    .find({\n                        $or: [\n                            {userID: self.userId, name:searchExpression},\n                            {userID: self.userId, email:searchExpression},\n                            {$and: [{contactID: self.userId}, {status: BuzzyGlobal.gUSERSTATUS.PENDING}, {name:searchExpression}]},\n                            {$and: [{contactID: self.userId}, {status: BuzzyGlobal.gUSERSTATUS.PENDING}, {email:searchExpression}]}\n                        ]\n                    }, {limit:20});\n            },\n            children:[\n                {\n                    find: function(contact){\n                        var contactID = getContactID(contact);\n                        return Users.find(\n                            {_id:contactID},\n                            {\n                                fields: {\n                                    '_id': 1,\n                                    'profile': 1,\n                                    'subscriptionID': 1,\n                                    'username': 1,\n                                    'emails': 1,\n                                    'email': 1,\n                                    //'services':1\n                                    'services.google.picture': 1,\n                                    'services.google.email': 1,\n                                    'services.google.name': 1,\n                                    'services.facebook.email': 1,\n                                    'services.facebook.id': 1,\n                                    'services.facebook.link': 1,\n                                    'services.facebook.name': 1,\n                                    'services.google.verified_email': 1,\n                                    'services.password.verified_email': 1,\n\n\n                                },\n                                limit:1\n                            });\n                    }\n                }\n            ]\n        }\n\n    } else {\n        return {\n            find:function(){\n                return  UserContacts\n                    .find({\n                        $or: [\n                            {userID: self.userId},\n                            {$and: [{contactID: self.userId}, {status: BuzzyGlobal.gUSERSTATUS.PENDING}]}\n                        ]\n                    }, {limit:20});\n            },\n            children:[\n                {\n                    find: function(contact){\n                        var contactID = getContactID(contact);\n                        return Users.find(\n                            {_id:contactID},\n                            {\n                                fields: {\n                                    '_id': 1,\n                                    'profile': 1,\n                                    'subscriptionID': 1,\n                                    'username': 1,\n                                    'emails': 1,\n                                    'email': 1,\n                                    //'services':1\n                                    'services.google.picture': 1,\n                                    'services.google.email': 1,\n                                    'services.google.name': 1,\n                                    'services.facebook.email': 1,\n                                    'services.facebook.id': 1,\n                                    'services.facebook.link': 1,\n                                    'services.facebook.name': 1,\n                                    'services.google.verified_email': 1,\n                                    'services.password.verified_email': 1,\n\n\n                                },\n                                limit:1\n                            });\n                    }\n                }\n            ]\n        }\n    }\n\n\n\n\n\n\n});\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nMeteor.publishComposite('resourcesFavoriteAndRecent', function(){\n    this.unblock();\n    var searchUserExpression = new RegExp(this.userId);\n\n    if (this.userId){\n        return {\n            find:function(){\n\n                return  Users.find({_id:this.userId});\n            },\n            children:[{\n                find: function(user){\n                    if (typeof user.profile === \"undefined\" || typeof user.profile.favoriteBuzz === \"undefined\"){\n                        return;\n                    }\n                    return Resources.find({$or:[\n                        {$and:[\n                            {_id:{$in:user.profile.favoriteBuzz}},\n                            {path:null},\n                            {type:\"buzz\"},\n                            {isStarterTemplate:false},\n                            {$or:[{userID: this.userId},\n                                {editors:searchUserExpression},\n                                {owners:searchUserExpression}\n                            ]},\n                            {$or:[{status:'draft'},{status:'published'}]},\n\n                        ]},\n                        {$and:[\n                            {_id:{$in:user.profile.favoriteBuzz}},\n                            {path:null},\n                            {type:\"buzz\"},\n                            {isStarterTemplate:false},\n                            {readers:searchUserExpression},\n                            {status:'published'}\n                        ]}\n                    ]},\n                        {limit:BuzzyGlobal.gMAX_HISTORY});\n\n                }\n            },\n                {find: function(user){\n                    if (typeof user.profile === \"undefined\" || typeof user.profile.recentBuzz === \"undefined\"){\n                        return;\n                    }\n                    return Resources.find({$or:[\n                        {$and:[\n                            {_id:{$in:user.profile.recentBuzz}},\n                            {path:null},\n                            {type:\"buzz\"},\n                            {isStarterTemplate:false},\n                            {$or:[{userID: this.userId},\n                                {editors:searchUserExpression},\n                                {owners:searchUserExpression}\n                            ]},\n                            {$or:[{status:'draft'},{status:'published'}]},\n\n                        ]},\n                        {$and:[\n                            {_id:{$in:user.profile.recentBuzz}},\n                            {path:null},\n                            {type:\"buzz\"},\n                            {isStarterTemplate:false},\n                            {readers:searchUserExpression},\n                            {status:'published'}\n                        ]}\n                    ]},\n                        {limit:BuzzyGlobal.gMAX_HISTORY});\n\n                }\n            }]\n\n        }\n\n    }\n\n\n})\n\nMeteor.publish('resourcesAndImages', function(sortOptions, searchQuery, resourceListType,showTemplates) {\n    this.unblock();\n    var self = this;\n    if (showTemplates){\n        var query = templateQuery(this.userId, resourceListType, searchQuery);\n    } else {\n        var query = resourceQuery(this.userId, resourceListType,searchQuery);\n    }\n    var searchExpression = new RegExp(searchQuery);\n    //console.log(\"publish resourcesAndImages\", this.userId, \"sortoptions:\",sortOptions, \"q:\", searchQuery, \"listType:\", resourceListType,\"showT:\",showTemplates);\n    return Resources.find(query,sortOptions);\n\n});\n\n\n\nMeteor.publish('userTagsResources', function(resourceID) {\n   // return UserTagsResources.find({$and:[{resourceID:resourceID},{userID:this.userId}]});\n    return UserTagsResources.find({$and:[{userID:this.userId}]});\n});\n\n\n\nMeteor.publish('singleResource', function(id) {\n    this.unblock();\n    return id && Resources.find(id);\n});\n\n\n\n\n/// will need to fix this to only publish resources for the specific user, so will need to check permissions, just leaving as is for now/testing/initial dev\nMeteor.publish('templateResources', function() {\n    this.unblock();\n    return Resources.find(\n        {\n            $and: [\n                {userID: this.userId},\n                {status: \"published\"},\n                {isStarterTemplate: true},\n            ]\n        }\n    );\n\n});\n\nMeteor.publish('resourcesForAddition', function() {\n    this.unblock();\n    return Resources.find(\n        {\n            $or: [\n                {\n                    $and: [\n                        {status: \"published\"},\n                        {privacy: \"public\"},\n\n                        {\n                            $or: [\n\n                                {isStarterTemplate: true},\n                                {isBasic: true},\n                            ]\n                        }\n                    ]\n                }\n\n\n            ]\n        }\n    );\n\n});\n\n\n\nMeteor.publishComposite('resourceComments', function(resourceID, commentLimit, optCommentID, optMicroAppFilter) {\n    this.unblock();\n    var self = this;\n\n    var userID = this.userId;\n    var userSearchCommentsExpression = new RegExp(userID);\n    var comment = null;\n    if ((typeof optCommentID !== \"undefined\" && optCommentID)){\n        comment = Comments.findOne({_id:optCommentID});\n    }\n    if (!resourceID){\n        BuzzyGlobal.throwError(\"Invalid Params to resourceComments\");\n    }\n\n    return {\n        find: function() {\n\n            var searchExpression = new RegExp(\"^,\"+ resourceID +\",\");\n            var userSearchExpression = new RegExp(userID);\n\n            var resource = Resources.findOne({_id:resourceID});\n\n            if (!resource) {\n                return;\n            }\n\n            if (resource.status === BuzzyGlobal.gRESOURCE_STATUS.ARCHIVED || resource.status === BuzzyGlobal.gRESOURCE_STATUS.DELETED){\n                return;\n            }\n\n\n            if (resource.status === BuzzyGlobal.gRESOURCE_STATUS.PUBLISHED && (resource.privacy === BuzzyGlobal.gPRIVACY.PUBLIC || resource.privacy === BuzzyGlobal.gPRIVACY.UNLISTED)){\n                if (Meteor.settings.BUZZY_DEBUG){\n                    var perfStartTime = new Date().getTime();\n                    console.log(\"PERF resourceComments Resources.find START\", perfStartTime);\n                }\n                var resourcesList =  Resources.find(\n                    {$and:[\n                        {status:'published'},\n                        {$or:[\n                            {_id:resourceID},\n                            {path:searchExpression}\n                        ]}\n\n                    ]}\n                );\n                if (Meteor.settings.BUZZY_DEBUG){\n                    var perfEndTime = new Date().getTime();\n                    console.log(\"PERF usersForResource UserContacts.find  DUR\", perfEndTime - perfStartTime);\n                }\n                return resourcesList;\n\n            } else {\n                if (userID && userID !== \"undefined\"){\n\n                    var userSearchExpression = new RegExp(userID);\n                    var resourcesCursor = Resources.find(\n                        {$or:[\n                            {$and:[\n                                {$or:[\n                                    {_id:resourceID},\n                                    {path:searchExpression}\n                                ]},\n                                {$or:[{userID: userID},\n                                    {editors:userSearchExpression},\n                                    {owners:userSearchExpression},\n                                ]},\n                                {$or:[{status:'draft'},{status:'published'}]}\n\n                            ]},\n                            {$and:[\n                                {$or:[\n                                    {_id:resourceID},\n                                    {path:searchExpression}\n                                ]},\n                                {readers:userSearchExpression},\n                                {status:'published'}\n\n                            ]}\n                        ]}\n\n                    );\n                    return resourcesCursor;\n\n\n                } else {\n\n                    return;\n\n                }\n\n            }\n        },\n        children: [\n            {\n                find: function(resource) {\n                    var commentCursor;\n                    var coreQuery = {};\n\n                    if (Resources.isAuthorOwner(this.userId, resource)){\n                        coreQuery = {$or: [\n\n                            {\n                                $and: [{resourceParentID: resource._id},{$or:[{toUsers: null},{toUsers:{$exists:false}}]}]\n                            },\n                            {\n                                $and: [{resourceParentID: resource._id},{toUsers: userSearchCommentsExpression}]\n                            }\n                        ]};\n                    } else {\n\n                        coreQuery = {$or: [\n\n                            {\n                                $and: [\n                                    {resourceParentID: resource._id},\n                                    {$or:[{toUsers: null},{toUsers:{$exists:false}}]},\n                                    {$or:[\n                                        {status:BuzzyGlobal.gCOMMENTSTATUS.LIVE},\n                                        {status:BuzzyGlobal.gCOMMENTSTATUS.DELETED},\n                                        {$and:[\n                                            {status:BuzzyGlobal.gCOMMENTSTATUS.WAITING_APPROVAL},\n                                            {userID: userID}\n                                        ]}\n\n                                    ]}\n                                ]\n                            },\n                            {\n                                $and: [{resourceParentID: resource._id},{toUsers: userSearchCommentsExpression}]\n                            }\n                        ]};\n\n                    }\n\n                    if (comment){\n                        if (resource.showComments === BuzzyGlobal.gCOMMENTSHOW.INLINE || resource.showComments === BuzzyGlobal.gCOMMENTSHOW.MODAL){\n\n                                var limit = (typeof commentLimit.commentDownLimit) !== \"undefined\" && commentLimit.commentDownLimit?commentLimit.commentDownLimit:BuzzyGlobal.gCOMMENT_LIMIT;\n                                return Comments.find({$and:[\n                                    coreQuery,\n                                    {submitted:{$gte:comment.submitted}}\n                                ]}, {sort:{submitted:1},limit:limit});\n                        } else {\n\n                            return;\n\n                        }\n\n                    } else {\n                        if (resource.showComments === BuzzyGlobal.gCOMMENTSHOW.INLINE || resource.showComments === BuzzyGlobal.gCOMMENTSHOW.MODAL){\n\n                            if (commentLimit.resourceID === resource._id){\n                                return Comments.find(coreQuery, {sort:{submitted:-1},limit:commentLimit.limit});\n                            } else {\n                                //return Comments.find({resourceParentID:resource._id}, {sort:{submitted:-1},limit:BuzzyGlobal.gCOMMENT_LIMIT});\n\n                                return Comments.find(\n                                    coreQuery,\n                                    {sort:{submitted:-1},limit:BuzzyGlobal.gCOMMENT_LIMIT});\n                            }\n                        } else {\n\n                            return;\n\n                        }\n                    }\n\n\n\n                }\n            },\n            {\n                find: function(resource) {\n                    var commentCursor;\n                    var coreQuery = {};\n\n                    if (Resources.isAuthorOwner(this.userId, resource)){\n                        coreQuery = {$or: [\n\n                            {\n                                $and: [{resourceParentID: resource._id},{$or:[{toUsers: null},{toUsers:{$exists:false}}]}]\n                            },\n                            {\n                                $and: [{resourceParentID: resource._id},{toUsers: userSearchCommentsExpression}]\n                            }\n                        ]};\n                    } else {\n\n                        coreQuery = {$or: [\n\n                            {\n                                $and: [\n                                    {resourceParentID: resource._id},\n                                    {$or:[{toUsers: null},{toUsers:{$exists:false}}]},\n                                    {$or:[\n                                        {status:BuzzyGlobal.gCOMMENTSTATUS.LIVE},\n                                        {status:BuzzyGlobal.gCOMMENTSTATUS.DELETED},\n                                        {$and:[\n                                            {status:BuzzyGlobal.gCOMMENTSTATUS.WAITING_APPROVAL},\n                                            {userID: userID}\n                                        ]}\n\n                                    ]}\n                                ]\n                            },\n                            {\n                                $and: [{resourceParentID: resource._id},{toUsers: userSearchCommentsExpression}]\n                            }\n                        ]};\n\n                    }\n\n                    if (comment){\n                        if (resource.showComments === BuzzyGlobal.gCOMMENTSHOW.INLINE || resource.showComments === BuzzyGlobal.gCOMMENTSHOW.MODAL){\n\n                                var limit = (typeof commentLimit.commentUpLimit) !== \"undefined\" && commentLimit.commentUpLimit?commentLimit.commentUpLimit:BuzzyGlobal.gCOMMENT_LIMIT;\n                                return Comments.find(\n\n                                    {$and:[\n                                        coreQuery,\n                                        {submitted:{$lte:comment.submitted}}]},\n                                    {sort:{submitted:-1},limit:limit});\n                        } else {\n\n                            return;\n\n                        }\n\n                    } else {\n                        return;\n                    }\n\n\n\n                }\n            },\n            {\n                find: function(resource) {\n                    if (!Resources.isAuthorOwner(userID,resource)){\n                        return;\n                    }\n                    if (resource.showComments === BuzzyGlobal.gCOMMENTSHOW.INLINE || resource.showComments === BuzzyGlobal.gCOMMENTSHOW.MODAL){\n                        var userSearchCommentsExpression = new RegExp(userID);\n                        return Comments.find(\n\n                            {$or: [\n\n                                {$and:[\n                                    {resourceParentID: resource._id},\n                                    { toUsers: { $exists: true, $ne: [] } },\n                                    {status: BuzzyGlobal.gCOMMENTSTATUS.FLAGGED}\n                                ]},\n                                {\n                                    $and: [\n                                        {resourceParentID: resource._id},\n                                        {status: BuzzyGlobal.gCOMMENTSTATUS.WAITING_APPROVAL},\n                                        {toUsers: userSearchCommentsExpression},\n                                    ]\n                                }\n                            ]},\n                            {sort:{submitted:-1},limit:BuzzyGlobal.gCOMMENT_LIMIT});\n                    } else {\n                        return;\n                    }\n\n                }\n            },\n            {\n                find: function(resource) {\n                    if (resource.type === BuzzyGlobal.gBASICTYPES.RESTCALL){\n                        return ExternalRestData.find({parentResourceID: resource._id},{fields:{_id:1, result:1, parentResourceID:1}, limit:1});\n                    } else {\n                        return;\n                    }\n\n                }\n            },\n            {\n                find: function(resource) {\n                    if (resource.type === BuzzyGlobal.gBASICTYPES.APPLICATION){\n                        return MicroAppFields.find({parentResourceID: resource._id})\n                    } else {\n                        return;\n                    }\n\n                }\n            },\n\n            {\n                find: function(resource) {\n                    if (resource.type === BuzzyGlobal.gBASICTYPES.APPLICATION){\n                        return MicroAppVotes.find({parentResourceID: resource._id, userID:this.userId});\n                    } else {\n                        return\n                    }\n\n                }\n            },\n            {\n                find: function(resource) {\n\n                    if (resource.type === BuzzyGlobal.gBASICTYPES.APPLICATION){\n                        var currLimit = BuzzyGlobal.gMICROAPPDATA_LIMIT;\n\n                        if (typeof resource.content.numberOfItems != \"undefined\" && resource.content.numberOfItems > 0){\n                            currLimit = resource.content.numberOfItems;\n                        }\n                        var currSortOrder = (resource.content.sortOrder && resource.content.sortOrder == \"asc\" )?1:-1;\n                        var cursor;\n                        \n                        var queryObj = {\n                            query: {parentResourceID: resource._id},\n                            projection: {sort: {sortVal: currSortOrder}, limit: currLimit}\n                        };\n\n                        if (!Resources.canEdit(userID, resource) && resource.content.whoCanView === BuzzyGlobal.gMICROAPP_PERMISSION_WHOCANVIEW.OWNER_AUTHOR_CREATOR) {\n                            queryObj.query = {parentResourceID: resource._id, userID: userID};\n                        } else if (!Resources.canEdit(userID, resource) && resource.content.whoCanView === BuzzyGlobal.gMICROAPP_PERMISSION_WHOCANVIEW.OWNER_AUTHOR_CREATORS_VIEWERS) {\n                            var searchUserExpression = new RegExp(this.userId);\n                            queryObj.query = {\n                                $or: [\n                                    {\n                                        $and: [\n                                            {parentResourceID: resource._id},\n                                            {viewers: searchUserExpression}\n                                        ]\n                                    },\n\n                                    {\n                                        parentResourceID: resource._id,\n                                        userID: userID\n                                    }\n                                ]\n\n\n                            };\n                        }\n                        \n                        if (typeof optMicroAppFilter !== \"undefined\"  && optMicroAppFilter ) {\n                            var indexOfFilter = optMicroAppFilter.findIndex(function(item){\n                                return item.resourceID === resource._id;\n                            })\n\n                            if (indexOfFilter >= 0){\n                                if (optMicroAppFilter[indexOfFilter].limit){\n                                    currLimit = optMicroAppFilter[indexOfFilter].limit;\n                                }\n                                if (typeof optMicroAppFilter[indexOfFilter].field !== \"undefined\" && optMicroAppFilter[indexOfFilter].field ){\n                                    switch( optMicroAppFilter[indexOfFilter].field){\n                                        case \"1\":\n                                            queryObj.projection = {sort: {sortVal: optMicroAppFilter[indexOfFilter].order}, limit: currLimit};\n                                            break;\n                                        case \"2\":\n                                            queryObj.projection = {sort: {sortVal2: optMicroAppFilter[indexOfFilter].order}, limit: currLimit};\n                                            break;\n                                        case \"3\":\n                                            queryObj.projection = {sort: {sortVal3: optMicroAppFilter[indexOfFilter].order}, limit: currLimit};\n                                            break;\n\n                                    }\n                                }\n\n                                if (typeof optMicroAppFilter[indexOfFilter].searchString !== \"undefined\" && optMicroAppFilter[indexOfFilter].searchString){\n                                    var searchRegEx =  new RegExp(optMicroAppFilter[indexOfFilter].searchString, \"i\");\n                                    switch( optMicroAppFilter[indexOfFilter].searchField){\n                                        case \"1\":\n                                            queryObj.query.sortVal = searchRegEx;\n                                            break;\n                                        case \"2\":\n                                            queryObj.query.sortVal2 = searchRegEx;\n                                            break;\n                                        case \"3\":\n                                            queryObj.query.sortVal3 = searchRegEx;\n                                            break;\n\n                                    };\n                                }\n\n                            }\n\n\n\n\n\n                        } else {\n                            if (typeof resource.content.sortOrder !== \"undefined\") {\n                                var sortOrder = resource.content.sortOrder === BuzzyGlobal.gSORT_ORDER.ASCENDING ? 1 : -1;\n                                queryObj.projection.sort.sortVal = resource.content.sortOrder === BuzzyGlobal.gSORT_ORDER.ASCENDING ? 1 : -1;\n                            }\n                        }\n\n\n\n\n                        return MicroAppData.find(queryObj.query,queryObj.projection);\n                        \n                        /*if (typeof resource.content.sortOrder !== \"undefined\"){\n                            var sortOrder = resource.content.sortOrder === BuzzyGlobal.gSORT_ORDER.ASCENDING?1:-1;\n                            if (resource.content.whoCanView === BuzzyGlobal.gMICROAPP_PERMISSION_WHOCANVIEW.OWNER_AUTHOR_CREATOR){\n                           \n                                if (Resources.canEdit(userID, resource)){\n                                    \n                                    return MicroAppData.find({parentResourceID:  resource._id},{sort:{sortVal:sortOrder},limit:currLimit});\n\n                                } else {\n                                    return MicroAppData.find({parentResourceID:  resource._id, userID:userID},{sort:{sortVal:sortOrder},limit:currLimit});\n\n                                }\n\n                            } else {\n                               \n                                return MicroAppData.find({parentResourceID:  resource._id},{sort:{sortVal:sortOrder},limit:currLimit});\n\n                            }\n\n                        } else {\n                            if (resource.content.whoCanView === BuzzyGlobal.gMICROAPP_PERMISSION_WHOCANVIEW.OWNER_AUTHOR_CREATOR){\n                                if (Resources.canEdit(userID, resource)){\n                                    return  MicroAppData.find({parentResourceID:  resource._id});\n\n                                    \n                                } else {\n                                    return MicroAppData.find({parentResourceID:  resource._id, userID:userID});\n                                }\n                            } else {\n                                return MicroAppData.find({parentResourceID:  resource._id});\n\n                            }\n\n\n                        }*/\n\n                    } else {\n                        return;\n                    }\n                },\n                children: [\n                    {\n                        find: function (microAppItem) {\n                            return MicroAppChild.find({parentAppItemID:microAppItem._id, type:BuzzyGlobal.gAPPFIELDTYPE.FILE_ATTACHMENTS});\n                        }\n                    } ]\n                \n            },\n            {\n                find: function(resource) {\n                    if (resource.type === BuzzyGlobal.gBASICTYPES.EMBED_BUZZ){\n\n                        var searchExpression = new RegExp(\"^,\"+ resource.content.buzzID +\",\");\n                        var userSearchExpression = new RegExp(userID);\n\n\n                        if (resource.status === BuzzyGlobal.gRESOURCE_STATUS.ARCHIVED || resource.status === BuzzyGlobal.gRESOURCE_STATUS.DELETED){\n                            return;\n                        }\n\n                        if (!Resources.canView(userID,resource)){\n                            return;\n                        }\n                        if (Meteor.settings.BUZZY_DEBUG){\n                            console.log(\"ABOUT to Embed:\", new RegExp(\"^,\"+ resource.content.buzzID +\",\"));\n                        }\n\n                        return  Resources.find(\n                            {$and:[\n                                {$or:[\n                                    {_id:resource.content.buzzID },\n                                    {path:searchExpression}\n                                ]},\n                                {status:'published'}\n\n                            ]}\n\n                        );\n\n\n                    } else {\n                        return;\n                    }\n\n                },\n                children: [\n                    {\n                        find: function(resource) {\n                            if (resource.type === BuzzyGlobal.gBASICTYPES.APPLICATION){\n                                return MicroAppFields.find({parentResourceID: resource._id})\n                            } else {\n                                return;\n                            }\n\n                        }\n                    },\n\n                    {\n                        find: function(resource) {\n                            if (resource.type === BuzzyGlobal.gBASICTYPES.APPLICATION){\n                                return MicroAppVotes.find({parentResourceID: resource._id, userID:this.userId});\n                            } else {\n                                return\n                            }\n\n                        }\n                    },\n                    {\n                        find: function(resource) {\n\n                            if (resource.type === BuzzyGlobal.gBASICTYPES.APPLICATION){\n                                var currLimit = BuzzyGlobal.gMICROAPPDATA_LIMIT;\n\n                                if (typeof resource.content.numberOfItems != \"undefined\" && resource.content.numberOfItems > 0){\n                                    currLimit = resource.content.numberOfItems;\n                                }\n\n                                var cursor;\n\n                                var queryObj = {\n                                    query: {parentResourceID: resource._id},\n                                    projection: {sort: {sortVal: -1}, limit: currLimit}\n                                };\n\n                                if (!Resources.canEdit(userID, resource) && resource.content.whoCanView === BuzzyGlobal.gMICROAPP_PERMISSION_WHOCANVIEW.OWNER_AUTHOR_CREATOR) {\n                                    queryObj.query = {parentResourceID: resource._id, userID: userID};\n                                } else if (!Resources.canEdit(userID, resource) && resource.content.whoCanView === BuzzyGlobal.gMICROAPP_PERMISSION_WHOCANVIEW.OWNER_AUTHOR_CREATORS_VIEWERS) {\n                                    var searchUserExpression = new RegExp(this.userId);\n                                    queryObj.query = {\n                                        $or: [\n                                            {\n                                                $and: [\n                                                    {parentResourceID: resource._id},\n                                                    {viewers: searchUserExpression}\n                                                ]\n                                            },\n\n                                            {\n                                                parentResourceID: resource._id,\n                                                userID: userID\n                                            }\n                                        ]\n\n\n                                    };\n                                }\n\n                                if (typeof optMicroAppFilter !== \"undefined\"  && optMicroAppFilter ) {\n                                    var indexOfFilter = optMicroAppFilter.findIndex(function(item){\n                                        return item.resourceID === resource._id;\n                                    })\n\n                                    if (indexOfFilter >= 0){\n                                        if (optMicroAppFilter[indexOfFilter].limit){\n                                            currLimit = optMicroAppFilter[indexOfFilter].limit;\n                                        }\n                                        if (typeof optMicroAppFilter[indexOfFilter].field !== \"undefined\" && optMicroAppFilter[indexOfFilter].field ){\n                                            switch( optMicroAppFilter[indexOfFilter].field){\n                                                case \"1\":\n                                                    queryObj.projection = {sort: {sortVal: optMicroAppFilter[indexOfFilter].order}, limit: currLimit};\n                                                    break;\n                                                case \"2\":\n                                                    queryObj.projection = {sort: {sortVal2: optMicroAppFilter[indexOfFilter].order}, limit: currLimit};\n                                                    break;\n                                                case \"3\":\n                                                    queryObj.projection = {sort: {sortVal3: optMicroAppFilter[indexOfFilter].order}, limit: currLimit};\n                                                    break;\n\n                                            }\n                                        }\n\n                                        if (typeof optMicroAppFilter[indexOfFilter].searchString !== \"undefined\" && optMicroAppFilter[indexOfFilter].searchString){\n                                            var searchRegEx =  new RegExp(optMicroAppFilter[indexOfFilter].searchString, \"i\");\n                                            switch( optMicroAppFilter[indexOfFilter].searchField){\n                                                case \"1\":\n                                                    queryObj.query.sortVal = searchRegEx;\n                                                    break;\n                                                case \"2\":\n                                                    queryObj.query.sortVal2 = searchRegEx;\n                                                    break;\n                                                case \"3\":\n                                                    queryObj.query.sortVal3 = searchRegEx;\n                                                    break;\n\n                                            };\n                                        }\n\n                                    }\n\n\n\n\n\n                                } else {\n                                    if (typeof resource.content.sortOrder !== \"undefined\") {\n                                        var sortOrder = resource.content.sortOrder === BuzzyGlobal.gSORT_ORDER.ASCENDING ? 1 : -1;\n                                        queryObj.projection.sort.sortVal = resource.content.sortOrder === BuzzyGlobal.gSORT_ORDER.ASCENDING ? 1 : -1;\n                                    }\n                                }\n\n\n\n\n                                return MicroAppData.find(queryObj.query,queryObj.projection);\n\n                                /*if (typeof resource.content.sortOrder !== \"undefined\"){\n                                 var sortOrder = resource.content.sortOrder === BuzzyGlobal.gSORT_ORDER.ASCENDING?1:-1;\n                                 if (resource.content.whoCanView === BuzzyGlobal.gMICROAPP_PERMISSION_WHOCANVIEW.OWNER_AUTHOR_CREATOR){\n\n                                 if (Resources.canEdit(userID, resource)){\n\n                                 return MicroAppData.find({parentResourceID:  resource._id},{sort:{sortVal:sortOrder},limit:currLimit});\n\n                                 } else {\n                                 return MicroAppData.find({parentResourceID:  resource._id, userID:userID},{sort:{sortVal:sortOrder},limit:currLimit});\n\n                                 }\n\n                                 } else {\n\n                                 return MicroAppData.find({parentResourceID:  resource._id},{sort:{sortVal:sortOrder},limit:currLimit});\n\n                                 }\n\n                                 } else {\n                                 if (resource.content.whoCanView === BuzzyGlobal.gMICROAPP_PERMISSION_WHOCANVIEW.OWNER_AUTHOR_CREATOR){\n                                 if (Resources.canEdit(userID, resource)){\n                                 return  MicroAppData.find({parentResourceID:  resource._id});\n\n\n                                 } else {\n                                 return MicroAppData.find({parentResourceID:  resource._id, userID:userID});\n                                 }\n                                 } else {\n                                 return MicroAppData.find({parentResourceID:  resource._id});\n\n                                 }\n\n\n                                 }*/\n\n                            } else {\n                                return;\n                            }\n                        },\n                        children: [\n                            {\n                                find: function (microAppItem) {\n                                    return MicroAppChild.find({parentAppItemID:microAppItem._id, type:BuzzyGlobal.gAPPFIELDTYPE.FILE_ATTACHMENTS});\n                                }\n                            } ]\n\n                    }\n                ]\n            }\n        ]\n    }\n\n});\n\n\n\n\nMeteor.publish('resourceFollowers', function(resourceID) {\n    this.unblock();\n\n    return ResourceFollowers.find({resourceID:resourceID});\n\n});\n\n\n\n\nMeteor.publish('resourceFollowersByUser', function(userID) {\n    this.unblock();\n    return ResourceFollowers.find({userID:userID});\n});\n\n\n\nMeteor.publishComposite('resourceFollowersUsers', function(resourceID) {\n    this.unblock();\n\n\n        return {\n            find: function() {\n                return ResourceFollowers.find({resourceID:resourceID});\n\n            },\n            children:[\n                {\n                    find: function(follower) {\n                        return Users.find({_id:follower.userID})\n                    },\n                }\n\n            ]}\n\n\n\n\n});\n\nMeteor.publishComposite('notifications', function(searchTerm, notificationLimit) {\n    this.unblock();\n\n\n        var searchQueryExpression = new RegExp(searchTerm, \"i\");\n        return {\n            find: function() {\n                if (typeof searchTerm !== \"undefined\" && searchTerm){\n\n                    return Notifications.find(\n                        {$and:[\n                            {forUserID: this.userId},\n                            {$or:[\n                                {\"activity.actor.displayName\":searchQueryExpression},\n                                {\"action.message\":searchQueryExpression},\n                                {\"activity.object.content\":searchQueryExpression},\n                            ]}\n                        ]},\n\n                        {limit:notificationLimit, sort:{submitted:-1}});\n                } else {\n                    if (this.userId){\n                        return Notifications.find({forUserID: this.userId},{limit:notificationLimit, sort:{submitted:-1}});\n                    }\n\n\n                }\n\n            },\n            children:[\n                {\n                    find: function(notifcation) {\n                        return Users.find({_id:notifcation.byUserID})\n                    },\n                }\n\n            ]}\n\n\n\n\n});\n\n\nMeteor.publish('externalData', function() {\n    this.unblock();\n    return ExternalData.find({userID: this.userId},{limit:10, sort:{submitted:-1}});\n});\n\nMeteor.publishComposite('myTeams', function() {\n    this.unblock();\n    var self = this;\n    var userID = self.userId;\n    return {\n        find: function() {\n            return TeamMembers.find({userID:userID});\n\n        },\n        children:[\n            {\n                find: function(membership) {\n                    return Teams.find({_id:membership.teamID})\n                },\n            }\n\n        ]}\n\n});\n\nMeteor.publishComposite('teamInfo', function(teamID) {\n    this.unblock();\n    var self = this;\n    var userID = self.userId;\n    return {\n        find: function() {\n            return Teams.find({_id:teamID});\n        },\n        children:[\n            {\n                find: function(team) {\n                    return TeamMembers.find({teamID:teamID});\n                },\n                children:[\n                    {\n                        find: function(member) {\n                            return Users.find({_id:member.userID})\n                        },\n                    }\n\n                ]\n            }\n\n        ]}\n\n});\n\nMeteor.publish('getCounterMicroAppData', function (counterName, resourceID) {\n    this.unblock();\n    var pollingInterval = 10 * 1000; //10 seconds\n    if (!resourceID || !counterName){\n        BuzzyGlobal.throwError (\"Invalid Params for Counter\");\n    }\n    var resource = Resources.findOne({_id:resourceID});\n    if (!resource ){\n        BuzzyGlobal.throwError (\"Can't find resource!\");\n    }\n    var cursor = {};\n    var userID = this.userId;\n    if (userID){\n        cursor =  MicroAppData.find({parentResourceID: resourceID});\n        return new Counter(counterName, cursor, pollingInterval);\n\n    }\n\n\n});\n\nMeteor.publish('getCounter', function (counterName, resourceID) {\n    this.unblock();\n    var pollingInterval = 10 * 1000; //10 seconds\n    if (!resourceID || !counterName){\n        BuzzyGlobal.throwError (\"Invalid Params for Counter\");\n    }\n    var resource = Resources.findOne({_id:resourceID});\n    if (!resource ){\n        BuzzyGlobal.throwError (\"Can't find resource!\");\n    }\n    var cursor = {};\n    var userID = this.userId;\n    if (userID){\n        var userSearchCommentsExpression = new RegExp(userID);\n        if (Resources.isAuthorOwner(this.userId, resource)){\n\n\n            cursor =\n                Comments.find(\n                    {$or: [\n\n                        {\n                            $and: [\n                                {resourceParentID: resourceID},\n                                {$or:[{toUsers: null},{toUsers: {$exists: false}}]},\n                                {$or:[\n                                    {status:BuzzyGlobal.gCOMMENTSTATUS.LIVE},\n                                    {status:BuzzyGlobal.gCOMMENTSTATUS.DELETED},\n                                    {$and:[\n                                        {status:BuzzyGlobal.gCOMMENTSTATUS.WAITING_APPROVAL},\n                                        {userID: userID}\n                                    ]}\n\n                                ]}\n                            ]\n                        },\n                        {\n                            $and: [\n                                {resourceParentID: resourceID},\n                                {toUsers: null},\n                                {status:BuzzyGlobal.gCOMMENTSTATUS.WAITING_APPROVAL}\n                            ]\n                        },\n                        {\n                            $and: [\n                                {resourceParentID: resourceID},\n                                {status:BuzzyGlobal.gCOMMENTSTATUS.FLAGGED}\n                            ]\n                        },\n                        {\n                            $and: [\n                                {resourceParentID: resourceID},\n                                {toUsers: userSearchCommentsExpression}\n                            ]\n                        }\n                    ]});\n\n\n        } else {\n\n            cursor =\n                Comments.find(\n                    {$or: [\n\n                        {\n                            $and: [\n                                {resourceParentID: resourceID},\n                                {$or:[{toUsers: null},{toUsers: {$exists: false}}]},\n                                {$or:[\n                                    {status:BuzzyGlobal.gCOMMENTSTATUS.LIVE},\n                                    {status:BuzzyGlobal.gCOMMENTSTATUS.DELETED},\n                                    {$and:[\n                                        {status:BuzzyGlobal.gCOMMENTSTATUS.WAITING_APPROVAL},\n                                        {userID: userID}\n                                    ]}\n\n                                ]}\n                            ]\n                        },\n\n                        {\n                            $and: [\n                                {resourceParentID: resourceID},\n                                {status:BuzzyGlobal.gCOMMENTSTATUS.FLAGGED}\n                            ]\n                        },\n                        {\n                            $and: [\n                                {resourceParentID: resourceID},\n                                {toUsers: userSearchCommentsExpression}\n                            ]\n                        }\n                    ]});\n  \n        }\n\n\n    } else {\n        cursor =\n            Comments.find(\n                {$and:[\n                    {$or: [\n\n                        {\n                            $and: [\n                                {resourceParentID: resourceID},\n                                {$or:[{toUsers: null},{toUsers: {$exists: false}}]},\n                                {$or:[\n                                    {status:BuzzyGlobal.gCOMMENTSTATUS.DELETED},\n                                    {status:BuzzyGlobal.gCOMMENTSTATUS.LIVE}\n                                ]}\n\n\n                            ]\n                        }\n                    ]}\n\n\n                ]});\n\n\n\n    }\n\n    \n\n\n    return new Counter(counterName, cursor, pollingInterval);\n});\n\n\n\n","/**\n * Created by adamginsburg on 19/12/2014.\n */\n\n\nMeteor.startup(function() {\n\n    Push.debug = true;\n\n    /*Push.Configure({\n        \"apn\": {\n            \"passphrase\": \"awoke1-excel\",\n            \"keyData\": Assets.getText('Prod_BuzzyBuzzKey.pem'),\n            \"certData\": Assets.getText('Prod_BuzzyBuzzCert.pem')\n        },\n        \"gcm\": {\n            \"apiKey\": \"AIzaSyCAluGdU2kXfNpJy7bO48h-ulu8smg5bN0\"\n        },\n        \"production\": true,\n        \"badge\": true,\n        \"sound\": true,\n        \"alert\": true,\n        \"vibrate\": true\n    });*/\n\n\n    Push.Configure({\n        apn: {\n            certData: Assets.getText('buzzypush_prod_cert.pem'),\n            keyData: Assets.getText('buzzypush_prod_key.pem'),\n            passphrase: 'amonkey-surfer',\n            production: true,\n            //gateway: 'gateway.push.apple.com',\n        },\n        gcm: {\n            apiKey: 'AIzaSyCAluGdU2kXfNpJy7bO48h-ulu8smg5bN0',\n        },\n         production: true,\n         'sound': true,\n         'badge': true,\n         'alert': true,\n         'vibrate': true,\n        // 'sendInterval': 15000, Configurable interval between sending\n        // 'sendBatchSize': 1, Configurable number of notifications to send per batch\n        // 'keepNotifications': false,\n//\n    });\n\n});\n\n\n\n","/**\n * Created by adamginsburg on 2/12/2014.\n */\n\n/*Meteor.startup(function () {\n    console.log(\"BEFORE: comments found with null: \" +  Comments.find({topLevelParentID:null}).count());\n    Comments.find({topLevelParentID:null}).forEach(function(item){\n        console.log(\"temp parent:\"  + item.resourceParentID);\n        var currResource = Resources.findOne({_id:item.resourceParentID});\n        if (currResource){\n            console.log(\"path:\" + currResource.path);\n            if (currResource.path != null){\n                console.log(\"split:\" + currResource.path.split(\",\")[1]);\n                Comments.update({_id:item._id},{$set:{topLevelParentID:currResource.path.split(\",\")[1]}});\n            } else {\n                Comments.update({_id:item._id},{$set:{topLevelParentID:currResource._id}});\n\n            }\n        }\n    });\n    console.log(\"AFTER: comments found with null: \" +  Comments.find({topLevelParentID:null}).count());\n})*/\n\n"]}