{"version":3,"sources":["meteor://ðŸ’»app/packages/buzzy-buzz:resources-core/lib/logging.js","meteor://ðŸ’»app/packages/buzzy-buzz:resources-core/lib/collections/resources.js","meteor://ðŸ’»app/packages/buzzy-buzz:resources-core/lib/collections/usercontacts.js","meteor://ðŸ’»app/packages/buzzy-buzz:resources-core/lib/collections/external_data.js","meteor://ðŸ’»app/packages/buzzy-buzz:resources-core/lib/collections/external_rest_data.js","meteor://ðŸ’»app/packages/buzzy-buzz:resources-core/lib/collections/micro_app_data.js","meteor://ðŸ’»app/packages/buzzy-buzz:resources-core/lib/collections/micro_app_fields.js","meteor://ðŸ’»app/packages/buzzy-buzz:resources-core/lib/collections/micro_app_votes.js","meteor://ðŸ’»app/packages/buzzy-buzz:resources-core/lib/collections/micro_app_child.js","meteor://ðŸ’»app/packages/buzzy-buzz:resources-core/lib/collections/micro_app_action_rules.js","meteor://ðŸ’»app/packages/buzzy-buzz:resources-core/lib/collections/collection_globals.js","meteor://ðŸ’»app/packages/buzzy-buzz:resources-core/lib/collections/teams.js","meteor://ðŸ’»app/packages/buzzy-buzz:resources-core/lib/collections/team_members.js","meteor://ðŸ’»app/packages/buzzy-buzz:resources-core/lib/collections/comments.js","meteor://ðŸ’»app/packages/buzzy-buzz:resources-core/lib/collections/commentsViewed.js","meteor://ðŸ’»app/packages/buzzy-buzz:resources-core/lib/collections/notifications.js","meteor://ðŸ’»app/packages/buzzy-buzz:resources-core/lib/collections/resourcefollowers.js","meteor://ðŸ’»app/packages/buzzy-buzz:resources-core/lib/collections/users.js","meteor://ðŸ’»app/packages/buzzy-buzz:resources-core/resources-core.js","meteor://ðŸ’»app/packages/buzzy-buzz:resources-core/server/notifications.js","meteor://ðŸ’»app/packages/buzzy-buzz:resources-core/server/campaignmonitor.js","meteor://ðŸ’»app/packages/buzzy-buzz:resources-core/server/indices.js","meteor://ðŸ’»app/packages/buzzy-buzz:resources-core/server/teams.js","meteor://ðŸ’»app/packages/buzzy-buzz:resources-core/server/teamMembers.js","meteor://ðŸ’»app/packages/buzzy-buzz:resources-core/server/payment_history.js","meteor://ðŸ’»app/packages/buzzy-buzz:resources-core/users.js"],"names":["BuzzyLogging","Meteor","settings","BUZZY_LOGGING_SERVER","DDP","connect","startup","isClient","onReconnect","loginToken","_localStorage","getItem","call","isServer","Resources","Collection","UserContacts","allow","update","ownsDocument","remove","insert","user","ExternalData","displayLinkResult","link","encodedURL","encodeURIComponent","newTempID","ObjectID","_str","Session","set","canEdit","ExternalRestData","methods","updateExternalRestData","resoureID","url","optUserToken","BuzzyGlobal","getCurrentUser","throwError","HTTP","err","result","console","log","message","upsert","parentResourceID","restURL","MicroAppData","currentDataItemField","currentDataItem","fieldID","i","content","_id","duplicateMicroAppData","srcResourceID","newResourceID","oldVsNewFieldIDs","findNewID","contentID","foundItem","find","item","oldFieldID","newFieldID","resource","findOne","canView","allAppData","forEach","appDataItem","newID","addMicroAppData","resourceID","topLevelParentID","getSortInitialVal","field","fieldValueToSort","fieldType","gAPPFIELDTYPE","AUTHOR","author","SUBMITTED","submittedDate","DATETIME","Date","getTime","canAddRow","TimeSync","serverTime","gGetUserNameByID","sortedFieldVal","sortField","MicroAppFields","sortedFieldVal2","sortField2","sortedFieldVal3","sortField3","appFields","fetch","appDataToInsert","userID","submitted","sortVal","sortVal2","sortVal3","appID","error","addFieldMicroAppData","fieldData","userId","$push","addMicroAppDataFields","embeddingResourceID","updateMicroAppData","microAppDataID","microAppDataFieldID","val","currField","canEditMicroAppField","whoCanEdit","searchVal","option","type","gAPPFIELD_DATETYPE","EVENT","start","RATING","toString","searchID","searchID2","searchID3","updateObj","$set","removeFieldsMicroAppData","$pull","multi","updateAllFieldsMicroAppData","fieldName","fieldVal","fieldObj","getAutoIncrementField","microAppID","highestItem","limit","sort","highestVal","isNaN","value","parseInt","updateAllFieldsMicroAppDataOption","updateAllFieldsMicroAppDataSortVal","fieldNumber","BuzzyGlobalAdmin","isBuzzyAdmin","sortedField","microAppDataItem","temp","sortUpdateQuery","removeMicroAppRow","appRowID","microAppDataUpdateViewers","originalRow","newViewers","viewers","_","difference","length","microAppAddChildUpdateCollage","Blobs","topResourceID","blobImageHandleArray","mimetype","indexOf","push","gGetFilePickerHandle","oldHandleArray","MicroAppChild","parentAppItemID","parentAppFieldID","map","childItem","match","k","galleryItem","galleryURL","signature","policy","additionalImageCount","union","collageURL","reason","signedURL","searchMicroAppFieldQuery","getHighestRank","lastRankedItem","rank","insertMicroAppField","collapseBreakPoint","gAPPFIELD_COLLAPSE","XS","defaultVal","gAPPFIELD_INTERACT","OWNERS_AND_AUTHORS","end","format","displayAs","PAYMENT","style","buttonHelp","label","paymentType","gPAYMENT_TYPE","VARIABLE","payment","recipientID","amount","updateMicroAppFieldLabel","updateMicroAppFieldClass","updateMicroAppAddFieldValues","$addToSet","updateMicroAppRemoveFieldValues","updateMicroAppFieldOptionMultipleSelect","multipleSelect","updateMicroAppFieldOptionTimeFormat","timeFormat","updateMicroAppFieldOptionDatetype","dateType","dateFormatObj","DATE","MONTH","YEAR","TIME","updateMicroAppFieldRowSelector","updateMicroAppFieldOptionRating","updateMicroAppFieldOptionAutoIncrement","updateMicroAppFieldOptionIsPhonenumber","updateMicroAppFieldOptionWatsonPersonality","updateMicroAppFieldOptionEventIncludeRSVP","updateMicroAppFieldOptionEventHideAttendee","updateMicroAppFieldOptionEventAuthorRSVP","updateMicroAppFieldCollapseBreakPoint","updateMicroAppFieldOptionDisplayAs","updateMicroAppFieldOptionDisplayResultsBy","displayResultsBy","updateMicroAppFieldWhoCanAdd","whoCanAdd","updateMicroAppFieldWhoCanEdit","updateMicroAppFieldWhoCanDelete","whoCanDelete","updateMicroAppFieldRank","removeMicroAppField","microAppEmailCalendar","iCalBlob","dateData","email","gGetUserEmail","Mailer","send","to","subject","template","replyTo","from","data","attachments","fileName","contents","duplicateMicroAppFields","existingResourceID","oldAndNewFieldIDArray","allFields","aField","MicroAppVotes","microAppVote","appItemID","voteValue","previousVote","voteFieldID","parentAppID","vote","microAppVoteUser","Users","viewMicroAppVoteToCSV","viewViewerSuperSet","viewerSuperset","results","moment","fields","addMicroAppChild","microAppResourceID","topLevelResourceID","parentField","microAppItem","whoCanView","childDataToInsert","removeMicroAppChild","childID","microAppChildItem","MicroAppActionRules","insertMicroAppActionRule","actionRule","updateMicroAppActionCondition","actionID","updateMicroAppActionRuleRank","removeMicroAppActionRule","gCleanString","s","cleanString","replace","Random","id","Teams","isAdmin","teamID","undefined","TeamMembers","role","gMEMBER_TYPE","ADMIN","Comments","hasViewed","commentID","viewedComment","CommentsViewed","$and","hasMoreComments","userSearchCommentsExpression","RegExp","lastComments","$or","resourceParentID","toUsers","status","gCOMMENTSTATUS","LIVE","DELETED","WAITING_APPROVAL","$gte","count","hasPreviousComments","previousComments","$lte","totalComments","viewCommentsToCSV","hasViewedResult","check","String","alreadyViewed","viewedCommentsSummary","pipeline","$match","$project","$sort","$limit","aggregate","Notifications","ownsNotification","markNotificationReadForComment","forUserID","read","ResourceFollowers","updateResourceFollowersCount","numFollowers","updateResourceField","users","deny","addToHistory","profile","buzzHistory","unshift","gMAX_HISTORY","splice","without","addFavorite","favoriteBuzz","removeFavorite","isFavorited","clearHistory","isBot","watsonCreds","FollowedResources","particpants","readers","concat","editors","owners","followers","rf","doc","isAudienceAuthorOwner","privacy","gPRIVACY","PUBLIC","gRESOURCE_STATUS","PUBLISHED","UNLISTED","isAuthorOwner","BUZZY_DEBUG_CLIENT","perfStartTime","result1","perfEndTime","result2","AUDIENCE_OWNERS_AND_AUTHORS","rowCreator","gMICROAPP_PERMISSION_WHOCANVIEW","OWNER_AUTHOR_CREATOR","ANYONE","OWNERSAUTHOR_AND_CREATORS","canChangeAudienceAndAuthors","canChangeOwners","canViewFile","currentResourceID","fieldValue","obj","updatedResourceID","Error","resourceIsFollowed","gNewPath","currPath","gGetParentFromPath","path","substring","pathArray","split","gGetTopParentFromPath","createDirectChildrenServer","targetPath","parentStatus","optResource","callback","createDirectChildren","srcResource","tempTitle","title","gBASICTYPES","BUZZ","newResource","searchExpression","directChildrenCursor","$regex","DRAFT","childResource","newFileResourceID","extend","pick","mediaFile","reusable","isStarterTemplate","username","updated","IMAGE","topParentID","ATTACHMENT","APPLICATION","newSortField","newSortField2","newSortField3","isLoggedIn","fieldNames","updateResourceWhoCanAdd","updateResourceDefaultTimezone","updateResourceNumberOfItems","Number","updateResourceGroupField","updateMicroAppType","updateMicroAppSubmitType","updateMicroAppResultsLocation","updateMicroAppResultsDisplayStyle","updateMicroAppResultsDisplayGantt","updateMicroAppResultsDisplayMap","updateMicroAppResultsDisplayModal","updateMicroAppResultsShowColumnHeader","updateResourceSortOrder","updateResourceAddButtonLocation","updateResourceButtonText","updateResourceFormHelpText","updateResourceButtonStyle","updateResourceSubmitButtonText","updateResourceSubmitButtonMessage","updateResourceSubmitButtonStyle","updateResourceWhoCanDelete","updateResourceWhoCanView","createWithToken","token","createWithID","updateResourceSortField","currentResource","sortFieldObj","isPublicOrUnlistedResource","addReader","readerID","activity","gGetUserName","addEditor","editorID","addOwner","ownerID","removeReader","removeEditor","removeOwner","removeParticipant","participantID","updateUpdatedDate","ResourceSetAllToFollow","gACTIONS","createDirectChildrenServerMethod","resourceParent","parentID","duplicateWelcomeBuzz","welcomeBuzz","BUZZY_WELCOME","userName","PRIVATE","changeRoleTo","targetRole","relatedBuzz","participants","query","resourceQuery","allValues","$setUnion","$all","$ne","resourceFollowersLimited","optLimit","timeCalled","follower","userArray","$in","BuzzGlobal","searchBuzz","searchQuery","contactsArray","name","contact","contactID","coverImage","searchBuzzOwnerAuthor","generateQuery","searchExp","searchUserExpression","getBasicBuzzID","BUZZY_BASIC_BUZZ_ID","updateResourceGalleryURL","updateData","updateResourceAnalyticsOn","resourceAnalyticsOn","createBuzzFromTemplate","templateID","optUserList","chosenTemplate","newReaders","newEditors","newOwners","hasTour","setTimeout","j","audience","action","invitedByID","invitedUserEmail","invitingResourceID","analytics","track","authors","makeRestCall","microAppCSV","fieldsCursor","fieldsArray","appData","row","tempEvent","gFormatDate","timezone","location","formatted_address","ATTACHMENTS","viewedResourceSummary","resourceViewedByUser","resourceTrackUserView","completedSetup","updateResourcePayment","updateResourceContent","updateResourcePaymentButtonHelp","updateText","updateResourcePaymentButtonText","updateResourcePaymentButtonStyle","resourceCopyMicroApp","getCommentToList","currentParticipants","participantsWithNames","currentUsersArray","checkValidLicense","ownerAuthorsArray","subscriptionID","connected","BUZZY_LOGGING_TOKEN","addWatsonCredential","newCred","watsonAtID","watsonUserID","watsonPassword","watsonWorkspaceID","updateWatsonCredentials","watsonItemID","creds","createAnonymousPaymentNotification","recipientUserID","self","emailRecipients","byUserID","target","commenterName","actor","displayName","msgText","object","currency","formatCurrency","receipt_number","Push","text","badge","sound","sendResourceNotifications","connection","sendNotifications","recipients","emailMessage","userEmail","gGetUserFormattedEmail","usersToEmail","usersToSMS","usersCursor","usersToNotify","channels","channel","gNOTIFICATION_CHANNEL","EMAIL","tempToken","services","password","reset","enabled","address","SMS","comment","MAIL_INCOMING_DOMAIN","toUserEmail","toUserID","fromUserID","absoluteUrl","thisConnection","optResourceChangeList","isNew","resourceList","showComments","gCOMMENTSHOW","INLINE","resourceIDs","currentUserID","sendMicroAppNotifications","customMessage","microAppRowID","createCommentNotification","truncatedText","optOldToUsers","truncate","gCOMMENT_TRUNCATE","followerList","tempOldToList","currActivity","verb","currentAction","COMMENTED","SENT_TO_ALL","createCommentNotificationAuthorsAndOwners","gNotificationsUnreadForUserID","markAllNotificationsRead","markAllNotificationsReadResource","sendSMSTwilio","recipeints","accountSid","authToken","twilio","Twilio","sendSms","body","mediaUrl","responseData","createResourceNotification","createResourceChangeNotification","resourceCursor","arrayChildren","aResource","validResourcesIDs","intersection","createSingleUserResourceNotification","paymentNotifications","notification","emailaddress","gEmailforUserID","charge_id","paymentNotificationsMicroApp","currentPaymentItem","actionRuleNotificationsMicroApp","Object","getFieldVal","contentArray","element","microAppResource","docParentID","embeddingResource","fieldLabelsArray","currentActionRules","rule","condition","currentField","targetedUsers","gROLES","OWNER","AUDIENCE","FOLLOWER","resourceFollowers","embeddingResourceFollowers","viewerNotificationsMicroApp","appResourceID","addCMSubscriber","marketingOrigin","auth","sendWelcomeEmail","addToInvitedList","optResourceTitle","dateUserInvited","inviteURL","createTemplateID","customFields","invitingUser","removeFromInvitedList","addToReferralList","_ensureIndex","isBasic","special","background","SamlProviders","org","createTeam","teamInfo","memberInfo","changeTeamName","newVal","changeMemberRole","newRole","teamMember","adminCount","addTeamMember","PaymentHistory","trackPayment","event","paymentData","sendVerificationEmail","Accounts","changeProfileImage","image","setPassword","newPassword","emailAddress","emailObj","verified","emails","logout","userIAcceptLicense","acceptedLicense","dateLicenseAccepted","userIDoNotAcceptLicense","userHasAcceptedLicense","userCompleteInitialSetup","dateInitialSetup","userHasCompletedInitialSetup","optUserID","inviteUser","optResourceID","optCreateTemplateID","resourceTitle","gGetUserforEmail","toLowerCase","userData","createdAt","secret","gUSERSTATUS","ACTIVE","approveContact","contactRecord","userContact","denyContact","removeContact","userContactID","addContact","tempEmail","addNewUser","addedEmail","newParticipant","addNewFollower","updateProfile","updateUserStripe","removeStripeAccountInfo","stripeInfo","updateUserNotifications","gNOTIFICATION_ACTIONS","ADD","found","REMOVE","addNewUserEmail","otherUsers","resendEnrollment","emailTemplate","sendEnrollmentEmail","optRegoTop","userExists","postRegisterEmail","registeredEmail","regex","REGEX_EMAIL","identify","hashedToken","_hashLoginToken","selector","options","userAddWatsonCredential","userUpdateWatsonCredentials","userRemoveWatsonCredentials"],"mappings":"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","file":"/packages/buzzy-buzz_resources-core.js","sourcesContent":["/**\n * Created by adamginsburg on 22/02/2016.\n */\n\nBuzzyLogging = {};\nif (Meteor.settings.public.BUZZY_LOGGING_SERVER){\n    BuzzyLogging = DDP.connect(Meteor.settings.public.BUZZY_LOGGING_SERVER);\n}\n\nMeteor.startup(function(){\n\n    if (Meteor.isClient) {\n        BuzzyLogging.onReconnect = function() {\n            var loginToken = Meteor._localStorage.getItem('Meteor.loginToken');\n            this.call('authenticate', loginToken);\n        };\n        BuzzyLogging.onReconnect();\n    }\n\n\n});\n\nif (Meteor.isServer){\n\n\n}\n","/**\n * Created by adamginsburg on 27/01/2016.\n */\nResources = new Meteor.Collection('resources');","/**\n * Created by adamginsburg on 22/05/2014.\n */\nUserContacts = new Meteor.Collection('userContacts');\n\n\nUserContacts.allow({\n    update: Resources.ownsDocument,\n    remove: Resources.ownsDocument,\n    insert: Meteor.user\n});\n\n\n\n","/**\n * Created by adamginsburg on 23/10/2014.\n */\nExternalData = new Meteor.Collection('externalData');\nExternalData.displayLinkResult = function(link){\n    //encode link and call iFramely\n    var encodedURL = encodeURIComponent(link);\n    var newTempID = new Meteor.Collection.ObjectID()._str;\n    Session.set('tempLinkID',newTempID);\n    Meteor.call('gGetURLMetaData',newTempID, link);\n\n\n};\n\n\nExternalData.allow({\n    update: Resources.canEdit,\n    remove: Resources.ownsDocument,\n    insert: Meteor.user\n});","/**\n * Created by adamginsburg on 2/02/2016.\n */\nExternalRestData = new Meteor.Collection('externalRestData');\n\nif (Meteor.isServer){\n    Meteor.methods({\n        updateExternalRestData: function(resoureID, url, optUserToken){\n            var user = BuzzyGlobal.getCurrentUser(optUserToken);\n            if (!user){\n                BuzzyGlobal.throwError(\"You do not have the rights to do that!!!\")\n            }\n\n            HTTP.call(\"GET\",url, {\n                },\n                function (err, result) {\n                    console.log(\"POST RESULT:\", result, \" ERR:\", err)\n                    if (err) {\n                        console.log({message: 'Test failed error.'});\n                    } else {\n                        console.log(\"TT res:\", result)\n                        console.log({message: 'Test passed - got result: ' + result});\n                        ExternalRestData.upsert(\n                            {parentResourceID:resoureID},\n                            {\n                                parentResourceID: resoureID,\n                                restURL: url,\n                                result: result\n                            },\n                            {\n                                upsert: true\n                            },\n                            function(err){\n                                if (err){\n                                    BuzzyGlobal.throwError(err)\n                                }\n                            });\n                    }\n                }) ;\n\n\n        }\n    })\n}","/**\n * Created by adamginsburg on 8/11/2015.\n */\nMicroAppData = new Meteor.Collection('microAppData');\n/*\n AppData.allow({\n //update: Resources.ownsDocument\n //update: Resources.ownsNotification,\n insert: Meteor.user\n });\n */\n\n\nMicroAppData.currentDataItemField = function(currentDataItem, fieldID){\n    if (currentDataItem && fieldID){\n        for (i in currentDataItem.content){\n            if (currentDataItem.content[i]._id === fieldID){\n                return currentDataItem.content[i];\n            }\n        }\n    }\n\n}\nMicroAppData.duplicateMicroAppData =  function(srcResourceID, newResourceID,oldVsNewFieldIDs, optUserToken){\n\n\n    var findNewID = function(contentID){\n        if (oldVsNewFieldIDs){\n            var foundItem =  oldVsNewFieldIDs.find(function(item){\n                return contentID === item.oldFieldID\n            })\n            if (foundItem){\n                return foundItem.newFieldID;\n            } else {\n                return \"undefined\";\n            }\n\n        }\n        else {\n            return \"undefined\";\n        }\n    }\n\n    var user = BuzzyGlobal.getCurrentUser(optUserToken);\n    var resource = Resources.findOne(srcResourceID);\n    if (!user && !Resources.canView(user._id,resource)){\n        BuzzyGlobal.throwError(\"You do not have the permission to do that!\")\n    }\n\n    var allAppData = MicroAppData.find({parentResourceID:srcResourceID});\n    if (allAppData){\n        allAppData.forEach(function(appDataItem){\n            appDataItem._id = new Meteor.Collection.ObjectID()._str;\n            appDataItem.parentResourceID = newResourceID;\n            for (i in appDataItem.content){\n                var newID = findNewID(appDataItem.content[i]._id);\n                appDataItem.content[i]._id = newID; //swap ID's with new Field ID's\n                //appDataItem.content[i]._id = oldVsNewFieldIDs.IDs[appDataItem.content[i]._id]; //swap ID's with new Field ID's\n            }\n            MicroAppData.insert(appDataItem);\n        });\n    }\n}\n\nif (Meteor.isServer){\n    Meteor.methods({\n\n        addMicroAppData: function (resourceID, topLevelParentID) {\n            var user = Meteor.user();\n\n            var getSortInitialVal = function(field){\n                var fieldValueToSort = \"\";\n                if (field){\n                    switch(field.fieldType){\n                        case BuzzyGlobal.gAPPFIELDTYPE.AUTHOR:\n                            fieldValueToSort = author;\n                            break;\n                        case BuzzyGlobal.gAPPFIELDTYPE.SUBMITTED:\n                            fieldValueToSort = submittedDate;\n                            break;\n                        case BuzzyGlobal.gAPPFIELDTYPE.DATETIME:\n                            fieldValueToSort =   new Date().getTime();\n\n                            break;\n                        default:\n                            fieldValueToSort = \"\";\n                    }\n\n                };\n                return fieldValueToSort;\n            }\n\n            var resource = Resources.findOne(resourceID);\n            // ensure the user is logged in\n            if (!user) {\n                BuzzyGlobal.throwError(\"You need to be logged complete this operation.\")\n\n            };\n            if (!Resources.canAddRow(resource)){\n                BuzzyGlobal.throwError(\"You are not allowed to perform this operation.\")\n            }\n\n            var submittedDate;\n            if (Meteor.isClient){\n                submittedDate = TimeSync.serverTime();\n            } else {\n                submittedDate = new Date().getTime();\n            }\n            var author = BuzzyGlobal.gGetUserNameByID(user._id);\n            var sortedFieldVal = (typeof resource.content.sortField != \"undefined\")? getSortInitialVal(MicroAppFields.findOne({_id:resource.content.sortField})): new Date().getTime();\n            var sortedFieldVal2 = (typeof resource.content.sortField2 != \"undefined\")? getSortInitialVal(MicroAppFields.findOne({_id:resource.content.sortField2})): null;\n            var sortedFieldVal3 = (typeof resource.content.sortField3 != \"undefined\")? getSortInitialVal(MicroAppFields.findOne({_id:resource.content.sortField3})): null;\n\n\n            var appFields = MicroAppFields.find({parentResourceID:resourceID}).fetch();\n\n            if (appFields){\n                var appDataToInsert =  {\n                    userID: user._id,\n                    author: author,\n                    submitted: submittedDate,\n                    content:appFields,\n                    parentResourceID:resourceID,\n                    sortVal: sortedFieldVal,\n                    sortVal2: sortedFieldVal2,\n                    sortVal3: sortedFieldVal3,\n                    _id: new Meteor.Collection.ObjectID()._str\n                };\n                var appID = MicroAppData.insert(appDataToInsert, function(error){\n                    if (!error){\n                        Meteor.call(\"updateUpdatedDate\", topLevelParentID);\n\n                    }\n                });\n                return appDataToInsert._id;\n            }\n\n\n        },\n        addFieldMicroAppData: function (fieldData) {\n            var user = Meteor.user();\n\n            var resource = Resources.findOne(fieldData.parentResourceID);\n            // ensure the user is logged in\n            if (!user) {\n                BuzzyGlobal.throwError(\"You need to be logged complete this operation.\")\n\n            };\n            if (!Resources.canEdit(Meteor.userId(),resource)){\n                BuzzyGlobal.throwError(\"You are not allowed to perform this operation.\")\n            }\n\n            var submittedDate;\n            if (Meteor.isClient){\n                submittedDate = TimeSync.serverTime();\n            } else {\n                submittedDate = new Date().getTime();\n            }\n\n            var allAppData = MicroAppData.find({parentResourceID:fieldData.parentResourceID});\n            if (allAppData){\n                allAppData.forEach(function(appDataItem){\n                    MicroAppData.update({_id:appDataItem._id},\n                        {$push:{content:fieldData}})\n                });\n            }\n\n\n        },\n        addMicroAppDataFields: function (fieldData, embeddingResourceID) {\n            var user = Meteor.user();\n\n            var resource = Resources.findOne(fieldData.parentResourceID);\n            // ensure the user is logged in\n            if (!user) {\n                BuzzyGlobal.throwError(\"You need to be logged complete this operation.\")\n\n            };\n            if (!Resources.canAddRow(resource)){\n                BuzzyGlobal.throwError(\"You are not allowed to perform this operation.\")\n            }\n\n            var submittedDate;\n            if (Meteor.isClient){\n                submittedDate = TimeSync.serverTime();\n            } else {\n                submittedDate = new Date().getTime();\n            }\n  \n            MicroAppData.insert(fieldData, function(err){\n                if (err){\n                    BuzzyGlobal.throwError(err);\n                    return;\n                }\n                Meteor.call(\"actionRuleNotificationsMicroApp\",fieldData,embeddingResourceID, function (err) {\n                    if (err){\n                        BuzzyGlobal.throwError(err);\n                        console.log(err)\n                    }\n                })\n\n            });\n\n\n        },\n        updateMicroAppData: function (resourceID, topLevelParentID,microAppDataID,microAppDataFieldID, val) {\n            var user = Meteor.user();\n            var resource = Resources.findOne(resourceID);\n\n\n            // ensure the user is logged in\n            if (!user) {\n                BuzzyGlobal.throwError(\"You need to be logged complete this operation.\")\n\n            };\n            var currField = MicroAppFields.findOne({_id:microAppDataFieldID});\n            if (!currField && !Resources.canEditMicroAppField(Meteor.userId(),resource, currField.whoCanEdit, currField.whoCanEdit, null)){\n                BuzzyGlobal.throwError(\"You are not allowed to perform this operation.\")\n            }\n\n            var submittedDate;\n            if (Meteor.isClient){\n                submittedDate = TimeSync.serverTime();\n            } else {\n                submittedDate = new Date().getTime();\n            }\n            var searchVal = val;\n            if (currField.fieldType == BuzzyGlobal.gAPPFIELDTYPE.DATETIME && currField.option.type === BuzzyGlobal.gAPPFIELD_DATETYPE.EVENT.type && typeof val.start !== \"undefined\"){\n                searchVal= val.start\n            } else if (currField.fieldType == BuzzyGlobal.gAPPFIELDTYPE.RATING && typeof val !== \"undefined\"){\n                searchVal= val? val.toString():\"\";\n            }\n\n\n\n            var searchID = typeof resource.content.sortField !== \"undefined\"? resource.content.sortField: \"\";\n            var searchID2 = typeof resource.content.sortField2 !== \"undefined\"? resource.content.sortField2: \"\";\n            var searchID3 = typeof resource.content.sortField3 !== \"undefined\"? resource.content.sortField3: \"\";\n            var updateObj = {\"content.$.value\":val};\n            switch (microAppDataFieldID){\n                case searchID:\n                    updateObj.sortVal = searchVal;\n                    break;\n                case searchID2:\n                    updateObj.sortVal2 = searchVal;\n                    break;\n                case searchID3:\n                    updateObj.sortVal3 =searchVal;\n                    break;\n                default:\n\n            }\n            MicroAppData.update(\n                {_id:microAppDataID,\"content._id\":microAppDataFieldID},\n                {$set:updateObj},\n                function(error){\n                    if (!error){\n                        Meteor.call(\"updateUpdatedDate\", topLevelParentID);\n                    } else {\n                        BuzzyGlobal.throwError(error);\n                    }\n                }\n            );\n\n\n\n\n\n        },\n\n        removeFieldsMicroAppData: function (resourceID, microAppDataFieldID) {\n            var user = Meteor.user();\n\n            var resource = Resources.findOne(resourceID);\n            // ensure the user is logged in\n            if (!user) {\n                BuzzyGlobal.throwError(\"You need to be logged complete this operation.\")\n\n            };\n            var currField = MicroAppFields.findOne({_id:microAppDataFieldID});\n            if (!currField && !Resources.canEditMicroAppField(Meteor.userId(),resource, currField.whoCanEdit, currField.whoCanEdit, null)){\n                BuzzyGlobal.throwError(\"You are not allowed to perform this operation.\")\n            }\n\n            var submittedDate;\n            if (Meteor.isClient){\n                submittedDate = TimeSync.serverTime();\n            } else {\n                submittedDate = new Date().getTime();\n            }\n            var searchVal = \"\";\n\n            if (resource.content.sortField === microAppDataFieldID ){\n                MicroAppData.update(\n                    {\"content._id\":microAppDataFieldID},\n                    {$pull:{content:{_id:microAppDataFieldID}}},\n                    {multi: true},\n                    function(error){\n                        if (!error){\n                            //Meteor.call(\"updateUpdatedDate\", resource._id);\n                        } else {\n                            BuzzyGlobal.throwError(error);\n                        }\n                    }\n                );\n\n            } else {\n                MicroAppData.update(\n                    {\"content._id\":microAppDataFieldID},\n                    {$pull:{content:{_id:microAppDataFieldID}}},\n                    {multi: true},\n                    function(error){\n                        if (!error){\n                            //Meteor.call(\"updateUpdatedDate\", resource._id);\n                        } else {\n                            BuzzyGlobal.throwError(error);\n                        }\n                    }\n                );\n            }\n\n        },\n        updateAllFieldsMicroAppData: function(resourceID,fieldID,fieldName, fieldVal){\n            var user = Meteor.user();\n\n            var resource = Resources.findOne(resourceID);\n            // ensure the user is logged in\n            if (!user) {\n                BuzzyGlobal.throwError(\"You need to be logged complete this operation.\")\n\n            };\n            if (!Resources.canEdit(Meteor.userId(),resource)){\n                BuzzyGlobal.throwError(\"You are not allowed to perform this operation.\")\n            }\n            var fieldObj = {};\n            fieldObj[fieldName] = fieldVal;\n            MicroAppData.update(\n                {parentResourceID:resourceID,\"content._id\":fieldID},\n                {$set:{\"content.$\":fieldObj}},\n                {multi:true},\n                function(error){\n                    if (!error){\n                        //Meteor.call(\"updateUpdatedDate\", topLevelParentID);\n                    } else {\n                        BuzzyGlobal.throwError(error);\n                    }\n                }\n            );\n\n        },\n        getAutoIncrementField: function(microAppID,fieldID) {\n            var user = Meteor.user();\n\n\n            if (!user) {\n                BuzzyGlobal.throwError(\"You need to be logged complete this operation.\")\n\n            }\n            var highestItem = MicroAppData.findOne({parentResourceID:microAppID},{limit:1,sort:{sortVal:-1}});\n            if (highestItem){\n                var highestVal = MicroAppData.currentDataItemField(highestItem,fieldID);\n                if (!isNaN(highestVal.value)){\n                    return parseInt(highestVal.value) + 1;\n                }\n            }\n\n        },\n        updateAllFieldsMicroAppDataOption: function(resourceID,fieldID, fieldVal){\n            var user = Meteor.user();\n\n            var resource = Resources.findOne(resourceID);\n            // ensure the user is logged in\n            if (!user) {\n                BuzzyGlobal.throwError(\"You need to be logged complete this operation.\")\n\n            };\n            if (!Resources.canEdit(Meteor.userId(),resource)){\n                BuzzyGlobal.throwError(\"You are not allowed to perform this operation.\")\n            }\n\n            MicroAppData.update(\n                {parentResourceID:resourceID,\"content._id\":fieldID},\n                {$set:{\"content.$.option\":fieldVal}},\n                {multi:true},\n                function(error){\n                    if (!error){\n                        //Meteor.call(\"updateUpdatedDate\", topLevelParentID);\n                    } else {\n                        BuzzyGlobal.throwError(error);\n                    }\n                }\n            );\n\n        },\n        updateAllFieldsMicroAppDataSortVal: function(resourceID,fieldID, fieldNumber){\n            var user = Meteor.user();\n\n            var resource = Resources.findOne(resourceID);\n            // ensure the user is logged in\n            if (!user) {\n                BuzzyGlobal.throwError(\"You need to be logged complete this operation.\")\n\n            };\n            if (!(Resources.canEdit(Meteor.userId(),resource) || BuzzyGlobalAdmin.isBuzzyAdmin())){\n                BuzzyGlobal.throwError(\"You are not allowed to perform this operation.\")\n            }\n\n            var sortedField = MicroAppFields.findOne({_id:fieldID});\n\n            MicroAppData.find(\n                {parentResourceID:resourceID})\n                .forEach(function(microAppDataItem){\n\n                    var fieldValueToSort = \"\";\n                    switch(sortedField.fieldType){\n                        case BuzzyGlobal.gAPPFIELDTYPE.AUTHOR:\n                            fieldValueToSort = microAppDataItem.author;\n                            break;\n                        case BuzzyGlobal.gAPPFIELDTYPE.SUBMITTED:\n                            fieldValueToSort = microAppDataItem.submitted;\n                            break;\n                        case BuzzyGlobal.gAPPFIELDTYPE.DATETIME:\n                            var currField = MicroAppData.currentDataItemField(microAppDataItem,fieldID);\n                            if (currField && (typeof currField !== \"undefined\") && currField.value && sortedField.option.type === BuzzyGlobal.gAPPFIELD_DATETYPE.EVENT.type){\n                                fieldValueToSort = currField.value.start;\n                            } else {\n                                fieldValueToSort = currField.value;\n                            }\n\n                            break;\n                        case BuzzyGlobal.gAPPFIELDTYPE.EVENT:\n                            var currField = MicroAppData.currentDataItemField(microAppDataItem,fieldID);\n                            if (currField && (typeof currField !== \"undefined\") && currField.value){\n                                fieldValueToSort = currField.value.start;\n                            }\n\n\n                            break;\n                        case BuzzyGlobal.gAPPFIELDTYPE.RATING:\n                            var temp = MicroAppData.currentDataItemField(microAppDataItem,fieldID).value\n                            fieldValueToSort = temp?temp.toString():null;\n\n\n                            break;\n                        default:\n                            fieldValueToSort = MicroAppData.currentDataItemField(microAppDataItem,fieldID).value;\n                    }\n\n                    var sortUpdateQuery = {sortVal:(fieldValueToSort)};\n                    switch (fieldNumber){\n                        case \"2\":\n                            sortUpdateQuery = {sortVal2:(fieldValueToSort)};\n                            break;\n                        case \"3\":\n                            sortUpdateQuery = {sortVal3:(fieldValueToSort)};\n                            break;\n                        default:\n\n                    }\n\n                    MicroAppData.update(\n                        {_id:microAppDataItem._id},\n                        {$set:sortUpdateQuery},\n                        function(error){\n                            if (!error){\n                                //Meteor.call(\"updateUpdatedDate\", topLevelParentID);\n                            } else {\n                                BuzzyGlobal.throwError(error);\n                            }\n                        }\n                    );\n                })\n\n\n        },\n        removeMicroAppRow: function(appRowID, resourceID){\n            var user = Meteor.user();\n\n            var resource = Resources.findOne(resourceID);\n            // ensure the user is logged in\n            if (!user) {\n                BuzzyGlobal.throwError(\"You need to be logged complete this operation.\")\n\n            };\n            if (!Resources.canEdit(Meteor.userId(),resource)){\n                BuzzyGlobal.throwError(\"You are not allowed to perform this operation.\")\n            }\n\n            MicroAppData.remove(\n                {\"_id\":appRowID},\n                function(error){\n                    if (error){\n                        BuzzyGlobal.throwError(error);\n                    }\n                }\n            );\n\n        },\n        microAppDataUpdateViewers: function(appRowID,resourceID, val,optUserToken){\n            var user = BuzzyGlobal.getCurrentUser(optUserToken);\n\n            var resource = Resources.findOne(resourceID);\n            // ensure the user is logged in\n            if (!user) {\n                BuzzyGlobal.throwError(\"You need to be logged complete this operation.\")\n\n            };\n            if (!Resources.canEdit(Meteor.userId(),resource)){\n                BuzzyGlobal.throwError(\"You are not allowed to perform this operation.\")\n            }\n\n            var originalRow = MicroAppData.findOne({_id:appRowID});\n            var newViewers = [];\n            if (originalRow && originalRow.viewers ){\n                newViewers = _.difference(val,originalRow.viewers);\n            }\n\n\n            MicroAppData.update(\n                {_id:appRowID},\n                {$set:{viewers:val}},\n                function(error){\n                    if (error){\n                        BuzzyGlobal.throwError(error);\n                    } else {\n                        if (newViewers.length > 0){\n                            Meteor.call(\"viewerNotificationsMicroApp\", resource._id, newViewers, optUserToken)\n                        }\n                    }\n                }\n            );\n\n        },\n        microAppAddChildUpdateCollage: function(Blobs, parentResourceID, topResourceID, appID, fieldID){\n            var blobImageHandleArray = [];\n            for(i in Blobs) {\n\n                if (Blobs[i].mimetype.indexOf(\"image\") >= 0 ){\n                    blobImageHandleArray.push(BuzzyGlobal.gGetFilePickerHandle(Blobs[i].url));\n                }\n            }\n\n            var oldHandleArray = MicroAppChild.find({parentAppItemID:appID,parentAppFieldID:fieldID }).map(function(childItem){\n                return childItem.content.url.match(/(api\\/file\\/)([A-Za-z0-9]+)/)[2];\n            });\n\n\n            Meteor.call(\"filepickerSignUrlListMethod\",Blobs, function(err,result) {\n                if (err) {\n                    BuzzyGlobal.throwError(err);\n                }\n\n                for (k in result){\n                    Meteor.call(\"addMicroAppChild\",parentResourceID, topResourceID, appID, fieldID, result[k]);\n\n\n                }\n\n                if (Blobs && Blobs.length === 1) {\n                    var galleryItem = {\n                        galleryURL: result[0].url,\n                        signature:result[0].signature,\n                        policy:result[0].policy,\n                        additionalImageCount:0\n                    };\n                    Meteor.call(\"updateMicroAppData\",parentResourceID, topResourceID, appID, fieldID,galleryItem);\n                }\n            });\n\n            blobImageHandleArray = _.union(oldHandleArray,blobImageHandleArray);\n            if (blobImageHandleArray.length > 1){\n                Meteor.call('createFilepickerCollage',blobImageHandleArray, function (error, collageURL) {\n                    if (error) {\n\n                        BuzzyGlobal.throwError(error.reason);\n                    } else {\n                        var galleryItem = {\n                            galleryURL: collageURL.signedURL,\n                            signature:collageURL.signature,\n                            policy:collageURL.policy,\n                            additionalImageCount:collageURL.additionalImageCount\n                        };\n                        Meteor.call(\"updateMicroAppData\",parentResourceID, topResourceID, appID, fieldID,galleryItem);\n\n\n                    }\n                });\n            }\n        },\n        searchMicroAppFieldQuery: function(parentResourceID, fieldID, optUserToken){\n            var user = BuzzyGlobal.getCurrentUser(optUserToken);\n\n            var resource = Resources.findOne(parentResourceID);\n            // ensure the user is logged in\n            if (!user) {\n                BuzzyGlobal.throwError(\"You need to be logged complete this operation.\")\n\n            };\n            if (!Resources.canView(Meteor.userId(),resource)){\n                BuzzyGlobal.throwError(\"You are not allowed to perform this operation.\")\n            }\n\n           /* var items = MicroAppData.find({\n                $and:[\n                    {parentResourceID: parentResourceID},\n                    {\"content.$._id\":fieldID};\n                ]\n            })*/\n\n        }\n\n    });\n}\n","/**\n * Created by adamginsburg on 14/11/2015.\n */\nMicroAppFields = new Meteor.Collection('microAppFields');\nMicroAppFields.getHighestRank = function(resourceID){\n    if (Meteor.userId() && resourceID){\n        var lastRankedItem = MicroAppFields.findOne({parentResourceID:resourceID},{sort:{rank:-1}});\n        if (!lastRankedItem || isNaN(lastRankedItem.rank)){\n            return 0;\n        } else {\n            return lastRankedItem.rank\n        }\n\n    }\n};\nMeteor.methods({\n    insertMicroAppField: function (resourceID, fieldType) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n                var rank = MicroAppFields.getHighestRank(resourceID) + 1;\n                var fieldData = {\n                    parentResourceID: resourceID,\n                    fieldType: fieldType,\n                    collapseBreakPoint: BuzzyGlobal.gAPPFIELD_COLLAPSE.XS,\n                    defaultVal: null,\n                    rank: rank,\n                    whoCanEdit:BuzzyGlobal.gAPPFIELD_INTERACT.OWNERS_AND_AUTHORS,\n                     _id: new Meteor.Collection.ObjectID()._str\n                };\n\n                if (fieldType === BuzzyGlobal.gAPPFIELDTYPE.DATETIME){\n                    fieldData.option = \"YYYY-MMM-DD HH:mm\";\n                } else if (fieldType === BuzzyGlobal.gAPPFIELDTYPE.EVENT){\n                    fieldData.start = new Date();\n                    fieldData.end = new Date();\n                    fieldData.option = {\n                        format: \"h:mm a D MMM YYYY ZZ\",\n                        type: \"event\",\n                        displayAs:\"selectbox\"\n                    }\n                } else if (fieldType === BuzzyGlobal.gAPPFIELDTYPE.PAYMENT){\n\n                    fieldData.value = {\n                        style: 'btn-success',\n                        buttonHelp: 'custom help text',\n                        label: 'Please click \"Edit\" below',\n                        paymentType: BuzzyGlobal.gPAYMENT_TYPE.VARIABLE,\n                        payment:{\n                            recipientID:\"\",\n                            amount:0,\n\n                        }\n\n                    }\n                }\n                MicroAppFields.insert(fieldData, function(error){\n                    if (error){\n                        BuzzyGlobal.throwError(error);\n                    } else {\n                        if (!fieldData.value){\n                            fieldData.value = fieldData.defaultVal;\n                        }\n                        Meteor.call(\"addFieldMicroAppData\",fieldData);\n                    }\n                });\n\n\n\n            }\n        }\n    },\n\n    updateMicroAppFieldLabel: function (resourceID,fieldID, fieldVal) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n                MicroAppFields.update({_id:fieldID},{$set:{\"label\":fieldVal}}, function(error){\n                    if (error){\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n\n    updateMicroAppFieldClass: function (resourceID,fieldID, fieldVal) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n                MicroAppFields.update({_id:fieldID},{$set:{\"fieldClass\":fieldVal}}, function(error){\n                    if (error){\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n    updateMicroAppAddFieldValues: function (resourceID,fieldID, fieldVal) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n                MicroAppFields.update({_id:fieldID},{$addToSet:{\"option.values\":fieldVal}}, function(error){\n                    if (error){\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n    updateMicroAppRemoveFieldValues: function (resourceID,fieldID, fieldVal) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n                MicroAppFields.update({_id:fieldID},{$pull:{\"option.values\":fieldVal}}, function(error){\n                    if (error){\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n    updateMicroAppFieldOptionMultipleSelect: function (resourceID,fieldID, fieldVal) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n                MicroAppFields.update({_id:fieldID},{$set:{option:{multipleSelect:fieldVal}}}, function(error){\n                    if (error){\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n    updateMicroAppFieldOptionTimeFormat: function (resourceID,fieldID, fieldVal) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n                MicroAppFields.update({_id:fieldID},{$set:{option:{timeFormat:fieldVal}}}, function(error){\n                    if (error){\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n    updateMicroAppFieldOptionDatetype: function (resourceID,fieldID, dateType) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n                var dateFormatObj = {};\n                switch (dateType){\n                    case BuzzyGlobal.gAPPFIELD_DATETYPE.DATETIME.type:\n                        dateFormatObj = BuzzyGlobal.gAPPFIELD_DATETYPE.DATETIME;\n                        break;\n                    case BuzzyGlobal.gAPPFIELD_DATETYPE.DATE.type:\n                        dateFormatObj = BuzzyGlobal.gAPPFIELD_DATETYPE.DATE;\n                        break;\n                    case BuzzyGlobal.gAPPFIELD_DATETYPE.MONTH.type:\n                        dateFormatObj = BuzzyGlobal.gAPPFIELD_DATETYPE.MONTH;\n                        break;\n                    case BuzzyGlobal.gAPPFIELD_DATETYPE.YEAR.type:\n                        dateFormatObj = BuzzyGlobal.gAPPFIELD_DATETYPE.YEAR;\n                        break;\n                    case BuzzyGlobal.gAPPFIELD_DATETYPE.TIME.type:\n                        dateFormatObj = BuzzyGlobal.gAPPFIELD_DATETYPE.TIME;\n                        break;\n                    case BuzzyGlobal.gAPPFIELD_DATETYPE.EVENT.type:\n                        dateFormatObj = BuzzyGlobal.gAPPFIELD_DATETYPE.EVENT;\n                        break;\n                    default:\n                        dateFormatObj = BuzzyGlobal.gAPPFIELD_DATETYPE.DATETIME;\n\n                }\n\n                MicroAppFields.update({_id:fieldID},{$set:{option:dateFormatObj}}, function(error){\n                    if (error){\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n    updateMicroAppFieldRowSelector: function (resourceID,fieldID, val) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n                var dateFormatObj = {};\n\n                MicroAppFields.update({_id:fieldID},{$set:{option:val}}, function(error){\n                    if (error){\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n    updateMicroAppFieldOptionRating: function (resourceID,fieldID, val) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n                MicroAppFields.update({_id:fieldID},{$set:{option:val}}, function(error){\n                    if (error){\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n    updateMicroAppFieldOptionAutoIncrement: function (resourceID,fieldID, val) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n\n\n                MicroAppFields.update({_id:fieldID},{$set:{\"option.autoIncrement\":val}}, function(error){\n                    if (error){\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n    updateMicroAppFieldOptionIsPhonenumber: function (resourceID,fieldID, val) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n\n\n                MicroAppFields.update({_id:fieldID},{$set:{\"option.isPhoneNumber\":val}}, function(error){\n                    if (error){\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n    updateMicroAppFieldOptionWatsonPersonality: function (resourceID,fieldID, val) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n\n\n                MicroAppFields.update({_id:fieldID},{$set:{\"option.isWatsonPersonality\":val}}, function(error){\n                    if (error){\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n    updateMicroAppFieldOptionEventIncludeRSVP: function (resourceID,fieldID, value) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n\n                MicroAppFields.update({_id:fieldID},{$set:{\"option.includeRSVP\":value}}, function(error){\n                    if (error){\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n    updateMicroAppFieldOptionEventHideAttendee: function (resourceID,fieldID, value) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n\n                MicroAppFields.update({_id:fieldID},{$set:{\"option.hideRSVPAudience\":value}}, function(error){\n                    if (error){\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n    updateMicroAppFieldOptionEventAuthorRSVP: function (resourceID,fieldID, value) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n\n                MicroAppFields.update({_id:fieldID},{$set:{\"option.allowAuthorRSVP\":value}}, function(error){\n                    if (error){\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n    updateMicroAppFieldCollapseBreakPoint: function (resourceID,fieldID, fieldVal) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n                MicroAppFields.update({_id:fieldID},{$set:{\"collapseBreakPoint\":fieldVal}}, function(error){\n                    if (error){\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n    updateMicroAppFieldOptionDisplayAs: function (resourceID,fieldID, fieldVal) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n                MicroAppFields.update({_id:fieldID},{$set:{\"option.displayAs\":fieldVal}}, function(error){\n                    if (error){\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n    updateMicroAppFieldOptionDisplayResultsBy: function (resourceID,fieldID, fieldVal) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n                MicroAppFields.update({_id:fieldID},{$set:{option:{displayResultsBy:fieldVal}}}, function(error){\n                    if (error){\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n    updateMicroAppFieldWhoCanAdd: function (resourceID,fieldID, fieldVal) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n                MicroAppFields.update({_id:fieldID},{$set:{whoCanAdd:fieldVal}}, function(error){\n                    if (error){\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n    updateMicroAppFieldWhoCanEdit: function (resourceID,fieldID, fieldVal) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n                MicroAppFields.update({_id:fieldID},{$set:{whoCanEdit:fieldVal}}, function(error){\n                    if (error){\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n    updateMicroAppFieldWhoCanDelete: function (resourceID,fieldID, fieldVal) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n                MicroAppFields.update({_id:fieldID},{$set:{whoCanDelete:fieldVal}}, function(error){\n                    if (error){\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n\n    updateMicroAppFieldRank: function (resourceID,fieldID, fieldVal) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n                MicroAppFields.update({_id:fieldID},{$set:{rank:fieldVal}}, function(error){\n                    if (error){\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n    removeMicroAppField: function (resourceID,fieldID) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n                Meteor.call(\"removeFieldsMicroAppData\",resourceID,fieldID, function(err){\n                    if (err){\n                        BuzzyGlobal.throwError(err)\n                    } else {\n                        MicroAppFields.remove({_id:fieldID}, function(error){\n                            if (error){\n                                BuzzyGlobal.throwError(error);\n                            }\n                        });\n                    }\n                });\n\n\n            }\n        }\n    }\n});\n\nif (Meteor.isServer){\n    Meteor.methods({\n        microAppEmailCalendar: function (resourceID, iCalBlob, dateData) {\n            if (Meteor.userId() && resourceID) {\n                var resource = Resources.findOne({_id: resourceID});\n                if (resource && Resources.canView(Meteor.userId(), resource)) {\n                    var email = BuzzyGlobal.gGetUserEmail(Meteor.user());\n                    var result = Mailer.send({\n                        to:  email,           // 'To: ' address. Required.\n                        subject: \"Buzzy Calendar Attachment\",\n                        template: \"iCalEmail\",               // Required.\n                        replyTo: 'donotreply@buzzy.buzz',       // Override global 'ReplyTo: ' option.\n                        from: \"Do Not Reply\" + \"<donotreply@buzzy.buzz>\",         // Override global 'From: ' option.\n                        data:dateData,\n                        attachments: [\n                            {   // binary buffer as an attachment\n                                fileName: 'calendar.ics',\n                                contents: iCalBlob\n                            }]\n                    });\n\n\n                }\n            }\n        },\n        duplicateMicroAppFields: function (existingResourceID, newResourceID, optUserToken) {\n            var user = BuzzyGlobal.getCurrentUser(optUserToken);\n            if (!user){\n                BuzzyGlobal.throwError(\"You do not have the permission to do that!\")\n            }\n            if (user && existingResourceID) {\n                var resource = Resources.findOne({_id: existingResourceID});\n                if (resource && Resources.canView(user._id, resource)) {\n                    var oldVsNewFieldIDs = [];\n                    var oldAndNewFieldIDArray = [];\n                    var allFields = MicroAppFields.find({parentResourceID: existingResourceID});\n                    if (allFields){\n                        allFields.forEach(function(aField){\n                            var newFieldID = new Meteor.Collection.ObjectID()._str;\n                            oldAndNewFieldIDArray.push({oldFieldID: aField._id,newFieldID:newFieldID });\n                            aField.parentResourceID = newResourceID;\n                            aField._id = newFieldID;\n                            MicroAppFields.insert(aField);\n\n\n\n                        });\n                        return oldAndNewFieldIDArray;\n                    }\n\n                }\n            }\n        },\n    })\n}","/**\n * Created by adamginsburg on 30/11/2015.\n */\nMicroAppVotes = new Meteor.Collection('microAppVotes');\n\nMeteor.methods({\n    microAppVote: function(resourceID, appItemID, fieldID, voteValue){\n        var user = Meteor.user();\n        console.log(\"vote:\",user._id, resourceID , appItemID , fieldID , voteValue)\n        if (user && resourceID && appItemID && fieldID && voteValue){\n            var resource = Resources.findOne(resourceID);\n            // ensure the user is logged in\n\n           /* Take that out now - come back to it\n            if (!Resources.canEdit(Meteor.userId(),resource)){\n                BuzzyGlobal.throwError(\"You are not allowed to perform this operation.\")\n            }\n*/\n            var submittedDate;\n            if (Meteor.isClient){\n                submittedDate = TimeSync.serverTime();\n            } else {\n                submittedDate = new Date().getTime();\n            }\n\n            var previousVote = MicroAppVotes.findOne({userID: user._id,voteFieldID: fieldID,parentAppID:appItemID});\n\n            if (previousVote){\n                MicroAppVotes.update(\n                    {_id:previousVote._id},\n                    {$set:{submitted: submittedDate, vote:voteValue,}\n                });\n            } else {\n                MicroAppVotes.insert({\n                    userID: user._id,\n                    author: BuzzyGlobal.gGetUserNameByID(user._id),\n                    submitted: submittedDate,\n                    voteFieldID: fieldID,\n                    vote:voteValue,\n                    parentAppID:appItemID,\n                    parentResourceID:resourceID,\n                    _id: new Meteor.Collection.ObjectID()._str\n                });\n            }\n\n\n        } else {\n            BuzzyGlobal.throwError(\"Sorry, you're not allowed to do that 123!\")\n        }\n    },\n    microAppVoteUser: function(userID, resourceID, appItemID, fieldID, voteValue){\n        console.log(\"microAppVoteUser:\", userID, \"r:\", resourceID, \"a:\", appItemID, \"f:\", fieldID, \"v:\", voteValue);\n\n        var user = Users.findOne({_id:userID});\n        if (user && resourceID && appItemID && fieldID && voteValue){\n            var resource = Resources.findOne(resourceID);\n            // ensure the user is logged in\n\n            /* Take that out now - come back to it\n             if (!Resources.canEdit(Meteor.userId(),resource)){\n             BuzzyGlobal.throwError(\"You are not allowed to perform this operation.\")\n             }\n             */\n            var submittedDate;\n            if (Meteor.isClient){\n                submittedDate = TimeSync.serverTime();\n            } else {\n                submittedDate = new Date().getTime();\n            }\n\n            var previousVote = MicroAppVotes.findOne({userID: user._id,voteFieldID: fieldID,parentAppID:appItemID});\n\n            if (previousVote){\n                MicroAppVotes.update(\n                    {_id:previousVote._id},\n                    {$set:{submitted: submittedDate, vote:voteValue,}\n                    });\n            } else {\n                MicroAppVotes.insert({\n                    userID: user._id,\n                    author: BuzzyGlobal.gGetUserNameByID(user._id),\n                    submitted: submittedDate,\n                    voteFieldID: fieldID,\n                    vote:voteValue,\n                    parentAppID:appItemID,\n                    parentResourceID:resourceID,\n                    _id: new Meteor.Collection.ObjectID()._str\n                });\n            }\n\n\n        } else {\n            BuzzyGlobal.throwError(\"Sorry, you're not allowed to do that!\")\n        }\n    },\n    viewMicroAppVoteToCSV: function(resourceID, appID, voteFieldID){\n        var viewViewerSuperSet = Resources.viewerSuperset(resourceID);\n        var results = viewViewerSuperSet.map(function(userID){\n            var vote = MicroAppVotes.findOne({userID:userID,voteFieldID:voteFieldID});\n            if (vote){\n                return [BuzzyGlobal.gGetUserNameByID(userID),vote.vote, moment(vote.submitted).format()];\n            } else {\n                return [BuzzyGlobal.gGetUserNameByID(userID),\"No response yet\", \"\"];\n            }\n\n        })\n\n        return {\n            fields: [\"Person\", \"Vote\", \"Submitted\"],\n            data: results\n        }\n\n    }\n});","/**\n * Created by adamginsburg on 8/11/2015.\n */\nMicroAppChild = new Meteor.Collection('microAppChild');\n/*\nAppData.allow({\n    //update: Resources.ownsDocument\n    //update: Resources.ownsNotification,\n    insert: Meteor.user\n});\n*/\n\n\n\n\n\nMeteor.methods({\n\n    addMicroAppChild: function (microAppResourceID, topLevelResourceID, appID, fieldID, content) {\n        var user = Meteor.user();\n\n        var resource = Resources.findOne(microAppResourceID);\n        // ensure the user is logged in\n        if (!user) {\n            BuzzyGlobal.throwError(\"You need to be logged complete this operation.\")\n\n        };\n\n\n        var submittedDate;\n        if (Meteor.isClient){\n            submittedDate = TimeSync.serverTime();\n        } else {\n            submittedDate = new Date().getTime();\n        }\n        var author = BuzzyGlobal.gGetUserNameByID(user._id);\n        var parentField = MicroAppFields.findOne({_id:fieldID});\n        var microAppItem = MicroAppData.findOne({_id:appID});\n\n\n        if (parentField && microAppItem && Resources.canEditMicroAppField(user._id,resource,parentField.whoCanEdit,resource.whoCanView,microAppItem.userID)){\n            var childDataToInsert =  {\n                userID: user._id,\n                author: author,\n                submitted: submittedDate,\n                content:content,\n                parentResourceID:microAppResourceID,\n                parentAppItemID:appID,\n                parentAppFieldID:fieldID,\n                type: parentField.fieldType,\n                _id: new Meteor.Collection.ObjectID()._str\n            };\n            MicroAppChild.insert(childDataToInsert, function(error){\n                if (!error){\n                    Meteor.call(\"updateUpdatedDate\", topLevelResourceID);\n\n                }\n            });\n            return childDataToInsert._id;\n        }\n\n\n    },\n    removeMicroAppChild: function(childID){\n        var user = Meteor.user();\n\n        if (!user) {\n            BuzzyGlobal.throwError(\"You need to be logged complete this operation.\")\n\n        };\n        var microAppChildItem = MicroAppChild.findOne({_id:childID});\n        if (!microAppChildItem) {\n            BuzzyGlobal.throwError(\"Item does not exist!\")\n        };\n        var resource = Resources.findOne({_id:microAppChildItem.parentResourceID});\n\n\n        var parentField = MicroAppFields.findOne({_id:microAppChildItem.parentAppFieldID});\n        var microAppItem = MicroAppData.findOne({_id:microAppChildItem.parentAppItemID});\n\n\n        if (parentField && microAppItem && Resources.canEditMicroAppField(user._id,resource,parentField.whoCanEdit,resource.whoCanView,microAppItem.userID)) {\n            MicroAppChild.remove(\n                {\"_id\": childID},\n                function (error) {\n                    if (error) {\n                        BuzzyGlobal.throwError(error);\n                    }\n                }\n            );\n        }\n\n    },\n\n\n\n});\n","/**\n * Created by adamginsburg on 14/11/2015.\n */\nMicroAppActionRules = new Meteor.Collection('microAppActionRules');\nMicroAppActionRules.getHighestRank = function(resourceID){\n    if (Meteor.userId() && resourceID){\n        var lastRankedItem = MicroAppActionRules.findOne({parentResourceID:resourceID},{sort:{rank:-1}});\n        if (!lastRankedItem || isNaN(lastRankedItem.rank)){\n            return 0;\n        } else {\n            return lastRankedItem.rank\n        }\n\n    }\n};\nMeteor.methods({\n    insertMicroAppActionRule: function (resourceID, actionRule) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n                var rank = MicroAppActionRules.getHighestRank(resourceID) + 1;\n                actionRule._id= new Meteor.Collection.ObjectID()._str;\n                actionRule.parentResourceID = resourceID;\n\n                MicroAppActionRules.insert(actionRule, function(error){\n                    if (error){\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n\n\n            }\n        }\n    },\n\n\n\n    updateMicroAppActionCondition: function (resourceID,actionID, val) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n                MicroAppActionRules.update({_id:actionID},{$set:{\"condition\":val}}, function(error){\n                    if (error){\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n    \n    \n\n    updateMicroAppActionRuleRank: function (resourceID,actionID, fieldVal) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n                MicroAppActionRules.update({_id:actionID},{$set:{rank:fieldVal}}, function(error){\n                    if (error){\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n    removeMicroAppActionRule: function (resourceID,actionID) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n                MicroAppActionRules.remove({_id:actionID}, function(error){\n                    if (error){\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    }\n});\n\n","/**\n * Created by adamginsburg on 13/10/2015.\n */\ngCleanString = function(s){\n    if (s){\n        var cleanString = s.replace(/[|&;$%@\"<>()+,]/g, \"\");\n        if (cleanString.length == 0){\n            return Random.id();\n        } else {\n            return cleanString;\n        }\n    } else {\n        return Random.id();\n    }\n\n\n};","/**\n * Created by adamginsburg on 13/07/2016.\n */\nTeams = new Meteor.Collection('teams');\n\n\nTeams.isAdmin = function(userID, teamID) {\n    if (typeof userID !== undefined && typeof teamID !== \"undefined\"){\n        return TeamMembers.findOne({teamID:teamID, userID:userID, role:BuzzyGlobal.gMEMBER_TYPE.ADMIN});\n    } else {\n        return false;\n    }\n\n}","/**\n * Created by adamginsburg on 13/07/2016.\n */\nTeamMembers = new Meteor.Collection('teamMembers');","Comments = new Meteor.Collection('comments');\nComments.allow({\n    //update: Resources.ownsDocument\n    //update: Resources.ownsNotification,\n    insert: Meteor.user\n});\n\n\nComments.hasViewed = function(userID, commentID){\n    var viewedComment = CommentsViewed.findOne({$and:[{userID:userID},{commentID: commentID}]})\n    if (viewedComment){\n        return viewedComment\n    } else {\n        return false\n    }\n\n};\n\nif (Meteor.isServer){\n    Meteor.methods({\n        hasMoreComments: function(resourceID, submitted){\n            var userSearchCommentsExpression = new RegExp(Meteor.userId());\n            if (Meteor.userId() && resourceID && submitted){\n                var lastComments =\n                    Comments.find(\n                        {$and:[\n                            {$or: [\n\n                                {\n                                    $and: [\n                                        {resourceParentID: resourceID},\n                                        {toUsers: null},\n                                        {$or:[\n                                            {status:BuzzyGlobal.gCOMMENTSTATUS.LIVE},\n                                            {status:BuzzyGlobal.gCOMMENTSTATUS.DELETED}\n                                        ]}\n                                    ]\n                                },\n\n                                {\n                                    $and: [{resourceParentID: resourceID},{toUsers: null},\n                                        {status:BuzzyGlobal.gCOMMENTSTATUS.WAITING_APPROVAL},\n                                        {userID:Meteor.userId()}\n                                    ]\n                                },\n                                {\n                                    $and: [{resourceParentID: resourceID},{toUsers: userSearchCommentsExpression}]\n                                }\n                            ]},\n                            {submitted:{$gte:submitted}}]},\n                {sort:{submitted:1},limit:2});\n                return lastComments.count() > 1;\n            }\n        },\n        /*commentCountLive: function(resourceID){\n            var userSearchCommentsExpression = new RegExp(Meteor.userId());\n            if (Meteor.userId() && resourceID){\n                var lastComments =\n                    Comments.find(\n                        {$and:[\n                            {$or: [\n\n                                {\n                                    $and: [\n                                        {resourceParentID: resourceID},\n                                        {toUsers: null},\n                                        {$or:[\n                                            {status:BuzzyGlobal.gCOMMENTSTATUS.LIVE},\n                                            {$and:[\n                                                {status:BuzzyGlobal.gCOMMENTSTATUS.WAITING_APPROVAL},\n                                                {userID: Meteor.userId()}\n                                            ]}\n\n                                        ]}\n                                    ]\n                                },\n                                {\n                                    $and: [\n                                        {resourceParentID: resourceID},\n                                        {toUsers: userSearchCommentsExpression},\n                                        {$or:[\n                                            {status:BuzzyGlobal.gCOMMENTSTATUS.LIVE},\n                                            {status:BuzzyGlobal.gCOMMENTSTATUS.WAITING_APPROVAL}\n                                        ]}\n                                    ]\n                                }\n                            ]}\n\n\n                        ]});\n                return lastComments.count();\n            }\n        },*/\n        hasPreviousComments: function(resourceID, submitted){\n            var userSearchCommentsExpression = new RegExp(Meteor.userId());\n            if (Meteor.userId() && resourceID && submitted){\n                var previousComments =\n                    Comments.find(\n                        {$and:[\n                            {$or: [\n\n                                {\n                                    $and: [{resourceParentID: resourceID},{toUsers: null}]\n                                },\n                                {\n                                    $and: [{resourceParentID: resourceID},{toUsers: userSearchCommentsExpression}]\n                                }\n                            ]},\n                            {submitted:{$lte:submitted}}]},\n                {sort:{submitted:1},limit:2});\n                return previousComments.count() > 1;\n            }\n        },\n        /*commentCountLive: function(resourceID){\n            var userSearchCommentsExpression = new RegExp(Meteor.userId());\n            if (Meteor.userId() && resourceID){\n                var lastComments =\n                    Comments.find(\n                        {$and:[\n                            {$or: [\n\n                                {\n                                    $and: [\n                                        {resourceParentID: resourceID},\n                                        {toUsers: null},\n                                        {$or:[\n                                            {status:BuzzyGlobal.gCOMMENTSTATUS.LIVE},\n                                            {$and:[\n                                                {status:BuzzyGlobal.gCOMMENTSTATUS.WAITING_APPROVAL},\n                                                {userID: Meteor.userId()}\n                                            ]}\n\n                                        ]}\n                                    ]\n                                },\n                                {\n                                    $and: [\n                                        {resourceParentID: resourceID},\n                                        {toUsers: userSearchCommentsExpression},\n                                        {$or:[\n                                            {status:BuzzyGlobal.gCOMMENTSTATUS.LIVE},\n                                            {status:BuzzyGlobal.gCOMMENTSTATUS.WAITING_APPROVAL}\n                                        ]}\n                                    ]\n                                }\n                            ]}\n\n\n                        ]});\n                return lastComments.count();\n            }\n        },*/\n        totalComments: function(resourceID){\n            if (!resourceID){\n                BuzzyGlobal.throwError(\"Invalid resource ID\")\n            }\n            var resource = Resources.findOne({_id:resourceID});\n            if (Meteor.userId() && resource){\n\n                return Comments.find({\n                            $and: [\n                                {resourceParentID: resourceID},\n                                {$or:[\n                                    {status:BuzzyGlobal.gCOMMENTSTATUS.LIVE},\n                                    {status:BuzzyGlobal.gCOMMENTSTATUS.WAITING_APPROVAL}\n                                ]}\n                            ]\n                        }).count();\n\n            }\n        },\n        viewCommentsToCSV: function(resourceID, commentID){\n            var viewViewerSuperSet = Resources.viewerSuperset(resourceID);\n            var results = viewViewerSuperSet.map(function(userID){\n                var hasViewed = Comments.hasViewed(userID,commentID);\n                var hasViewedResult = hasViewed?(moment(hasViewed.submitted).format()):\"not viewed\";\n\n                return [BuzzyGlobal.gGetUserNameByID(userID),hasViewedResult];\n            })\n\n            return {\n                fields: [\"Person\", \"Viewed?\"],\n                data: results\n            }\n\n        }\n\n\n    })\n}\n\n\n","CommentsViewed = new Meteor.Collection('commentsViewed');\nCommentsViewed.allow({\n    //update: Resources.ownsDocument\n    //update: Resources.ownsNotification,\n    insert: Meteor.user\n});\n\nMeteor.methods({\n    viewedComment: function (userID, resourceID, commentID) {\n        check(resourceID, String);\n        check(commentID, String);\n        check(userID, String);\n        // NEED TO ADD - should probably check that userID can viewResourceID\n        if (userID){\n            var alreadyViewed = CommentsViewed.findOne(\n                {$and:[\n                    {userID: userID},\n                    {resourceID: resourceID},\n                    {commentID: commentID}\n                ]});\n            if (!alreadyViewed){\n                var submittedDate;\n                if (Meteor.isClient){\n                    submittedDate = TimeSync.serverTime();\n                } else {\n                    submittedDate = new Date().getTime();\n                }\n                CommentsViewed.insert({\n                    _id:new Meteor.Collection.ObjectID()._str,\n                    userID: userID,\n                    resourceID: resourceID,\n                    commentID: commentID,\n                    submitted: submittedDate\n\n                });\n            }\n\n        }\n    },\n    viewedCommentsSummary: function(){\n        var pipeline = [\n            { $match:{parentResourceID:  resourceID}},\n            { $project: { author:1, content:1, parentResourceID:1, submitted:1, userID:1, _id: 1 } },\n            { $sort: { submitted : -1 } },\n            { $limit: 10 }\n            //{$group: {_id: null, resTime: {$sum: \"$resTime\"}}}\n        ];\n        var results = MicroAppData.aggregate(pipeline);\n    }\n\n});\n\n\n","    /**\n * Created by adamginsburg on 19/06/2014.\n */\nNotifications = new Meteor.Collection('notifications');\n\nNotifications.allow({\n    //update: Resources.ownsDocument\n    update: Resources.ownsNotification,\n    insert: Meteor.user\n});\n\nMeteor.methods({\n    markNotificationReadForComment: function (commentID) {\n        if (Meteor.userId()){\n            Notifications.update(\n                {$and:[\n                    {commentID:commentID},\n                    {forUserID:Meteor.userId()},\n                    {read:false}\n                ]},\n                {$set: {read: true}},\n                {multi:true}\n            );\n        }\n\n    }\n\n\n});\n\n\n\n\n\n\n\n","/**\n * Created by adamginsburg on 22/05/2014.\n */\nResourceFollowers = new Meteor.Collection('resourceFollowers');\n\n\nResourceFollowers.allow({\n    update: Resources.ownsDocument,\n    remove: Resources.ownsDocument,\n    insert: Meteor.user\n});\n\nResourceFollowers.updateResourceFollowersCount = function(resourceID){\n\n    var numFollowers = ResourceFollowers.find({resourceID:resourceID}).count();\n    Resources.updateResourceField(resourceID,'followerCount',numFollowers);\n\n    return;\n};\n\n\n\n","/**\n * Created by adamginsburg on 27/06/2014.\n */\nUsers = Meteor.users;\nUsers.deny({update: function () { return true; }});\nUsers.addToHistory = function(resourceID){\n    if (Meteor.userId()){\n        var user = Users.findOne({_id:Meteor.userId()});\n        if (typeof user.profile.buzzHistory !== \"undefined\"){\n            if (user.profile.buzzHistory.indexOf(resourceID) === -1){\n                user.profile.buzzHistory.unshift(resourceID);\n                if ( user.profile.buzzHistory.length > BuzzyGlobal.gMAX_HISTORY){\n                    user.profile.buzzHistory.splice(user.profile.buzzHistory.length - 1,1);\n                }\n                Users.update({_id:Meteor.userId()},{$set:{\"profile.buzzHistory\":user.profile.buzzHistory}});\n            } else {\n                user.profile.buzzHistory = _.without(user.profile.buzzHistory, resourceID);\n                user.profile.buzzHistory.unshift(resourceID);\n                Users.update({_id:Meteor.userId()},{$set:{\"profile.buzzHistory\":user.profile.buzzHistory}});\n\n            }\n        } else {\n            Users.update({_id:Meteor.userId()},{$set:{\"profile.buzzHistory\":[resourceID]}});\n        }\n    } else {\n        BuzzyGlobal.throwError(\"User must be logged in to update history.\")\n    }\n};\n\nUsers.addFavorite = function(resourceID){\n    if (Meteor.userId()){\n        var user = Users.findOne({_id:Meteor.userId()});\n        if (typeof user.profile.favoriteBuzz !== \"undefined\"){\n            if (user.profile.favoriteBuzz.indexOf(resourceID) === -1){\n                user.profile.favoriteBuzz.unshift(resourceID);\n                Users.update({_id:Meteor.userId()},{$set:{\"profile.favoriteBuzz\":user.profile.favoriteBuzz}});\n            }\n        } else {\n            Users.update({_id:Meteor.userId()},{$set:{\"profile.favoriteBuzz\":[resourceID]}});\n        }\n    } else {\n        BuzzyGlobal.throwError(\"User must be logged in to update history.\")\n    }\n};\n\nUsers.removeFavorite = function(resourceID){\n    if (Meteor.userId()){\n        var user = Users.findOne({_id:Meteor.userId()});\n        if (typeof user.profile.favoriteBuzz !== \"undefined\") {\n            if (user.profile.favoriteBuzz.indexOf(resourceID) !== -1) {\n                Users.update({_id: Meteor.userId()}, {$pull: {\"profile.favoriteBuzz\": resourceID}});\n            }\n        }\n    } else {\n        BuzzyGlobal.throwError(\"User must be logged in to update favorites.\")\n    }\n};\n\nUsers.isFavorited = function(resourceID){\n    if (Meteor.userId()){\n        var user = Users.findOne({_id:Meteor.userId()});\n        if (typeof user.profile.favoriteBuzz !== \"undefined\"){\n            return user.profile.favoriteBuzz.indexOf(resourceID) !== -1;\n        } else {\n            return null;\n        }\n    }\n};\nUsers.clearHistory = function(){\n    if (Meteor.userId()){\n        Users.update({_id:Meteor.userId()},{$set:{\"profile.buzzHistory\":[]}});\n    }\n};\n\nUsers.isBot = function(user){\n    console.log(\"IS BOT\", user);\n   if (user && user.watsonCreds && user.watsonCreds !== null && user.watsonCreds.length > 0){\n       return true;\n   } else {\n       return false;\n   }\n};\n\n\n\n","// Write your package code here!\n\n\nif (Meteor.isClient) {\n    FollowedResources = new Meteor.Collection('followedResources');\n}\n\nResources.viewerSuperset = function (resourceID) {\n    var resource = Resources.findOne(resourceID);\n    if (resource) {\n        var particpants = resource.readers.concat(resource.editors, resource.owners);\n        var followers = ResourceFollowers.find({resourceID: resource._id}).map(function (rf) {\n            return rf.userID;\n        })\n        return _.union(particpants, followers);\n    } else {\n        return [];\n    }\n\n};\n\nResources.ownsDocument = function (userID, doc) {\n    if (doc && typeof userID !== undefined && typeof doc !== \"undefined\") {\n\n        return _.indexOf(doc.owners, userID) !== -1;\n    } else {\n        return false;\n    }\n}\n\nResources.ownsNotification = function (userID, doc) {\n    if (doc && typeof userID !== undefined && typeof doc !== \"undefined\") {\n        return doc && doc.forUserID === userID;\n    } else {\n        return false;\n    }\n\n}\n\nResources.isAudienceAuthorOwner = function (userID, doc) {\n    if (doc && typeof userID !== undefined && typeof doc !== \"undefined\") {\n        return (doc.privacy === BuzzyGlobal.gPRIVACY.PUBLIC && doc.status === BuzzyGlobal.gRESOURCE_STATUS.PUBLISHED)\n            || (doc.privacy === BuzzyGlobal.gPRIVACY.UNLISTED && doc.status === BuzzyGlobal.gRESOURCE_STATUS.PUBLISHED)\n            || (_.indexOf(doc.readers, userID) != \"-1\" && doc.status === BuzzyGlobal.gRESOURCE_STATUS.PUBLISHED)\n            || (_.indexOf(doc.editors, userID) != \"-1\") || (_.indexOf(doc.owners, userID) != \"-1\");\n\n    } else {\n        return false;\n    }\n\n}\n\nResources.isAuthorOwner = function (userID, doc) {\n\n    if (doc && typeof userID !== undefined && typeof doc !== \"undefined\") {\n        return (typeof doc.editors !== \"undefined\" && _.indexOf(doc.editors, userID) !== -1) || (typeof doc.editors !== \"undefined\" && _.indexOf(doc.owners, userID) !== -1);\n    } else {\n        return false;\n    }\n\n}\n\nResources.canView = function (userID, doc) {\n    if (Meteor.settings.public.BUZZY_DEBUG_CLIENT) {\n        var perfStartTime = new Date().getTime();\n        console.log(\"PERF Resources.canView START\", perfStartTime);\n    }\n\n\n    if (doc && typeof userID === undefined && typeof doc !== \"undefined\") {\n        var result1 = (doc.privacy === BuzzyGlobal.gPRIVACY.PUBLIC && doc.status === BuzzyGlobal.gRESOURCE_STATUS.PUBLISHED) || (doc.privacy === BuzzyGlobal.gPRIVACY.UNLISTED && doc.status === BuzzyGlobal.gRESOURCE_STATUS.PUBLISHED);\n        if (Meteor.settings.public.BUZZY_DEBUG_CLIENT) {\n            var perfEndTime = new Date().getTime();\n            console.log(\"PERF resultCanView after result2  DUR\", perfEndTime - perfStartTime);\n        }\n\n        return result1;\n\n    } else if (doc && typeof userID !== undefined && typeof doc !== \"undefined\") {\n\n        var result2 = (doc.privacy === BuzzyGlobal.gPRIVACY.PUBLIC && doc.status === BuzzyGlobal.gRESOURCE_STATUS.PUBLISHED) || (doc.privacy === BuzzyGlobal.gPRIVACY.UNLISTED && doc.status === BuzzyGlobal.gRESOURCE_STATUS.PUBLISHED) || (_.indexOf(doc.readers, userID) != \"-1\" && doc.status === BuzzyGlobal.gRESOURCE_STATUS.PUBLISHED) || (_.indexOf(doc.editors, userID) != \"-1\") || (_.indexOf(doc.owners, userID) != \"-1\");\n        if (Meteor.settings.public.BUZZY_DEBUG_CLIENT) {\n            var perfEndTime = new Date().getTime();\n            console.log(\"PERF resultCanView after result2 DUR\", perfEndTime - perfStartTime);\n        }\n        return result2;\n    } else {\n        return false;\n    }\n\n}\n\nResources.canEdit = function (userID, doc) {\n    if (doc && typeof userID !== undefined && typeof doc !== \"undefined\") {\n        return (typeof doc.editors !== \"undefined\" && _.indexOf(doc.editors, userID) !== -1) || (typeof doc.editors !== \"undefined\" && _.indexOf(doc.owners, userID) !== -1);\n    } else {\n        return false;\n    }\n\n}\n\nResources.canAddRow = function (doc) {\n\n    if (Meteor.userId()) {\n        if (doc.content.whoCanAdd === BuzzyGlobal.gAPPFIELD_INTERACT.OWNERS_AND_AUTHORS && Resources.isAuthorOwner(Meteor.userId(), doc)) {\n            return true;\n        } else if (doc.content.whoCanAdd === BuzzyGlobal.gAPPFIELD_INTERACT.AUDIENCE_OWNERS_AND_AUTHORS && Resources.isAudienceAuthorOwner(Meteor.userId(), doc)) {\n            return true\n        } else {\n            return false;\n        }\n    } else {\n        return false;\n    }\n\n};\n\nResources.canEditMicroAppField = function (userID, doc, whoCanEdit, whoCanView, rowCreator) {\n    if (userID && doc) {\n\n        if (Resources.isAuthorOwner(userID, doc)) {\n\n            return true // deal with legacy content where items are nulluntil data is cleaned up\n        } else if (doc.content.whoCanView === BuzzyGlobal.gMICROAPP_PERMISSION_WHOCANVIEW.OWNER_AUTHOR_CREATOR) {\n            if ((whoCanEdit === BuzzyGlobal.gAPPFIELD_INTERACT.ANYONE)\n                || ((userID === rowCreator) && ((whoCanEdit === BuzzyGlobal.gAPPFIELD_INTERACT.AUDIENCE_OWNERS_AND_AUTHORS) && Resources.isAudienceAuthorOwner(userID, doc) ))\n                || ( Resources.isAuthorOwner(userID, doc))\n                || ((whoCanEdit === BuzzyGlobal.gAPPFIELD_INTERACT.OWNERSAUTHOR_AND_CREATORS) && (userID === rowCreator))\n            ) {\n\n                return true;\n            } else {\n\n                return false;\n            }\n\n        } else {\n            if (whoCanEdit === BuzzyGlobal.gAPPFIELD_INTERACT.ANYONE) {\n\n                return true;\n            } else if (whoCanEdit === BuzzyGlobal.gAPPFIELD_INTERACT.AUDIENCE_OWNERS_AND_AUTHORS && Resources.isAudienceAuthorOwner(userID, doc)) {\n\n                return true\n            } else if ((whoCanEdit === BuzzyGlobal.gAPPFIELD_INTERACT.OWNERSAUTHOR_AND_CREATORS) && (userID === rowCreator) && Resources.isAudienceAuthorOwner(userID, doc)) {\n\n                return true\n            } else if (whoCanEdit === BuzzyGlobal.gAPPFIELD_INTERACT.OWNERS_AND_AUTHORS && Resources.isAuthorOwner(userID, doc)) {\n\n                return true\n            } else {\n                return false;\n            }\n        }\n\n    } else {\n        return false;\n    }\n\n}\n\nResources.canChangeAudienceAndAuthors = function (userID, doc) {\n    if (typeof userID !== undefined && typeof doc !== \"undefined\") {\n        return (_.indexOf(doc.editors, userID) !== -1) || (_.indexOf(doc.owners, userID) !== -1);\n    } else {\n        return false;\n    }\n\n\n}\n\nResources.canChangeOwners = function (userID, doc) {\n    if (typeof userID !== undefined && typeof doc !== \"undefined\") {\n        return _.indexOf(doc.owners, userID) !== -1;\n    } else {\n        return false;\n    }\n}\n\n\nResources.canViewFile = function (userID, doc) {\n    return true; // dilemma - required for email (non auth access) until work out how to generate token????\n    /*console.log(\"Resources.canView:\" + userID + \" parent:\" +  doc.parentResourceID);\n     var parentResource = Resources.findOne({_id: doc.parentResourceID});\n     if (parentResource){\n\n     return (parentResource && parentResource.userID === userID) || (parentResource.privacy === BuzzyGlobal.gPRIVACY.PUBLIC) || (parentResource.privacy === BuzzyGlobal.gPRIVACY.PUBLIC)|| (_.indexOf( parentResource.editors, userID ) != \"-1\") || (_.indexOf( parentResource.owners, userID ) != \"-1\")|| (_.indexOf( parentResource.readers, userID ) != \"-1\");\n\n     } else {\n     return false;\n     }*/\n\n};\n\nResources.updateResourceField = function (currentResourceID, fieldName, fieldValue) {\n    var obj = {};\n    obj[fieldName] = fieldValue;\n    obj['updated'] = new Date().getTime();\n\n    var updatedResourceID = Resources.update({_id: currentResourceID}, {$set: obj}, function (error) {\n        if (error) {\n            // display the error to the user - Need to come back to fix 422 (not sure what # it should be???) as the error number\n            throw new Meteor.Error(422, error.reason);\n        } else {\n\n            return updatedResourceID;\n            //Router.go('resourceList');\n        }\n    });\n\n};\n\nResources.resourceIsFollowed = function (userID, resourceID) {\n    return ResourceFollowers.find({$and: [{resourceID: resourceID}, {userID: userID}]}).count();\n};\n\nResources.gNewPath = function (currPath, resourceID) {\n    if (currPath === null) {\n        return \",\" + resourceID + \",\";\n\n    } else {\n        return currPath + resourceID + \",\";\n    }\n};\n\nResources.gGetParentFromPath = function (path) {\n    if (path) {\n        //must be a better way to do with regex, anyway...\n        path = path.substring(0, path.length - 1); //chop last comma\n        var pathArray = path.split(',')\n        return pathArray[pathArray.length - 1];\n\n\n    } else {\n        BuzzyGlobal.throwError(\"Invalid Path\");\n    }\n}\n\nResources.gGetTopParentFromPath = function (path) {\n    if (path) {\n        //must be a better way to do with regex, anyway...\n        path = path.substring(0, path.length - 1); //chop last comma\n        var pathArray = path.split(',')\n        return pathArray[1];\n\n\n    } else {\n        BuzzyGlobal.throwError(\"Invalid Path\");\n    }\n}\n\nResources.createDirectChildrenServer = function (srcResourceID, readers, editors, owners, targetPath, rank, parentStatus, optResource, callback) {\n    Meteor.call(\"createDirectChildrenServerMethod\", srcResourceID, readers, editors, owners, targetPath, rank, parentStatus, optResource, function (err, id) {\n        if (err) {\n            BuzzyGlobal.throwError(err)\n        } else {\n            callback(id);\n        }\n    })\n}\n\nResources.createDirectChildren = function (srcResourceID, readers, editors, owners, targetPath, rank, parentStatus, optResource, optUserToken, callback) {\n    var user = BuzzyGlobal.getCurrentUser(optUserToken)\n    if (!user) {\n        BuzzyGlobal.throwError(\"Invalid User Credentials\");\n    }\n    // TBD need to check if path is set that user Can Edit:   if (!Resources.canEdit(user._id,))\n    optResource = (typeof optResource === \"undefined\") ? false : optResource;\n    var srcResource = Resources.findOne(srcResourceID);\n    if (srcResource) {\n        var tempTitle = srcResource.title;\n        if (srcResource.type === BuzzyGlobal.gBASICTYPES.BUZZ) {\n            tempTitle = \"\"\n        }\n        ; //Make title blank\n\n        if (optResource) {\n            newResource = optResource;\n\n            //console.log(\"about to create opt: \", newResource._id, \" path:\", newResource.path, \" owners: \", owners );\n\n            Meteor.call('createWithID', newResource, optUserToken, function (error, id) {\n                if (error) {\n                    // display the error to the user\n                    BuzzyGlobal.throwError(error.reason);\n                } else {\n\n                    if (typeof callback !== \"undefined\") {\n                        return callback(false);\n                    }\n                }\n            });\n\n            // now look for children\n            //console.log(\"ABOUT TO LOOK FOR CHILDRED for \" + srcResourceID);\n            var searchExpression = new RegExp(',' + srcResourceID + ',$');\n            //       console.log('search string:' + searchExpression);\n            //       console.log('target path:' + targetPath);\n            directChildrenCursor = Resources.find(\n                {\n                    $and: [\n                        {path: {$regex: searchExpression}},\n                        {\n                            $or: [\n                                {status: BuzzyGlobal.gRESOURCE_STATUS.DRAFT},\n                                {status: BuzzyGlobal.gRESOURCE_STATUS.PUBLISHED}\n                            ]\n                        }\n                    ]\n                });\n            //console.log('direct children:' + directChildrenCursor.count());\n            if (directChildrenCursor) {\n\n                directChildrenCursor.forEach(function (childResource) {\n\n                    var path;\n                    if (targetPath === null) {\n                        path = \",\" + newResource._id + \",\";\n                    } else {\n                        path = targetPath + newResource._id + \",\";\n                    }\n\n                    Resources.createDirectChildren(childResource._id, readers, editors, owners, path, childResource.rank, parentStatus, null, optUserToken);\n\n                });\n\n            } else {\n\n                return 0;\n            }\n\n        } else {\n\n\n            var newFileResourceID = new Meteor.Collection.ObjectID()._str;\n            var newResource = _.extend(_.pick(srcResource, 'description', 'content', 'coverImage', 'CSSclass', 'resourceURI', 'orginalResourceID', 'type', 'showComments', 'tourStepID', 'tourCode', 'hasTour'), {\n                title: tempTitle,\n                readers: readers,\n                editors: editors,\n                owners: owners,\n                mediaFile: {},\n                reusable: \"no\",\n                privacy: \"private\",\n                status: parentStatus,\n                isStarterTemplate: false,\n                userID: user._id,\n                author: user.username,\n                submitted: new Date().getTime(),\n                updated: new Date().getTime(),\n                path: targetPath,\n                _id: newFileResourceID,\n                rank: rank\n            });\n\n\n            if (srcResource.type === BuzzyGlobal.gBASICTYPES.IMAGE) {\n                if (targetPath !== null) {\n                    var pathArray = targetPath.split(\",\", 2);\n                    if (pathArray.length > 1) {\n                        var topParentID = pathArray[1];\n                    }\n                }\n                Meteor.call('createWithID', newResource, optUserToken, function (error, id) {\n                    if (error) {\n                        // display the error to the user\n                        BuzzyGlobal.throwError(error.reason);\n                    } else {\n                        if (typeof callback !== \"undefined\") {\n                            return callback(false);\n                        }\n                    }\n                });\n\n                //this did have the above in the callback below - taken out to try and get to happen in parallel\n                /*\n                 Meteor.call(\"collectionFSImageCopy\", srcResource.content.imageID, topParentID, function(error, fileID){\n                 if (!error){\n\n                 Resources.updateResourceField(newResource._id,\"content.imageID\",fileID);\n\n\n\n                 }\n\n                 });*/\n            } else if (srcResource.type === BuzzyGlobal.gBASICTYPES.ATTACHMENT) {\n\n\n                if (targetPath !== null) {\n                    var pathArray = targetPath.split(\",\", 2);\n                    if (pathArray.length > 1) {\n                        var topParentID = pathArray[1];\n                    }\n                }\n\n            } else if (srcResource.type === BuzzyGlobal.gBASICTYPES.APPLICATION) {\n\n\n                if (targetPath !== null) {\n                    var pathArray = targetPath.split(\",\", 2);\n                    if (pathArray.length > 1) {\n                        var topParentID = pathArray[1];\n                    }\n                }\n\n\n                Meteor.call(\"duplicateMicroAppFields\", srcResource._id, newResource._id, optUserToken, function (err, oldAndNewFieldIDArray) {\n                    if (err) {\n                        BuzzyGlobal.throwError(err);\n                    } else {\n                        Meteor.call(\"resourceCopyMicroApp\", srcResource._id, newResource._id, topParentID, oldAndNewFieldIDArray, optUserToken, function (error) {\n                            if (!error) {\n                                Meteor.call('createWithID', newResource, optUserToken, function (error, id) {\n                                    if (error) {\n                                        // display the error to the user\n                                        BuzzyGlobal.throwError(error.reason);\n                                    } else {\n                                        if (oldAndNewFieldIDArray) {\n\n\n                                            if (srcResource.content && srcResource.content.sortField) {\n\n                                                var newSortField = oldAndNewFieldIDArray.find(function (item) {\n                                                    return item.oldFieldID === srcResource.content.sortField;\n                                                });\n\n                                                if (newSortField && typeof newSortField.newFieldID !== \"undefined\") {\n                                                    Meteor.call(\"updateResourceSortField\", newResource._id, 1, newSortField.newFieldID, optUserToken);\n\n                                                }\n\n\n                                            }\n                                            if (srcResource.content && srcResource.content.sortField2) {\n\n                                                var newSortField2 = oldAndNewFieldIDArray.find(function (item) {\n                                                    return item.oldFieldID === srcResource.content.sortField2;\n                                                })\n\n                                                if (newSortField2 && typeof newSortField2.newFieldID !== \"undefined\") {\n                                                    Meteor.call(\"updateResourceSortField\", newResource._id, 2, newSortField2.newFieldID, optUserToken);\n                                                }\n\n                                            }\n                                            if (srcResource.content && srcResource.content.sortField3) {\n\n                                                var newSortField3 = oldAndNewFieldIDArray.find(function (item) {\n                                                    return item.oldFieldID === srcResource.content.sortField3;\n                                                });\n\n                                                if (newSortField3 && typeof newSortField3.newFieldID !== \"undefined\") {\n                                                    Meteor.call(\"updateResourceSortField\", newResource._id, 3, newSortField3.newFieldID, optUserToken);\n                                                }\n\n                                            }\n                                        }\n                                        if (typeof callback !== \"undefined\") {\n                                            return callback(false);\n                                        }\n                                    }\n                                });\n\n\n                            }\n\n                        });\n                    }\n\n                })\n\n\n            } else {\n                Meteor.call('createWithID', newResource, optUserToken, function (error, id) {\n                    if (error) {\n                        // display the error to the user\n                        BuzzyGlobal.throwError(error.reason);\n                    } else {\n                        if (typeof callback !== \"undefined\") {\n                            return callback(false);\n                        }\n                    }\n                });\n\n\n            }\n\n            // now look for children\n            var searchExpression = new RegExp(',' + srcResourceID + ',$');\n            //       console.log('search string:' + searchExpression);\n            //       console.log('target path:' + targetPath);\n            directChildrenCursor = Resources.find(\n                {\n                    $and: [\n                        {path: {$regex: searchExpression}},\n                        {\n                            $or: [\n                                {status: BuzzyGlobal.gRESOURCE_STATUS.DRAFT},\n                                {status: BuzzyGlobal.gRESOURCE_STATUS.PUBLISHED}\n                            ]\n                        }\n                    ]\n                });\n            //console.log('direct children:' + directChildrenCursor.count());\n            if (directChildrenCursor) {\n                directChildrenCursor.forEach(function (childResource) {\n\n                    var path;\n                    if (targetPath === null) {\n                        path = \",\" + newResource._id + \",\";\n                    } else {\n                        path = targetPath + newResource._id + \",\";\n                    }\n                    Resources.createDirectChildren(childResource._id, readers, editors, owners, path, childResource.rank, parentStatus, null, optUserToken);\n\n                });\n\n            } else {\n                return 0;\n            }\n\n\n        }\n\n\n    }\n\n\n};\n\n\nResources.allow({\n    update: Resources.canEdit,\n    remove: Resources.ownsDocument,\n    insert: BuzzyGlobal.isLoggedIn\n});\nResources.deny({\n    update: function (userId, resource, fieldNames) {\n        // may only edit the following  fields:\n        return (_.without(fieldNames,\n            'avatar', 'description', 'title', 'content', 'CSSclass', 'resourceURI', 'reusable', 'privacy',\n            'readers', 'editors', 'mediaFile', 'mimeType', 'queryTags', 'rank', 'path', 'updated',\n            'isStarterTemplate', 'hasTour', 'tourCode', 'tourStepID', 'bHideTitle', 'bHideDescription', 'bHaveChildren', 'bHideAuthors',\n            'bHideAudience', 'displayField', 'showComments', 'status', 'commentsApprovalRequired', 'coverImage', 'content.galleryURL'\n        ).length > 0);\n    }\n});\n\n\nMeteor.methods({\n\n    updateResourceWhoCanAdd: function (resourceID, fieldID, fieldVal) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n                Resources.update({_id: resourceID}, {$set: {\"content.whoCanAdd\": fieldVal}}, function (error) {\n                    if (error) {\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n    updateResourceDefaultTimezone: function (resourceID, fieldID, fieldVal) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n                Resources.update({_id: resourceID}, {$set: {\"content.timezone\": fieldVal}}, function (error) {\n                    if (error) {\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n    updateResourceNumberOfItems: function (resourceID, fieldID, fieldVal) {\n\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n                Resources.update({_id: resourceID}, {$set: {\"content.numberOfItems\": Number(fieldVal)}}, function (error) {\n                    if (error) {\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n\n    /*updateResourceSortField: function (resourceID,fieldID, fieldVal, fieldNumber) {\n     if (Meteor.userId() && resourceID) {\n     var resource = Resources.findOne({_id: resourceID});\n     if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n     var sortField = \"content.sortField\" + fieldNumber;\n     var sortObject = {$set:{\"content.sortField\":fieldVal}};\n     switch (fieldNumber){\n     case \"2\" :\n     sortObject = {$set:{\"content.sortField2\":fieldVal}};\n     break;\n     case \"3\" :\n     sortObject = {$set:{\"content.sortField3\":fieldVal}};\n     break;\n     }\n     Resources.update({_id:resourceID},sortObject, function(error){\n     if (error){\n     BuzzyGlobal.throwError(error);\n     } else {\n     Meteor.call(\"updateAllFieldsMicroAppDataSortVal\", resourceID,fieldVal,fieldNumber);\n     }\n     });\n\n     }\n     }\n     },*/\n\n    updateResourceGroupField: function (resourceID, fieldID, fieldVal) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n                Resources.update({_id: resourceID}, {$set: {\"content.groupField\": fieldVal}}, function (error) {\n                    if (error) {\n                        BuzzyGlobal.throwError(error);\n                    } else {\n                        //Meteor.call(\"updateAllFieldsMicroAppDataSortVal\", resourceID,fieldVal);\n                    }\n                });\n\n            }\n        }\n    },\n    updateMicroAppType: function (resourceID, fieldID, fieldVal) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n                Resources.update({_id: resourceID}, {$set: {\"content.microAppType\": fieldVal}}, function (error) {\n                    if (error) {\n                        BuzzyGlobal.throwError(error);\n                    } else {\n                        Meteor.call(\"updateAllFieldsMicroAppDataSortVal\", resourceID, fieldVal, \"1\");\n                    }\n                });\n\n            }\n        }\n    },\n    updateMicroAppSubmitType: function (resourceID, fieldID, fieldVal) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n                Resources.update({_id: resourceID}, {$set: {\"content.microAppSubmitType\": fieldVal}}, function (error) {\n                    if (error) {\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n    updateMicroAppResultsLocation: function (resourceID, fieldID, fieldVal) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n                Resources.update({_id: resourceID}, {$set: {\"content.resultsLocation\": fieldVal}}, function (error) {\n                    if (error) {\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n    updateMicroAppResultsDisplayStyle: function (resourceID, fieldID, fieldVal) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n                Resources.update({_id: resourceID}, {$set: {\"content.resultsDisplayStyle\": fieldVal}}, function (error) {\n                    if (error) {\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n    updateMicroAppResultsDisplayGantt: function (resourceID, fieldID, fieldVal) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n                Resources.update({_id: resourceID}, {$set: {\"content.resultsDisplayStyle\": fieldVal}}, function (error) {\n                    if (error) {\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n    updateMicroAppResultsDisplayMap: function (resourceID, fieldID, fieldVal) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n                Resources.update({_id: resourceID}, {$set: {\"content.resultsDisplayMap\": fieldVal}}, function (error) {\n                    if (error) {\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n    updateMicroAppResultsDisplayGantt: function (resourceID, fieldID, fieldVal) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n                Resources.update({_id: resourceID}, {$set: {\"content.resultsDisplayGantt\": fieldVal}}, function (error) {\n                    if (error) {\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n    updateMicroAppResultsDisplayModal: function (resourceID, fieldID, fieldVal) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n                Resources.update({_id: resourceID}, {$set: {\"content.resultsDisplayModal\": fieldVal}}, function (error) {\n                    if (error) {\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n    updateMicroAppResultsShowColumnHeader: function (resourceID, fieldID, fieldVal) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n                Resources.update({_id: resourceID}, {$set: {\"content.resultsShowColumnHeader\": fieldVal}}, function (error) {\n                    if (error) {\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n    updateResourceSortOrder: function (resourceID, fieldID, fieldVal) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n                Resources.update({_id: resourceID}, {$set: {\"content.sortOrder\": fieldVal}}, function (error) {\n                    if (error) {\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n    updateResourceAddButtonLocation: function (resourceID, fieldID, fieldVal) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n                Resources.update({_id: resourceID}, {$set: {\"content.addButtonLocation\": fieldVal}}, function (error) {\n                    if (error) {\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n    updateResourceButtonText: function (resourceID, fieldVal) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n                Resources.update({_id: resourceID}, {$set: {\"content.buttonText\": fieldVal}}, function (error) {\n                    if (error) {\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n    updateResourceFormHelpText: function (resourceID, fieldVal) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n                Resources.update({_id: resourceID}, {$set: {\"content.microAppFormHelp\": fieldVal}}, function (error) {\n                    if (error) {\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n    updateResourceButtonStyle: function (resourceID, fieldVal) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n                Resources.update({_id: resourceID}, {$set: {\"content.buttonStyle\": fieldVal}}, function (error) {\n                    if (error) {\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n    updateResourceSubmitButtonText: function (resourceID, fieldVal) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n                Resources.update({_id: resourceID}, {$set: {\"content.submitButtonText\": fieldVal}}, function (error) {\n                    if (error) {\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n    updateResourceSubmitButtonMessage: function (resourceID, fieldVal) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n                Resources.update({_id: resourceID}, {$set: {\"content.submitButtonMessage\": fieldVal}}, function (error) {\n                    if (error) {\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n    updateResourceSubmitButtonStyle: function (resourceID, fieldVal) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n                Resources.update({_id: resourceID}, {$set: {\"content.submitButtonStyle\": fieldVal}}, function (error) {\n                    if (error) {\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n    updateResourceWhoCanDelete: function (resourceID, fieldID, fieldVal) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n                Resources.update({_id: resourceID}, {$set: {\"content.whoCanDelete\": fieldVal}}, function (error) {\n                    if (error) {\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    },\n    updateResourceWhoCanView: function (resourceID, fieldID, fieldVal) {\n        if (Meteor.userId() && resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n                Resources.update({_id: resourceID}, {$set: {\"content.whoCanView\": fieldVal}}, function (error) {\n                    if (error) {\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n        }\n    }\n\n\n});\n\n\nif (Meteor.isServer) {\n    Meteor.methods({\n\n        createWithToken: function (token, resource) {\n            if (!token) {\n                BuzzyGlobal.throwError(\"Invalid Token\");\n            }\n            if (!BuzzyGlobal.getCurrentUser(token)) {\n                BuzzyGlobal.throwError(\"Invalid User\");\n            }\n            if (!resource) {\n                BuzzyGlobal.throwError(\"Invalid Resource\");\n            }\n\n            if (user) {\n\n                Resources.insert(resource, function (error) {\n\n\n                    if (error) {\n                        // display the error to the user - Need to come back to fix 422 (not sure what # it should be???) as the error number\n                        throw new Meteor.Error(422, error.reason);\n                    } else {\n                        console.log(\"Inserted New resources\");\n                    }\n                });\n            }\n\n\n        },\n        createWithID: function (resource, optUserToken) {\n            var user = BuzzyGlobal.getCurrentUser(optUserToken)\n\n            if (!user)\n                throw new Meteor.Error(401, \"You need to login to create new resources\");\n\n            Resources.insert(resource, function (error) {\n\n\n                if (error) {\n                    // display the error to the user - Need to come back to fix 422 (not sure what # it should be???) as the error number\n                    throw new Meteor.Error(422, error.reason);\n                } else {\n                    console.log(\"Inserted New resources\");\n                }\n            });\n            return true;\n\n        },\n        updateResourceSortField: function (resourceID, fieldNumber, fieldVal, optUserToken) {\n            var user = BuzzyGlobal.getCurrentUser(optUserToken)\n            var currentResource = Resources.findOne({_id: resourceID});\n            if (!user || !currentResource || !Resources.canEdit(user._id, currentResource)) {\n                BuzzyGlobal.throwError(\"You do not have the rights to do this!\")\n            }\n            var sortFieldObj = {};\n            switch (fieldNumber) {\n                case 1:\n                    sortFieldObj = {\"content.sortField\": fieldVal};\n                    break;\n                case 2:\n                    sortFieldObj = {\"content.sortField2\": fieldVal};\n                    break;\n                case 3:\n                    sortFieldObj = {\"content.sortField3\": fieldVal};\n                    break;\n                default:\n                    sortFieldObj = {\"content.sortField\": fieldVal};\n\n            }\n\n            Resources.update({_id: resourceID},\n                {$set: sortFieldObj},\n\n                function (error) {\n\n\n                    if (error) {\n                        // display the error to the user - Need to come back to fix 422 (not sure what # it should be???) as the error number\n                        throw new Meteor.Error(422, error.reason);\n                    } else {\n                        console.log(\"About to update sortfields\");\n                        Meteor.call(\"updateAllFieldsMicroAppDataSortVal\", resourceID, fieldVal, fieldNumber.toString());\n                    }\n                });\n            return true;\n\n        },\n        isPublicOrUnlistedResource: function (resourceID) {\n            check(resourceID, String);\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource) {\n                return resource.privacy === BuzzyGlobal.gPRIVACY.PUBLIC || resource.privacy === BuzzyGlobal.gPRIVACY.UNLISTED;\n            } else {\n                return false;\n            }\n\n        },\n\n\n        addReader: function (resourceID, readerID, optUserToken) {\n\n            var currentResource = Resources.findOne({_id: resourceID});\n            var user = BuzzyGlobal.getCurrentUser(optUserToken);\n            if (!user || !currentResource || !Resources.canEdit(user._id, currentResource)) {\n                BuzzyGlobal.throwError(\"You do not have the rights to do this!\")\n            }\n            var searchExpression = new RegExp(',' + resourceID + ',');\n            Resources.update(\n                //{$or:[{id:resourceID},{path:searchExpression}]},\n                {$or: [{_id: resourceID}, {path: searchExpression}]},\n                {$push: {readers: readerID}},\n                {\n\n                    multi: true\n\n                },\n                function (error) {\n                    if (error) {\n                        // display the error to the user - Need to come back to fix 422 (not sure what # it should be???) as the error number\n                        throw new Meteor.Error(422, error.reason);\n                    } else {\n                        if (currentResource.status === BuzzyGlobal.gRESOURCE_STATUS.PUBLISHED) {\n                            var activity = {\n                                \"actor\": {\n                                    \"objectType\": \"person\",\n                                    \"displayName\": BuzzyGlobal.gGetUserName(user)\n                                },\n                                \"verb\": \"post\",\n                                \"object\": {\n                                    \"objectType\": \"resource\",\n                                    \"resourceID\": currentResource._id,\n                                    \"displayName\": currentResource.title\n                                },\n                                \"target\": {\n                                    \"objectType\": \"resource\",\n                                    \"displayName\": currentResource.title\n                                }\n                            };\n\n                            Meteor.call(\"createSingleUserResourceNotification\", readerID, currentResource._id, \"add\", activity, optUserToken);\n                        }\n                        return;\n\n                    }\n                });\n\n        },\n        addEditor: function (resourceID, editorID, optUserToken) {\n            var currentResource = Resources.findOne({_id: resourceID});\n            var user = BuzzyGlobal.getCurrentUser(optUserToken);\n            if (!user || !currentResource || !Resources.canEdit(user._id, currentResource)) {\n                BuzzyGlobal.throwError(\"You do not have the rights to do this!\")\n            }\n\n            var searchExpression = new RegExp(',' + resourceID + ',');\n            Resources.update(\n                {$or: [{_id: resourceID}, {path: searchExpression}]},\n                {$push: {editors: editorID}},\n                {\n\n                    multi: true\n\n                },\n                function (error) {\n                    if (error) {\n                        // display the error to the user - Need to come back to fix 422 (not sure what # it should be???) as the error number\n                        throw new Meteor.Error(422, error.reason);\n                    } else {\n                        var activity = {\n                            \"actor\": {\n                                \"objectType\": \"person\",\n                                \"displayName\": BuzzyGlobal.gGetUserName(user)\n                            },\n                            \"verb\": \"post\",\n                            \"object\": {\n                                \"objectType\": \"resource\",\n                                \"resourceID\": currentResource._id,\n                                \"displayName\": currentResource.title\n                            },\n                            \"target\": {\n                                \"objectType\": \"resource\",\n                                \"displayName\": currentResource.title\n                            }\n                        };\n                        Meteor.call(\"createSingleUserResourceNotification\", editorID, resourceID, \"add\", activity, optUserToken);\n                        return true;\n\n                    }\n                });\n\n\n        },\n\n        addOwner: function (resourceID, ownerID, optUserToken) {\n            var currentResource = Resources.findOne({_id: resourceID});\n            var user = BuzzyGlobal.getCurrentUser(optUserToken);\n            if (!user || !currentResource || !Resources.canEdit(user._id, currentResource)) {\n                BuzzyGlobal.throwError(\"You do not have the rights to do this!\")\n            }\n            var searchExpression = new RegExp(',' + resourceID + ',');\n            Resources.update(\n                {$or: [{_id: resourceID}, {path: searchExpression}]},\n                {$push: {owners: ownerID}},\n                {\n\n                    multi: true\n\n                },\n                function (error) {\n                    if (error) {\n                        // display the error to the user - Need to come back to fix 422 (not sure what # it should be???) as the error number\n                        throw new Meteor.Error(422, error.reason);\n\n\n                    } else {\n                        var activity = {\n                            \"actor\": {\n                                \"objectType\": \"person\",\n                                \"displayName\": BuzzyGlobal.gGetUserName(user)\n                            },\n                            \"verb\": \"post\",\n                            \"object\": {\n                                \"objectType\": \"resource\",\n                                \"resourceID\": currentResource._id,\n                                \"displayName\": currentResource.title\n                            },\n                            \"target\": {\n                                \"objectType\": \"resource\",\n                                \"displayName\": currentResource.title\n                            }\n                        };\n                        Meteor.call(\"createSingleUserResourceNotification\", ownerID, resourceID, \"add\", activity, optUserToken);\n\n                        return true;\n\n                    }\n                });\n\n\n        },\n        removeReader: function (resourceID, readerID) {\n            console.log(\"addReader:\" + readerID + \" to resource:\" + resourceID);\n            var currentResource = Resources.findOne({_id: resourceID});\n            var user = Meteor.user();\n            if (!user || !currentResource || !Resources.canEdit(user._id, currentResource)) {\n                BuzzyGlobal.throwError(\"You do not have the rights to do this!\")\n            }\n\n            var searchExpression = new RegExp(',' + resourceID + ',');\n            Resources.update(\n                //{$or:[{id:resourceID},{path:searchExpression}]},\n                {$or: [{_id: resourceID}, {path: searchExpression}]},\n                {$pull: {readers: readerID}},\n                {\n\n                    multi: true\n\n                },\n                function (error) {\n                    if (error) {\n                        // display the error to the user - Need to come back to fix 422 (not sure what # it should be???) as the error number\n                        throw new Meteor.Error(422, error.reason);\n                    } else {\n                        console.log(\"Claims to have addedReader:\" + readerID + \" to resource:\" + resourceID);\n                        return;\n\n                    }\n                });\n\n        },\n        removeEditor: function (resourceID, editorID) {\n            var currentResource = Resources.findOne({_id: resourceID});\n            var user = Meteor.user();\n            if (!user || !currentResource || !Resources.canEdit(user._id, currentResource)) {\n                BuzzyGlobal.throwError(\"You do not have the rights to do this!\")\n            }\n\n            var searchExpression = new RegExp(',' + resourceID + ',');\n            Resources.update(\n                {$or: [{_id: resourceID}, {path: searchExpression}]},\n                {$pull: {editors: editorID}},\n                {\n\n                    multi: true\n\n                },\n                function (error) {\n                    if (error) {\n                        // display the error to the user - Need to come back to fix 422 (not sure what # it should be???) as the error number\n                        throw new Meteor.Error(422, error.reason);\n                    } else {\n                        return true;\n\n                    }\n                });\n\n\n        },\n\n        removeOwner: function (resourceID, ownerID) {\n            var currentResource = Resources.findOne({_id: resourceID});\n            var user = Meteor.user();\n            if (!user || !currentResource || !Resources.ownsDocument(user._id, currentResource)) {\n                BuzzyGlobal.throwError(\"You do not have the rights to do this!\")\n            }\n\n            var searchExpression = new RegExp(',' + resourceID + ',');\n            Resources.update(\n                {$or: [{_id: resourceID}, {path: searchExpression}]},\n                {$pull: {owners: ownerID}},\n                {\n\n                    multi: true\n\n                },\n                function (error) {\n                    if (error) {\n                        // display the error to the user - Need to come back to fix 422 (not sure what # it should be???) as the error number\n                        throw new Meteor.Error(422, error.reason);\n                    } else {\n                        return true;\n\n                    }\n                });\n        },\n\n        removeParticipant: function (resourceID, participantID) {\n            var resource = Resources.findOne({_id: resourceID});\n            var userID = Meteor.userId();\n            var searchExpression = new RegExp(',' + resourceID + ',');\n            if (resource && Resources.canChangeAudienceAndAuthors(userID, resource)) {\n\n                if (resource.readers.indexOf(participantID) >= 0) {\n                    Resources.update(\n                        {$or: [{_id: resourceID}, {path: searchExpression}]},\n                        {$pull: {readers: participantID}},\n                        {\n\n                            multi: true\n\n                        },\n                        function (error) {\n                            if (error) {\n                                // display the error to the user - Need to come back to fix 422 (not sure what # it should be???) as the error number\n                                throw new Meteor.Error(422, error.reason);\n                            } else {\n                                Meteor.call(\"removeFollower\", resourceID, participantID);\n                                return true;\n\n                            }\n                        });\n\n                } else if (resource.editors.indexOf(participantID) >= 0) {\n                    Resources.update(\n                        {$or: [{_id: resourceID}, {path: searchExpression}]},\n                        {$pull: {editors: participantID}},\n                        {\n\n                            multi: true\n\n                        },\n                        function (error) {\n                            if (error) {\n                                // display the error to the user - Need to come back to fix 422 (not sure what # it should be???) as the error number\n                                throw new Meteor.Error(422, error.reason);\n                            } else {\n\n                                Meteor.call(\"removeFollower\", resourceID, participantID);\n                                return true;\n\n                            }\n                        });\n                }\n\n            } else if (resource.owners.indexOf(participantID) >= 0 && Resources.canChangeOwners(userID, resource)) {\n                if (resource.owners.length === 1) {\n                    throw new Meteor.Error(500, \"You cannot remove last owner\");\n                } else {\n                    Resources.update(\n                        {$or: [{_id: resourceID}, {path: searchExpression}]},\n                        {$pull: {owners: participantID}},\n                        {\n\n                            multi: true\n\n                        },\n                        function (error) {\n                            if (error) {\n                                // display the error to the user - Need to come back to fix 422 (not sure what # it should be???) as the error number\n                                throw new Meteor.Error(422, error.reason);\n                            } else {\n                                Meteor.call(\"removeFollower\", resourceID, participantID);\n                                return true;\n\n                            }\n                        });\n                }\n\n\n            } else {\n                throw new Meteor.Error(500, \"User not allowed to remove participant\");\n            }\n\n\n        },\n\n        updateUpdatedDate: function (resourceID) {\n            Resources.update({_id: resourceID}, {$set: {updated: new Date().getTime()}});\n\n        },\n        ResourceSetAllToFollow: function (resourceID) {\n            check(resourceID, String);\n            var currentResource = Resources.findOne({_id: resourceID});\n            if (currentResource) {\n                currentResource.readers.forEach(function (user) {\n                    Meteor.call(\"addFollower\", resourceID, user);\n\n                });\n                currentResource.editors.forEach(function (user) {\n                    Meteor.call(\"addFollower\", resourceID, user);\n\n                });\n                currentResource.owners.forEach(function (user) {\n                    Meteor.call(\"addFollower\", resourceID, user);\n\n                });\n                //createResourceNotification(resourceID,BuzzyGlobal.gACTIONS.PUBLISHED);\n                Meteor.call(\"createResourceNotification\", resourceID, BuzzyGlobal.gACTIONS.PUBLISHED, function (error) {\n                    if (error) {\n                        console.log(error)\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            } else {\n                throw new Meteor.Error(500, \"cannot set followers\");\n\n            }\n\n        },\n        createDirectChildrenServerMethod: function (srcResourceID, readers, editors, owners, targetPath, rank, parentStatus, optResource) {\n\n            var resource = Resources.findOne({_id: srcResourceID});\n            console.log(\"createDirectChildrenServerMethod RESOURCE ID:\" + resource._id + \" can view:\" + Resources.canView(Meteor.userId(), resource));\n            var resourceParent;\n            if (targetPath) {\n                var parentID = Resources.gGetParentFromPath(targetPath);\n                resourceParent = Resources.findOne({_id: parentID});\n                if (resourceParent && !Resources.canEdit(Meteor.userId(), resourceParent)) {\n                    BuzzyGlobal.throwError(\"Sorry you don't have access to do that!\");\n                    return;\n                }\n            }\n\n\n            if (resource && Resources.canView(Meteor.userId(), resource)) {\n                Resources.createDirectChildren(srcResourceID, readers, editors, owners, targetPath, rank, parentStatus, optResource, null, function (err, id) {\n                    if (err) {\n                        throw new Meteor.Error(500, err);\n                    } else {\n                        console.log(\"NO ERROR CREATED DIRECT CHILDREN for \" + id);\n                    }\n                })\n            } else {\n                throw new Meteor.Error(500, \"Cannot access resource\");\n            }\n\n\n        },\n        duplicateWelcomeBuzz: function () {\n            if (!Meteor.userId()) {\n                throw new Meteor.Error(500, \"User musy be logged in to created Welcome Buzz.\");\n            }\n            var welcomeBuzz = Resources.findOne({_id: Meteor.settings.BUZZY_WELCOME});\n            if (welcomeBuzz) {\n                var userName = BuzzyGlobal.gGetUserNameByID(Meteor.userId());\n                var newResource = _.extend(_.pick(welcomeBuzz, 'CSSclass', 'coverImage', 'type', 'resourceURI', 'orginalResourceID', 'showComments', 'description', 'reusable', 'orginalResourceID', 'isStarterTemplate', 'tourStepID', 'tourCode', 'hasTour'), {\n\n                    title: \"Welcome to Buzzy, \" + userName,\n                    userID: Meteor.userId(),\n                    author: userName,\n                    readers: [],\n                    editors: [],\n                    status: BuzzyGlobal.gRESOURCE_STATUS.PUBLISHED,\n                    privacy: BuzzyGlobal.gPRIVACY.PRIVATE,\n\n\n                    owners: [Meteor.userId()],\n                    followers: [],\n\n                    submitted: new Date().getTime(),\n                    updated: new Date().getTime(),\n                    path: null,\n                    _id: new Meteor.Collection.ObjectID()._str\n\n                });\n\n\n                Resources.createDirectChildren(welcomeBuzz._id, [], [], [Meteor.userId()], null, 1, newResource.status, newResource, null, function (err) {\n\n                    if (err) {\n                        throw new Meteor.Error(500, err);\n                    } else {\n                        console.log(\"WELCOME BUZZ Created \" + newResource._id);\n                    }\n                })\n            }\n\n\n        },\n        changeRoleTo: function (resourceID, userID, targetRole) {\n\n            if (resourceID) {\n\n                var resource = Resources.findOne({_id: resourceID});\n                if (resource) {\n\n\n                    if (Resources.canChangeOwners(Meteor.userId(), resource)) {\n                        switch (targetRole) {\n                            case \"reader\":\n\n                                if (resource.editors.indexOf(userID) >= 0) {\n                                    Meteor.call(\"addReader\", resourceID, userID);\n                                    Meteor.call(\"removeEditor\", resourceID, userID);\n                                } else if (resource.owners.indexOf(userID) >= 0 && resource.owners.length > 1) {\n                                    Meteor.call(\"addReader\", resourceID, userID);\n                                    Meteor.call(\"removeOwner\", resourceID, userID);\n                                }\n\n                                break;\n                            case \"editor\":\n\n\n                                if (resource.readers.indexOf(userID) >= 0) {\n                                    Meteor.call(\"addEditor\", resourceID, userID);\n                                    Meteor.call(\"removeReader\", resourceID, userID);\n                                } else if (resource.owners.indexOf(userID) >= 0 && resource.owners.length > 1) {\n                                    Meteor.call(\"addEditor\", resourceID, userID);\n                                    Meteor.call(\"removeOwner\", resourceID, userID);\n                                }\n\n                                break;\n                            case \"owner\":\n\n                                if (resource.readers.indexOf(userID) >= 0) {\n                                    Meteor.call(\"addOwner\", resourceID, userID);\n                                    Meteor.call(\"removeReader\", resourceID, userID);\n                                } else if (resource.editors.indexOf(userID) >= 0) {\n                                    Meteor.call(\"addOwner\", resourceID, userID);\n                                    Meteor.call(\"removeEditor\", resourceID, userID);\n                                }\n\n                                break;\n\n                        }\n                    } else if (Resources.canChangeAudienceAndAuthors(Meteor.userId(), resource)) {\n\n                        switch (targetRole) {\n                            case \"reader\":\n\n                                if (resource.editors.indexOf(userID) >= 0) {\n                                    Meteor.call(\"addReader\", resourceID, userID);\n                                    Meteor.call(\"removeEditor\", resourceID, userID);\n                                } else if (resource.owners.indexOf(userID) >= 0 && resource.owners.length > 1) {\n                                    Meteor.call(\"addReader\", resourceID, userID);\n                                    Meteor.call(\"removeOwner\", resourceID, userID);\n                                }\n\n                                break;\n                            case \"editor\":\n\n\n                                if (resource.readers.indexOf(userID) >= 0) {\n                                    Meteor.call(\"addEditor\", resourceID, userID);\n                                    Meteor.call(\"removeReader\", resourceID, userID);\n                                } else if (resource.owners.indexOf(userID) >= 0 && resource.owners.length > 1) {\n                                    Meteor.call(\"addEditor\", resourceID, userID);\n                                    Meteor.call(\"removeOwner\", resourceID, userID);\n                                }\n\n                                break;\n\n\n                        }\n                    } else {\n                        throw new Meteor.Error(500, \"Insufficient rights to change user role.\");\n                    }\n\n                } else {\n                    throw new Meteor.Error(500, \"Can't find resource\");\n                }\n            } else {\n\n                throw new Meteor.Error(500, \"No resource provided\");\n            }\n\n        },\n        relatedBuzz: function (participants, currentResourceID) {\n            var query = resourceQuery(Meteor.userId(), \"all\", \"\");\n            var pipeline = [\n                {$match: query},\n                {\n                    $project: {\n                        title: 1,\n                        updated: 1,\n                        type: 1,\n                        status: 1,\n                        readers: 1,\n                        editors: 1,\n                        owners: 1,\n                        allValues: {$setUnion: [\"$readers\", \"$editors\", \"$owners\"]},\n                        _id: 1\n                    }\n                },\n                {\n                    $match: {\n                        $and: [\n                            {allValues: {$all: participants}},\n                            {_id: {$ne: currentResourceID}}\n                        ]\n                    }\n                },\n                {$sort: {updated: -1}},\n                {$limit: 10}\n                //{$group: {_id: null, resTime: {$sum: \"$resTime\"}}}\n            ];\n            var results = Resources.aggregate(pipeline);\n\n            return results;\n\n\n        },\n\n        resourceFollowersLimited: function (resourceID, optLimit, timeCalled) {\n            console.log(\"resourceFollowersLimited\", resourceID, optLimit)\n            check(resourceID, String);\n            check(optLimit, Number);\n\n            var resource = Resources.findOne({_id: resourceID});\n            if (resource && Meteor.userId() && Resources.canEdit(Meteor.userId(), resource)) {\n                var followers = ResourceFollowers.find({resourceID: resourceID}, {limit: optLimit}).map(function (follower) {\n\n                    return follower.userID;\n                });\n                console.log(\"resourceFollowersLimited f:\", followers)\n                var userArray = Users.find(\n                    {_id: {$in: followers}},\n                    {limit: optLimit}).map(function (user) {\n                    return _.pick(user,\n                        '_id',\n                        'profile',\n                        'username',\n                        'emails',\n                        'email',\n                        'services.google.picture',\n                        'services.google.email',\n                        'services.google.name',\n                        'services.facebook.email',\n                        'services.facebook.id',\n                        'services.facebook.link',\n                        'services.facebook.name',\n                        'services.google.verified_email',\n                        'services.password.verified_email');\n                });\n\n                return userArray;\n            } else {\n                BuzzGlobal.throwError(\"Sorry, can perform operation.\")\n            }\n\n\n        },\n        searchBuzz: function (searchQuery) {\n\n\n            var searchExpression = new RegExp(searchQuery, \"i\");\n            var contactsArray = UserContacts.find(\n                {\n                    $and: [\n                        {userID: Meteor.userId()},\n                        {$or: [{name: searchExpression}, {email: searchExpression}]}\n                    ]\n                }\n            ).map(function (contact) {\n                return contact.contactID\n            });\n\n            var query = resourceQuery(Meteor.userId(), \"all\", \"\");\n            var pipeline = [\n                {$match: query},\n                {\n                    $project: {\n                        title: 1,\n                        updated: 1,\n                        type: 1,\n                        status: 1,\n                        readers: 1,\n                        editors: 1,\n                        owners: 1,\n                        allValues: {$setUnion: [\"$readers\", \"$editors\", \"$owners\"]},\n                        _id: 1,\n                        coverImage: 1\n                    }\n                },\n                {\n                    $match: {\n                        $or: [\n                            {allValues: {$in: contactsArray}},\n                            {title: searchExpression}\n                        ]\n                    }\n                },\n                {$sort: {updated: -1}},\n                {$limit: 50}\n                //{$group: {_id: null, resTime: {$sum: \"$resTime\"}}}\n            ];\n            var results = Resources.aggregate(pipeline);\n\n            return results;\n\n        },\n        searchBuzzOwnerAuthor: function (searchQuery) {\n\n\n            var searchExpression = new RegExp(searchQuery, \"i\");\n            var contactsArray = UserContacts.find(\n                {\n                    $and: [\n                        {userID: Meteor.userId()},\n                        {$or: [{name: searchExpression}, {email: searchExpression}]}\n                    ]\n                }\n            ).map(function (contact) {\n                return contact.contactID\n            });\n\n            var generateQuery = function (searchExp) {\n                var searchUserExpression = new RegExp(Meteor.userId());\n                if (searchExp) {\n                    return {\n                        $and: [\n                            {title: searchExp},\n                            {path: null},\n                            {type: \"buzz\"},\n                            {isStarterTemplate: false},\n                            {\n                                $or: [\n                                    {editors: searchUserExpression},\n                                    {owners: searchUserExpression}\n                                ]\n                            },\n                            {$or: [{status: 'draft'}, {status: 'published'}]},\n\n                        ]\n                    }\n                } else {\n                    return {\n                        $and: [\n                            {path: null},\n                            {type: \"buzz\"},\n                            {isStarterTemplate: false},\n                            {\n                                $or: [\n                                    {editors: searchUserExpression},\n                                    {owners: searchUserExpression}\n                                ]\n                            },\n                            {$or: [{status: 'draft'}, {status: 'published'}]},\n\n                        ]\n                    }\n\n                }\n            }\n            var query = generateQuery(searchExpression);\n            var pipeline = [\n                {$match: query},\n                {\n                    $project: {\n                        title: 1,\n                        updated: 1,\n                        type: 1,\n                        status: 1,\n                        editors: 1,\n                        owners: 1,\n                        allValues: {$setUnion: [\"$editors\", \"$owners\"]},\n                        _id: 1\n                    }\n                },\n                {\n                    $match: {\n                        $or: [\n                            {allValues: {$in: contactsArray}},\n                            {title: searchExpression}\n                        ]\n                    }\n                },\n                {$sort: {updated: -1}},\n                {$limit: 50}\n                //{$group: {_id: null, resTime: {$sum: \"$resTime\"}}}\n            ];\n            var results = Resources.aggregate(pipeline);\n\n            return results;\n\n        },\n\n        getBasicBuzzID: function () {\n            console.log(\"Meteor.settings.BUZZY_BASIC_BUZZ_ID\", Meteor.settings.BUZZY_BASIC_BUZZ_ID)\n            if (typeof Meteor.settings.BUZZY_BASIC_BUZZ_ID === \"undefined\" || Meteor.settings.BUZZY_BASIC_BUZZ_ID === \"\" || Meteor.settings.BUZZY_BASIC_BUZZ_ID === null) {\n                throw new Meteor.Error(500, \"Can't get get basic buzz ID\");\n            } else {\n                return Meteor.settings.BUZZY_BASIC_BUZZ_ID;\n            }\n\n        },\n        updateResourceGalleryURL: function (resourceID, updateData) {\n            if (Meteor.userId() && resourceID && updateData) {\n                var resource = Resources.findOne({_id: resourceID});\n                if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n                    var obj = {\n                        content: {\n                            galleryURL: updateData.signedURL,\n                            signature: updateData.signature,\n                            policy: updateData.policy,\n                            additionalImageCount: updateData.additionalImageCount\n                        }\n                    }\n                    Resources.update({_id: resourceID}, {$set: obj}, function (error) {\n                        if (error) {\n                            BuzzyGlobal.throwError(error);\n                        }\n                    });\n\n                }\n            }\n        },\n        updateResourceAnalyticsOn: function (resourceID, updateData) {\n            if (Meteor.userId() && resourceID && (typeof updateData !== \"undefined\")) {\n                var resource = Resources.findOne({_id: resourceID});\n                if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n\n                    Resources.upsert({_id: resourceID}, {$set: {resourceAnalyticsOn: updateData}}, function (error) {\n                        if (error) {\n                            BuzzyGlobal.throwError(error);\n                        }\n                    });\n\n                }\n            }\n        },\n        createBuzzFromTemplate: function (templateID, optUserList, optUserToken) {\n\n            var user = BuzzyGlobal.getCurrentUser(optUserToken)\n            if (!user) {\n                BuzzyGlobal.throwError(\"Invalid User Credentials\");\n            }\n            var chosenTemplate = Resources.findOne({_id: templateID});\n\n            if (chosenTemplate && Resources.canView(user._id, chosenTemplate)) {\n                if (user) {\n                    var newReaders = [], newEditors = [], newOwners = [user._id];\n                    var newResource = _.extend(_.pick(chosenTemplate, 'coverImage', 'CSSclass', 'type', 'resourceURI', 'orginalResourceID', 'showComments', 'description', 'reusable', 'orginalResourceID', 'tourStepID', 'tourCode', 'hasTour'), {\n\n                        title: chosenTemplate.title + \" \" + moment(new Date().getTime()).format('DD MMM YYYY (h:mm a)'),\n                        userID: user._id,\n                        author: BuzzyGlobal.gGetUserName(user),\n                        readers: newReaders,\n                        editors: newEditors,\n                        status: BuzzyGlobal.gRESOURCE_STATUS.DRAFT,\n                        privacy: BuzzyGlobal.gPRIVACY.PRIVATE,\n                        isStarterTemplate: false,\n                        owners: newOwners,\n                        followers: [],\n\n                        submitted: new Date().getTime(),\n                        updated: new Date().getTime(),\n                        path: null,\n                        _id: new Meteor.Collection.ObjectID()._str,\n                        hasTour: false\n\n                    });\n                    Resources.createDirectChildren(chosenTemplate._id, newReaders, newEditors, newOwners, null, 1, newResource.status, newResource, optUserToken,\n                        function (err) {\n                            if (err) {\n                                BuzzyGlobal.throwError(err);\n                            } else {\n                                Meteor.setTimeout(function () {\n                                    if (typeof optUserList !== \"undefined\") {\n                                        var i = -1, j = -1, k = -1;\n\n                                        for (i in optUserList.audience) {\n                                            Meteor.call('addNewUser', newResource._id, optUserList.audience[i], \"addReader\", optUserToken,\n                                                function (err) {\n                                                    if (err) {\n                                                        BuzzyGlobal.throwError(err);\n                                                    } else {\n                                                        if (Meteor.isClient) {\n\n                                                            BuzzyLogging.call(\"track\", {\n                                                                action: \"invitedUser\",\n                                                                invitedByID: user._id,\n                                                                invitedUserEmail: optUserList.audience[i],\n                                                                invitingResourceID: newResource._id\n                                                            });\n                                                            analytics.track(\"invitedUser\", {\n                                                                invitedByID: user._id,\n                                                                invitedUserEmail: optUserList.audience[i],\n                                                                invitingResourceID: newResource._id\n                                                            }, function () {\n                                                                return;\n                                                            });\n                                                        }\n\n                                                    }\n                                                });\n\n                                        }\n                                    }\n                                    for (j in optUserList.authors) {\n                                        Meteor.call('addNewUser', newResource._id, optUserList.authors[j], \"addEditor\", optUserToken,\n                                            function (err) {\n                                                if (err) {\n                                                    BuzzyGlobal.throwError(err);\n                                                } else {\n                                                    if (Meteor.isClient) {\n                                                        BuzzyLogging.call(\"track\", {\n                                                            action: \"invitedUser\",\n                                                            invitedByID: user._id,\n                                                            invitedUserEmail: optUserList.authors[j],\n                                                            invitingResourceID: newResource._id\n                                                        });\n                                                        analytics.track(\"invitedUser\", {\n                                                            invitedByID: user._id,\n                                                            invitedUserEmail: optUserList.authors[j],\n                                                            invitingResourceID: newResource._id\n                                                        }, function () {\n                                                            return;\n                                                        });\n                                                    }\n\n                                                }\n                                            });\n\n                                    }\n                                    for (k in optUserList.owners) {\n                                        Meteor.call('addNewUser', newResource._id, optUserList.owners[k], \"addOwner\", optUserToken,\n                                            function (err) {\n                                                if (err) {\n                                                    BuzzyGlobal.throwError(err);\n                                                } else {\n                                                    if (Meteor.isClient) {\n\n                                                        BuzzyLogging.call(\"track\", {\n                                                            action: \"invitedUser\",\n                                                            invitedByID: user._id,\n                                                            invitedUserEmail: optUserList.owners[k],\n                                                            invitingResourceID: newResource._id\n                                                        });\n                                                        analytics.track(\"invitedUser\", {\n                                                            invitedByID: user._id,\n                                                            invitedUserEmail: optUserList.owners[k],\n                                                            invitingResourceID: newResource._id\n                                                        }, function () {\n                                                            return;\n                                                        });\n                                                    }\n\n                                                }\n                                            });\n\n                                    }\n\n                                }, 5000);\n\n                            }\n\n                        });\n\n                } else {\n                    console.log(\"here 4\")\n                    BuzzyGlobal.throwError(\"Cannot associate user with reqest.\")\n                }\n            } else {\n                console.log(\"here 5\")\n                BuzzyGlobal.throwError(\"Cannot find template.\")\n            }\n        },\n        makeRestCall: function (resourceID, url) {\n            HTTP.call(\"POST\", url, {},\n                function (err, result) {\n                    console.log(\"POST RESULT:\", result, \" ERR:\", err)\n                    if (err) {\n                        console.log({message: 'Test failed error.'});\n                    } else {\n                        console.log(\"TT res:\", result)\n                        console.log({message: 'Test passed - got result: ' + result});\n                    }\n\n\n                })\n        },\n        microAppCSV: function (resourceID) {\n            var resource = Resources.findOne({_id: resourceID});\n            var fieldsCursor = {};\n            var fieldsArray = [];\n            var appData = [];\n            if (Resources.canEdit(Meteor.userId(), resource)) {\n                fieldsCursor = MicroAppFields.find({parentResourceID: resourceID}, {sort: {rank: 1}})\n                fieldsArray = fieldsCursor.map(function (field) {\n                    return field.label;\n                });\n            }\n            ;\n\n            if (fieldsCursor) {\n                appData = MicroAppData.find({parentResourceID: resourceID}).map(function (data) {\n                    var row = [];\n                    fieldsCursor.forEach(function (currField) {\n                        var tempEvent = \"\";\n                        for (j in data.content) {\n                            if (data.content[j]._id === currField._id) {\n                                switch (currField.fieldType) {\n                                    case BuzzyGlobal.gAPPFIELDTYPE.DATETIME:\n                                        if (data.content[j].value && typeof data.content[j].value.start !== \"undefined\") {\n                                            row.push(\"start:\" + BuzzyGlobal.gFormatDate(data.content[j].value.start, currField.option.format, resource.content.timezone) + \" end:\" + BuzzyGlobal.gFormatDate(data.content[j].value.end, currField.option.format, resource.content.timezone));\n                                        } else {\n                                            row.push(BuzzyGlobal.gFormatDate(data.content[j].value, currField.option.format, resource.content.timezone));\n                                        }\n\n\n                                        break;\n                                    case BuzzyGlobal.gAPPFIELDTYPE.EVENT:\n                                        tempEvent = \"\";\n                                        if (data.content[j].value && typeof data.content[j].value.start !== \"undefined\") {\n                                            tempEvent = \"start:\" + BuzzyGlobal.gFormatDate(data.content[j].value.start, currField.option.format, resource.content.timezone) + \" end:\" + BuzzyGlobal.gFormatDate(data.content[j].value.end, currField.option.format, resource.content.timezone);\n                                        }\n                                        if (typeof data.content[j].value.title !== \"undefined\") {\n                                            tempEvent = tempEvent + \"title:\" + data.content[j].value.title\n                                        }\n                                        if ((typeof data.content[j].value.location !== \"undefined\" && typeof data.content[j].value.location.formatted_address !== \"undefined\")) {\n                                            tempEvent = tempEvent + \" location:\" + data.content[j].value.location.formatted_address;\n                                        }\n                                        row.push(tempEvent)\n                                        break;\n                                    case BuzzyGlobal.gAPPFIELDTYPE.ATTACHMENTS:\n                                        var attachments = \"\";\n                                        for (k in data.content[j].value) {\n                                            if (data.content[j].value[k].url && typeof  data.content[j].value[k].url !== \"undefined\") {\n                                                attachments = attachments + \" \" + data.content[j].value[k].url\n                                            }\n\n                                        }\n                                        row.push(attachments);\n                                        break;\n                                    case BuzzyGlobal.gAPPFIELDTYPE.SUBMITTED:\n                                        row.push(moment(data.submitted).format());\n                                        break;\n                                    case BuzzyGlobal.gAPPFIELDTYPE.AUTHOR:\n                                        row.push(data.author);\n                                        break;\n                                    default:\n                                        row.push(data.content[j].value);\n                                }\n\n                            }\n\n                        }\n                    })\n\n\n                    return row;\n\n                });\n            }\n\n\n            return {\n                fields: fieldsArray,\n                data: appData\n            }\n\n        },\n        viewedResourceSummary: function (resourceID) {\n            if (resourceID) {\n                BuzzyLogging.call(\"viewedResourceSummary\", resourceID, function (err, result) {\n                    if (err) {\n                        BuzzyGlobal.throwError(err);\n                    } else {\n                        return result;\n                    }\n                });\n            }\n        },\n        resourceViewedByUser: function (resourceID) {\n            if (resourceID) {\n                BuzzyLogging.call(\"viewedResourceByUser\", resourceID, function (err, result) {\n                    if (err) {\n                        BuzzyGlobal.throwError(err);\n                    } else {\n                        return result;\n                    }\n                });\n            }\n        },\n        resourceTrackUserView: function (userID, resourceID) {\n\n\n            /* if (typeof userID === \"undefined\" || !userID){\n             BuzzyGlobal.throwError(\"Invalid User!\")\n             }\n             if (typeof resourceID === \"undefined\" || !resourceID){\n             BuzzyGlobal.throwError(\"Invalid Resource!\")\n             }*/\n            var user = Users.findOne({_id: userID});\n            var resource = Resources.findOne({_id: resourceID});\n\n            if (user && resource && resource.resourceAnalyticsOn) {\n                BuzzyLogging.call(\"trackEmail\", {\n                    action: \"view\",\n                    \"resourceID\": resource._id,\n                    \"userID\": user._id,\n                    \"buzzTitle\": resource.title,\n                    \"completedSetup\": user.completedSetup ? user.completedSetup : false\n                });\n            }\n\n\n        },\n        updateResourcePayment: function (resourceID, payment) {\n            var resource = Resources.findOne({_id: resourceID});\n\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n                Resources.update({_id: resource._id}, {$set: {\"content.payment\": payment}}, function (err) {\n                    if (err) {\n                        BuzzyGlobal.throwError(\"Error updating payment info:\", err);\n                    }\n                })\n            }\n            ;\n\n\n        },\n        updateResourceContent: function (resourceID, content) {\n            var resource = Resources.findOne({_id: resourceID});\n\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n                Resources.update({_id: resource._id}, {$set: {\"content\": content}}, function (err) {\n                    if (err) {\n                        BuzzyGlobal.throwError(\"Error updating payment info:\", err);\n                    }\n                })\n            }\n            ;\n\n\n        },\n        updateResourcePaymentButtonHelp: function (resourceID, updateText) {\n            var resource = Resources.findOne({_id: resourceID});\n\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n                Resources.update({_id: resource._id}, {$set: {\"content.buttonHelp\": updateText}}, function (err) {\n                    if (err) {\n                        BuzzyGlobal.throwError(\"Error updating payment info:\", err);\n                    }\n                })\n            }\n            ;\n\n\n        },\n        updateResourcePaymentButtonText: function (resourceID, updateText) {\n            var resource = Resources.findOne({_id: resourceID});\n\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n                Resources.update({_id: resource._id}, {$set: {\"content.label\": updateText}}, function (err) {\n                    if (err) {\n                        BuzzyGlobal.throwError(\"Error updating payment info:\", err);\n                    }\n                })\n            }\n            ;\n\n\n        },\n        updateResourcePaymentButtonStyle: function (resourceID, updateText) {\n            var resource = Resources.findOne({_id: resourceID});\n\n            if (resource && Resources.canEdit(Meteor.userId(), resource)) {\n                Resources.update({_id: resource._id}, {$set: {\"content.style\": updateText}}, function (err) {\n                    if (err) {\n                        BuzzyGlobal.throwError(\"Error updating payment info:\", err);\n                    }\n                })\n            }\n            ;\n\n\n        },\n        resourceCopyMicroApp: function (srcResourceID, newResourceID, topParentID, oldVsNewFieldIDs, optUserToken) {\n            var user = BuzzyGlobal.getCurrentUser(optUserToken);\n            if (!user) {\n                BuzzyGlobal.throwError(\"You do not have the permission to do that!\")\n            }\n            if (user && srcResourceID) {\n                var resource = Resources.findOne({_id: srcResourceID});\n                if (resource && Resources.canView(user._id, resource)) {\n                    MicroAppData.duplicateMicroAppData(srcResourceID, newResourceID, oldVsNewFieldIDs, optUserToken);\n                } else {\n                    BuzzyGlobal.throwError(\"You don't have permission to do that!\");\n                }\n\n            }\n        },\n        getCommentToList: function (resourceID, optUserToken) {\n            check(resourceID, String);\n            var user = BuzzyGlobal.getCurrentUser(optUserToken);\n\n            if (user && resourceID) {\n                var resource = Resources.findOne({_id: resourceID});\n                if (resource && Resources.canView(user._id, resource)) {\n                    var currentParticipants = _.without(resource.readers.concat(resource.editors, resource.owners), Meteor.userId());\n                    var participantsWithNames = [];\n\n\n                    var currentUsersArray = Users.find({_id: {$in: currentParticipants}}).map(function (user) {\n                        return {_id: user._id, name: BuzzyGlobal.gGetUserName(user)}\n                    });\n\n                    console.log(\"initialize currentParticipants\", currentParticipants, \"currentUsersArray:\", currentUsersArray)\n                    return currentUsersArray;\n                } else {\n                    BuzzyGlobal.throwError(\"You don't have permission to do that!\");\n                }\n\n            }\n\n        },\n        checkValidLicense: function (resourceID, optUserToken) {\n            check(resourceID, String);\n            var user = BuzzyGlobal.getCurrentUser(optUserToken);\n\n            if (user && resourceID) {\n                var resource = Resources.findOne({_id: resourceID});\n                if (resource && Resources.canView(user._id, resource)) {\n\n\n                    var ownerAuthorsArray = resource.editors.concat(resource.owners);\n                    if (ownerAuthorsArray.indexOf(user._id) !== -1 && (ownerAuthorsArray.length > 1)) {\n                        if (user.subscriptionID) {\n                            if (BuzzyLogging && BuzzyLogging.status().connected) {\n                                BuzzyLogging.call(\"track\", {\n                                    action: \"checkValidLicense\",\n                                    resourceID: resourceID,\n                                    userID: user._id,\n                                    status: true\n                                }, Meteor.settings.BUZZY_LOGGING_TOKEN);\n                            }\n\n                            return true;\n                        } else {\n                            if (BuzzyLogging && BuzzyLogging.status().connected) {\n                                BuzzyLogging.call(\"track\", {\n                                    action: \"checkValidLicense\",\n                                    resourceID: resourceID,\n                                    userID: user._id,\n                                    status: false\n                                }, Meteor.settings.BUZZY_LOGGING_TOKEN);\n                            }\n\n                            return false;\n                        }\n\n                    } else {\n                        if (BuzzyLogging && BuzzyLogging.status().connected) {\n                            BuzzyLogging.call(\"track\", {\n                                action: \"checkValidLicense\",\n                                resourceID: resourceID,\n                                userID: user._id,\n                                status: true\n                            }, Meteor.settings.BUZZY_LOGGING_TOKEN);\n                        }\n\n                        return true;\n\n                    }\n\n                } else {\n                    BuzzyGlobal.throwError(\"You don't have permission to do that!\");\n                }\n\n            }\n\n        },\n        addWatsonCredential: function (resourceID, optUserToken) {\n            check(resourceID, String);\n            var user = BuzzyGlobal.getCurrentUser(optUserToken);\n\n            if (user && resourceID) {\n                var resource = Resources.findOne({_id: resourceID});\n                if (resource && Resources.canEdit(user._id, resource)) {\n                    const newCred = {\n                        _id:new Meteor.Collection.ObjectID()._str,\n                        watsonAtID: '',\n                        watsonUserID: '',\n                        watsonPassword: '',\n                        watsonWorkspaceID: '',\n\n                    }\n                    var watsonCreds = resource.watsonCreds;\n                    if (watsonCreds) {\n                        watsonCreds.push(newCred);\n\n                    } else {\n                        watsonCreds = [newCred];\n                    }\n                    Resources.update({_id: resourceID},\n                        {$set: {watsonCreds:watsonCreds}},\n\n                        function (error) {\n\n\n                            if (error) {\n                                // display the error to the user - Need to come back to fix 422 (not sure what # it should be???) as the error number\n                                throw new Meteor.Error(422, error.reason);\n                            } else {\n                                console.log('added Watson Creds',watsonCreds);\n                            }\n                        });\n\n                }\n\n            }\n        },\n        updateWatsonCredentials: function (resourceID, watsonItemID, creds, optUserToken) {\n            check(resourceID, String);\n            var user = BuzzyGlobal.getCurrentUser(optUserToken);\n\n            if (user && resourceID) {\n                var resource = Resources.findOne({_id: resourceID});\n                if (resource && Resources.canEdit(user._id, resource)) {\n                    /*const credential = {};\n                    credential[fieldName] = fieldVal;*/\n                    console.log('UPDATE CREDS',watsonItemID, creds);\n\n                    Resources.update({_id: resourceID, \"watsonCreds._id\":watsonItemID},\n                        {$set: {\"watsonCreds.$\":creds}},\n\n                        function (error) {\n\n\n                            if (error) {\n                                // display the error to the user - Need to come back to fix 422 (not sure what # it should be???) as the error number\n                                throw new Meteor.Error(422, error.reason);\n                            } else {\n                                console.log('updated Watson Creds',creds);\n                            }\n                        });\n\n                }\n\n            }\n        }\n\n\n    });\n\n}","/**\n * Created by adamginsburg on 9/12/2014.\n */\n\nif (Meteor.isServer){\n    Notifications.createAnonymousPaymentNotification =  function(recipientUserID, parentResourceID, action,activity) {\n        var self = this;\n\n        if (!recipientUserID || !parentResourceID || !activity){\n            throw BuzzyGlobal.throwError(\"Invalid Params\");\n        }\n        var resource = Resources.findOne({_id:parentResourceID});// come back to look at children notifications later, for now do for parent\n        var emailRecipients = [];\n\n\n        if (!resource){\n            BuzzyGlobal.throwError(\"Resource not found: \" + parentResourceID);\n        }\n\n\n\n        if (recipientUserID && typeof recipientUserID !== \"undefined\" ){\n            Notifications.insert({\n                _id:new Meteor.Collection.ObjectID()._str,\n                forUserID: recipientUserID,\n                byUserID: null,\n                action:action,\n                target:parentResourceID,\n                activity: activity,\n                //resourceID: resource._id,\n                resourceID: resource._id, // insert for parent not actual resource ID, may need to come back to this\n                commentID: null,\n                commenterName: activity.actor.displayName,\n                read: false,\n                submitted:new Date().getTime()\n            });\n\n        }\n\n        var msgText = \"transfered \" + activity.object.currency + \" \" + BuzzyGlobal.formatCurrency(activity.object.amount/100) + \" #\" + activity.object.receipt_number;\n\n\n\n\n        if (recipientUserID && typeof recipientUserID !== \"undefined\"){\n            Push.send({\n                from: activity.actor.displayName,\n                title: \"Some title\",\n                text: msgText,\n                badge: Meteor.call(\"gNotificationsUnreadForUserID\",recipientUserID), // get notifications count for user\n                sound: 'yes',\n                query: {\n                    userId:recipientUserID\n                }\n\n            });\n\n\n\n\n            Notifications.sendResourceNotifications(self.connection, recipientUserID, [recipientUserID], parentResourceID,[], true, function (error, id) {\n                if (error) {\n\n                    console.log(\"sendNotification error:\", error);\n                    //throw new Meteor.Error(422, error.reason);\n                    BuzzyGlobal.throwError(error);\n                }\n            });\n        }\n\n\n\n    };\n    Notifications.sendNotifications =  function (userID, recipients,emailMessage,topResourceID, resourceParentID,commentID, callback){\n\n        if (!commentID || typeof commentID === \"undefined\" || commentID === null ){\n            BuzzyGlobal.throwError(\"Invalid Comment ID: \" + commentID);\n        }\n        if (!userID){\n            BuzzyGlobal.throwError(\"Invalid User ID\")\n        }\n        var user = Users.findOne(userID);\n        if (!user){\n            BuzzyGlobal.throwError(\"Can't find user\")\n        }\n        if (!recipients){\n            BuzzyGlobal.throwError(\"Invalid recipients\")\n        }\n\n\n\n        var userEmail = BuzzyGlobal.gGetUserFormattedEmail(user);\n        var usersToEmail = [];\n        var usersToSMS = [];\n\n        var usersCursor = Meteor.users.find({_id:{$in:recipients}});\n\n        var usersToNotify = usersCursor.forEach(function (user) {\n            if (user && user._id != userID && !Users.isBot(user)){\n                if (typeof user.profile.channels !== \"undefined\"){\n                    for (i in user.profile.channels){\n                        switch (user.profile.channels[i].channel){\n                            case BuzzyGlobal.gNOTIFICATION_CHANNEL.EMAIL:\n                                // don't check verified if (user.profile.channels[i].enabled && BuzzyGlobal.gEmailIsVerified(user, user.profile.channels[i].address)){\n                                var tempToken = null;\n                                if (user.services && user.services.password && user.services.password && user.services.password.reset){\n                                    tempToken = user.services.password.reset.token;\n                                };\n                                if (user.profile.channels[i].enabled){\n                                    usersToEmail.push({\n                                        _id:user._id,\n                                        email:user.profile.channels[i].address,\n                                        completedSetup:user.completedSetup,\n                                        token: tempToken\n                                    });\n                                }\n                                break;\n                            case BuzzyGlobal.gNOTIFICATION_CHANNEL.SMS:\n                                if (user.profile.channels[i].enabled){\n                                    usersToSMS.push(user.profile.channels[i].address);\n                                };\n                                break;\n                        }\n                    }\n                }\n            } \n\n        });\n        var resource = Resources.findOne({_id:topResourceID});\n        var comment = Comments.findOne({_id:commentID});\n        if (!resource || !comment){\n            BuzzyGlobal.throwError(\"Invalid Resource/Comment\")\n        }\n\n        if (usersToEmail.length > 0 ){\n            for (i in usersToEmail){\n\n\n                try{\n\n                    Mailer.send({\n                        to:  usersToEmail[i].email,           // 'To: ' address. Required.\n                        subject: \"[Buzzy] \" +resource.title,                     // Required.\n                        template: 'commentNotification',               // Required.\n                        replyTo: BuzzyGlobal.gGetUserName(user) + \" \" + topResourceID + \".\" + resourceParentID + \".\" + userID + \"@\" + Meteor.settings.MAIL_INCOMING_DOMAIN,       // Override global 'ReplyTo: ' option.\n                        //from: 'Buzzy <info@buzzy.buzz>',         // Override global 'From: ' option.\n                        from: BuzzyGlobal.gGetUserName(user) + \" \" + \"notifications@buzzy.buzz\",         // Override global 'From: ' option.\n                        data: {\n                            comment: comment,\n                            toUserEmail: usersToEmail[i].email,\n                            completedSetup: usersToEmail[i].completedSetup,\n                            toUserID: usersToEmail[i]._id,\n                            token: usersToEmail[i].token,\n                            fromUserID: user._id\n                        }\n                    });\n                } catch (err){\n                    BuzzyGlobal.throwError(err)\n                }\n\n\n\n\n            }\n\n        }\n\n        if (usersToSMS.length > 0 ){\n\n            Meteor.call(\"sendSMSTwilio\", usersToSMS,\"New Buzz \" + Meteor.absoluteUrl(\"go/\" + topResourceID), function(error){\n                if (error) {\n\n                    throw new Meteor.Error(422, error.reason);\n                }\n\n            })\n\n        }\n\n    };\n\n\n    Notifications.sendResourceNotifications =  function (thisConnection, userID, recipients,resourceID,optResourceChangeList, isNew, callback){\n        var self= this;\n        if (!userID){\n            BuzzyGlobal.throwError(\"Invalid User ID\")\n        } else {\n            var user = Users.findOne(userID);\n            if (!user){\n                BuzzyGlobal.throwError(\"Can't find user\")\n            }\n        }\n        if (!recipients){\n            BuzzyGlobal.throwError(\"Invalid Recipients\")\n        }\n        var userEmail = BuzzyGlobal.gGetUserFormattedEmail(user);\n        var usersToEmail = [];\n        var usersToSMS = [];\n\n        var usersCursor = Meteor.users.find({_id:{$in:recipients}});\n\n\n        var usersToNotify = usersCursor.forEach(function (user) {\n            if (user._id != userID && !Users.isBot(user)){\n                if (typeof user.profile.channels !== \"undefined\"){\n                    for (i in user.profile.channels){\n                        switch (user.profile.channels[i].channel){\n                            case BuzzyGlobal.gNOTIFICATION_CHANNEL.EMAIL:\n                                // don't check verified - if (user.profile.channels[i].enabled && BuzzyGlobal.gEmailIsVerified(user, user.profile.channels[i].address)){\n                                var tempToken = null;\n                                if (user.services && user.services.password && user.services.password && user.services.password.reset){\n                                    tempToken = user.services.password.reset.token;\n                                };\n                                if (user.profile.channels[i].enabled){\n                                    usersToEmail.push({\n                                        _id:user._id,\n                                        email:user.profile.channels[i].address,\n                                        completedSetup:user.completedSetup,\n                                        token: tempToken\n                                    });\n                                }\n                                break;\n                            case BuzzyGlobal.gNOTIFICATION_CHANNEL.SMS:\n                                if (user.profile.channels[i].enabled){\n                                    usersToSMS.push(user.profile.channels[i].address);\n                                };\n                                break;\n\n                        }\n                    }\n\n                }\n\n            }\n\n\n        });\n\n\n        if (usersToEmail.length > 0 ){\n\n            var resource = Resources.findOne({_id:resourceID});\n            var searchExpression = new RegExp(\"^,\"+ resourceID +\",\");\n            // currently trusing user can access all published content for resource\n            var resourceList;\n            console.log(\"optResourceChangeList\",optResourceChangeList)\n            if (typeof optResourceChangeList === \"undefined\" || optResourceChangeList.length === 0){\n                resourceList = [resourceID];\n\n            } else {\n                resourceList = optResourceChangeList;\n            };\n\n\n            for (i in usersToEmail){\n\n\n                try{\n\n                    var replyTo = 'donotreply@buzzy.buzz';\n                    var from = \"Do Not Reply\" + \"<donotreply@buzzy.buzz>\";\n\n                    if (resource.showComments === BuzzyGlobal.gCOMMENTSHOW.INLINE){\n                        replyTo = BuzzyGlobal.gGetUserName(user) + \" \" + resource._id + \".\" + resource._id + \".\" + Meteor.userId() + \"@\" + Meteor.settings.MAIL_INCOMING_DOMAIN;       // Override global 'ReplyTo: ' option.\n                        //from: 'Buzzy <info@buzzy.buzz>',         // Override global 'From: ' option\n                        from = BuzzyGlobal.gGetUserName(user) + \" \" + \"notifications@buzzy.buzz\";\n                    }\n\n                    var result = Mailer.send({\n                        to:  usersToEmail[i].email,           // 'To: ' address. Required.\n                        subject: \"[Buzzy] \" +  resource.title,                     // Required.\n                        //template: 'templateName',               // Required.\n                        template: 'resourceNotification',               // Required.\n                        replyTo: replyTo,       // Override global 'ReplyTo: ' option.\n                        from: from,         // Override global 'From: ' option.\n                        data: {\n                            toUserEmail: usersToEmail[i].email,\n                            completedSetup: usersToEmail[i].completedSetup,\n                            toUserID: usersToEmail[i]._id,\n                            token: usersToEmail[i].token,\n                            resource: resource,\n                            resourceIDs: resourceList,\n                            currentUserID:userID,\n                            isNew: isNew,\n                            fromUserID: user._id\n                            //generatedToken: generatedToken\n\n                        }\n                    });\n                    console.log(\"MAILER RESULT:\" + result);\n                } catch (err){\n                    BuzzyGlobal.throwError(err)\n                }\n\n\n\n\n            }\n\n        }\n\n        if (usersToSMS.length > 0 ){\n\n            Meteor.call(\"sendSMSTwilio\", usersToSMS,\"New Buzz \" + Meteor.absoluteUrl(\"go/\" + resourceID), function(error){\n                if (error) {\n\n                    throw new Meteor.Error(422, error.reason);\n                }\n\n            })\n\n        }\n\n    }\n\n    Notifications.sendMicroAppNotifications =  function (thisConnection, userID, recipients,resourceID,optResourceChangeList, isNew,customMessage,microAppRowID, callback){\n        var self= this;\n        if (!userID){\n            BuzzyGlobal.throwError(\"Invalid User ID\")\n        } else {\n            var user = Users.findOne(userID);\n            if (!user){\n                BuzzyGlobal.throwError(\"Can't find user\")\n            }\n        }\n        if (!recipients){\n            BuzzyGlobal.throwError(\"Invalid Recipients\")\n        }\n        var userEmail = BuzzyGlobal.gGetUserFormattedEmail(user);\n        var usersToEmail = [];\n        var usersToSMS = [];\n\n        var usersCursor = Meteor.users.find({_id:{$in:recipients}});\n\n\n        var usersToNotify = usersCursor.forEach(function (user) {\n            if (user._id != userID){\n                if (typeof user.profile.channels !== \"undefined\"){\n                    for (i in user.profile.channels){\n                        switch (user.profile.channels[i].channel){\n                            case BuzzyGlobal.gNOTIFICATION_CHANNEL.EMAIL:\n                                // don't check verified - if (user.profile.channels[i].enabled && BuzzyGlobal.gEmailIsVerified(user, user.profile.channels[i].address)){\n                                var tempToken = null;\n                                if (user.services && user.services.password && user.services.password && user.services.password.reset){\n                                    tempToken = user.services.password.reset.token;\n                                };\n                                if (user.profile.channels[i].enabled){\n                                    usersToEmail.push({\n                                        _id:user._id,\n                                        email:user.profile.channels[i].address,\n                                        completedSetup:user.completedSetup,\n                                        token: tempToken\n                                    });\n                                }\n                                break;\n                            case BuzzyGlobal.gNOTIFICATION_CHANNEL.SMS:\n                                if (user.profile.channels[i].enabled){\n                                    usersToSMS.push(user.profile.channels[i].address);\n                                };\n                                break;\n\n                        }\n                    }\n\n                }\n\n            }\n\n\n        });\n\n\n        if (usersToEmail.length > 0 ){\n\n            var resource = Resources.findOne({_id:resourceID});\n            var searchExpression = new RegExp(\"^,\"+ resourceID +\",\");\n            // currently trusing user can access all published content for resource\n            var resourceList;\n            console.log(\"optResourceChangeList\",optResourceChangeList)\n            if (typeof optResourceChangeList === \"undefined\" || optResourceChangeList.length === 0){\n                resourceList = [resourceID];\n\n            } else {\n                resourceList = optResourceChangeList;\n            };\n\n\n            for (i in usersToEmail){\n\n\n                try{\n\n                    var replyTo = 'donotreply@buzzy.buzz';\n                    var from = \"Do Not Reply\" + \"<donotreply@buzzy.buzz>\";\n\n                    if (resource.showComments === BuzzyGlobal.gCOMMENTSHOW.INLINE){\n                        replyTo = BuzzyGlobal.gGetUserName(user) + \" \" + resource._id + \".\" + resource._id + \".\" + Meteor.userId() + \"@\" + Meteor.settings.MAIL_INCOMING_DOMAIN;       // Override global 'ReplyTo: ' option.\n                        //from: 'Buzzy <info@buzzy.buzz>',         // Override global 'From: ' option\n                        from = BuzzyGlobal.gGetUserName(user) + \" \" + \"notifications@buzzy.buzz\";\n                    }\n\n                    var result = Mailer.send({\n                        to:  usersToEmail[i].email,           // 'To: ' address. Required.\n                        subject: customMessage,                     // Required.\n                        //template: 'templateName',               // Required.\n                        template: 'microAppNotification',               // Required.\n                        replyTo: replyTo,       // Override global 'ReplyTo: ' option.\n                        from: from,         // Override global 'From: ' option.\n                        data: {\n                            toUserEmail: usersToEmail[i].email,\n                            completedSetup: usersToEmail[i].completedSetup,\n                            toUserID: usersToEmail[i]._id,\n                            token: usersToEmail[i].token,\n                            resource: resource,\n                            resourceIDs: resourceList,\n                            currentUserID:userID,\n                            isNew: isNew,\n                            fromUserID: user._id,\n                            microAppRowID: microAppRowID\n                            //generatedToken: generatedToken\n\n                        }\n                    });\n                    console.log(\"MAILER RESULT:\" + result);\n                } catch (err){\n                    BuzzyGlobal.throwError(err)\n                }\n\n\n\n\n            }\n\n        }\n\n        if (usersToSMS.length > 0 ){\n\n            Meteor.call(\"sendSMSTwilio\", usersToSMS,\"New Buzz \" + Meteor.absoluteUrl(\"go/\" + resourceID), function(error){\n                if (error) {\n\n                    throw new Meteor.Error(422, error.reason);\n                }\n\n            })\n\n        }\n\n    }\n\n    Meteor.methods({\n        createCommentNotification: function (comment, topResourceID, resourceParentID, truncatedText, optOldToUsers) {\n            if (typeof comment === \"undefined\" || !comment || comment._id === null || typeof comment.userID === \"undefined\" || !comment.userID) {\n                BuzzyGlobal.throwError(\"Invalid data for Notification!\");\n            }\n            var user = Users.findOne(comment.userID);\n            if (!user) {\n                BuzzyGlobal.throwError(\"user must be logged in to comment\");\n            }\n\n            var resource = Resources.findOne(topResourceID);// come back to look at children notifications later, for now do for parent\n            if (!resource) {\n                BuzzyGlobal.throwError(\"Resource not found!\");\n            }\n\n\n            var activity = {\n                \"actor\": {\n                    \"objectType\": \"person\",\n                    \"displayName\": BuzzyGlobal.gGetUserName(user)\n                },\n                \"verb\": \"post\",\n                \"object\": {\n                    \"objectType\": \"comment\",\n                    \"commentID\": comment._id,\n                    \"content\": truncate(comment.message, BuzzyGlobal.gCOMMENT_TRUNCATE)\n                },\n                \"target\": {\n                    \"objectType\": \"resource\",\n                    \"displayName\": resource.title\n\n                }\n            };\n\n\n            var followerList = [];\n            var tempOldToList = [];\n            if (typeof optOldToUsers !== \"undefined\") {\n                tempOldToList = optOldToUsers;\n            }\n\n            var followers;\n            if (typeof comment.toUsers !== \"undefined\" && comment.toUsers) {\n                followers = ResourceFollowers.find(\n                    {\n                        $and: [\n                            {resourceID: resource._id},\n                            {userID: {$in: comment.toUsers}}\n                        ]\n                    }\n                );\n            } else {\n                followers = ResourceFollowers.find({resourceID: resource._id});\n            }\n\n            if (followers) {\n                followers.forEach(function (follower) {\n\n                    if (follower.userID && typeof follower.userID !== \"undefined\" && follower.userID !== comment.userID) {\n                        var currActivity = activity;\n                        currActivity.verb = \"post\";\n                        var currentAction = BuzzyGlobal.gACTIONS.COMMENTED;\n                        if (tempOldToList.indexOf(follower.userID) !== -1) {\n                            currActivity.verb = \"sent to all\";\n                            currentAction = BuzzyGlobal.gACTIONS.SENT_TO_ALL;\n                        }\n                        followerList.push(follower.userID);\n                        Notifications.insert({\n                            _id: new Meteor.Collection.ObjectID()._str,\n                            forUserID: follower.userID,\n                            byUserID: user._id,\n                            action: currentAction,\n                            target: topResourceID,\n                            activity: currActivity,\n                            //resourceID: resource._id,\n                            resourceID: resourceParentID,\n                            commentID: comment._id,\n                            commenterName: comment.author,\n                            read: false,\n                            submitted: new Date().getTime()\n\n\n                        });\n\n                        Push.send({\n                            from: activity.actor.displayName,\n                            title: activity.target.displayName,\n                            text: activity.actor.displayName + ': ' + truncatedText + \"...\",\n                            badge: Meteor.call(\"gNotificationsUnreadForUserID\", follower.userID), // need get notifications count for user\n                            sound: 'yes',\n                            query: {\n                                userId: follower.userID\n                            }\n                        });\n                    }\n\n\n                });\n            }\n            if (followerList.length > 0) {\n\n                Notifications.sendNotifications(user._id, followerList, comment.message, topResourceID, resourceParentID, comment._id, function (error, id) {\n                    if (error) {\n                        throw new Meteor.Error(422, error.reason);\n                    }\n                });\n\n            }\n\n        },\n        createCommentNotificationAuthorsAndOwners: function (comment, topResourceID, resourceParentID, truncatedText) {\n\n            var user = Users.findOne(comment.userID);\n            if (!user)\n                BuzzyGlobal.throwError(\"user must be logged in to comment\");\n            var resource = Resources.findOne(topResourceID);// come back to look at children notifications later, for now do for parent\n            if (!resource)\n                BuzzyGlobal.throwError(\"Resource not found!\")\n            if (typeof comment === \"undefined\" || !comment || comment._id === null) {\n                BuzzyGlobal.throwError(\"Invalid Date for Notification!\");\n            }\n\n\n            var activity = {\n                \"actor\": {\n                    \"objectType\": \"person\",\n                    \"displayName\": BuzzyGlobal.gGetUserName(user)\n                },\n                \"verb\": \"post\",\n                \"object\": {\n                    \"objectType\": \"comment\",\n                    \"commentID\": comment._id,\n                    \"content\": truncate(comment.message, BuzzyGlobal.gCOMMENT_TRUNCATE)\n                },\n                \"target\": {\n                    \"objectType\": \"resource\",\n                    \"displayName\": resource.title\n\n                }\n            };\n\n            var followerList = [];\n\n            var followers;\n            if (typeof comment.toUsers !== \"undefined\" && comment.toUsers) {\n                followers = ResourceFollowers.find(\n                    {\n                        $and: [\n                            {resourceID: resource._id},\n                            {userID: {$in: comment.toUsers}}\n                        ]\n                    }\n                );\n            } else {\n                followers = ResourceFollowers.find({resourceID: resource._id});\n            }\n\n\n            if (followers) {\n                followers.forEach(function (follower) {\n                    if (follower.userID && typeof follower.userID !== \"undefined\" && follower.userID !== comment.userID && (Resources.canEdit(follower.userID, resource))) {\n                        followerList.push(follower.userID);\n                        Notifications.insert({\n                            _id: new Meteor.Collection.ObjectID()._str,\n                            forUserID: follower.userID,\n                            byUserID: user._id,\n                            action: BuzzyGlobal.gACTIONS.COMMENTED,\n                            target: topResourceID,\n                            activity: activity,\n                            //resourceID: resource._id,\n                            resourceID: resourceParentID,\n                            commentID: comment._id,\n                            commenterName: comment.author,\n                            read: false,\n                            submitted: new Date().getTime()\n\n                        });\n\n                        Push.send({\n                            from: activity.actor.displayName,\n                            title: activity.target.displayName,\n                            text: activity.actor.displayName + ': ' + truncatedText + \"...\",\n                            badge: Meteor.call(\"gNotificationsUnreadForUserID\", follower.userID), // need get notifications count for user\n                            sound: 'yes',\n                            query: {\n                                userId: follower.userID\n                            }\n                        });\n                    }\n\n\n                });\n            }\n            if (followerList.length > 0) {\n\n                Notifications.sendNotifications(user._id, followerList, comment.message, topResourceID, resourceParentID, comment._id, function (error, id) {\n                    if (error) {\n                        throw new Meteor.Error(422, error.reason);\n                    }\n                });\n\n            }\n\n        },\n        gNotificationsUnreadForUserID: function (userID) {\n            return Notifications.find({forUserID: userID, read: false}).count();\n        },\n\n        markAllNotificationsRead: function () {\n            console.log(\"about to mark all notifications read for:\" + this.userId);\n            if (this.userId) {\n                Notifications.update({read: false, forUserID: this.userId}, {$set: {read: true}}, {multi: true});\n\n            }\n\n\n        },\n        markAllNotificationsReadResource: function (resourceID) {\n            console.log(\"about to mark all notifications read for:\" + this.userId);\n            if (this.userId) {\n                Notifications.update(\n                    {\n                        $and: [\n                            {read: false},\n                            {forUserID: Meteor.userId()},\n                            {resourceID: resourceID},\n                            {\"action.type\": {$ne: BuzzyGlobal.gACTIONS.COMMENTED.type}}\n                        ]\n                    },\n                    {$set: {read: true}}, {multi: true});\n            }\n        },\n\n        sendSMSTwilio: function (recipeints, message) {\n            console.log(\"about to send Twilio message\");\n            var accountSid = 'ACcc929741c9fc7003bde8860e366f26f2';\n            var authToken = 'eaea7ac98545c992280d68aa096f9db6';\n\n\n            twilio = Twilio(accountSid, authToken);\n            for (i in recipeints) {\n                console.log(\"SMS#:\" + recipeints[i]);\n                twilio.sendSms({\n                    to: recipeints[i], // Any number Twilio can deliver to\n                    //from: '+12054902732', // A number you bought from Twilio and can use for outbound communication\n                    from: '+61438062451', // A number you bought from Twilio and can use for outbound communication\n                    body: message, // body of the SMS message\n                    mediaUrl: \"https://buzzy.buzz\"\n                }, function (err, responseData) { //this function is executed when a response is received from Twilio\n                    if (!err) { // \"err\" is an error received during the request, if any\n                        // \"responseData\" is a JavaScript object containing data received from Twilio.\n                        // A sample response from sending an SMS message is here (click \"JSON\" to see how the data appears in JavaScript):\n                        // http://www.twilio.com/docs/api/rest/sending-sms#example-1\n                        console.log(responseData.from); // outputs \"+14506667788\"\n                        console.log(responseData.body); // outputs \"word to your mother.\"\n                    }\n                });\n\n            }\n\n        },\n        createResourceNotification: function (parentResourceID, action) {\n            var self = this;\n            //var resource = Resources.findOne(comment.resourceParentID);\n            var resource = Resources.findOne(parentResourceID);// come back to look at children notifications later, for now do for parent\n            var emailRecipients = [];\n            var user = Meteor.user();\n            if (!user) {\n                BuzzyGlobal.throwError(\"you need to login to create resources\")\n            }\n            if (!resource) {\n                BuzzyGlobal.throwError(\"Resource not found: \" + parentResourceID);\n            }\n\n\n            var activity = {\n                \"actor\": {\n                    \"objectType\": \"person\",\n                    \"displayName\": BuzzyGlobal.gGetUserName(user)\n                },\n                \"verb\": \"post\",\n                \"object\": {\n                    \"objectType\": \"resource\",\n                    \"resourceID\": resource._id,\n                    \"displayName\": resource.title\n                },\n                \"target\": {\n                    \"objectType\": \"resource\",\n                    \"displayName\": resource.title\n                }\n            };\n\n\n            var followers = ResourceFollowers.find({resourceID: resource._id});\n            if (followers) {\n\n                followers.forEach(function (follower) {\n\n                    emailRecipients.push(follower.userID);\n                    if (follower.userID && (follower.userID !== user._id)) {\n                        emailRecipients.push(follower.userID);\n\n                        Notifications.insert({\n                            _id: new Meteor.Collection.ObjectID()._str,\n                            forUserID: follower.userID,\n                            byUserID: user._id,\n                            action: action,\n                            target: parentResourceID,\n                            activity: activity,\n                            //resourceID: resource._id,\n                            resourceID: resource._id, // insert for parent not actual resource ID, may need to come back to this\n                            commentID: null,\n                            commenterName: user.profile.name,\n                            read: false,\n                            submitted: new Date().getTime()\n                        });\n\n                    }\n                    if (follower.userID && typeof follower.userID !== \"undefined\" && follower.userID !== user._id) {\n                        console.log({\n                            from: activity.actor.displayName,\n                            title: \"Some title\",\n                            text: activity.verb + \"ed \" + activity.target.displayName,\n                            badge: Meteor.call(\"gNotificationsUnreadForUserID\", follower.userID), // get notifications count for user\n                            sound: 'yes',\n                            query: {\n                                userId: follower.userID\n                            }\n\n                        });\n                        Push.send({\n                            from: activity.actor.displayName,\n                            title: \"Some title\",\n                            text: activity.verb + \"ed \" + activity.target.displayName,\n                            badge: Meteor.call(\"gNotificationsUnreadForUserID\", follower.userID), // get notifications count for user\n                            sound: 'yes',\n                            query: {\n                                userId: follower.userID\n                            }\n\n                        });\n\n                    }\n                    Meteor.call(\"addToInvitedList\", follower.userID, \"testOrigin\", resource.title);\n\n\n                });\n\n            }\n\n            if (emailRecipients.length > 0) {\n                console.log(\"EMAIL RECIP:\", emailRecipients);\n\n                Notifications.sendResourceNotifications(self.connection, user._id, emailRecipients, parentResourceID, [], true, function (error, id) {\n                    if (error) {\n\n                        console.log(\"sendNotification error:\", error);\n                        //throw new Meteor.Error(422, error.reason);\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n\n        },\n        createResourceChangeNotification: function (parentResourceID, resourceIDs, action) {\n            var self = this;\n            //var resource = Resources.findOne(comment.resourceParentID);\n            if (!parentResourceID || !resourceIDs) {\n                BuzzyGlobal.throwError(\"Create Change Notification invalid params!\")\n            }\n            var resource = Resources.findOne(parentResourceID);// come back to look at children notifications later, for now do for parent\n            if (!resource) {\n                BuzzyGlobal.throwError(\"Can't find resource!\")\n            }\n            var emailRecipients = [];\n            var user = Meteor.user();\n            if (!user) {\n                BuzzyGlobal.throwError(\"you need to login to create resources\")\n            }\n            if (!resource) {\n                BuzzyGlobal.throwError(\"Resource not found: \" + parentResourceID);\n            }\n\n            if (!Resources.canEdit(user._id, resource)) {\n                BuzzyGlobal.throwError(\"Sorry you don't have the rights to do that!\")\n            }\n\n            // this is a hack to remove the issue of the router not re-initalizing the changelist,\n            // so just remove any resourceID that are not a child of the curent Resource\n            var searchExpression = new RegExp(',' + parentResourceID + ',');\n            var resourceCursor = Resources.find({path: searchExpression});\n            var arrayChildren = [];\n            if (resourceCursor) {\n                arrayChildren = resourceCursor.map(function (aResource) {\n                    return aResource._id\n                })\n            }\n\n\n            var validResourcesIDs = [];\n            if (arrayChildren) {\n                validResourcesIDs = _.intersection(arrayChildren, resourceIDs);\n            }\n\n\n            if (validResourcesIDs.length > 0) {\n                var activity = {\n                    \"actor\": {\n                        \"objectType\": \"person\",\n                        \"displayName\": BuzzyGlobal.gGetUserName(user)\n                    },\n                    \"verb\": \"chang\",\n                    \"object\": {\n                        \"objectType\": \"resource\",\n                        \"resourceID\": resource._id,\n                        \"displayName\": resource.title\n                    },\n                    \"target\": {\n                        \"objectType\": \"resource\",\n                        \"displayName\": resource.title\n                    }\n                };\n\n\n                Notifications.insert({\n                    _id: new Meteor.Collection.ObjectID()._str,\n                    forUserID: resource.userID,\n                    byUserID: user._id,\n                    action: action,\n                    target: parentResourceID,\n                    activity: activity,\n                    //resourceID: resource._id,\n                    resourceID: resource._id, // insert for parent not actual resource ID, may need to come back to this\n                    commentID: null,\n                    commenterName: user.profile.name,\n                    read: true,\n                    submitted: new Date().getTime()\n                });\n\n                if (user._id !== resource.userID) {\n\n                    emailRecipients.push(resource.userID);\n                }\n                ;\n\n                var followers = ResourceFollowers.find({resourceID: resource._id});\n                if (followers) {\n\n                    followers.forEach(function (follower) {\n\n                        emailRecipients.push(follower.userID);\n                        if ((follower.userID !== user._id) && (follower.userID !== resource.userID)) {\n                            emailRecipients.push(follower.userID);\n\n                            Notifications.insert({\n                                _id: new Meteor.Collection.ObjectID()._str,\n\n                                forUserID: follower.userID,\n                                byUserID: user._id,\n                                action: action,\n                                target: parentResourceID,\n                                activity: activity,\n                                //resourceID: resource._id,\n                                resourceID: resource._id, // insert for parent not actual resource ID, may need to come back to this\n                                commentID: null,\n                                commenterName: user.profile.name,\n                                read: false,\n                                submitted: new Date().getTime()\n                            });\n\n                            //console.log(\"about to push to \" + user.profile.name + \" follower: \" + follower.userID);\n\n                        }\n                        if (follower.userID && typeof follower.userID !== \"undefined\" && follower.userID !== user._id) {\n                            console.log({\n                                from: activity.actor.displayName,\n                                title: \"Some title\",\n                                text: activity.verb + \"ed \" + activity.target.displayName,\n                                badge: Meteor.call(\"gNotificationsUnreadForUserID\", follower.userID), // get notifications count for user\n                                sound: 'yes',\n                                query: {\n                                    userId: follower.userID\n                                }\n\n                            })\n                            Push.send({\n                                from: activity.actor.displayName,\n                                title: \"Some title\",\n                                text: activity.verb + \"ed \" + activity.target.displayName,\n                                badge: Meteor.call(\"gNotificationsUnreadForUserID\", follower.userID), // get notifications count for user\n                                sound: 'yes',\n                                query: {\n                                    userId: follower.userID\n                                }\n\n                            });\n\n\n                        }\n\n                    });\n\n                }\n\n                if (emailRecipients.length > 0) {\n\n\n                    Notifications.sendResourceNotifications(self.connection, user._id, emailRecipients, parentResourceID, resourceIDs, false, function (error, id) {\n                        if (error) {\n\n                            console.log(\"sendNotification error:\", error);\n                            //throw new Meteor.Error(422, error.reason);\n                            BuzzyGlobal.throwError(error);\n                        }\n                    });\n\n                }\n\n            }\n\n\n        },\n        createSingleUserResourceNotification: function (recipientUserID, parentResourceID, action, activity, optUserToken) {\n            var self = this;\n\n            if (!recipientUserID || !parentResourceID || !activity) {\n                throw BuzzyGlobal.throwError(\"Invalid Params\");\n            }\n            var resource = Resources.findOne({_id: parentResourceID});// come back to look at children notifications later, for now do for parent\n            var emailRecipients = [];\n            var user = BuzzyGlobal.getCurrentUser(optUserToken);\n            if (!user || !resource || (action !== \"transfer\" && !Resources.canEdit(user._id, resource)) || (action === \"transfer\" && !Resources.canView(user._id, resource))) {\n                BuzzyGlobal.throwError(\"You do not have the rights to do this!\")\n            }\n            if (!resource) {\n                BuzzyGlobal.throwError(\"Resource not found: \" + parentResourceID);\n            }\n\n\n            Notifications.insert({\n                _id: new Meteor.Collection.ObjectID()._str,\n                forUserID: user._id,\n                byUserID: user._id,\n                action: action,\n                target: parentResourceID,\n                activity: activity,\n                //resourceID: resource._id,\n                resourceID: resource._id, // insert for parent not actual resource ID, may need to come back to this\n                commentID: null,\n                commenterName: user.profile.name,\n                read: true,\n                submitted: new Date().getTime()\n            });\n\n            if (recipientUserID && typeof recipientUserID !== \"undefined\" && user._id !== recipientUserID) {\n                Notifications.insert({\n                    _id: new Meteor.Collection.ObjectID()._str,\n                    forUserID: recipientUserID,\n                    byUserID: user._id,\n                    action: action,\n                    target: parentResourceID,\n                    activity: activity,\n                    //resourceID: resource._id,\n                    resourceID: resource._id, // insert for parent not actual resource ID, may need to come back to this\n                    commentID: null,\n                    commenterName: user.profile.name,\n                    read: false,\n                    submitted: new Date().getTime()\n                });\n\n            }\n\n            var msgText = \"\";\n\n            switch (action) {\n                case \"transfer\":\n                    msgText = activity.verb + \"ed \" + activity.object.currency + \" \" + BuzzyGlobal.formatCurrency(activity.object.amount / 100) + \" #\" + activity.object.receipt_number;\n                    break;\n                default:\n                    msgText = activity.verb + \"ed \" + activity.target.displayName;\n            }\n\n            if (recipientUserID && typeof recipientUserID !== \"undefined\") {\n                Push.send({\n                    from: activity.actor.displayName,\n                    title: \"Some title\",\n                    text: msgText,\n                    badge: Meteor.call(\"gNotificationsUnreadForUserID\", recipientUserID), // get notifications count for user\n                    sound: 'yes',\n                    query: {\n                        userId: recipientUserID\n                    }\n\n                });\n\n                Meteor.call(\"addToInvitedList\", recipientUserID, \"testOrigin\", resource.title);\n\n\n                Notifications.sendResourceNotifications(self.connection, user._id, [recipientUserID], parentResourceID, [], true, function (error, id) {\n                    if (error) {\n\n                        console.log(\"sendNotification error:\", error);\n                        //throw new Meteor.Error(422, error.reason);\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n            }\n\n\n        },\n        paymentNotifications: function (resourceID) {\n            check(resourceID, String);\n\n            var resource = Resources.findOne({_id: resourceID});\n\n            if (resource && Meteor.userId() && Resources.canEdit(Meteor.userId(), resource)) {\n\n                var results = Notifications.find({\n                    \"activity.object.resource_button_id\": resourceID,\n                    forUserID: resource.content.payment.recipientID\n                }, {sort: {submitted: -1}}).map(function (notification) {\n\n                    return {\n                        byUserID: notification.byUserID,\n                        emailaddress: notification.byUserID ? BuzzyGlobal.gEmailforUserID(notification.byUserID) : notification.activity.actor.displayName,\n                        currency: (notification.activity.object.currency),\n                        amount: (notification.activity.object.amount),\n                        charge_id: notification.activity.object.charge_id,\n                        submitted: notification.submitted\n                    };\n                });\n                return results;\n            } else {\n                BuzzyGlobal.throwError(\"Sorry! Invalid Params to Perform request\");\n            }\n        },\n        paymentNotificationsMicroApp: function (appID, fieldID) {\n\n            check(appID, String);\n            check(fieldID, String);\n\n\n            var currentDataItem = MicroAppData.findOne({_id: appID});\n            var resource = Resources.findOne({_id: currentDataItem.parentResourceID});\n            var currentPaymentItem = MicroAppData.currentDataItemField(currentDataItem, fieldID)\n\n\n            if (currentPaymentItem && resource && Meteor.userId() && Resources.canEdit(Meteor.userId(), resource)) {\n\n                var results = Notifications.find(\n                    {\n                        \"activity.object.microAppField.appID\": appID,\n                        \"activity.object.microAppField.fieldID\": fieldID,\n                        forUserID: currentPaymentItem.value.payment.recipientID\n                    },\n                    {sort: {submitted: -1}})\n                    .map(function (notification) {\n\n                        return {\n                            byUserID: notification.byUserID,\n                            emailaddress: notification.byUserID ? BuzzyGlobal.gEmailforUserID(notification.byUserID) : notification.activity.actor.displayName,\n                            currency: (notification.activity.object.currency),\n                            amount: (notification.activity.object.amount),\n                            charge_id: notification.activity.object.charge_id,\n                            submitted: notification.submitted\n                        };\n                    });\n                console.log(\"IN paymentNotifications:\", results)\n                return results;\n            } else {\n                BuzzyGlobal.throwError(\"Sorry! Invalid Params to Perform request\");\n            }\n        },\n\n        actionRuleNotificationsMicroApp: function (fieldData,embeddingResourceID,  optUserToken) {\n            var self = this;\n\n            check(fieldData, Object);\n            check(embeddingResourceID, String);\n\n\n            var getFieldVal = function (contentArray, fieldID) {\n                var item = contentArray.find(function (element) {\n                    return  element._id === fieldID;\n                })\n                return (item && typeof item !== \"undefined\" && typeof item.value !== \"undefined\" && item.value) ? item.value : null;\n            };\n\n\n            var user = BuzzyGlobal.getCurrentUser(optUserToken);\n            var microAppResource = Resources.findOne({_id: fieldData.parentResourceID});\n            var docParentID = Resources.gGetTopParentFromPath(microAppResource.path);\n            var resource = Resources.findOne({_id:docParentID});\n            var embeddingResource;\n            if (docParentID !== embeddingResourceID){\n                embeddingResource = Resources.findOne({_id:embeddingResourceID});\n            }\n\n            if (!user || !resource || !microAppResource || !Resources.canAddRow(microAppResource)) {\n                BuzzyGlobal.throwError(\"You do not have the rights to do this!\")\n            }\n\n\n\n            /* COME BACK TO THIS MORE COMPLEX THAN JUST ADD ... need CAN EDIT MICROAPP FIELD TOO\n             if (!Resources.canAddRow(resource) && Resources.can){\n             BuzzyGlobal.throwError(\"Sorry you don't have the rights to do that!\")\n             }*/\n\n\n            var activity = {\n                \"actor\": {\n                    \"objectType\": \"person\",\n                    \"displayName\": BuzzyGlobal.gGetUserName(user)\n                },\n                \"verb\": \"undefined\",\n                \"object\": {\n                    \"objectType\": \"resource\",\n                    \"resourceID\": resource._id,\n                    \"displayName\": resource.title,\n                    \"message\": \"undefined\"\n                },\n                \"target\": {\n                    \"objectType\": \"resource\",\n                    \"displayName\": resource.title\n                }\n            };\n\n            var emailRecipients = [];\n\n            var fieldLabelsArray = MicroAppFields.find({parentResourceID:fieldData.parentResourceID}).map(function (field) {\n                if (field.label){\n                    return field.label;\n                }\n            })\n\n            var currentActionRules = MicroAppActionRules.find({parentResourceID: fieldData.parentResourceID}).map(function (rule) {\n                activity.verb = rule.condition;\n\n                for (j in fieldLabelsArray){\n                    var currentField = MicroAppFields.findOne({parentResourceID: fieldData.parentResourceID, label:fieldLabelsArray[j]});\n                    var fieldVal = \"\";\n                    switch (currentField.fieldType){\n                        case BuzzyGlobal.gAPPFIELDTYPE.AUTHOR:\n                            fieldVal = BuzzyGlobal.gGetUserName(user);\n                            break;\n                        case BuzzyGlobal.gAPPFIELDTYPE.SUBMITTED:\n                            fieldVal = BuzzyGlobal.gFormatDate(fieldData.submitted);\n                            break;\n                        default:\n                            fieldVal = getFieldVal(fieldData.content,currentField._id);\n                    }\n\n                    rule.message = rule.message.replace(\"[\" + fieldLabelsArray[j] + \"]\",fieldVal);\n                }\n\n                activity.object.message = rule.message;\n\n\n                var targetedUsers = [];\n\n                for (i in rule.target) {\n\n\n\n                    switch (rule.target[i]){\n                        case BuzzyGlobal.gROLES.OWNER:\n                            emailRecipients =  _.without(emailRecipients.concat(resource.owners,(embeddingResource?embeddingResource.owners:[])),Meteor.userId());\n\n                            break;\n                        case BuzzyGlobal.gROLES.AUTHOR:\n                            emailRecipients =  _.without(emailRecipients.concat(resource.editors, (embeddingResource?embeddingResource.editors:[])),Meteor.userId());\n\n                            break;\n                        case BuzzyGlobal.gROLES.AUDIENCE:\n                            emailRecipients =  _.without(emailRecipients.concat(resource.readers, (embeddingResource?embeddingResource.readers:[])),Meteor.userId());\n\n                            break;\n                        case BuzzyGlobal.gROLES.FOLLOWER:\n                            var resourceFollowers = ResourceFollowers.find({resourceID:resource._id}).map(function(follower){\n                                return follower.userID;});\n                            var embeddingResourceFollowers = [];\n                            if (embeddingResource){\n                                embeddingResourceFollowers = ResourceFollowers.find({resourceID:embeddingResource._id}).map(function(follower){\n                                    return follower.userID;});\n                            }\n\n\n                            emailRecipients = _.without(\n                                emailRecipients.concat(resourceFollowers, embeddingResourceFollowers),\n                                Meteor.userId());\n\n                            break;\n                        default:\n                            emailRecipients.push(rule.target[i]);\n                    }\n\n                }\n                for (k in emailRecipients){\n                    Notifications.insert({\n                        _id: new Meteor.Collection.ObjectID()._str,\n                        forUserID: emailRecipients[k],\n                        byUserID: user._id,\n                        action: activity.verb,\n                        target: resource._id,\n                        activity: activity,\n                        //resourceID: resource._id,\n                        resourceID: resource._id, // insert for parent not actual resource ID, may need to come back to this\n                        commentID: null,\n                        commenterName: user.profile.name,\n                        read: false,\n                        submitted: new Date().getTime()\n                    });\n\n                    if (emailRecipients[k] && emailRecipients[k] !== user._id) {\n\n                        Push.send({\n                            from: activity.actor.displayName,\n                            title: resource.title,\n                            text: rule.message,\n                            badge: Meteor.call(\"gNotificationsUnreadForUserID\", emailRecipients[k]), // get notifications count for user\n                            sound: 'yes',\n                            query: {\n                                userId: emailRecipients[k]\n                            }\n                        });\n                    }\n\n                }\n\n\n\n\n                if (emailRecipients && emailRecipients.length > 0) {\n\n                    Notifications.sendMicroAppNotifications(self.connection, user._id, emailRecipients, fieldData.parentResourceID, [], false, rule.message,fieldData._id, function (error, id) {\n                        if (error) {\n\n                            console.log(\"sendNotification error:\", error);\n                            //throw new Meteor.Error(422, error.reason);\n                            BuzzyGlobal.throwError(error);\n                        }\n                    });\n\n                }\n\n\n            });\n\n\n\n        },\n        viewerNotificationsMicroApp: function (appResourceID, newViewers, optUserToken) {\n            var self = this;\n\n            check(appResourceID, String);\n\n\n            var user = BuzzyGlobal.getCurrentUser(optUserToken);\n            var resource = Resources.findOne({_id: appResourceID});\n\n            if (!user || !resource || !Resources.canAddRow(resource)) {\n                BuzzyGlobal.throwError(\"You do not have the rights to do this!\")\n            }\n\n            /* COME BACK TO THIS MORE COMPLEX THAN JUST ADD ... need CAN EDIT MICROAPP FIELD TOO\n             if (!Resources.canAddRow(resource) && Resources.can){\n             BuzzyGlobal.throwError(\"Sorry you don't have the rights to do that!\")\n             }*/\n\n\n            var activity = {\n                \"actor\": {\n                    \"objectType\": \"person\",\n                    \"displayName\": BuzzyGlobal.gGetUserName(user)\n                },\n                \"verb\": \"undefined\",\n                \"object\": {\n                    \"objectType\": \"resource\",\n                    \"resourceID\": resource._id,\n                    \"displayName\": resource.title,\n                    \"message\": \"Assigned you to resource\"\n                },\n                \"target\": {\n                    \"objectType\": \"resource\",\n                    \"displayName\": resource.title\n                }\n            };\n\n            var emailRecipients = [];\n\n            for (i in newViewers) {\n                Notifications.insert({\n                    _id: new Meteor.Collection.ObjectID()._str,\n                    forUserID: newViewers[i],\n                    byUserID: user._id,\n                    action: \"assigned\",\n                    target: appResourceID,\n                    activity: activity,\n                    //resourceID: resource._id,\n                    resourceID: resource._id, // insert for parent not actual resource ID, may need to come back to this\n                    commentID: null,\n                    commenterName: user.profile.name,\n                    read: false,\n                    submitted: new Date().getTime()\n                });\n\n                if (newViewers[i] && newViewers[i] !== user._id) {\n\n                    Push.send({\n                        from: activity.actor.displayName,\n                        title: resource.title,\n                        text: \"Assigned you to item\",\n                        badge: Meteor.call(\"gNotificationsUnreadForUserID\", newViewers[i]), // get notifications count for user\n                        sound: 'yes',\n                        query: {\n                            userId: newViewers[i]\n                        }\n                    });\n                }\n\n                emailRecipients.push(newViewers[i]);\n            }\n\n            if (emailRecipients && emailRecipients.length > 0) {\n\n                Notifications.sendResourceNotifications(self.connection, user._id, emailRecipients, appResourceID, [], false, function (error, id) {\n                    if (error) {\n\n                        console.log(\"sendNotification error:\", error);\n                        //throw new Meteor.Error(422, error.reason);\n                        BuzzyGlobal.throwError(error);\n                    }\n                });\n\n            }\n\n\n        }\n    });\n}\n\n","/**\n * Created by adamginsburg on 27/03/2015.\n */\n//var createsend = Meteor.npmRequire('createsend-node');\n/*var createsend = Npm.require('createsend-node');\n\n\nvar auth = { apiKey: '75767a68d775a784aa271ae40d1e57c5' };\nvar api = new createsend(auth);*/\n/*api.account.getClients(\n    function (err, clientList) {\n        console.log(\"clientList\", clientList.subscribers);\n    }\n);*/\n\n\nMeteor.methods({\n    addCMSubscriber: function(email, marketingOrigin){\n\n\n\n\n        HTTP.call(\"POST\", \"https://api.createsend.com/api/v3.1/subscribers/5cf39ecefe621f50b2b327afd363ce07.json\",\n            {\n                auth:'75767a68d775a784aa271ae40d1e57c5:x',\n                data:{\n                    \"EmailAddress\": email,\n                    \"CustomFields\": [\n                        {\n                            \"Key\": \"marketingOrigin\",\n                            \"Value\": marketingOrigin\n                        }\n                    ],\n\n                    /*\"Name\": \"New Subscriber\",\n                    CustomFields\": [\n                        {\n                            \"Key\": \"website\",\n                            \"Value\": \"http://example.com\"\n                        },\n                        {\n                            \"Key\": \"interests\",\n                            \"Value\": \"magic\"\n                        },\n                        {\n                            \"Key\": \"interests\",\n                            \"Value\": \"romantic walks\"\n                        }\n                    ],*/\n                    \"Resubscribe\": true,\n                    \"RestartSubscriptionBasedAutoresponders\": true\n                }\n\n            },\n\n            function (error, result) {\n                if (!error) {\n                    return;\n                    //console.log(\"result.uri:\", result);\n                } else {\n                    console.log(\"error:\" , error)\n                }\n            }\n        );\n\n    },\n    sendWelcomeEmail: function(marketingOrigin){\n\n        if (!Meteor.userId()){\n            BuzzyGlobal.throwError(\"You need to be logged in to send Welcome Email\");\n        }\n        var user = Meteor.user();\n        var email = BuzzyGlobal.gGetUserEmail(user);\n        var name = BuzzyGlobal.gGetUserName(user);\n        HTTP.call(\"POST\", \"https://api.createsend.com/api/v3.1/subscribers/bd3da2f3fb84fb0b4f0a1fa35d3ee21d.json\",\n            {\n                auth:'75767a68d775a784aa271ae40d1e57c5:x',\n                data:{\n                    \"EmailAddress\": email,\n                    \"Name\":name,\n                    \"CustomFields\": [\n                        {\n                            \"Key\": \"marketingOrigin\",\n                            \"Value\": marketingOrigin\n                        }\n                    ],\n\n                    /*\"Name\": \"New Subscriber\",\n                     CustomFields\": [\n                     {\n                     \"Key\": \"website\",\n                     \"Value\": \"http://example.com\"\n                     },\n                     {\n                     \"Key\": \"interests\",\n                     \"Value\": \"magic\"\n                     },\n                     {\n                     \"Key\": \"interests\",\n                     \"Value\": \"romantic walks\"\n                     }\n                     ],*/\n                    \"Resubscribe\": true,\n                    \"RestartSubscriptionBasedAutoresponders\": true\n                }\n\n            },\n\n            function (error, result) {\n                if (!error) {\n                    return;\n                    //console.log(\"result.uri:\", result);\n                } else {\n                    console.log(\"error:\" , error)\n                }\n            }\n        );\n\n    },\n    addToInvitedList: function(userID, marketingOrigin,  optResourceTitle){\n\n        /*if (!Meteor.userId()){\n            BuzzyGlobal.throwError(\"You need to be logged in to send Welcome Email\");\n        }*/\n        var user = Users.findOne({_id:userID});\n        if (!user){\n            BuzzyGlobal.throwError(\"Can't find user\");\n        }\n\n        if (user.dateUserInvited === null && typeof user.services !== \"undefined\" && typeof user.services.password !== \"undefined\" && typeof user.services.password.reset !== \"undefined\" && typeof user.services.password.reset.token !== \"undefined\"){\n            var inviteURL;\n            if ((typeof user.invitingResourceID !== \"undefined\") && user.invitingResourceID){\n                inviteURL = Meteor.absoluteUrl('regopassword/1/?token=' + user.services.password.reset.token + \"&top=\" + user.invitingResourceID + \"&sub=\" + user.invitingResourceID + \"&user=\" + user._id);\n            } else if ((typeof user.createTemplateID !== \"undefined\") && user.createTemplateID){\n                inviteURL = Meteor.absoluteUrl('regopassword/1/?token=' + user.services.password.reset.token + \"&template=\" + user.createTemplateID  + \"&user=\" + user._id);\n            } else {\n\n                inviteURL = Meteor.absoluteUrl('regopassword/1/?token=' + user.services.password.reset.token + \"&user=\" + user._id);\n\n            }\n\n\n            var customFields = [\n                {\n                    \"Key\": \"marketingOrigin\",\n                    \"Value\": marketingOrigin\n                },\n                {\n                    \"Key\":\"inviteURL\",\n                    \"Value\":inviteURL\n                }\n            ];\n\n            if (Meteor.userId() && typeof optResourceTitle !== \"undefined\"){\n                var invitingUser = Meteor.user();\n                customFields.push(\n                    {\n                        \"Key\":\"invitingUserName\",\n                        \"Value\": BuzzyGlobal.gGetUserName(invitingUser)\n                    },\n                    {\n                        \"Key\":\"resourceTitle\",\n                        \"Value\":optResourceTitle\n                    });\n            }\n\n            var email = BuzzyGlobal.gGetUserEmail(user);\n            var name = BuzzyGlobal.gGetUserName(user);\n            HTTP.call(\"POST\", \"https://api.createsend.com/api/v3.1/subscribers/96ffdadb00bc09a2f2c4a220aa3f0672.json\",\n                {\n                    auth:'75767a68d775a784aa271ae40d1e57c5:x',\n                    data:{\n                        \"EmailAddress\": email,\n                        \"Name\":name,\n                        \"CustomFields\": customFields,\n                        \"Resubscribe\": true,\n                        \"RestartSubscriptionBasedAutoresponders\": true\n                    }\n\n                },\n\n                function (error, result) {\n                    if (!error) {\n                        Users.update({_id:user._id},{$set:{dateUserInvited:new Date().getTime()}});\n                        return;\n                        //console.log(\"result.uri:\", result);\n                    } else {\n                        console.log(\"error:\" , error)\n                    }\n                }\n            );\n\n\n        }\n\n\n\n    },\n    removeFromInvitedList: function(){\n\n        if (!Meteor.userId()){\n            BuzzyGlobal.throwError(\"You need to be logged in to remove from Invited List\");\n        }\n        var user = Meteor.user();\n        var email = BuzzyGlobal.gGetUserEmail(user);\n\n\n        HTTP.call(\"POST\", \"https://api.createsend.com/api/v3.1/subscribers/96ffdadb00bc09a2f2c4a220aa3f0672/unsubscribe.json\",\n            {\n                auth:'75767a68d775a784aa271ae40d1e57c5:x',\n                data:{\n                    \"EmailAddress\": email\n\n                }\n\n            },\n            function (error, result) {\n                if (!error) {\n                    return;\n                    //console.log(\"result.uri:\", result);\n                } else {\n                    console.log(\"error:\" , error)\n                }\n            }\n        );\n\n    },\n    addToReferralList: function(email, marketingOrigin){\n\n\n        var customFields = [\n            {\n                \"Key\": \"marketingOrigin\",\n                \"Value\": marketingOrigin\n            }\n        ];\n\n        if (Meteor.userId()){\n            var invitingUser = Meteor.user();\n            customFields.push(\n                {\n                    \"Key\":\"invitingUserName\",\n                    \"Value\": BuzzyGlobal.gGetUserName(invitingUser)\n                },\n                {\n                    \"Key\":\"resinvitingUserEmail\",\n                    \"Value\":BuzzyGlobal.gGetUserEmail(invitingUser)\n                });\n        }\n\n        HTTP.call(\"POST\", \"https://api.createsend.com/api/v3.1/subscribers/2cdfee67b2999ec401320502b409d11f.json\",\n            {\n                auth:'75767a68d775a784aa271ae40d1e57c5:x',\n                data:{\n                    \"EmailAddress\": email,\n                    \"CustomFields\": customFields,\n                    \"Resubscribe\": true,\n                    \"RestartSubscriptionBasedAutoresponders\": true\n                }\n\n            },\n\n            function (error, result) {\n                if (!error) {\n                    return;\n                    //console.log(\"result.uri:\", result);\n                } else {\n                    console.log(\"error:\" , error)\n                }\n            }\n        );\n\n    },\n})","/**\n * Created by adamginsburg on 10/11/2014.\n */\nif (Meteor.isServer){\n    Meteor.startup(function () {\n\n        // causes crash Resources._ensureIndex({ path: 1, status:1,isStarterTemplate:1, updated:-1, readers:1, editors:1, owners:1, title:1});\n        Resources._ensureIndex({ path: 1, status:1,isStarterTemplate:1, updated:-1,  title:1});\n        //Resources._ensureIndex({ status:1, privacy:1, isStarterTemplate:1, reusable:-1,  userID:1});\n        Resources._ensureIndex({ status:1, privacy:1, isStarterTemplate:1, isBasic:-1,  userID:1});\n        Resources._ensureIndex({ path: 1, updated:-1, title:1});\n        Resources._ensureIndex({ path: 1, status:1});\n        Resources._ensureIndex({ special: 1, status:1});\n        Comments._ensureIndex({ resourceParentID: 1,submitted:-1});\n        Comments._ensureIndex({ resourceParentID: 1,submitted:1});\n        Comments._ensureIndex({ topLevelParentID: 1, submitted:-1});\n        Comments._ensureIndex({ topLevelParentID: 1,toUsers: 1, submitted:-1});\n        Comments._ensureIndex({ topLevelParentID: 1,toUsers: 1, status:1});\n        CommentsViewed._ensureIndex({userID:1, resourceID:1, commentID:1});\n        CommentsViewed._ensureIndex({commentID:1});\n\n        Notifications._ensureIndex({ forUserID: 1});\n        Notifications._ensureIndex({ forUserID: 1,  submitted: -1});\n\n        Notifications._ensureIndex({ forUserID: 1, \"activity.object.resource_button_id\":1, submitted:-1});\n\n        ResourceFollowers._ensureIndex({ userID: 1}, {submitted:-1});\n        ResourceFollowers._ensureIndex({ resourceID: 1});\n        ResourceFollowers._ensureIndex({ userID: 1});\n        UserContacts._ensureIndex({ userID: 1, contactID: 1, status:1});\n        UserContacts._ensureIndex({ contactID: 1, status:1});\n        UserContacts._ensureIndex({ contactID: 1});\n        Users._ensureIndex({ \"profile.email\": 1}); // probably need more here for Services\n        Users._ensureIndex({ \"profile.name\": 1}); // probably need more here for Services\n        ExternalData._ensureIndex({ \"userID\": 1}); // probably need more here for Services\n        MicroAppFields._ensureIndex({ \"parentResourceID\": 1}); // probably need more here for Services\n        MicroAppData._ensureIndex({ \"parentResourceID\": 1}); // probably need more here for Services\n        MicroAppData._ensureIndex({ \"parentResourceID\": 1, \"sortVal\": 1},{background:true}); // probably need more here for Services\n        MicroAppData._ensureIndex({ \"parentResourceID\": 1, \"sortVal\": -1},{background:true}); // probably need more here for Services\n        MicroAppData._ensureIndex({ \"parentResourceID\": 1, \"sortVal2\": 1},{background:true}); // probably need more here for Services\n        MicroAppData._ensureIndex({ \"parentResourceID\": 1, \"sortVal2\": -1},{background:true}); // probably need more here for Services\n        MicroAppData._ensureIndex({ \"parentResourceID\": 1, \"sortVal3\": 1},{background:true}); // probably need more here for Services\n        MicroAppData._ensureIndex({ \"parentResourceID\": 1, \"sortVal3\": -1},{background:true}); // probably need more here for Services\n        MicroAppData._ensureIndex({ \"parentResourceID\": 1, \"submitted\": 1},{background:true}); // probably need more here for Services\n        MicroAppData._ensureIndex({ \"parentResourceID\": 1, \"submitted\": -1},{background:true}); // probably need more here for Services\n       \n        MicroAppVotes._ensureIndex({ \"voteFieldID\": 1}); // probably need more here for Services\n        MicroAppChild._ensureIndex({parentAppItemID:1,parentAppFieldID:1}); // probably need more here for Services\n        TeamMembers._ensureIndex({teamID:1,userID:1, role:1}); // probably need more here for Services\n        TeamMembers._ensureIndex({teamID:1}); // probably need more here for Services\n        SamlProviders._ensureIndex({org:1}); // probably need more here for Services\n\n\n\n    })\n}\n","/**\n * Created by adamginsburg on 14/07/2016.\n */\n\nMeteor.methods({\n    createTeam: function (teamInfo) {\n        var user = Meteor.user();\n        if (!user){\n            BuzzyGlobal.throwError(\"User must be logged in!\");\n            return;\n        }\n        if (!teamInfo){\n            BuzzyGlobal.throwError(\"Invalid params\");\n            return;\n        }\n        var memberInfo = {\n            teamID: teamInfo._id,\n            userID: user._id,\n            role: BuzzyGlobal.gMEMBER_TYPE.ADMIN\n        }\n\n\n        Teams.insert(teamInfo,  function(error) {\n\n\n            if (error) {\n                // display the error to the user - Need to come back to fix 422 (not sure what # it should be???) as the error number\n                throw new Meteor.Error(422, error.reason);\n            } else {\n                TeamMembers.insert(memberInfo,  function(error) {\n\n                    if (error) {\n                        // display the error to the user - Need to come back to fix 422 (not sure what # it should be???) as the error number\n                        throw new Meteor.Error(422, error.reason);\n                    }\n                });\n            }\n        });\n\n\n    },\n    changeTeamName: function (teamID, newVal) {\n        check(teamID,String);\n        check(newVal,String);\n        if (!Meteor.userId() || !Teams.isAdmin(Meteor.userId(),teamID)){\n            BuzzyGlobal.throwError(\"Ooops! Sorry you're not allowed to do that!\");\n            return;\n        }\n\n        Teams.update({_id:teamID},{$set:{name:newVal}});\n\n    }\n});","/**\n * Created by adamginsburg on 14/07/2016.\n */\n\nMeteor.methods({\n    /*removeTeamMember: function (memberUserID, teamID) {\n        if (Meteor.userId() && Teams.isAdmin(Meteor.userId(),params._id)){\n            TeamMembers.remove({teamID:teamID,userID:memberUserID}, function (err) {\n                if (err){\n                    BuzzyGlobal.throwError(err.reason);\n                } else {\n                    Users.update({_id:subscription.userIDs[i]},{$set:{subscriptionID:newSubscription.id}});\n                }\n            });\n        } else {\n            BuzzyGlobal.throwError(\"Sorry! you don't have the rights to do that!\")\n        }\n\n    },*/\n    changeMemberRole: function (teamID,userID,newRole) {\n        if (! Teams.isAdmin(Meteor.userId(),teamID)){\n            BuzzyGlobal.throwError(\"Oops!!! You're not allowed to do that!\");\n            return;\n        };\n        var user = Users.findOne(userID);\n        if (!user){\n            BuzzyGlobal.throwError(\"User must be logged in!\");\n            return;\n        }\n        if (!newRole){\n            BuzzyGlobal.throwError(\"Invalid params\");\n            return;\n        }\n        // need to check use is manager\n        var teamMember = TeamMembers.findOne({teamID:teamID,userID:userID});\n        var adminCount = TeamMembers.find({teamID:teamID,role:BuzzyGlobal.gMEMBER_TYPE.ADMIN}).count();\n        if (teamMember ){\n            if (teamMember.role === BuzzyGlobal.gMEMBER_TYPE.ADMIN && adminCount === 1 ){\n                BuzzyGlobal.throwError(\"Ooops!!! You need to have at least one Adminstrator for a team. Change ignored.\")\n                return\n            }\n\n            TeamMembers.update({_id:teamMember._id}, {$set:{role:newRole}},  function(error) {\n\n                if (error) {\n                    // display the error to the user - Need to come back to fix 422 (not sure what # it should be???) as the error number\n                    BuzzyGlobal.throwError(error.reason);\n                } else {\n\n                }\n            });\n        }\n    },\n    addTeamMember: function (memberInfo) {\n        var user = Users.findOne(memberInfo.userID);\n        if (!user){\n            BuzzyGlobal.throwError(\"User must be logged in!\");\n            return;\n        }\n        if (!memberInfo){\n            BuzzyGlobal.throwError(\"Invalid params\");\n            return;\n        }\n        // need to check use is manager\n        var teamMember = TeamMembers.findOne({teamID:memberInfo.teamID,userID:memberInfo.userID});\n        if (teamMember){\n            memberInfo.role = teamMember.role;\n            TeamMembers.update({_id:teamMember._id}, {$set:memberInfo},  function(error) {\n\n                if (error) {\n                    // display the error to the user - Need to come back to fix 422 (not sure what # it should be???) as the error number\n                    BuzzyGlobal.throwError(error.reason);\n                } else {\n\n                }\n            });\n        } else {\n            TeamMembers.insert(memberInfo,  function(error) {\n\n                if (error) {\n                    // display the error to the user - Need to come back to fix 422 (not sure what # it should be???) as the error number\n                   BuzzyGlobal.throwError( error.reason);\n                }\n            });\n        }\n\n\n    }\n});","/**\n * Created by adamginsburg on 2/05/2016.\n */\nif (Meteor.isServer){\n    PaymentHistory = new Meteor.Collection('paymentHistory');\n    PaymentHistory.allow({\n        //update: Resources.ownsDocument\n        //update: Resources.ownsNotification,\n        insert: Meteor.user\n    });\n    Meteor.methods({\n        trackPayment: function(event){\n            //this.unblock();\n            console.log(\"INSIDE trackPayment\", event, \"userID:\" ,Meteor.userId())\n            if(!Meteor.userId()) {\n                console.log(\"trackPayment Error\", Meteor.userId())\n                throw new Meteor.Error(401, \"Unauthorized\");\n            }\n            var paymentData = {\n                _id: new Meteor.Collection.ObjectID()._str,\n                submitted:new Date().getTime(),\n                userID:Meteor.userId(),\n                event: event\n            }\n            PaymentHistory.insert(paymentData);\n\n        },\n\n    })\n}\n","/**\n * Created by adamginsburg on 20/11/2014.\n */\nif (Meteor.isServer){\n    Meteor.methods({\n        sendVerificationEmail: function(email){\n            Accounts.sendVerificationEmail(Meteor.userId(), email);\n        },\n        changeProfileImage: function(image){\n\n            if (!Meteor.userId()){\n                throw new Meteor.Error(422, \"You need to login!\");\n\n\n            };\n            if (!image){\n                throw new Meteor.Error(422, \"No Image Supplied\");\n\n\n            };\n\n            Users.update({_id:Meteor.userId()},{$set: {\"profile.profileImage\":image}}, function(err){\n                if (err){\n                    BuzzyGlobal.throwError(err);\n                }\n            })\n\n\n\n        },\n        setPassword: function(newPassword){\n\n            if (!Meteor.userId()){\n                throw new Meteor.Error(422, \"You need to login!\");\n\n\n            };\n            if (!newPassword){\n                throw new Meteor.Error(422, \"Password cannot be blank!\");\n\n\n            };\n\n            var emailAddress = BuzzyGlobal.gGetUserEmail(Meteor.user());\n            console.log(\"EMAIL ADDR:\" + emailAddress);\n            var user = Meteor.user();\n            if (typeof user.email === \"undefined\" || user.email === \"\"){\n                var emailObj = { address: emailAddress, verified: true };\n                Users.update({_id:Meteor.userId()},{$push:{emails:emailObj}})\n            }\n            Accounts.setPassword(Meteor.userId(), newPassword,{logout:false});\n\n\n        },\n        userIAcceptLicense: function(){\n\n\n            if (!Meteor.userId()){\n                throw new Meteor.Error(422, \"Issue finding user!\");\n\n\n            };\n\n            console.log(\"about to update acceptedLicense for user: \" + Meteor.userId())\n\n            Users.update({_id:Meteor.userId()},{$set:{acceptedLicense:true, dateLicenseAccepted:new Date().getTime()}},function(err){\n                if (err){\n                    throw new Meteor.Error(422, err);\n\n                }\n            }); // should push some log too\n            return;\n\n\n        },\n        userIDoNotAcceptLicense: function(){\n            var user = Meteor.user();\n\n            if (!user){\n                throw new Meteor.Error(422, \"Issue finding user!\");\n\n\n            };\n\n            Users.update({_id:Meteor.userId()},{$set:{acceptedLicense:false}},function(err){\n                if (err){\n                    throw new Meteor.Error(422, err);\n\n                }\n            }); // should push some log too\n            return;\n\n        },\n        userHasAcceptedLicense: function(){\n            var user = Meteor.user();\n\n            if (!user){\n                throw new Meteor.Error(422, \"Issue finding user!\");\n\n\n            };\n\n            if (typeof user.acceptedLicense != \"undefined\"){\n                return user.acceptedLicense;\n                /* if (typeof callback === \"function\") {\n                 // Call it, since we have confirmed it is callableâ€‹\n                 console.log(\"IN userHasAcceptedLicense: \" + user._id + \" accepted: \" + user.acceptedLicense);\n                 callback(user.acceptedLicense);\n                 } else {\n                 console.log(\"IN userHasAcceptedLicense NOT A FUNCTION: \" + user._id + \" accepted: \" + user.acceptedLicense);\n                 callback(user.acceptedLicense);\n                 }*/\n\n            } else {\n                return false;\n                /*console.log(\"IN userHasAcceptedLicense UNDEFINED: \" + user._id);\n                 if (typeof callback === \"function\") {\n                 // Call it, since we have confirmed it is callableâ€‹\n                 callback(false);\n                 }*/\n            }\n\n\n        },\n        userCompleteInitialSetup: function(){\n            var user = Meteor.user();\n\n            if (!user){\n                throw new Meteor.Error(422, \"Issue finding user!\");\n\n\n            };\n\n            Users.update({_id:Meteor.userId()},{$set:{completedSetup:true, dateInitialSetup:new Date().getTime()}},function(err){\n                if (err){\n                    throw new Meteor.Error(422, err);\n\n                }\n            }); // should push some log too\n            return;\n\n        },\n\n        userHasCompletedInitialSetup: function(optUserID){\n            var user;\n\n            if (typeof optUserID !== undefined && optUserID.length > 0){\n                user = Users.findOne({_id:optUserID});\n                if (!user){\n                    throw new Meteor.Error(422, \"Issue finding user!\");\n                };\n\n                if (typeof user.completedSetup != \"undefined\"){\n                    return user.completedSetup;\n\n\n                } else {\n                    return false;\n\n                }\n\n            } else {\n                user = Meteor.user();\n\n                if (!user){\n                    throw new Meteor.Error(422, \"Issue finding user!\");\n\n\n                };\n\n                if (typeof user.completedSetup != \"undefined\"){\n                    return user.completedSetup;\n\n\n                } else {\n                    return false;\n\n                }\n            }\n\n\n\n        },\n        inviteUser: function (userID, email, optResourceID, optCreateTemplateID, optUserToken) {\n            console.log(\"inviteUser:\", userID, email, optResourceID, optCreateTemplateID, optUserToken)\n            var user = BuzzyGlobal.getCurrentUser(optUserToken);\n\n            if (!user){\n                BuzzyGlobal.throwError(\"You do not have permission to do that\");\n            }\n\n            var resourceTitle = \"\";\n\n            if (email && !BuzzyGlobal.gGetUserforEmail(email)){\n                email = email.toLowerCase();\n                var userData =  {\n                    _id: userID,\n                    //profile:{name: 'Update Profile'},\n                    createdAt:new Date().getTime(),\n                    email: email,\n                    emails: [{ address: email, verified: false }],\n                    dateUserInvited:null,\n                    invitingResourceID: null,\n                    completedSetup: false,\n                    services:{\n                        password:{\n                            reset: {\n                                \"token\" : Random.secret(),\n                                \"email\" : email,\n                                \"when\" : new Date().getTime()\n                            }\n                        }\n                    },\n                    profile:{\n                        channels:\n                            [\n                                {\n                                    channel: \"email\",\n                                    address: email,\n                                    enabled: true\n                                }\n                            ]\n                    },\n\n\n                    //services:[]\n                };\n\n                if (typeof optResourceID !== \"undefined\" && optResourceID){\n                    userData.invitingResourceID = optResourceID;\n                    resourceTitle = Resources.findOne({_id:optResourceID}).title;\n                } else if(typeof optCreateTemplateID !== \"undefined\" && optCreateTemplateID) {\n                    userData.createTemplateID = optCreateTemplateID;\n\n                    var template = Resources.findOne({_id:optCreateTemplateID});\n                    if (template){\n                        resourceTitle = template.title;\n                    } else {\n                        BuzzyGlobal.throwError(\"Can't find template \" + optCreateTemplateID);\n                    }\n                }\n\n                if (Users.find({_id:userID}).count() === 0){\n                    Users.insert(\n                        userData,\n                        function(error) {\n\n\n                            if (error) {\n                                // display the error to the user - Need to come back to fix 422 (not sure what # it should be???) as the error number\n                                throw new Meteor.Error(422, error.reason);\n                            } else {\n                                BuzzyLogging.call(\"track\", {\n                                    action:\"createUser\",\n                                    \"userID\": userID,\n                                    \"dateCreated\": new Date().getTime(),\n                                    \"source\": \"invited\"\n                                }, Meteor.settings.BUZZY_LOGGING_TOKEN);\n\n                             \n\n                                var inviteURL;\n                                if (userData.invitingResourceID){\n                                    inviteURL = Meteor.absoluteUrl('regopassword/1/?token=' + userData.services.password.reset.token + \"&top=\" + userData.invitingResourceID + \"&sub=\" + userData.invitingResourceID + \"&user=\" + userData._id);\n                                } else if (userData.createTemplateID){\n                                    inviteURL = Meteor.absoluteUrl('regopassword/1/?token=' + userData.services.password.reset.token + \"&template=\" + userData.createTemplateID  + \"&user=\" + userData._id);\n                                } else {\n                                    inviteURL = Meteor.absoluteUrl('regopassword/1/?token=' + userData.services.password.reset.token + \"&user=\" + userData._id);\n                                }\n\n                                // MOVING to resourceNOTIFICATION Meteor.call(\"addToInvitedList\",userID, \"testOrigin\", inviteURL, resourceTitle)\n                                if (user){\n                                    Meteor.call(\"addContact\", userID, BuzzyGlobal.gUSERSTATUS.ACTIVE, email, optUserToken)\n                                }\n                            }\n                        });\n                    return;\n\n                } else {\n                    BuzzyGlobal.throwError(\"Error creating user for ID: \" + userID);\n                }\n\n            } else {\n                console.log(\"invite user, email not valid for \" + email);\n                BuzzyGlobal.throwError(\"invite user, email not valid for \" + email);\n            }\n\n\n\n\n\n        },\n        approveContact: function(contactID) {\n\n\n            // ensure the user is logged in\n            if (!Meteor.user())\n                throw new Meteor.Error(401, \"You need to login to approve contacts\");\n\n            var contact = Users.findOne({_id:contactID});\n\n            if (!contact)\n                throw new Meteor.Error(401, \"contact not found\");\n            //console.log(this.userId  + \" inside  approve contact for: \" + contactID);\n            var contactRecord = UserContacts.findOne({$and:[{userID:contactID},{contactID:this.userId}]});\n\n            if (contactRecord){\n\n                //console.log(\"about to update  contact:\" + contactID + \" status:\" + contactRecord.status);\n\n                var userContact = UserContacts.update({_id:contactRecord._id},{$set:{status:BuzzyGlobal.gUSERSTATUS.ACTIVE}}, function(error){\n                    if (error){\n                        throw new Meteor.Error(422, error.reason);\n                    } else {\n                        Meteor.call(\"addContact\", contactID, BuzzyGlobal.gUSERSTATUS.ACTIVE, function(err){\n                            if (err){\n                                throw new Meteor.Error(401, \"Error adding contact\");\n                            }\n                        });\n                    }\n                });\n\n\n            }\n\n\n            return true;\n        },\n        denyContact: function(contactID) {\n\n\n            // ensure the user is logged in\n            if (!Meteor.user())\n                throw new Meteor.Error(401, \"You need to login to deny contacts\");\n\n            var contact = Users.findOne({_id:contactID});\n\n            if (!contact)\n                throw new Meteor.Error(401, \"contact not found\");\n            //console.log(this.userId  + \" inside  deny contact for: \" + contactID);\n            var contactRecord = UserContacts.findOne({$and:[{userID:contactID},{contactID:this.userId}]});\n\n            if (contactRecord){\n\n                //console.log(\"about to deny  contact:\" + contactID + \" status:\" + contactRecord.status);\n\n                var userContact = UserContacts.remove({_id:contactRecord._id}, function(error){\n                    if (error){\n                        throw new Meteor.Error(422, error.reason);\n                    }\n                });\n\n\n            }\n\n\n            return true;\n        },\n        removeContact: function(userContactID) {\n\n\n            // ensure the user is logged in\n            if (!Meteor.user())\n                throw new Meteor.Error(401, \"You need to login to approve contacts\");\n\n\n\n            if (userContactID){\n\n\n\n                var userContact = UserContacts.remove({_id:userContactID}, function(error){\n                    if (error){\n                        throw new Meteor.Error(422, error.reason);\n                    }\n                });\n\n\n            }\n\n\n            return true;\n        },\n        addContact: function(contactID, status, email,optUserToken) {\n\n            var user = BuzzyGlobal.getCurrentUser(optUserToken);\n\n            if (!user){\n                BuzzyGlobal.throwError(\"You do not have permission to do that\");\n            }\n\n            var contact = Users.findOne({_id:contactID});\n\n            if (!contact)\n                throw new Meteor.Error(401, \"contact not found\");\n            var userContact = UserContacts.findOne({$and:[{userID:user._id},{contactID:contactID}]});\n\n            var tempEmail = \"\";\n            if (typeof email !== \"undefined\"){\n                tempEmail = email;\n            }\n\n            if (!userContact){\n\n                //console.log(\"about to insert new contact:\" + contactID);\n                var userContact =  {\n                    userID: user._id,\n                    email:tempEmail,\n                    name:BuzzyGlobal.gGetUserName(contact),\n                    contactID: contactID,\n                    status: status ,\n                    submitted: new Date().getTime()\n                };\n\n                var userContact = UserContacts.insert(userContact, function(error){\n                    if (error){\n                        throw new Meteor.Error(422, error.reason);\n                    }\n                });\n\n\n            } else {\n                //console.log(\"about to update existing user contact ID:\" + userContact._id);\n                UserContacts.update({_id:userContact._id},{$set:{status:BuzzyGlobal.gUSERSTATUS.ACTIVE}}, function(error){\n                    if (error){\n                        throw new Meteor.Error(422, error.reason);\n                    }\n                });\n\n            }\n\n            console.log(\"About to return\");\n            return;\n        },\n        addNewUser: function(currentResourceID, addedEmail, field, optUserToken){\n            var resource = Resources.findOne({_id:currentResourceID});\n            var user = BuzzyGlobal.getCurrentUser(optUserToken);\n\n            if (!user){\n                BuzzyGlobal.throwError(\"You do not have permission to do that\");\n            }\n            if (!resource || !Resources.canEdit(user._id,resource)){\n                throw new Meteor.Error(422, \"User does not have rights to add users\");\n            }\n            var newParticipant = BuzzyGlobal.gGetUserforEmail(addedEmail);\n\n\n            if (newParticipant) {\n                if (resource.owners.indexOf(newParticipant._id) !== -1) {\n                    return;\n                }\n\n\n                var participants;\n                //var currentResource = Resources.findOne(currentResourceID);\n\n                switch(field){\n                    case 'addReader':\n\n                        participants = resource.readers;\n                        break;\n                    case 'addEditor':\n                        participants = resource.editors;\n                        break;\n                    case 'addOwner':\n                        participants = resource.owners;\n                        break;\n                    default:\n                        throw new Meteor.Error(500, \"Invalid Field\");\n\n                }\n\n                if (participants.indexOf(newParticipant._id) === -1) {\n                    Meteor.call(field, currentResourceID, newParticipant._id,optUserToken, function (error, id) {\n                        //console.log(\"back from \" + field )\n                        if (error) {\n                            // display the error to the user\n                            throw new Meteor.Error(500, error.reason);\n                        } else {\n                            if (resource.status === BuzzyGlobal.gRESOURCE_STATUS.PUBLISHED){\n                                Meteor.call(\"addFollower\", currentResourceID,newParticipant._id,optUserToken);\n\n                            };\n\n                            Meteor.call('addContact', newParticipant._id, BuzzyGlobal.gUSERSTATUS.ACTIVE,null,optUserToken, function(err){\n                                if (err){\n                                    throw new Meteor.Error(500, err);\n                                } else {\n\n                                    return;\n\n                                }\n                            });\n\n                        }\n\n                    });\n                }\n            }  else {\n\n                var newID = new Meteor.Collection.ObjectID()._str;\n                Meteor.call(\"inviteUser\", newID, addedEmail,currentResourceID, null, optUserToken,function(error, id) {\n                    if (error) {\n                        // display the error to the user\n                        //throw new Meteor.Error(422, error.reason);\n                        console.log(error)\n                        BuzzyGlobal.throwError(error)\n                    } else {\n                        console.log(field, currentResourceID, newID, null, optUserToken);\n                        Meteor.call(field, currentResourceID, newID, null, optUserToken, function (error, id) {\n                            if (error) {\n                                // display the error to the user\n                                throw new Meteor.Error(422, error.reason);\n                            } else {\n                                Meteor.call('addContact', newID, BuzzyGlobal.gUSERSTATUS.ACTIVE,addedEmail, optUserToken, function(err){\n                                    if (err){\n\n                                        BuzzyGlobal.throwError(error)\n                                    } else {\n                                        if (resource.status === BuzzyGlobal.gRESOURCE_STATUS.PUBLISHED){\n                                            Meteor.call(\"addFollower\", currentResourceID,newID, optUserToken);\n\n                                        };\n                                        return;\n                                    }\n                                });\n                            }\n                        });\n\n                    }\n                });\n\n            }\n        },\n        addNewFollower: function(currentResourceID, addedEmail, field, optUserToken){\n            var resource = Resources.findOne({_id:currentResourceID});\n            var user = BuzzyGlobal.getCurrentUser(optUserToken);\n\n            if (!user){\n                BuzzyGlobal.throwError(\"You do not have permission to do that\");\n            }\n            if (!resource || !Resources.canEdit(user._id,resource)){\n                throw new Meteor.Error(422, \"User does not have rights to add users\");\n            }\n            var newParticipant = BuzzyGlobal.gGetUserforEmail(addedEmail);\n\n\n            if (newParticipant) {\n                Meteor.call(\"addFollower\", currentResourceID,newParticipant._id,optUserToken);\n\n            }  else {\n\n                var newID = new Meteor.Collection.ObjectID()._str;\n                Meteor.call(\"inviteUser\", newID, addedEmail,currentResourceID, null, optUserToken,function(error, id) {\n                    if (error) {\n                        // display the error to the user\n                        //throw new Meteor.Error(422, error.reason);\n                        console.log(error)\n                        BuzzyGlobal.throwError(error)\n                    } else {\n                        Meteor.call(\"addFollower\", currentResourceID,newID, optUserToken);\n                        //SHOULD send notification if published\n\n                    }\n                });\n\n            }\n        },\n        updateProfile: function(field, value){\n\n            var user = Meteor.user();\n            // ensure the user is logged in\n            if (!user)\n                throw new Meteor.Error(401, \"User must be logged into change profile.\");\n\n            var obj = {};\n            obj[\"profile.\" + field] = value;\n\n            Users.update({_id:user._id},{$set:obj},function(error){\n                if (error) {\n                    // display the error to the user\n                    throw new Meteor.Error(422, error.reason);\n                }\n\n            })\n\n        },\n        updateUserStripe: function(field, value){\n\n            var user = Meteor.user();\n            // ensure the user is logged in\n            if (!user)\n                throw new Meteor.Error(401, \"User must be logged into change profile.\");\n\n            var obj = {};\n            obj[\"stripeInfo.\" + field] = value;\n\n            Users.update({_id:user._id},{$set:obj},function(error){\n                if (error) {\n                    // display the error to the user\n                    throw new Meteor.Error(422, error.reason);\n                }\n\n            })\n\n        },\n        removeStripeAccountInfo: function(){\n\n            var user = Meteor.user();\n            // ensure the user is logged in\n            if (!user){\n                throw new Meteor.Error(401, \"User must be logged into change profile.\");\n            } else {\n                Users.update({_id:user._id},{$set:{stripeInfo:null}},function(error){\n                    if (error) {\n                        // display the error to the user\n                        throw new Meteor.Error(422, error.reason);\n                    }\n\n                })\n            }\n\n\n\n\n\n        },\n        updateUserNotifications: function(action, channel, address){\n            var user = Meteor.user();\n            // ensure the user is logged in\n            if (!user)\n                throw new Meteor.Error(401, \"User must be logged into change profile.\");\n\n            if (action === BuzzyGlobal.gNOTIFICATION_ACTIONS.ADD){\n                if (typeof user.profile.channels === \"undefined\"){\n                    Users.update({_id:user._id},{$set:{\"profile.channels\":[{channel: channel, address:address,enabled:true}]}},function(error){\n                        if (error) {\n                            // display the error to the user\n                            throw new Meteor.Error(422, error.reason);\n                        }\n\n                    });\n                } else{\n                    var found = false;\n                    var i = 0;\n                    while (i < user.profile.channels.length && !found){\n                        if (user.profile.channels[i].channel === channel && user.profile.channels[i].address === address){\n                            found = true;\n                            Users.update({_id:user._id},{$pull:{\"profile.channels\":{channel: channel, address:address}}},function(error){\n                                if (error) {\n                                    // display the error to the user\n                                    throw new Meteor.Error(422, error.reason);\n                                } else {\n                                    Users.update({_id:user._id},{$push:{\"profile.channels\":{channel: channel, address:address,enabled:true}}},function(error){\n                                        if (error) {\n                                            // display the error to the user\n                                            throw new Meteor.Error(422, error.reason);\n                                        }\n\n                                    });\n                                }\n\n                            });\n\n                        }\n                        i++;\n                    }\n\n                    if (!found){\n                        Users.update({_id:user._id},{$push:{\"profile.channels\":{channel: channel, address:address,enabled:true}}},function(error){\n                            if (error) {\n                                // display the error to the user\n                                throw new Meteor.Error(422, error.reason);\n                            }\n\n                        });\n                    }\n\n\n                }\n\n            } else if (action === BuzzyGlobal.gNOTIFICATION_ACTIONS.REMOVE){\n\n                if (typeof user.profile.channels !== \"undefined\"){\n                    Users.update({_id:user._id},{$pull:{\"profile.channels\":{channel: channel, address:address}}},function(error){\n                        if (error) {\n                            // display the error to the user\n                            throw new Meteor.Error(422, error.reason);\n                        } else {\n                            Users.update({_id:user._id},{$push:{\"profile.channels\":{channel: channel, address:address,enabled:false}}},function(error){\n                                if (error) {\n                                    // display the error to the user\n                                    throw new Meteor.Error(422, error.reason);\n                                }\n\n                            });\n                        }\n\n                    });\n                }\n            }\n\n        },\n        addNewUserEmail: function(email){\n            var user = Meteor.user();\n            if (typeof user.emails !== \"undefined\"){\n                var otherUsers = BuzzyGlobal.gGetUserforEmail(email);\n                if (otherUsers){\n                    throw new Meteor.Error(422, \"Email address is already used.\");\n                    //should change to callback to can let user know of error\n                }\n                Users.update({_id:user._id},{$push:{\"emails\":{address:email, verified:false}}},function(error){\n                    if (error) {\n                        // display the error to the user\n                        throw new Meteor.Error(422, error.reason);\n                    } else {\n                        Meteor.call(\"updateUserNotifications\", BuzzyGlobal.gNOTIFICATION_ACTIONS.ADD, BuzzyGlobal.gNOTIFICATION_CHANNEL.EMAIL,email);\n                    }\n\n                });\n            } else {\n                console.log(\"UNDEFINED\", typeof user.emails, user);\n            }\n\n        },\n\n\n\n\n        /*updateProfileNotifications: function(notificationSetting){\n\n         var user = Meteor.user();\n         // ensure the user is logged in\n         if (!user)\n         throw new Meteor.Error(401, \"User must be logged into change profile.\");\n\n         var obj = {};\n         if (typeof user.notification != \"undefined\"){\n\n         if (user.notification.indexOf[notificationSetting.target] >= 0){\n         //exist, so replace\n\n         var newNotification = user.notification;\n         newNotification[notificationSetting.target] = notificationSetting;\n         Users.update({_id:user._id},{$set:{\"profile.notification\":newNotification}},function(error){\n         if (error) {\n         // display the error to the user\n         throw new Meteor.Error(422, error.reason);\n         }\n\n         })\n\n\n         } else {\n         // does not exists, so push\n         Users.update({_id:user._id},{$push:{\"profile.notification\":notificationSetting}},function(error){\n         if (error) {\n         // display the error to the user\n         throw new Meteor.Error(422, error.reason);\n         }\n\n         })\n\n         }\n\n\n         } else {\n         // first notification, so update/create\n         Users.update({_id:user._id},{$set:{\"profile.notification\":[notificationSetting]}},function(error){\n         if (error) {\n         // display the error to the user\n         throw new Meteor.Error(422, error.reason);\n         }\n\n         })\n\n         }\n\n\n         },*/\n        resendEnrollment: function(userID){\n\n            var user = Users.findOne({_id:userID});\n\n            if (user){\n                var email = BuzzyGlobal.gGetUserEmail(user);\n                var userData =  {\n\n                    services:{\n                        password:{\n                            reset: {\n                                \"token\" : Random.secret(),\n                                \"email\" : email,\n                                \"when\" : new Date().getTime()\n                            }\n                        }\n                    }\n\n                };\n\n                Users.update({_id:userID},{$set:userData}, function(err){\n                    if (err){\n                        BuzzyGlobal.throwError(err);\n                    } else {\n                        try{\n\n                            var createTemplateID;\n                            var emailTemplate = 'activationEmail';\n                            if (Meteor.userId() && (Meteor.userId() !== userID) ){\n                                emailTemplate = 'inviteEmail';\n                            }\n\n\n\n                            var result = Mailer.send({\n                                to:  email,           // 'To: ' address. Required.\n                                subject: \"[Buzzy] Please activate your account.\",\n                                //template: 'templateName',               // Required.\n                                template: emailTemplate,               // Required.\n                                replyTo: 'donotreply@buzzy.buzz',       // Override global 'ReplyTo: ' option.\n                                from: \"Do Not Reply\" + \"<donotreply@buzzy.buzz>\",         // Override global 'From: ' option.\n                                data: {\n                                    token: userData.services.password.reset.token,\n                                    fromUserID: Meteor.userId()\n\n                                }\n                            });\n\n                        } catch (err){\n                            BuzzyGlobal.throwError(err)\n                        }\n                    }\n                });\n\n\n\n\n            }\n\n\n\n        },\n        sendEnrollmentEmail: function(userID, optCreateTemplateID, optRegoTop){\n            try{\n                var user = Users.findOne(userID);\n                if (!user){\n                    BuzzyGlobal.throwError(\"User Not found - can't send enrollment email\");\n                }\n                var email = BuzzyGlobal.gGetUserEmail(user);\n                var result = Mailer.send({\n                    to:  email,           // 'To: ' address. Required.\n                    subject: \"[Buzzy] Please activate your account.\",\n                    //template: 'templateName',               // Required.\n                    template: 'activationEmail',               // Required.\n                    replyTo: 'donotreply@buzzy.buzz',       // Override global 'ReplyTo: ' option.\n                    from: \"Do Not Reply\" + \"<donotreply@buzzy.buzz>\",         // Override global 'From: ' option.\n                    data: {\n                        token: user.services.password.reset.token,\n                        createTemplateID: optCreateTemplateID,\n                        invitingResourceID: optRegoTop,\n                        fromUserID: user._id\n\n                    }\n                });\n\n                Meteor.call(\"addToInvitedList\",userID, \"testOrigin\");\n\n\n            } catch (err){\n                BuzzyGlobal.throwError(err)\n            }\n        },\n        userExists: function(email){\n            /* if (typeof callback === \"function\") {\n             // Call it, since we have confirmed it is callableâ€‹\n             console.log(\"IN userHasAcceptedLicense: \" + user._id + \" accepted: \" + user.acceptedLicense);\n             callback(user.acceptedLicense);\n             } else {\n             console.log(\"IN userHasAcceptedLicense NOT A FUNCTION: \" + user._id + \" accepted: \" + user.acceptedLicense);\n             callback(user.acceptedLicense);\n             }*/\n            var user = Users.findOne({$or:[{\"emails.address\":email},{email:email}]});\n            if (user){\n\n                return user._id;\n            } else {\n                return false;\n            }\n\n\n\n        },\n        addToHistory: function(resourceID){\n            if (Meteor.userId()){\n                Users.addToHistory(resourceID);\n            }\n\n        },\n        addFavorite: function(resourceID){\n            if (Meteor.userId()){\n                Users.addFavorite(resourceID);\n            }\n\n        },\n        removeFavorite: function(resourceID){\n            if (Meteor.userId()){\n                Users.removeFavorite(resourceID);\n            }\n\n        },\n        clearHistory: function(){\n            if (Meteor.userId()){\n                Users.clearHistory();\n            }\n\n        },\n        postRegisterEmail: function (registeredEmail, createTemplateID){\n            var regex = new RegExp('^' + BuzzyGlobal.REGEX_EMAIL + '$', 'i');\n            var match = registeredEmail.match(regex);\n            if (match){\n                //console.log(\"Meteor.call('userExists',registeredEmail )\", Meteor.call(\"userExists\",registeredEmail ));\n                Meteor.call(\"userExists\",registeredEmail, function(error, result){\n\n                    if (result){\n                        //BuzzyGlobal.throwError(\"Email address is already a registered or invited user, please Sign In/Reset Password instead.\");\n                        Meteor.call(\"resendEnrollment\", result);\n\n\n                    } else if (result === false) {\n                        var newID = new Meteor.Collection.ObjectID()._str;\n\n                        Meteor.call(\"inviteUser\", newID, registeredEmail,null,createTemplateID, null,function(error, id) {\n                            if (error) {\n                                // display the error to the user\n                                throw new Meteor.Error(422, error.reason);\n                            } else {\n                                BuzzyLogging.call(\"registerWithEmail\", {\n                                    userID: newID,\n                                    email:registeredEmail\n                                });\n                                analytics.identify(newID);\n\n                                analytics.track(\n                                    \"registerWithEmail\",\n                                    {\n                                        userID: newID,\n                                        email:registeredEmail\n\n                                    }, function(){\n                                        return;\n                                    }\n                                );\n                                Meteor.call(\"sendEnrollmentEmail\", newID, createTemplateID);\n\n\n\n                            }\n                        });\n                    }\n                })\n\n\n            } else {\n                BuzzyGlobal.throwError(\"Please enter a valid email address\")\n            };\n        },\n        \"getUserByToken\": function(loginToken) {\n            var hashedToken = loginToken && Accounts._hashLoginToken(loginToken);\n            var selector = {'services.resume.loginTokens.hashedToken': hashedToken};\n            var options = {fields: {_id: 1}};\n\n            var user = Meteor.users.findOne(selector, options);\n            return (user)? user._id : null;\n        },\n        userAddWatsonCredential: function (optUserToken) {\n\n            var user = BuzzyGlobal.getCurrentUser(optUserToken);\n\n            if (user) {\n                const newCred = {\n                    _id:new Meteor.Collection.ObjectID()._str,\n                    watsonAtID: '',\n                    watsonUserID: '',\n                    watsonPassword: '',\n                    watsonWorkspaceID: '',\n\n                }\n                var watsonCreds = user.watsonCreds;\n                if (watsonCreds) {\n                    watsonCreds.push(newCred);\n\n                } else {\n                    watsonCreds = [newCred];\n                }\n                Users.update({_id: user._id},\n                    {$set: {watsonCreds:watsonCreds}},\n\n                    function (error) {\n\n\n                        if (error) {\n                            // display the error to the user - Need to come back to fix 422 (not sure what # it should be???) as the error number\n                            throw new Meteor.Error(422, error.reason);\n                        } else {\n                            console.log('added Watson  User Creds',watsonCreds);\n                        }\n                    });\n\n\n            }\n        },\n        userUpdateWatsonCredentials: function ( watsonItemID, creds, optUserToken) {\n            check(watsonItemID, String);\n            check(creds, Object);\n            var user = BuzzyGlobal.getCurrentUser(optUserToken);\n\n            if (user ) {\n                Users.update({_id: user._id, \"watsonCreds._id\":watsonItemID},\n                    {$set: {\"watsonCreds.$\":creds}},\n\n                    function (error) {\n\n\n                        if (error) {\n                            // display the error to the user - Need to come back to fix 422 (not sure what # it should be???) as the error number\n                            throw new Meteor.Error(422, error.reason);\n                        } else {\n                            console.log('updated Watson Creds',creds);\n                        }\n                    });\n\n            }\n        },\n        userRemoveWatsonCredentials: function ( watsonItemID, optUserToken) {\n            check(watsonItemID, String);\n            var user = BuzzyGlobal.getCurrentUser(optUserToken);\n\n            if (user ) {\n                Users.update({_id: user._id, \"watsonCreds._id\":watsonItemID},\n                    {$pull: {\"watsonCreds\":{_id:watsonItemID}}},\n\n                    function (error) {\n\n\n                        if (error) {\n                            // display the error to the user - Need to come back to fix 422 (not sure what # it should be???) as the error number\n                            throw new Meteor.Error(422, error.reason);\n                        } else {\n                            console.log('pull Watson Creds',watsonItemID);\n                        }\n                    });\n\n            }\n        }\n\n    });\n\n}\n"]}